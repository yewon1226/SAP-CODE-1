## <  핵심 개념 >
</br>

- **1) `module pool program` 생성 방법 ( 일반 프로그램 생성 방법에서 include 파일 포함 )**
- **2) 모듈풀 프로그램은 무조건 `TCODE` 생성해야 함**

</br>

---

</br>

## < ABAP Expressions(표현식) 기본 개념 정리 >
</br>

### 1) replace
- 문자열에서 지정한 부분(sub)을 다른 문자열(with)로 바꾼 새 문자열을 반환하는 문자열 처리 함수
- 대소문자 구분 여부를 case 옵션으로 제어 가능
```abap
RESULT = replace(
           val  = <원본문자열>
           sub  = <찾을문자열>
           case = abap_false   " 대소문자 구분 안 함 (abap_true면 구분)
           with = <바꿀문자열>
         ).
```
</br>
</br>

### 2) 문자열 연결 (Concatenation)
- 여러 문자열을 하나로 이어서 새 문자열을 만듦
```abap
*************** 기존 방식 ****************
CONCATENATE gv_var1 gv_var2
  INTO gv_result
  SEPARATED BY <sep>.

*************** 최신 방식 ****************
gv_result = gv_var1 && gv_var2.
```
</br>
</br>

### 3) 문자열 템플릿 (String Templates)
- 문자열 안에 변수나 표현식을 직접 삽입해 새 문자열을 만듦
```abap
*************** 기존 방식 ****************
DATA gv_string TYPE string.
gv_string = |Hello World|.

*************** 최신 방식 ****************
DATA gv_string TYPE string.
PARAMETERS pa_name TYPE string.
gv_string = |Hello { pa_name }|.
```
</br>

**ABAP 문자열 처리(Expression) 함수 목록** 


| 구분 | 함수명 | 한줄 설명 |
|----|-------|---------|
| 비교 | `distance` | 두 문자열 간의 차이(편집 거리)를 계산 |
| 공백 | `condense` | 문자열 내 불필요한 공백을 제거 |
| 결합 | `concat_lines_of` | 내부테이블 여러 줄을 하나의 문자열로 결합 |
| 변환 | `escape` | 특수문자를 이스케이프 처리 |
| 검색 | `find` | 문자열에서 특정 문자열 위치 검색 |
| 검색 | `find_end` | 문자열 끝 기준으로 문자열 검색 |
| 검색 | `find_any_of` | 지정 문자 집합 중 하나라도 포함된 위치 검색 |
| 검색 | `find_any_not_of` | 지정 문자 집합에 속하지 않는 문자 위치 검색 |
| 삽입 | `insert` | 문자열의 특정 위치에 문자열 삽입 |
| 반복 | `repeat` | 문자열을 지정한 횟수만큼 반복 |
| 치환 | `replace` | 문자열의 특정 부분을 다른 문자열로 치환 |
| 변환 | `reverse` | 문자열을 거꾸로 뒤집음 |
| 추출 | `segment` | 문자열의 특정 구간 추출 |
| 정렬 | `shift_left` | 문자열을 왼쪽으로 이동 (공백 제거 가능) |
| 정렬 | `shift_right` | 문자열을 오른쪽으로 이동 |
| 추출 | `substring` | 문자열의 일부 추출 |
| 추출 | `substring_from` | 지정 위치부터 끝까지 문자열 추출 |
| 추출 | `substring_before` | 특정 문자열 이전 부분 추출 |
| 추출 | `substring_after` | 특정 문자열 이후 부분 추출 |
| 추출 | `substring_to` | 시작부터 지정 위치까지 문자열 추출 |
| 대소문자 | `to_upper` | 문자열을 대문자로 변환 |
| 대소문자 | `to_lower` | 문자열을 소문자로 변환 |
| 대소문자 | `to_mixed` | 문자열을 혼합 대소문자 형식으로 변환 |
| 대소문자 | `from_mixed` | 혼합 대소문자를 일반 문자열로 변환 |
| 변환 | `translate` | 특정 문자들을 다른 문자로 일괄 변환 |
| 비교 | `matches` | 문자열이 패턴과 일치하는지 확인 |
| 비교 | `contains` | 문자열에 특정 문자열 포함 여부 확인 |
</br>

**ABAP 문자열 처리 함수 공통 파라미터 (Standard Arguments)**

| 파라미터 | 의미 | 설명 |
|--------|----|----|
| `val` | 대상 문자열 | 처리할 원본 문자열 |
| `sub` | 부분 문자열 | 찾거나(replace/find) 치환할 문자열 |
| `case` | 대소문자 구분 | 대소문자 구분 여부 (`abap_true` / `abap_false`) |
| `occ` | 발생 횟수 | 몇 번째 발생 위치를 대상으로 할지 지정 |
| `off` | 오프셋 | 문자열 내 시작 위치 |
| `len` | 길이 | 처리할 문자열 길이 |
| `regex` | 정규식 | 찾기·치환·매칭에 사용할 정규 표현식 |

</br>
</br>

### 4) SET COUNTRY / DATE FORMAT
- 국가(로케일) 기준에 맞게 날짜·숫자 등의 출력 형식을 설정하는 환경 설정 명령
```abap
SET COUNTRY 'US'.
SET DATE FORMAT 'ENVIRONMENT'.
```
</br>
</br>

### 5) ABAP Inline Data Declarations 정리
- 변수를 미리 선언하지 않고, 사용하는 위치에서 DATA( )로 바로 선언하는 ABAP 최신 문법
- Inline DATA는 타입을 추론할 수 있는 위치에서만 가능. 일반 대입문에서는 불가능.
- `IMPORTING` , `RECEIVING` , `INTO` , `CATCH` 처럼값을 받는 쪽 에서만 가능
```abap
*************** INTO 구문 ****************
LOOP AT gt_itab INTO DATA(gs_line).
READ TABLE gt_itab INTO DATA(gs_line).
SELECT * FROM sflight INTO TABLE DATA(gt_tab).

*************** ASSIGNING 구문 ****************
LOOP AT gt_itab ASSIGNING FIELD-SYMBOL(<fs>).
READ TABLE gt_itab ASSIGNING FIELD-SYMBOL(<fs>).

*************** 메서드 파라미터 ****************
CALL METHOD obj->method
  IMPORTING ev_value = DATA(lv_val).

*************** 예외 처리 ****************
TRY.
  " 로직
CATCH cx_root INTO DATA(lo_exc).
ENDTRY.
```
```abap
*************** 예외 처리 ****************
DATA gx_excp TYPE REF TO cx_sy_move_cast_error.           " 기존 방식
TRY.
  go_oref2 ?= go_oref1.
CATCH cx_sy_move_cast_error INTO gx_excp.
ENDTRY.

TRY.
  go_oref2 ?= go_oref1.
CATCH cx_sy_move_cast_error INTO DATA(gx_excp).           " 최신 방식
ENDTRY.

*************** 내부테이블 + Work Area (LOOP) ****************
DATA gs_line TYPE LINE OF gt_itab.            " 기존 방식
LOOP AT gt_itab INTO gs_line.
  " 로직
ENDLOOP.

LOOP AT gt_itab INTO DATA(gs_line).           " 최신 방식
  " 로직
ENDLOOP.

*************** 내부테이블 + Work Area (READ) ****************
DATA gs_line TYPE LINE OF gt_itab.
READ TABLE gt_itab INTO gs_line INDEX n.                 " 기존 방식

READ TABLE gt_itab INTO DATA(gs_line) INDEX n.           " 최신 방식

*************** 메서드 IMPORTING 파라미터 ****************
DATA go_alv TYPE REF TO cl_salv_table.           " 기존 방식
cl_salv_table=>factory(
  IMPORTING
    r_salv_table = go_alv
  CHANGING
    t_table      = gt_data
).

cl_salv_table=>factory(
  IMPORTING
    r_salv_table = DATA(go_alv)                  " 최신 방식
  CHANGING
    t_table      = gt_data
).

*************** 필드심볼 LOOP ****************
FIELD-SYMBOLS <line> TYPE LINE OF gt_itab.                 " 기존 방식
LOOP AT gt_itab ASSIGNING <line>.
  " 로직
ENDLOOP.

LOOP AT gt_itab ASSIGNING FIELD-SYMBOL(<line>).           " 최신 방식
  " 로직
ENDLOOP.

*************** 필드심볼 READ ****************
FIELD-SYMBOLS <line> TYPE LINE OF gt_itab.
READ TABLE gt_itab ASSIGNING <line> INDEX n.                         " 기존 방식

READ TABLE gt_itab ASSIGNING FIELD-SYMBOL(<line>) INDEX n.           " 최신 방식
```
</br>
</br>


---

</br>

## < 실습 코드 >
</br>

### 실습 1
- 엑셀 업로드 연습
```abap
REPORT ZBC400_B03_PRACTICE13.

TYPES: BEGIN OF ts_data,
        ID(20),
        NAME(20),
        AGE(20),
        ADDRESS(20),
       END OF ts_data.


PARAMETERS: pa_file TYPE localfile.
DATA: gt_filename TYPE filetable,
      gv_rc TYPE I,
      gt_excel_data TYPE TABLE OF alsmex_tabline.
DATA: gt_data TYPE TABLE OF ts_data,
      gs_data LIKE LINE OF gt_data.
FIELD-SYMBOLS: <fs> TYPE ANY.
CONSTANTS gc_filters TYPE string VALUE 'EXCEL FILES (*.XLSX)|*.XLSX|EXCEL FILES (*.XLS)|*.XLS|'.

AT SELECTION-SCREEN ON VALUE-REQUEST FOR pa_file.
  cl_gui_frontend_services=>file_open_dialog(
    EXPORTING
      window_title            = '파일찾기'                 " Title Of File Open Dialog
      default_filename        = space                 " Default File Name
      file_filter             = gc_filters                 " File Extension Filter String
      initial_directory       = 'C:'                 " Initial Directory
    CHANGING
      file_table              = gt_filename                 " Table Holding Selected Files
      rc                      = gv_rc                 " Return Code, Number of Files or -1 If Error Occurred
    EXCEPTIONS
      file_open_dialog_failed = 1                " "Open File" dialog failed
      cntl_error              = 2                " Control error
      error_no_gui            = 3                " No GUI available
      not_supported_by_gui    = 4                " GUI does not support this
      others                  = 5
  ).
  IF SY-SUBRC = 0.
    READ TABLE gt_filename INTO pa_file INDEX 1.
  ENDIF.

START-OF-SELECTION.
  IF pa_file IS NOT INITIAL.
    CALL FUNCTION 'ALSM_EXCEL_TO_INTERNAL_TABLE'
      EXPORTING
        filename                = pa_file
        i_begin_col             = 2
        i_begin_row             = 5
        i_end_col               = 5
        i_end_row               = 50
      TABLES
        intern                  = gt_excel_data
      EXCEPTIONS
        inconsistent_parameters = 1
        upload_ole              = 2
        others                  = 3.
    IF SY-SUBRC = 0.
      SORT gt_excel_data BY row col.
      LOOP AT gt_excel_data INTO DATA(gs_excel_data).
        UNASSIGN <fs>.
        ASSIGN COMPONENT gs_excel_data-col OF STRUCTURE gs_data TO <fs>.
        <fs> = gs_excel_data-value.

        AT END OF row.
          APPEND gs_data TO gt_data.
          CLEAR gs_data.
        ENDAT.
      ENDLOOP.
      cl_demo_output=>display( gt_data ).
    ENDIF.
  ENDIF.
```
