## <  핵심 개념 >
- **1) Class 데이터 테스트는 `F9` 로**
- **2) ABAP SQL 내장 함수 정리(Numeric Functions)**

  - Date Processing Example (날짜 처리 함수 예제)
  - CURRENCY CONVERSION
  - Timestamp Conversion (타임스탬프 날짜 변환)
  - CDS Session Variable
- **3) CDS View에서 파라미터 설정하기**
- **4) DISTINCT 위치 차이**
- **5) JOIN / UNION / UNION ALL**

</br>
</br>

---

</br>

## < ABAP SQL 신문법 >
</br>

- CDS View : `ZCDSCUSTOM_B03`
```abap
REPORT z_new_sql_all_in_one_b03.

*----------------------------------------------------------------------*
* [신문법 마스터] Asterisk(*)와 모든 옵션(Group, Order) 결합
*----------------------------------------------------------------------*
SELECT FROM ZCDSMEALRESERVE_MB03
  FIELDS
    *,         " 1. 현재 뷰의 모든 필드 가져오기 (*)
    \_Spfli._Scarr.Carrname as Long_Airline_Name,      " 2. 추가로 Association 필드 하나 더 얹기 (\)
    count( * )            as Booking_Count,        " 3. 집계 함수 (Aggregate)
    avg( Luggweight )     as Avg_Weight

  WHERE cancelled <> 'X'              " 취소되지 않은 건만
    AND carrid = 'AA'                 " 특정 항공사 조건

  /* [중요] *를 썼을 때의 GROUP BY 규칙 */
  " 집계 함수를 썼다면, *에 포함된 모든 일반 필드와 \ 경로 필드를 그룹바이에 적어야 함
  " (실무에서는 *와 GROUP BY를 함께 쓰기보다 필요한 필드만 적는 것을 권장)
  GROUP BY 
    Carrid, Connid, Fldate, Bookid,   " * 안에 포함된 키 필드들
    AirlineName, AirlineCurrency, 
    DepartureCity, ArrivalCity, FlightTime,
    Cust_Rank, Meal_Name, Custtype, Smoker,
    Luggweight, Wunit, Class,
    \_Spfli._Scarr.Carrname           " 경로 표현식 필드

  ORDER BY     " [정렬] 별칭(Alias)으로 정렬
    Avg_Weight DESC,                  " 평균 무게가 무거운 순서
    Booking_Count ASC                 " 예약 건수는 적은 순서
  INTO TABLE @DATA(gt_final_data).    " 인라인 선언으로 한 방에 수신

" 결과 출력
IF sy-subrc = 0.
  cl_demo_output=>display( gt_final_data ).
  MESSAGE |총 { lines( gt_final_data ) }개 그룹의 데이터가 분석되었습니다.| TYPE 'S'.  " 선택된 행 개수 체크 (LINES 함수)
ENDIF.
```
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1
</br>

- 도메인 설정 실습
- CDS 실습
<img width="707" height="323" alt="image" src="https://github.com/user-attachments/assets/7c087899-d7de-4691-8f47-042a143f6b56" />
</br>
</br>

- CDS View : `ZCDSCUSTOM_B03`
```abap
@AbapCatalog.viewEnhancementCategory: [#NONE]
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'ZCDSCUSTOM_B03'
@Metadata.ignorePropagatedAnnotations: true
define view entity ZCDSCUSTOM_B03 as select from sbuspart as _Buspart
    inner join scustom as _Custom on _Buspart.buspartnum = _Custom.id
    association to I_DomainFixedValueText as _DomainFixed
        on 'S_CUSTTYPE' = _DomainFixed.SAPDataDictionaryDomain
//        and _Custom.custtype = _DomainFixed.DomainValue
//        and 'E' = _DomainFixed.Language
{
    key _Buspart.buspartnum as Buspartnum,       // 고객 ID
    _Custom.name as Name,   // 고객명
    _Custom.custtype as Custtype,   // 고객타입
//    _DomainFixed.DomainText as CusttypeName,    // 고객타입명
    _DomainFixed[1: Language = $session.system_language and DomainValue = $projection.Custtype ].DomainText as CusttypeName,
    
    case        // 고객등급
    when _Custom.custtype = 'B' and cast(_Custom.discount as abap.fltp) >= 20 then 'VB'
    when _Custom.custtype = 'B' and cast(_Custom.discount as abap.fltp) < 20 then 'B'
    when _Custom.custtype = 'P' and cast(_Custom.discount as abap.fltp) >= 20 then 'VP'
    when _Custom.custtype = 'P' and cast(_Custom.discount as abap.fltp) < 20 then 'P'
    else ' '
    end   as Custrate,
    
    case        // 고객등급명
    when _Custom.custtype = 'B' and cast(_Custom.discount as abap.fltp) >= 20 then 'VIP 고객(기업)'
    when _Custom.custtype = 'B' and cast(_Custom.discount as abap.fltp) < 20 then '고객(기업)'
    when _Custom.custtype = 'P' and cast(_Custom.discount as abap.fltp) >= 20 then 'VIP 고객(개인)'
    when _Custom.custtype = 'P' and cast(_Custom.discount as abap.fltp) < 20 then '고객(개인)'
    else ' '
    end as CustrateText,
    
    _Buspart.buspatyp as Buspatyp,  // 고객구분
    _Custom.discount as Discount,   // 할인율
    
    _DomainFixed
}
```
</br>
</br>
</br>

### 실습 2
- 실습 1에 이어서 진행
- SAP GUI에서 CDS View를 이용해 ALV 출력
</br>

<img width="382" height="92" alt="image" src="https://github.com/user-attachments/assets/1be4ab5b-4ff8-47bf-8bb4-c1dedb662356" />
