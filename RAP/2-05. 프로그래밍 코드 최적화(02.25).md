## <  핵심 개념 >
- **1) CDS에서 산술 연산(계산 필드) 가능**
- **2) CDS에서 Literal(고정값) 사용 가능**
- **3) CDS에서 CAST로 타입 변환 가능**
- **4) 나누기 연산 시 CAST가 필요한 이유**
- **5) CDS CASE 구문 정리 (Simple vs Complex 분기 구조)**
- **6) CDS → OData → Gateway Client 흐름**
</br>
</br>

---

</br>

## < CDS Association 복습 정리 >
- <data source>는 다른 CDS View 또는 DB 테이블 모두 가능함
- `{ }` 안에 `<alias>` 를 노출하면 → OData에서 EntitySet의 확장 대상으로 사용 가능
- `{ }` 안에 `<alias>` 를 노출하면 → 데이터를 즉시 조회하라는 의미가 아니라, 외부에서 해당 Association 경로를 사용할 수 있도록 노출(경로 오픈)해두는 선언
```abap
define view ZCDS_EXAMPLE as select from <source>
  association [*] to <data source> as <alias>
    on <조건>
{
    <alias>
}
```
- Association이 있으면 필드 충돌 방지를 위해 데이터소스.필드명으로 명확히 적는 게 안전함
```abap
define view entity ZI_SPFLI as select from SPFLI
  association [*] to SCARR as _Scarr
    on SPFLI.carrid = _Scarr.carrid
{
  key SPFLI.carrid as Carr_Id,
      connid
}
```
</br>
</br>

---

</br>

## < ABAP SQL 내장 함수 정리 >
- 내장함수의 파라미터가 궁금하면 해당 함수 키워드에서 F1 Help로 확인
</br>

#### < Numeric Functions (숫자 계산 관련 함수) >
- DIVISION은 나눗셈 후 반올림, ROUND는 계산 없이 기존 값만 반올림
- CDS에서는 계산이나 함수 결과값을 별도 변수 없이 바로 필드로 정의할 수 있음
  
| 함수 | 의미 | 사용 예시 | 예시 의미 |
|------|------|------------|------------|
| `DIV()` | 정수 나눗셈 (몫 반환) | `DIV( field1, field2 )` | field1 ÷ field2의 정수 몫 (소수점 버림) |
| `MOD()` | 나머지 반환 | `MOD( field1, field2 )` | field1 ÷ field2의 나머지 |
| `DIVISION()` | 나눗셈 후 반올림하여 소수점까지 표시 | `DIVISION( field1, field2, 2 )` | field1 ÷ field2 결과를 소수점 2자리까지 반올림 |
| `ROUND()` | 지정한 소수점 위치에서 반올림 | `ROUND( field, 2 )` | field 값을 소수점 2자리에서 반올림 |

</br>

#### < String Processing (문자열 처리 함수) >

| 함수 | 의미 | 사용 예시 | 예시 의미 |
|------|------|------------|------------|
| `CONCAT()` | 문자열 연결 | `CONCAT( field1, field2 )` | field1과 field2를 이어붙임 |
| `CONCAT_WITH_SPACE()` | 공백 포함 문자열 연결 | `CONCAT_WITH_SPACE( field1, field2, 1 )` | field1과 field2를 공백 1칸 두고 연결 |
| `UPPER()` | 대문자 변환 | `UPPER( field )` | field 값을 모두 대문자로 변환 |
| `LOWER()` | 소문자 변환 | `LOWER( field )` | field 값을 모두 소문자로 변환 |
| `SUBSTRING()` | 문자열 일부 추출 | `SUBSTRING( field, 1, 3 )` | 1번째 위치부터 3글자 추출 |
| `LEFT()` | 왼쪽부터 n글자 추출 | `LEFT( field, 2 )` | 왼쪽에서 2글자 반환 |
| `LENGTH()` | 문자열 길이 반환 | `LENGTH( field )` | 문자열의 총 길이 반환 |
| `REPLACE()` | 문자열 치환 | `REPLACE( field, 'A', 'B' )` | 'A'를 'B'로 변경 |

</br>

#### < Date and Time Processing (날짜·시간 처리 함수) >

| 함수 | 의미 | 사용 예시 | 예시 의미 |
|------|------|------------|------------|
| `IS_VALID()` | 날짜 형식 유효성 확인 | `IS_VALID( field )` | field가 올바른 날짜 형식인지 확인 |
| `ADD_DAYS()` | 날짜에 일수 추가 | `ADD_DAYS( field, 10 )` | field 날짜에 10일 추가 |
| `DAYS_BETWEEN()` | 두 날짜 사이 일수 계산 | `DAYS_BETWEEN( date1, date2 )` | date1과 date2 사이 일수 계산 |
| `WEEKDAY()` | 요일 반환 | `WEEKDAY( field )` | field 날짜의 요일 반환 |
| `EXTRACT_MONTH()` | 월 추출 | `EXTRACT_MONTH( field )` | field 날짜에서 월만 추출 |

</br>
</br>
</br>

### 1) Numeric Functions Example (숫자 함수 사용 예제)
#### 1) ABAP SQL 코드
```abap
SELECT FROM /dmo/flight
  FIELDS
    div( seats_occupied * 100, seats_max ) AS percentage_int,    " 정수 나눗셈 (몫만 반환)
    division( seats_occupied * 100, seats_max, 2 ) AS percentage_dec.    " 나눗셈 후 소수점 2자리까지 반올림
```
#### 2) CDS 코드
```abap
define view entity ZI_FLIGHT as select from /dmo/flight
{
  div( seats_occupied * 100, seats_max )        as percentage_int,
  division( seats_occupied * 100, seats_max, 2 ) as percentage_dec
}
```
</br>

```abap
@AbapCatalog.sqlViewName: 'ZCDSFLT2_B03'
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Flight CDS View 2'
@Metadata.ignorePropagatedAnnotations: true

@OData.publish: true
@OData.entitySet.name: 'Flights'
define view ZCDSFLIGHT2_B03 as select from sflight as f
    association to ZCDSSCARR2_B03 as _Scarr
    on f.carrid = _Scarr.Carrid
{
    key f.carrid as Carrid,
    key f.connid as Connid,
    key f.fldate as Fldate,
    
    @Semantics.currencyCode: true
    f.currency as Currency,
    f.seatsmax as Seatsmax,
    
    div(f.seatsmax, 10) as DivResult, // 몫 
    mod(f.seatsmax, 10) as ModResult, // 나머지
    
    f.seatsocc as Seatsocc,
    @Semantics.amount.currencyCode: 'Currency'
    f.paymentsum as Paymentsum,
    
    // 값 나눗셈 후 소수점 1자리까지 표현(반올림)
    division(paymentsum, 1, 1) as divisionResult,
    // 소수점 1자리까지 표현(반올림)
    round(paymentsum, 1) as RoundResult
}
```
- 결과 확인
  
<img width="940" height="193" alt="image" src="https://github.com/user-attachments/assets/c569d069-04a7-4be3-b906-aaaa70c9f208" />

</br>
</br>
</br>
</br>
</br>

### 2) CDS 문자열 연결 예제 (CONCAT / CONCAT_WITH_SPACE)
- concat_with_space는 공백 개수를 지정해 문자열을 연결하며, 함수 안에 다시 넣어 중첩 구성 가능
  
#### 1) ABAP SQL 코드
- 두 문자열을 지정한 개수의 공백을 사이에 두고 연결
```abap
CONCAT_WITH_SPACE( <문자열1>, <문자열2>, <공백개수> )
```
- 두 문자열을 공백 없이 그대로 이어붙이는 함수
```abap
CONCAT( <문자열1>, <문자열2> )
```
```abap
SELECT FROM /dmo/customer
  FIELDS
    " && 연산자를 사용한 문자열 연결 (CDS에서는 사용 불가)
    street && ', ' && postal_code && ' ' && city AS address_expr,

    " 함수 기반 문자열 연결
    concat(
      street,                                   " street 먼저 연결
      concat_with_space(
        ',',                                    " 쉼표 추가
        concat_with_space(
          postal_code,                          " 우편번호
          upper( city ),                        " 도시를 대문자로 변환
          1                                     " 우편번호와 도시 사이 공백 1개
        ),
        1                                       " 쉼표와 우편번호 사이 공백 1개
      )
    ) AS address_func.
```

#### 2) CDS 코드
```abap
define view entity ZI_CUSTOMER as select from /dmo/customer
{
  concat(
    street,                                   // street 먼저 연결
    concat_with_space(
      ',',                                    // 쉼표 추가
      concat_with_space(
        postal_code,                          // 우편번호
        upper( city ),                        // 도시를 대문자로 변환
        1                                     // 우편번호와 도시 사이 공백 1개
      ),
      1                                       // 쉼표와 우편번호 사이 공백 1개
    )
  ) as address                                // 최종 주소 필드
}
```
</br>

```abap
@AbapCatalog.sqlViewName: 'ZCDSFLT2_B03'
@AbapCatalog.compiler.compareFilter: true
@AbapCatalog.preserveKey: true
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'Flight CDS View 2'
@Metadata.ignorePropagatedAnnotations: true

@OData.publish: true
@OData.entitySet.name: 'Flights'
define view ZCDSFLIGHT2_B03 as select from sflight as f
    association to ZCDSSCARR2_B03 as _Scarr
    on f.carrid = _Scarr.Carrid
{
    key f.carrid as Carrid,
    key f.connid as Connid,
    key f.fldate as Fldate,
    
    // concat : 문자열 합치기
    // concat_with_space : 공백 포함 문자열 합치기
    concat('CARRID,CONNID:',
        concat_with_space( f.carrid,
            concat_with_space( ',', f.connid, 3 ),   
        3)
     ) as CarrConnSTR,
    
    f.planetype as Planetype,
    // planetype에 있는 문자열 'A340'을 'B111'로 변경
    replace(f.planetype, 'A340', 'B111') as ReplaceSTR,
    
    // planetype에서 2번째 자리부터 5글자 자르기
    // => 특이사항: -기호가 마지막자리로 잘리면, -가 맨앞에 표시됨
    substring(f.planetype, 2, 5) as SubSTR,
    
    // 왼쪽에서부터 2글자 자르기
    left(f.planetype, 2) as LeftSTR,
    
    // 소문자로 변경
    lower(f.carrid) as LowerSTR, 
    
    // 문자열 길이 반환
    length(f.planetype) as LengthSTR,
}
```
- 결과 확인
  
<img width="940" height="230" alt="image" src="https://github.com/user-attachments/assets/a44a53cc-d3c5-4076-88b8-e362ca65e41b" />

</br>
</br>
</br>
</br>
</br>

### 3) Date Processing Example (날짜 처리 함수 예제)
#### 1) ABAP SQL 코드
```abap
SELECT FROM /dmo/travel
  FIELDS
    is_valid( begin_date )                     AS valid,        " 날짜 형식 유효성 확인
    add_days( begin_date, 7 )                  AS add_7_days,   " 시작일 + 7일
    days_between( begin_date, end_date )       AS duration,     " 두 날짜 사이 일수 계산
    extract_month( begin_date )                AS month,        " 월 추출
    weekday( begin_date )                      AS weekday.      " 요일 반환
```
#### 2) CDS 코드
- `dats_` 계열 함수는 DATS 타입 전용이므로, 문자열 날짜는 먼저 CAST가 필요함
- `dats_add_days` 의 세 번째 파라미터는 오류 처리 옵션이며, 'FAIL'은 덤프 발생 가능, 'NULL'은 NULL 반환, 'INITIAL'은 초기값 반환
```abap
define view entity ZI_TRAVEL as select from /dmo/travel
{
  dats_is_valid( begin_date )                         as valid,       // CDS에서는 dats_ prefix 사용
  dats_add_days( begin_date, 7, 'FAIL' )             as add_7_days,  // 7일 추가, 오류 시 FAIL 처리
  dats_days_between( begin_date, end_date )          as duration,    // 날짜 차이 계산
  substring( begin_date, 5, 2 )                      as month        // 5번째 위치부터 2자리 → 월 추출
}
```
</br>
</br>
</br>

### 4) CURRENCY CONVERSION
- 금액을 다른 통화로 환율 적용해서 변환하는 함수
- `exchange_rate_date` 는 어떤 날짜의 환율을 적용할지 지정하는 필드
- currency_conversion 쓰려면 금액 필드에 `@Semantics.amount.currencyCode` 어노테이션을 반드시 선언해야 함
  
#### 1) ABAP SQL 코드
```abap
SELECT FROM /dmo/travel
  FIELDS
    currency_conversion(
      amount             = total_price,     " 변환할 금액
      source_currency    = currency_code,   " 기존 통화
      target_currency    = 'EUR',           " 목표 통화
      exchange_rate_date = begin_date       " 환율 기준 날짜
    ) AS total_price_EUR.
```

#### 2) CDS 코드
- CDS에서는 파라미터 전달 시 `=` 가 아니라 `=>` 를 사용해야 함
- CDS는 타입에 엄격하므로 통화코드(CUKY)는 `CAST()` 로 맞춰줘야 함
```abap
define view entity ZI_TRAVEL as select from /dmo/travel
{
  currency_conversion(
    amount             => total_price,                      // 변환할 금액
    source_currency    => currency_code,                    // 기존 통화
    target_currency    => cast( 'EUR' as abap.cuky ),       // CDS는 타입 엄격 → CAST 필요
    exchange_rate_date => begin_date                        // 환율 적용 기준 날짜
  ) as total_price_EUR
}
```
</br>

```abap
@AbapCatalog.viewEnhancementCategory: [#NONE]
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'SBOOK CDS View'
@Metadata.ignorePropagatedAnnotations: true
define view entity ZCDSBOOK_B03
  as select from sbook
{
  key carrid     as Carrid,
  key connid     as Connid,
  key fldate     as Fldate,
  key bookid     as Bookid,

      @Semantics.quantity.unitOfMeasure: 'Wunit'
      luggweight as Luggweight,
      
      @Semantics.quantity.unitOfMeasure: 'Wunit'
      unit_conversion( quantity => luggweight,    // 무게 KG → LB
                       source_unit => wunit,
                       target_unit => cast('LB' as abap.unit),
                       error_handling => 'FAIL_ON_ERROR'
      )                        as luggweigh_conv,
      wunit      as Wunit,
      
      @Semantics.amount.currencyCode: 'Forcurkey'
      forcuram   as Forcuram,
      forcurkey  as Forcurkey,
      
      @Semantics.amount.currencyCode: 'Forcurkey'
      currency_conversion( amount => forcuram,    // 금액 USD → KRW
                           source_currency => forcurkey,
                           target_currency => cast( 'KRW' as abap.cuky ),
                           exchange_rate_date => fldate,
                           error_handling => 'SET_TO_NULL'
      )                        as Forcuram_conv,
}
where
  luggweight > 20
  and forcurkey  = 'USD'
// and fldate = $session.user_date
```
- 결과 화면

<img width="940" height="216" alt="image" src="https://github.com/user-attachments/assets/f6c68187-2f8e-4672-8f25-d3ee30c7e089" />

</br>
</br>
</br>
</br>
</br>

### 5) Timestamp Conversion (타임스탬프 날짜 변환)
- 타임존을 고려해 Timestamp(날짜+시간)를 날짜(DATS)만으로 변환하는 함수
- ABAP은 필수값만 넘기고 client, on_error는 생략 가능하지만, CDS는 모두 작성해야 함
- 'FAIL', 'NULL', 'INITIAL'은 오류 발생 시 각각 덤프 발생, NULL 반환, 초기값 반환으로 처리 방식을 지정하는 옵션
- `tstmp_to_dats()` 의 타임존 파라미터는 CHAR(6) 타입

#### 1) ABAP SQL 코드
```abap
tstmp_to_dats(
  tstmp     = <timestamp>,     " 날짜+시간이 들어있는 Timestamp 값 (DEC 15,0)
  tzone     = <timezone>,      " 변환 기준 타임존 (예: 'UTC', 'EST')
  client    = <client>,        " 클라이언트 번호 (시스템 구분값, 선택)
  on_error  = <error_option>   " 오류 처리 방식 ('FAIL' / 'NULL' / 'INITIAL', 선택)
)
```
```abap
SELECT FROM /dmo/travel
  FIELDS
    tstmp_to_dats(
      tstmp = cast( lastchangedat as dec(15,0) ),   " 날짜+시간(Timestamp) 값
      tzone = cast( 'EST' as char(6) )              " 변환 기준 타임존 (미국 동부시간)
      " client, on_error 는 선택 파라미터
    ) AS date_est.                                  " 날짜(DATS)만 반환
```

#### 2) CDS 코드
```abap
tstmp_to_dats(
  <timestamp>,      // Timestamp 값 (날짜+시간, DEC 15,0)
  <timezone>,       // 타임존 (CHAR 6, 예: 'UTC')
  <client>,         // 클라이언트 번호 (CLNT 타입)
  <error_option>    // 오류 처리 옵션 ('FAIL' / 'NULL' / 'INITIAL')
)
```
```abap
define view entity ZI_TRAVEL as select from /dmo/travel
{
  tstmp_to_dats(
    cast( lastchangedat as abap.dec(15,0) ),   // Timestamp 값 (날짜+시간)
    cast( 'EST' as abap.char(6) ),             // 타임존 지정
    cast( '001' as abap.clnt ),                // 클라이언트 (CDS는 필수)
    'FAIL'                                     // 오류 처리 옵션
  ) as date_est                                // 변환된 날짜
}
```
</br>
</br>
</br>

### 6) CDS Session Variable
- `$session` 은 ABAP의 `sy-` 구조처럼 현재 로그인 세션 정보를 가져오는 변수
- CDS에서도 SELECT 영역과 WHERE 절에서 모두 사용 가능
- `$session.system_date` = CDS에서 현재 시스템 날짜(오늘 날짜)를 가져오는 세션 변수

```abap
define view entity ZS4D430_Session_Variables as select from /DMO/I_Flight
{
  _Currency._Text[ 1: Language = $session.system_language ].CurrencyName as CurrencyName    // 현재 로그인 사용자의 언어 기준으로 통화 텍스트 조회
}
where FlightDate > $session.system_date    // 오늘 날짜 이후의 항공편만 조회
```

| CDS Session Variable        | 대응 ABAP System Field | 의미 설명 |
|----------------------------|------------------------|------------|
| $session.client            | sy-mandt               | 현재 로그인한 클라이언트 번호 |
| $session.system_date       | sy-datum               | 시스템 기준 오늘 날짜 |
| $session.system_language   | sy-langu               | 현재 세션의 언어 코드 (로그온 언어) |
| $session.user              | sy-uname               | 현재 로그인한 사용자 ID |
| $session.user_date         | sy-datlo               | 사용자 타임존 기준 오늘 날짜 |
| $session.user_timezone     | sy-zonlo               | 사용자 개인 타임존 |

- `$session.system_date` vs `$session.user_date` 차이 정리

| 구분 | $session.system_date | $session.user_date |
|------|----------------------|--------------------|
| 기준 | 서버(시스템) 시간 기준 날짜 | 사용자 설정 타임존 기준 날짜 |
| 모두 동일? | ⭕ 모든 사용자 동일 | ❌ 사용자마다 다를 수 있음 |
| 타임존 영향 | ❌ 없음 | ⭕ 있음 (SU01 설정 기준) |
| 쉽게 표현 | 회사 공식 오늘 | 내가 보는 오늘 |
| 주 사용처 | 전표, 로그, 배치 프로그램 | 보고서, 화면 표시용 날짜 |

</br>

```abap
@AbapCatalog.viewEnhancementCategory: [#NONE]
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'SBOOK CDS View'
@Metadata.ignorePropagatedAnnotations: true
define view entity ZCDSBOOK_B03
  as select from sbook
{
  key carrid     as Carrid,
  key connid     as Connid,
  key fldate     as Fldate,
  key bookid     as Bookid,
      
      // session
      $session.client          as syClient,
      $session.system_date     as today,
      $session.system_language as SystemLangu,
      $session.user            as UserName,
      $session.user_date       as UserDate,
      $session.user_timezone   as syTimezone
}
where
  luggweight > 20
  and forcurkey  = 'USD'
// and fldate = $session.user_date
```

- 결과 화면
  
<img width="647" height="169" alt="image" src="https://github.com/user-attachments/assets/e70c5f58-3593-4033-b9f8-e7ef7f8834ea" />
</br>
</br>
</br>
</br>
</br>

---

</br>

## < CDS View에서 파라미터 설정하기 >
</br>

### 1) CDS 내부에서 파라미터 사용하는 경우
- CDS 파라미터는 조회 조건을 실행할 때마다 바꾸기 위해 외부에서 입력받는 변수이며 `with parameters` 로 선언하고 이름은 중복될 수 없음
- `파라미터이름 : 타입` 형식으로 선언하며, annotation 가능하고 Element List·CASE·함수·Filter·WHERE절에서 사용 가능
- 여러 개의 파라미터를 선언할 때는 `,` (콤마)로 구분
```abap
$parameters.파라미터이름
```
```abap
define view entity ZI_FLIGHT
  with parameters                                // 파라미터 선언 영역
       
  @EndUserText.label: 'X for free seats, Space for occupied'
  FreeOrOccupied  : abap.char(1),                // ':' 는 이름과 타입을 구분하는 기호 (이 변수의 타입은 char(1))
  
  BookingFee      : /dmo/booking_fee,           // 왼쪽=파라미터 이름 / 오른쪽=DDIC 타입
  
  TargetCurrency  : waers,                      // waers 타입(통화코드)
  
  @EndUserText.label: 'Only consider flights after this date'
  FirstFlightDate : /dmo/flight_date,           // 날짜 타입
  
  Language        : spras                       // 언어 코드 타입

as select from /DMO/I_Flight
{
   1. Element List에서 파라미터 사용
   $parameters.TargetCurrency as CurrencyCode,

   2. CASE 구문에서 파라미터 사용
   case $parameters.FreeOrOccupied
        when 'X' then MaximumSeats - OccupiedSeats
        else OccupiedSeats
   end as Seats,

   3. 표현식/함수에서 파라미터 사용
   currency_conversion(
        amount             => Price,
        source_currency    => CurrencyCode,
        target_currency    => $parameters.TargetCurrency,
        exchange_rate_date => FlightDate
   ) as PriceConverted,

   4. Filter Condition에서 파라미터 사용
   _Currency._Text[ 1 : Language = $parameters.Language ].CurrencyName,

   ...
}

5. WHERE 절에서 파라미터 사용
where FlightDate > $parameters.FirstFlightDate
```
</br>
</br>
</br>

### 2) 파라미터 있는 CDS를 다른 CDS에서 호출하는 경우
- 파라미터 있는 CDS를 데이터 소스로 사용할 때 괄호 `()` 안에서 값을 넘겨줘야 함
```abap
as select from <CDS이름>(
    파라미터이름 : 값,
    파라미터이름 : 값
)
```
```abap
define view entity ZS4D430_Use_Parameters
  with parameters
    Language            : spras,
    BeginWithFlightDate : /dmo/flight_date

as select from ZS4D430_Parameters(      // 파라미터 있는 CDS 호출
    FreeOrOccupied  : 'X',              // 직접 값 전달
    TargetCurrency  : 'EUR',            // 직접 값 전달
    Language        : $parameters.Language,          // 상위 파라미터 전달
    FirstFlightDate : $parameters.BeginWithFlightDate
)
{
   ...
}
```
</br>
</br>
</br>

### 3) ABAP에서 CDS 파라미터 넘기는 방법 (신문법)
#### 1) 리터럴 값으로 직접 전달
- `=` 로 값 할당 (CDS와 다르게 `:` 아님)
```abap
SELECT FROM ZS4D430_Use_Parameters(
    beginwithflightdate = '20230101',
    language            = 'D'
)
FIELDS ...
```
- 예제 `ZCDSBOOK_B03`
```abap
@AbapCatalog.viewEnhancementCategory: [#NONE]
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'SBOOK CDS View'
@Metadata.ignorePropagatedAnnotations: true
define view entity ZCDSBOOK_B03
  with parameters
    paCarrid : s_carr_id,
    paConnid : s_conn_id,
    @Environment.systemField: #SYSTEM_DATE
    paDate   : s_date,
    paCurr   : abap.cuky
  as select from sbook
{
  key carrid                   as Carrid,
  key connid                   as Connid,
  key fldate                   as Fldate,
  key bookid                   as Bookid,
      $parameters.paDate       as ParamDate
}
where
      luggweight > 20
  and forcurkey  = 'USD'
  and carrid     = $parameters.paCarrid
  and connid     = $parameters.paConnid
```

- 실행(F8)하면 파라미터 입력창이 뜨고, 필수값에는 * 표시가 있으며 대소문자를 구분
- Data Preview에서 파라미터 값은 반드시 대문자로 입력해야 정상 조회됨
<img width="418" height="248" alt="image" src="https://github.com/user-attachments/assets/f0e8a3ee-d978-491a-86fe-aa3437bed02a" />

- `paDate` 에 값을 입력하면 입력한 날짜가 사용
<img width="629" height="163" alt="image" src="https://github.com/user-attachments/assets/8fa17bc1-68c0-4040-9b92-0bb0e8c6232f" />
</br>
</br>
</br>

<img width="416" height="228" alt="image" src="https://github.com/user-attachments/assets/8f9669ee-ea7c-49a6-a80c-fa832c996d0d" />

- `paDate` 에 값을 입력하지 않으면 `@Environment.systemField: #SYSTEM_DATE` 에 의해 오늘 날짜가 자동 적용
<img width="601" height="171" alt="image" src="https://github.com/user-attachments/assets/de7202b7-4790-45b3-a9b5-6471c2cc2cc8" />
</br>
</br>
</br>
</br>

#### 2) Host 변수로 전달 (신문법 @ 사용)
- ABAP 변수는 `@` 붙여서 사용
```abap
DATA(today)    = cl_abap_context_info=>get_system_date( ).
DATA(language) = cl_abap_context_info=>get_user_language_iso_format( ).

SELECT FROM ZS4D430_Use_Parameters(
    beginwithflightdate = @today,
    language            = @language
)
FIELDS ...
```
- 예제 `ZCDSPARAMETER_B03`
```abap
@AccessControl.authorizationCheck: #NOT_REQUIRED
@EndUserText.label: 'CDS View with parameters'
@Metadata.ignorePropagatedAnnotations: true
define root view entity ZCDSPARAMETER_B03
  as select from ZCDSBOOK_B03(
                 paCarrid: 'AA',
                 paConnid: '0017',
                 paDate: '20260101'
                 )
{
  key Carrid,
  key Connid,
  key Fldate,
  key Bookid,
      ParamDate,
      Customid,
      Custtype,
      Cust_Text,
      Smoker
}
```
<img width="410" height="264" alt="image" src="https://github.com/user-attachments/assets/9ea1227e-f171-4551-ac43-3f2da6e2a4b4" />

<img width="575" height="161" alt="image" src="https://github.com/user-attachments/assets/9caa4840-721a-414f-a3d6-a0be348bf27e" />

</br>
</br>

#### 3) Host 표현식으로 바로 전달
- 변수에 담지 않고 `@(...)` 로 바로 전달하는 방식
```abap
SELECT FROM ZS4D430_Use_Parameters(
    beginwithflightdate = @( cl_abap_context_info=>get_system_date( ) ),
    language            = @( cl_abap_context_info=>get_user_language_iso_format( ) )
)
FIELDS ...
```
</br>
</br>

#### 4) 시스템 필드 자동 연결 (`@Environment.systemField` 사용)
- `@Environment.systemField` 는 CDS 파라미터를 ABAP 시스템 필드(`sy-*`)와 자동 연결하는 어노테이션
- ABAP에서 값을 따로 넘기지 않아도 시스템 날짜·언어 등이 자동으로 들어감
- systemField가 지정된 파라미터는 필수값(*)이 아님
```abap
define view entity ZS4D430_Use_Parameters
  with parameters
    @Environment.systemField: #SYSTEM_LANGUAGE   // 로그인 언어(sy-langu) 자동 전달
    Language            : spras,
    @Environment.systemField: #SYSTEM_DATE       // 시스템 날짜(sy-datum) 자동 전달
    BeginWithFlightDate : /dmo/flight_date

as select from ...
{ ... }
```
```abap
SELECT FROM ZS4D430_Use_Parameters
FIELDS ...
```
</br>
</br>

