# 02/03
</br>

## < ABAP Editor Code Completion >
- `CTRL + Space` : 코드 자동완성 호출
- `Shift + Enter` Or `CTRL + Space + Enter` : 선택한 메서드 템플릿 자동 삽입
- `CTRL + 백틱` : 터미널 창 열기
- `npm run start` : 실행
- `F12` : 디버깅 확인
- `F5` : 새로고침
</br>

- `SAPGUI` 로 열기
<img width="484" height="253" alt="image" src="https://github.com/user-attachments/assets/be16d7c0-188f-42c7-98ff-5036728b9199" />
</br>
</br>

- SAP Fiori(UI5)는 BTP(BAS)에서 개발되고, Cloud Connector를 통해 온프레미스 SAP System과 연결됨
<img width="410" height="203" alt="image" src="https://github.com/user-attachments/assets/d809a3a8-438c-452e-b517-bd701a8c8160" />
</br>
</br>
</br>
</br>

---

</br>

- 전역모델
<img width="404" height="278" alt="image" src="https://github.com/user-attachments/assets/c42bf161-6b09-4c7e-96c0-b864f53078fc" />
</br>
</br>
</br>
</br>
</br>

---

</br>

# 02/04
</br>

## <  핵심 개념 >
- **1) `items="{ZCODE_PERSON2_SRV>/PersonSet}"` 처럼 바인딩할 때 `/PersonSet` 은 반드시 `EntitySet` 으로 지정**
- **2) `\n` : 줄바꿈**
- **3) `<ToolbarSpacer />` : 버튼 끝에 추가**
- **4) `Ctrl + Space` : 함수 자동완성 단축**
</br>
</br>

---

</br>

# < FIORI 복습 >
</br>

## < 추가적인 개념 정리 >
</br>

- `/` 붙이면 그대로 출력
<img width="501" height="228" alt="image" src="https://github.com/user-attachments/assets/8dede643-e566-4ec1-a296-51a923fdada6" />

</br>
</br>
</br>
</br>

### < Fiori OData 서비스 추가 연결 >
</br>

- `Network` 에서 `meta` 검색 후 들어가기
<img width="471" height="254" alt="image" src="https://github.com/user-attachments/assets/8252554b-bd09-489a-a1ea-360304d675a7" />
</br>
</br>
</br>

**1) `Open Application Info` 선택**

<img width="456" height="231" alt="image" src="https://github.com/user-attachments/assets/991dca8c-b3db-474f-9fb9-6b78ff60de0c" />
</br>
</br>

**2) `Manage service Models` 선택**

<img width="589" height="242" alt="image" src="https://github.com/user-attachments/assets/af122b73-f236-4732-9570-b0614e449edd" />
</br>
</br>

**3) `oData` 생성**

<img width="599" height="350" alt="image" src="https://github.com/user-attachments/assets/3feda1a1-2a86-4d70-ad4d-7d23b56b4500" />

</br>
</br>
</br>
</br>
</br>


### < OData EntitySet 조회 형식 차이 >
- `/<EntitySet>?$format=json` : 해당 EntitySet 데이터를 JSON 형식으로 조회
```
https://port8080-workspaces-ws-vefo7.us10.trial.applicationstudio.cloud.sap/sap/opu/odata/sap/ZCODE_PERSON2_SRV/PersonSet?$format=json
```
<img width="535" height="212" alt="image" src="https://github.com/user-attachments/assets/7aefd8dd-43d4-4607-8b8c-04aa2d760973" />
</br>
</br>

- `/<EntitySet>` : 해당 EntitySet 데이터를 OData 기본 화면(XML/브라우저용)으로 조회
```
https://port8080-workspaces-ws-vefo7.us10.trial.applicationstudio.cloud.sap/sap/opu/odata/sap/ZCODE_PERSON2_SRV/PersonSet
```
<img width="682" height="237" alt="image" src="https://github.com/user-attachments/assets/6042266a-b9f6-486a-8cae-b7658558bf3a" />

</br>
</br>
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1: Aggregation Binding을 이용한 리스트 데이터 바인딩 실습
- `\` 붙이면 그대로 출력
- Aggregation Binding 실습
  
<img width="610" height="253" alt="image" src="https://github.com/user-attachments/assets/4ae09177-4afa-46a9-a646-ee25f74ec895" />

</br>
</br>
</br>

### 1. Main.controller.js
```java
// test 프로그램

sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel"   // 사용할 라이브러리 추가
], (Controller, JSONModel) => {
    "use strict";

    return Controller.extend("test1.controller.Main", {
        onInit() {
            let oModel = this.getOwnerComponent().getModel(); // 기본 (빈문자열) 모델을 가져옴
            let oMainModel = this.getOwnerComponent().getModel("main"); // main 모델을 가져옴

            // 해당 라인에서 디버깅이 실행됨. 단, 개발자도구가 켜져있는 상태여야 함
            // debugger; 

            let oData = {
                name : { 
                    FirstName : "홍", 
                    LastName : "길동"
                 },
                age : 30,
                salary : "4000만원",
                list : [
                    { ProductNo : "P001", ProdectName : "책상", price : 10000 },
                    { ProductNo : "P002", ProdectName : "키보드", price : 5000 },
                    { ProductNo : "P003", ProdectName : "물티슈", price : 1000 },
                    { ProductNo : "P004", ProdectName : "의자", price :30000 }
                ]
            };
            let oJSONModel = new JSONModel(oData);
            // 모델 이름 생략 시 빈 문자열
            // 기존에 기본모델이 존재한다면 해당 모델을 덮어씀
            // 따라서 모델 이름을 부여해서 각 모델을 구분할 수 있도록 함
            // this.getView().setModel(모델객체, 모델이름); 
            this.getView().setModel(oJSONModel, "view"); 

            // 모델에 들어있는 데이터를 화면에 표시하기 위해서
            // "바인딩(Binding)" 이라는 것을 사용
            // 기본 문법
            // <tag name="{모델이름>/경로}" />  모델 이름이 있는 경우
            // <tag name="{/경로}" />           모델 이름이 없는 경우(기본)
            // 경로는 JSON 객체의 key 값으로 접근
            // => {모델이름>/key1/key2} 와 같이 하위로 내려갈 수 있음
        }
    });
});
```
</br>

### 2. Main.view.xml
```html
// test 프로그램

<mvc:View controllerName="test1.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:l = "sap.ui.layout"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <l:Grid containerQuery="true" 
                class="sapUiSmallMargin"
                defaultSpan="XL3 L4 M4 S12">
                <Input value="{view>/name/FirstName}" description="\{view>/name/FirstName}"/>
                <Input value="{view>/name/LastName}" description="\{view>/name/LastName}"/>
                <Input value="{view>/age}" description="\{view>/age}"/>
                <Input value="{view>/salary}" description="\{view>/salary}"/>
        </l:Grid>

        <!-- sap.m.table 추가 -->
        <Table id="idProductsTable"
            inset="false"
            items="{view>/list}">
            <headerToolbar>
                <OverflowToolbar>
                    <content>
                        <Title text="Products" level="H2"/>
                        <ToolbarSpacer />
                        <ComboBox id="idPopinLayout"
                            placeholder="Popin layout options"
                            change="onPopinLayoutChanged">
                            <items>
                                <core:Item  text="Block"
                                    key="Block"/>
                                <core:Item  text="Grid Large"
                                    key="GridLarge"/>
                                <core:Item  text="Grid Small"
                                    key="GridSmall"/>
                            </items>
                        </ComboBox>
                        <Label text="Sticky options:" />
                        <CheckBox text="ColumnHeaders"
                            select="onSelect"/>
                        <CheckBox text="HeaderToolbar"
                            select="onSelect"/>
                        <CheckBox text="InfoToolbar"
                            select="onSelect"/>
                        <ToggleButton id="toggleInfoToolbar"
                            text="Hide/Show InfoToolbar"
                            press="onToggleInfoToolbar" />
                    </content>
                </OverflowToolbar>
            </headerToolbar>
            <infoToolbar>
                <OverflowToolbar>
                    <Label text="Wide range of available products"/>
                </OverflowToolbar>
            </infoToolbar>
            <columns>
                <Column><Text text="추가" /></Column>
                <Column><Text text="ProductNo" /></Column>
                <Column><Text text="ProdectName" /></Column>
                <Column><Text text="Price" /></Column>
            </columns>
            <items>
                <ColumnListItem vAlign="Middle">
                    <cells>
                        <ObjectIdentifier title="{view>ProductNo}" text="{view>ProdectName}"/>
                        <Text text="{view>ProductNo}" />
                        <Text text="{view>ProdectName}" />
                        <Text text="{view>price}" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>
    </Page>
</mvc:View>
```
</br>
</br>
</br>

### 실습 2: OData 모델 추가 후 EntitySet 바인딩 실습
- oData 추가해서 바인딩 실습
- `items="{ZCODE_PERSON2_SRV>/PersonSet}"` 처럼 바인딩할 때 `/PersonSet` 은 반드시 `EntitySet` 으로 지정
- 실습 1 코드에서 `view.xml` 파일만 수정

<img width="536" height="348" alt="image" src="https://github.com/user-attachments/assets/03c5a025-3012-41e6-9c36-abb770ca719e" />

</br>
</br>
</br>
</br>

### 1. `manifest.json` 파일에서 모델 생성 확인
<img width="373" height="169" alt="image" src="https://github.com/user-attachments/assets/27bbe5be-ded2-42b3-8fc1-23c46f5879ba" />
</br>
</br>

### 2. Main.view.xml
```html
// test 프로그램

<mvc:View controllerName="test1.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:l = "sap.ui.layout"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <l:Grid containerQuery="true" 
                class="sapUiSmallMargin"
                defaultSpan="XL3 L4 M4 S12">
                <Input value="{view>/name/FirstName}" description="\{view>/name/FirstName}"/>
                <Input value="{view>/name/LastName}" description="\{view>/name/LastName}"/>
                <Input value="{view>/age}" description="\{view>/age}"/>
                <Input value="{view>/salary}" description="\{view>/salary}"/>
        </l:Grid>

        <!-- sap.m.table 추가 -->
        <Table id="idPersonTable"
            inset="false"
            items="{ZCODE_PERSON2_SRV>/PersonSet}">
            <headerToolbar>
                <OverflowToolbar>
                    <content>
                        <Title text="Person" level="H2"/>
                    </content>
                </OverflowToolbar>
            </headerToolbar>
            <infoToolbar>
                <OverflowToolbar>
                    <Label text="Person"/>
                </OverflowToolbar>
            </infoToolbar>
            <columns>
                <Column><Text text="Perno" /></Column>
                <Column><Text text="Name" /></Column>
                <Column><Text text="Memo" /></Column>
            </columns>
            <items>
                <ColumnListItem vAlign="Middle">
                    <cells>
                        <Text text="{ZCODE_PERSON2_SRV>Perno}" />
                        <ObjectIdentifier title="{ZCODE_PERSON2_SRV>Firstname}" text="{ZCODE_PERSON2_SRV>Lastname}"/>
                        <Text text="{ZCODE_PERSON2_SRV>Memo}" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>

        <Table id="idProductsTable"
            inset="false"
            items="{/Carriers}">
            <headerToolbar>
                <OverflowToolbar>
                    <content>
                        <Title text="Products" level="H2"/>
                        <ToolbarSpacer />
                        <ComboBox id="idPopinLayout"
                            placeholder="Popin layout options"
                            change="onPopinLayoutChanged"
                            items="{view>/Combo}">
                            <items>
                                <core:Item  text="{view>text}" key="{view>key}"/>
                            </items>
                        </ComboBox>
                        <Label text="Sticky options:" />
                        <CheckBox text="ColumnHeaders" select="onSelect"/>
                        <CheckBox text="HeaderToolbar" select="onSelect"/>
                        <CheckBox text="InfoToolbar" select="onSelect"/>
                        <ToggleButton id="toggleInfoToolbar" text="Hide/Show InfoToolbar" press="onToggleInfoToolbar" />
                    </content>
                </OverflowToolbar>
            </headerToolbar>
            <infoToolbar>
                <OverflowToolbar>
                    <Label text="Wide range of available products"/>
                </OverflowToolbar>
            </infoToolbar>
            <columns>
                <Column><Text text="Carrid" /></Column>
                <Column><Text text="Carrname" /></Column>
                <Column><Text text="Currcode" /></Column>
                <Column><Text text="Url" /></Column>
            </columns>
            <items>
                <ColumnListItem vAlign="Middle">
                    <cells>
                        <Text text="{Carrid}" />
                        <Text text="{Carrname}" />
                        <Text text="{Currcode}" />
                        <Text text="{Url}" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>
    </Page>
</mvc:View>
```
</br>
</br>
</br>

### 실습 3: getProperty / getData를 이용한 모델 데이터 조회 실습
- `getProperty` 와 `getData` 이용 실습
- 버튼 클릭시 입력한 값이 출력
- 실습 1 코드에서 `controller.js` 파일만 수정
</br>

<img width="376" height="217" alt="image" src="https://github.com/user-attachments/assets/49bdb5f6-870a-4870-8230-df640d1caa0d" />
</br>

<img width="254" height="143" alt="image" src="https://github.com/user-attachments/assets/ef7fd498-c512-4bd4-8862-a9a40adf9a4c" />

</br>
</br>
</br>

### 1. Main.view.xml
```html
// test 프로그램

<Table id="idProductsTable"
    inset="false"
    items="{/Carriers}">
    <headerToolbar>
        <OverflowToolbar>
            <content>
                <Title text="Products" level="H2"/>
                <ToolbarSpacer />
                <Button text="버튼" press="onPress" />
            </content>
        </OverflowToolbar>
    </headerToolbar>
    <infoToolbar>
        <OverflowToolbar>
            <Label text="Wide range of available products"/>
        </OverflowToolbar>
    </infoToolbar>
    <columns>
        <Column><Text text="Carrid" /></Column>
        <Column><Text text="Carrname" /></Column>
        <Column><Text text="Currcode" /></Column>
        <Column><Text text="Url" /></Column>
    </columns>
    <items>
        <ColumnListItem vAlign="Middle">
            <cells>
                <Text text="{Carrid}" />
                <Text text="{Carrname}" />
                <Text text="{Currcode}" />
                <Text text="{Url}" />
            </cells>
        </ColumnListItem>
    </items>
</Table>
```
</br>
</br>

### 2. Main.controller.js
```java
// test 프로그램
onPress: function () {
    let oModel = this.getView().getModel("view");
    let oData = oModel.getProperty("/");            // oModel.getData();
    sap.m.MessageBox.information(
        `이름:  ${oData.name.FirstName}${oData.name.LastName} 
        나이:  ${oData.age} 
        연봉:  ${oData.salary}`
    );
}
```
</br>
</br>
</br>

### 실습 4: Table 행 선택 시 BindingContext로 데이터 조회 실습
- Table row 클릭시 해당 row의 데이터 가져오기 실습
- getBinding 이용
  
<img width="474" height="320" alt="image" src="https://github.com/user-attachments/assets/f8ae09ed-684a-4713-9e42-7a40e71191b4" />
</br>
</br>
</br>

### 1. Main.view.xml
- `selectionChange`와 `mode` 설
```html
// test 프로그램
<Table id="idProductsTable"
            inset="false"
            mode="SingleSelectLeft"
            selectionChange="onSelectionChange"
            items="{/Carriers}">
```
</br>
</br>

### 2. Main.controller.js
```java
// test 프로그램
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel"   // 사용할 라이브러리 추가
], (Controller, JSONModel) => {
    "use strict";

    return Controller.extend("test1.controller.Main", {
        onSelectionChange: function(oEvent) {
            let oModel = this.getView().getModel();
            let sPath = oEvent.getParameters().listItem.getBindingContext().getPath();
            let oData = oModel.getProperty(sPath);
            sap.m.MessageBox.information(
                `Carrid:  ${oData.Carrid} 
                Carrname:  ${oData.Carrname} 
                Currcode:  ${oData.Currcode}
                Url:  ${oData.Url}`
            );
        }
    });
});
```
</br>
</br>

---

</br>

# 02/05
</br>

## <  핵심 개념 >
- **1) `read()` 로 `GET_ENTITY` 호출 시, 문자 타입 키는 반드시 ' '로 감싸야 함**
```java
this.oModel.read(`/EmployeeSet(Empno='${oData.Empno}',Projod='${oData.Projod}')`, ...)
```

- **2) `sap.ui.table.Table` 정리**

| 구분 | 의미 | XML에서 쓰는 방식 | 예시 |
|---|---|---|---|
| Properties | 값 설정 | 속성 | selectionMode="Single" |
| Aggregations | 자식 컨트롤 | 태그 | <t:columns> |
| Associations | ID 연결 | 속성(ID) | ariaLabelledBy="titleId" |
| Events | 이벤트 핸들러 | 속성 | rowSelectionChange="onSelect" |
| Methods | 함수 | JS에서만 사용 | getSelectedIndex() |

- **3) `m.Table` → 모바일·단순 조회용 List 기반 테이블, `ui.table.Table` → 데스크탑·대량 데이터용 ALV 스타일 Grid 테이블**
- **4) `SEGW` : OData 서비스 모델 설계 및 Runtime 클래스 생성**
- **5) `/n/IWFND/MAINT_SERVICE` : OData 서비스 등록·활성화 관리**
- **6) `/n/IWFND/GW_CLIENT` : OData 서비스 URL 호출 및 테스트**
</br>
</br>

## < API 문서 보는 법 >
- **1) `Properties` : 테이블의 전체 설정값(행 수, 선택 방식 등)**
- **2) `Aggregations` : 테이블이 포함하는 구성요소(컬럼, 행 데이터)**
- **3) `Events` : 사용자 동작을 감지하는 이벤트(행 선택, 셀 클릭)**
- **4) `Methods` : JS에서 테이블을 제어·데이터를 가져오는 함수들**
- **5) `Constructor` : 테이블 생성 시 초기 설정 정보**
- **6) `Associations` : 다른 컨트롤과 ID로 연결되는 관계(실무 사용 적음)**
</br>
</br>

---

</br>

## < FIORI 함수 >
</br>

### 1) 컨트롤러 한정 전역 변수
- 해당 컨트롤러 내부에서는 전역처럼 사용
- 다른 컨트롤러에서는 접근 불가
```java
this._oPersonModel = this.getOwnerComponent().getModel();
```
</br>
</br>

### 2) OData 단건 조회 (EntitySet Read)
- 키가 1개면 필드명 생략 가능 → `/EntitySet('값')`
- 키가 여러 개면 키 이름 필수 → `/EntitySet(key1='값', key2='값')`
```java
// /EntitySet('KeyValue') → 단건
this._oPersonModel.read("/PersonSet('9001')", {
    success: function (oReturn) {
        // oReturn = 단일 Entity
        // oReturn.FieldName 형태로 바로 접근
        debugger;
    }.bind(this),
    error: function (oError) {
        console.log("Read EntitySet 에러!", oError);
    }
});

// /EntitySet → 다건
this._oPersonModel.read("/PersonSet", {
    success: function (oReturn) {
        // oReturn.results = Entity 배열
        // oReturn.results[0].FieldName 형태로 접근
        debugger;
    }.bind(this),
    error: function (oError) {
        console.log("Read EntitySet 에러!", oError);
    }
});
```

</br>
</br>

---

</br>

## < SAP Gateway OData 서비스 생성·활성·테스트 흐름 (TCODE: `SEGW`) >
- SEGW에서 OData 설계 → MAINT_SERVICE에서 서비스 활성화 → GW_CLIENT에서 URL 테스트
<img width="315" height="175" alt="image" src="https://github.com/user-attachments/assets/dc8325ac-9057-42a3-bd43-9c3f032c3045" />
</br>
</br>

**SAP OData 구축 요약**
1. DB 생성 (SE11): 테이블 생성 및 PK 설정 필수.
2. 모델 정의 (SEGW): 테이블 Import 후 햇님(Generate) 클릭.
3. 로직 구현 (DPC_EXT): GET_ENTITYSET 메서드 Redefine 및 조회 코드 작성.
4. 서비스 활성화 (/n/IWFND/MAINT_SERVICE): 서비스 등록 및 Green 상태 확인.
5. 최종 테스트 (/n/IWFND/GW_CLIENT): 데이터 출력 확인.
</br>
</br>
</br>

### SAP Gateway 주요 T-Code 역할 정리
- `SEGW` → OData 서비스 모델(Entity, EntitySet 등) 설계 및 Runtime 클래스 생성
- `/n/IWFND/MAINT_SERVICE` → 생성한 OData 서비스를 Gateway에 등록하고 활성화
- `/n/IWFND/GW_CLIENT` → OData 서비스 URL 호출 및 CRUD 테스트 수행
  
<img width="646" height="300" alt="image" src="https://github.com/user-attachments/assets/735223ec-bbe0-4e14-8402-eaa7d8bcf40c" />

</br>
</br>
</br>
</br>
</br>

### 1) OData 연동을 위한 DB 테이블 정의
- OData 서비스에서 사용할 사원 정보 테이블(ZTEMPINFO_B03)을 생성하고 필드와 Key를 정의

<img width="513" height="225" alt="image" src="https://github.com/user-attachments/assets/5b3705b3-7aa1-4484-bfb3-95a05db69d8e" />
</br>
</br>
</br>

### 2) `SEGW` 에서 OData 프로젝트 생성
- SAP Gateway Service Builder(SEGW)에서 Employee OData 서비스를 위한 프로젝트를 생성
  
<img width="356" height="116" alt="image" src="https://github.com/user-attachments/assets/5390dc8b-e248-4d13-b958-82e492b1e51c" />

<img width="428" height="256" alt="image" src="https://github.com/user-attachments/assets/b3736899-0229-402e-a84e-e2372d021a7b" />
</br>
</br>
</br>

### 3) DB 테이블 기반 Entity 생성
- SEGW에서 DDIC 테이블(ZTEMPINFO_B03)을 Import하여 Employee Entity와 EntitySet을 생성

<img width="375" height="251" alt="image" src="https://github.com/user-attachments/assets/216e5112-5bf7-45a4-a78c-399dd9f8d8ff" />

<img width="433" height="268" alt="image" src="https://github.com/user-attachments/assets/316f999a-9060-4eb2-bfd9-89a30ee88b7a" />

</br>
</br>
</br>

### 4) Entity 필드 속성 및 Key 설정
- Employee Entity의 필드 타입을 확인하고 Primary Key를 지정하며, Nullable 옵션으로 해당 필드의 필수 입력 여부(NULL 허용/불가)를 설정
  
<img width="590" height="256" alt="image" src="https://github.com/user-attachments/assets/a4cee978-4e20-4308-bcf9-134187c31be8" />
</br>
</br>
</br>

### 5) Runtime Artifacts 생성 및 변경사항 반영
- SEGW에서 Data Model(Entity, Property, Key 등)을 변경하면, 실제 실행에 사용되는 Runtime 클래스(MPC/DPC)에 그 변경사항을 반영
- 구조나 설정이 변경되면 반드시 다시 Generate 버튼을 눌러야 변경사항이 반영됨
  
<img width="409" height="161" alt="image" src="https://github.com/user-attachments/assets/44019cff-dc54-4d1c-a9cf-672bf28de402" />

<img width="433" height="238" alt="image" src="https://github.com/user-attachments/assets/806f86c5-056b-4565-bea0-5b950f82c6f2" />
</br>
</br>
</br>

### 6) OData 서비스 등록 및 활성화
- SEGW에서 생성한 OData 서비스를 Gateway 시스템에 등록(Register)하여 외부에서 호출 가능하게 활성화

<img width="508" height="201" alt="image" src="https://github.com/user-attachments/assets/7bf7fa93-0778-4f27-9f57-0115ceb1f953" />

<img width="675" height="469" alt="image" src="https://github.com/user-attachments/assets/40404773-edfa-4fcc-afd3-001fc8f32935" />

</br>
</br>
</br>
</br>

### 7) Gateway 서비스 관리 및 활성화 확인
- /IWFND/MAINT_SERVICE에서 등록된 OData 서비스를 조회하고 활성화 상태, System Alias, ICF 노드를 관리
  
<img width="586" height="472" alt="image" src="https://github.com/user-attachments/assets/9727bf15-2d8c-4259-90e0-c9369d4dc73e" />
</br>
</br>
</br>

### 8) SAP Gateway Client를 통한 OData 서비스 테스트
- `SEGW` 또는 `/IWFND/GW_CLIENT` 에서 OData 서비스 URL을 실행하여 EntitySet 조회 및 응답 데이터를 테스트

<img width="638" height="299" alt="image" src="https://github.com/user-attachments/assets/77b3e903-f2cb-457d-b72d-2fddb014316d" />

<img width="651" height="387" alt="image" src="https://github.com/user-attachments/assets/008dbaf0-6f99-4b6b-9c37-79fcc4bd9392" />
</br>
</br>
</br>

### 9) SAP Gateway Client에서 CRUD 테스트
- GET/POST/PUT/DELETE 방식으로 Read·Create·Update·Delete 동작을 테스트
- 200번대 응답은 성공이며, 오류 발생 시 결과가 빨간색으로 표시됨
- POST 요청은 Body에 데이터를 담아 전송하여 데이터 생성 수행

<img width="626" height="384" alt="image" src="https://github.com/user-attachments/assets/61f6c753-907f-4fe0-b19f-fabb9650955f" />
</br>
</br>
</br>

### 10) EntitySet 선택 및 응답 형식 설정
- EntitySet을 더블클릭하면 URL이 자동 완성되며, 기본 응답은 XML 형식이고 `$format=json` 옵션을 추가하면 JSON 형식으로 응답이 반환됨

<img width="654" height="331" alt="image" src="https://github.com/user-attachments/assets/ed7b868b-3ddd-48b7-a81a-a3d8b2e6f2cf" />

<img width="650" height="352" alt="image" src="https://github.com/user-attachments/assets/156f56d8-c6ff-4c62-9969-c6b63e86b178" />
</br>
</br>
</br>

### 11) GET_ENTITYSET 메소드 구현
- DPC_EXT 클래스에서 `EMPLOYEESET_GET_ENTITYSET` 메소드를 구현하여 EmployeeSet 조회 시 DB 테이블(ZTEMPINFO_B03)에서 데이터를 SELECT하여 응답으로 반환
- `et_entityset` → OData EntitySet 결과를 담아 UI로 반환하는 출력용 내부 테이블
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_GET_ENTITYSET
  method EMPLOYEESET_GET_ENTITYSET.
    SELECT * FROM ztempinfo_b03
      INTO CORRESPONDING FIELDS OF TABLE et_entityset.
  endmethod.
```
<img width="716" height="335" alt="image" src="https://github.com/user-attachments/assets/af85cfc5-b0fc-456d-b67e-f9e75804f986" />

<img width="713" height="371" alt="image" src="https://github.com/user-attachments/assets/937b1c4c-5594-4a17-95f3-57d93547492a" />

</br>
</br>
</br>

### 12) GET_ENTITY 메소드 구현 (단건 조회)
- DPC_EXT 클래스의 `EMPLOYEESET_GET_ENTITY` 메소드에서 키 필드(Empno, Projod)를 추출해 DB 테이블(ZTEMPINFO_B03)에서 단건 데이터를 조회하여 반환
- `IT_KEY_TAB` → GET_ENTITY 요청 URL에 포함된 Key 필드 값 목록 (WHERE 조건용)
- `ER_ENTITY` → 조회된 단건 데이터를 담아 OData 응답으로 반환하는 Entity 구조
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_GET_ENTITY
  method EMPLOYEESET_GET_ENTITY.
    DATA: ls_data TYPE ztempinfo_b03.

    "/EntitySet(key1='값1',key2='값2')
    LOOP AT it_key_tab INTO DATA(ls_key).
      CASE ls_key-name. " 키 프로퍼티의 이름(Entity기준)
        WHEN 'Empno'.
          ls_data-empno = ls_key-value.
        WHEN 'Projod'.
          ls_data-projod = ls_key-value.
        WHEN OTHERS.
      ENDCASE.
    ENDLOOP.

    SELECT SINGLE * FROM ztempinfo_b03
      INTO @DATA(ls_result)
      WHERE empno = @ls_data-empno
        AND projod = @ls_data-projod.

    IF sy-subrc = 0.
      MOVE-CORRESPONDING ls_result TO er_entity.
    ENDIF.
  endmethod.
```

<img width="716" height="335" alt="image" src="https://github.com/user-attachments/assets/715b944b-d62c-453c-ac41-7599f0a3bae4" />

<img width="714" height="282" alt="image" src="https://github.com/user-attachments/assets/a7cc3a8e-035c-467d-b1b9-c091413b6bda" />

<img width="827" height="213" alt="image" src="https://github.com/user-attachments/assets/e757fc4f-233a-407a-b256-0cdb0665c806" />

<img width="739" height="342" alt="image" src="https://github.com/user-attachments/assets/c0c609bc-93d6-4f24-9dc6-38150f577a65" />
</br>
</br>
</br>

### 13) GET_ENTITY 호출 시 Key 작성 규칙
- OData GET_ENTITY 호출에서는 Key가 1개면 해당 값만 작성하고, 복합 Key일 경우 모든 Key 값을 `(Key1='값',Key2='값')` 형태로 반드시 모두 작성해야 함

<img width="707" height="282" alt="image" src="https://github.com/user-attachments/assets/624303af-4ac0-4aab-863b-4127efe45164" />

- 전체 조회
<img width="797" height="375" alt="image" src="https://github.com/user-attachments/assets/88ca391d-fc94-4dec-a72a-f27519dd12bc" />


- 단 건 조회
<img width="806" height="373" alt="image" src="https://github.com/user-attachments/assets/013df931-6e69-407e-86e2-1caba491f49d" />
</br>
</br>
</br>

### 14) SAP Fiori Generator – OData 서비스 선택
<img width="646" height="307" alt="image" src="https://github.com/user-attachments/assets/44dd9b17-bd83-4a9a-ac70-2bfa62f05bbf" />
</br>
</br>
</br>

### 15) OData 서비스 메타데이터 갱신
- Manage Service Models에서 OData 서비스의 메타데이터를 Refresh & Save 하여 변경된 서비스 구조를 Fiori 앱에 반영
  
<img width="602" height="298" alt="image" src="https://github.com/user-attachments/assets/ea453733-0aa0-4d44-8605-b91218c80c64" />

<img width="489" height="259" alt="image" src="https://github.com/user-attachments/assets/fb4c6c96-28f8-49da-aae6-aa8b49abbde0" />
</br>
</br>
</br>

### 추가 기능 - Entity Property–DB 필드 매핑 확인
- SEGW의 Properties 화면에서 OData Entity 속성과 DB 테이블 필드(ABAP Field)가 정상적으로 매핑되었는지 확인하는 단계
  
<img width="621" height="131" alt="image" src="https://github.com/user-attachments/assets/945b6217-1d73-4421-aa86-756e3f3dcf2d" />

</br>
</br>
</br>
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1
- read로 조회 후 input에 세팅하는 실습
<img width="474" height="244" alt="image" src="https://github.com/user-attachments/assets/431bc215-12b6-4521-9727-450b4d7a01f0" />

</br>
</br>
</br>

### 1) Main.view.xml
```html
// test 프로그램
<Button text="EntitySet" press="onReadEntitySet" />
```
</br>

### 2) Main.controller.js
```java
// test 프로그램

sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel"   // 사용할 라이브러리 추가
], (Controller, JSONModel) => {
    "use strict";

    return Controller.extend("test1.controller.Main", {
        onInit() {
            this._oPersonModel = this.getOwnerComponent().getModel("ZCODE_PERSON2_SRV");
        },
        onReadEntitySet: function() {
            // this._oPersonModel => oData V2 Model
            let oModel = this.getView().getModel("view");
    
            this._oPersonModel.read("/PersonSet('9001')", {
                success: function(oReturn) {
                    // Request 요청이 성공하면, succcess 함수가 실행됨
                    // console.log("Read EntitySet 성공!", oReturn);
                    // oModel.setProperty("/salary", oReturn.results[0].Memo);
                    oModel.setProperty("/name/FirstName", oReturn.Firstname);
                    oModel.setProperty("/name/LastName", oReturn.Lastname);
                    debugger;
                }.bind(this),
                error: function(oError) {
                    console.log("Read EntitySet 에러!", oError);
                }
            })
        }
    });
});
```
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1 : m.table / ui.table 행 선택 기반 단건 조회 실습
- 테이블 중 한 행 선택하면 해당 행 정보 띄우기
- m.table ui.table 실습

<img width="540" height="243" alt="image" src="https://github.com/user-attachments/assets/5bf25e0e-e0d5-49a7-8248-499d1edfc3bc" />
</br>
</br>
</br>

### 1) Main.controller.js
```java
// project1

sap.ui.define([
    "sap/ui/core/mvc/Controller"
], (Controller) => {
    "use strict";

    return Controller.extend("project1.controller.Main", {
        onInit() {
            this.oModel = this.getOwnerComponent().getModel();
        },
        onPress: function() {
            let oTable = this.getView().byId("idEmployee");
            let oItem = oTable.getSelectedItem();
            let oData = oItem.getBindingContext().getObject();
            this.oModel.read(`/EmployeeSet(Empno='${oData.Empno}',Projod='${oData.Projod}')`, {
                success: function(oReturn) {
                    sap.m.MessageBox.information(
                        `Empno:  ${oReturn.Empno}
                        Memo:  ${oReturn.Memo} 
                        Projod:  ${oReturn.Projod} 
                        Role:  ${oReturn.Role} `,
                        { title: "m.table 버튼 조회" }
                    );
                }.bind(this),
                error: function(oError) {
                    console.log("Read EntitySet 에러!", oError);
                }
            })
            debugger;
        },
        onSelectionChange: function(oEvent) {
            let sPath = oEvent.getParameters().listItem.getBindingContext().getPath();
            let oData = this.oModel.getProperty(sPath);
            this.oModel.read(`/EmployeeSet(Empno='${oData.Empno}',Projod='${oData.Projod}')`, {
                success: function(oReturn) {
                    sap.m.MessageBox.information(
                        `Empno:  ${oReturn.Empno}
                        Memo:  ${oReturn.Memo} 
                        Projod:  ${oReturn.Projod} 
                        Role:  ${oReturn.Role} `,
                        { title: "m.table 행 클릭 조회" }
                    );
                }.bind(this),
                error: function(oError) {
                    console.log("Read EntitySet 에러!", oError);
                }
            })
        },
        onPress2: function() {
            let oTable = this.byId("idEmployee2");
            let oIndex = oTable.getSelectedIndex();

            if (oIndex < 0) return sap.m.MessageToast.show("데이터를 선택하세요.");

            let oData = oTable.getContextByIndex(oIndex).getObject();
            this.oModel.read(`/EmployeeSet(Empno='${oData.Empno}',Projod='${oData.Projod}')`, {
                success: function(oReturn) {
                    sap.m.MessageToast.show("ui.table 버튼으로 1건 조회", oReturn);
                }.bind(this),
                error: function(oError) {
                    console.log("Read EntitySet 에러!", oError);
                }
            })
        },
        onRowSelect: function(oEvent) {
            let oRowIndex = oEvent.getParameter("rowIndex");
            let oContext = oEvent.getParameter("rowContext");
            let oData = oContext.getObject();
            this.oModel.read(`/EmployeeSet(Empno='${oData.Empno}',Projod='${oData.Projod}')`, {
                success: function(oReturn) {
                    sap.m.MessageBox.information(
                        `Empno:  ${oReturn.Empno}
                        Memo:  ${oReturn.Memo} 
                        Projod:  ${oReturn.Projod} 
                        Role:  ${oReturn.Role} `,
                        { title: "ui.table 행 클릭 조회" }
                    );
                }.bind(this),
                error: function(oError) {
                    console.log("Read EntitySet 에러!", oError);
                }
            })
        }
    });
});
```
</br>

### 2) Main.view.xml
```html
// project1

<mvc:View controllerName="project1.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:t="sap.ui.table"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <VBox >
            <Table id="idEmployee"
                class="sapUiSmallMarginBottom"
                inset="false"
                mode="SingleSelectLeft"
                selectionChange="onSelectionChange"
                items="{/EmployeeSet}">
                <headerToolbar>
                    <OverflowToolbar>
                        <content>
                            <Title text="Employee" level="H2"/>
                            <ToolbarSpacer />
                            <Button text="클릭" press="onPress"/>
                        </content>
                    </OverflowToolbar>
                </headerToolbar>
                <infoToolbar>
                    <OverflowToolbar>
                        <Label text="Employee"/>
                    </OverflowToolbar>
                </infoToolbar>
                <columns>
                    <Column><Text text="EMPNO" /></Column>
                    <Column><Text text="PROJOD" /></Column>
                    <Column><Text text="ASSIGNDATE" /></Column>
                    <Column><Text text="ROLE" /></Column>
                    <Column><Text text="MEMO" /></Column>
                </columns>
                <items>
                    <ColumnListItem vAlign="Middle">
                        <cells>
                            <Text text="{Empno}" />
                            <Text text="{Projod}" />
                            <Text text="{
                                path: 'Assigndate',
                                type: 'sap.ui.model.type.DateTime',
                                formatOptions: { pattern : 'yyyy-MM-dd' }
                            }" />
                            <Text text="{Role}" />
                            <Text text="{Memo}" />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>

            <t:Table rows="{/EmployeeSet}"
                    id="idEmployee2"
                    selectionMode="Single"
                    selectionBehavior="RowOnly"
                    rowSelectionChange="onRowSelect"
                    >
                <t:extension>
                    <OverflowToolbar>
                        <Title text="Employee" level="H2"/>
                        <ToolbarSpacer />
                        <Button text="클릭" press="onPress2"/>
                    </OverflowToolbar>
                </t:extension>
                <t:columns>
                    <t:Column>
                        <Label text="EMPNO" />
                        <t:template>
                            <Text text="{Empno}" />
                        </t:template>
                    </t:Column>

                    <t:Column>
                        <Label text="PROJOD" />
                        <t:template>
                            <Text text="{Projod}" />
                        </t:template>
                    </t:Column>

                    <t:Column>
                        <Label text="ASSIGNDATE" />
                        <t:template>
                            <Text text="{
                                path: 'Assigndate',
                                type: 'sap.ui.model.type.DateTime',
                                formatOptions: { pattern : 'yyyy-MM-dd' }
                            }" />
                        </t:template>
                    </t:Column>

                    <t:Column>
                        <Label text="ROLE" />
                        <t:template>
                            <Text text="Role" />
                        </t:template>
                    </t:Column>

                    <t:Column>
                        <Label text="MEMO" />
                        <t:template>
                            <Text text="{Memo}" />
                        </t:template>
                    </t:Column>
                </t:columns>
            </t:Table>
        </VBox>
    </Page>
</mvc:View>
```
</br>
</br>

---

</br>

# 02/06
</br>

## <  핵심 개념 >
- **1) ODataModel은 `getData()` / `getDate()` 같은 직접 접근 불가이고, 데이터는 `read()` 콜백이나 바인딩된 컨텍스트(`getBindingContext().getProperty()`)로만 가져올 수 있음**
- **2) `read()` 는 ODataModel만 가능, JSONModel은 `setData/getData` 로 직접 다룸**
- **3) `content aggregation` 은 하나만 가능해서 여러 컨트롤 쓰려면 `VBox` 같은 컨테이너로 감싸야 함**
- **4) `GET_ENTITY` / `GET_ENTITYSET` 은 read 호출할 때만 의미 있음**
- **5) oData FIlter 연결**
- **6) oData CRUD 구현**

</br>
</br>

---

</br>

## < Filter 연결 >
</br>

- `it_filter_select_options` → OData 필터를 필드별 SELECT-OPTIONS 구조로 파싱해서 전달하는 내부 테이블
- `iv_filter_string` → OData $filter 조건을 문자열 그대로 전달한 WHERE 절용 필터 문자열
- `WHERE (변수)` 는 문자열을 SQL 조건식으로 해석하는 ABAP의 동적 WHERE 문법

```java
// project1

onReadEntitySet: function() {
    // new Filter(path, operator, value1, value2(operator가 BT 인 경우에 씀))
    
    // let aFilter = []
    // let oFilter = new Filter("Memo", FilterOperator.Contains, "TEST2 MEMO");
    // aFilter.push(oFilter);
    let oDateFormat = sap.ui.core.format.DateFormat.getInstance({
        pattern: "yyyyMMdd",
        UTC: true
    });
    let oStartDate = oDateFormat.parse("20260119");
    let oEndDate = oDateFormat.parse("20260701");

    let oFilter = [];
    oFilter.push(new Filter("Memo", FilterOperator.Contains, "TEST2 MEMO"));
    // oFilter.push(new Filter("Role", FilterOperator.Contains, "TEST2"));
    // oFilter.push(new Filter("Projod", FilterOperator.NE, "TEST2")); // 5000번 데이터 띄우기
    oFilter.push(new Filter("Assigndate", FilterOperator.BT, oStartDate, oEndDate));

    this.oModel.read("/EmployeeSet", {
        filters: oFilter, //aFilters,
        success: function(oReturn) {
            sap.m.MessageToast.show("조회 완료, 콘솔창 확인!");
            console.log("onReadEntitySet 전체 조회 성공 : ", oReturn.results);
        }
    })
}
```
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_GET_ENTITYSET

  method EMPLOYEESET_GET_ENTITYSET.
    DATA: lv_where_clause TYPE string.
        " 전체 필터 조건을 SQL WHERE 절 문자열로 변환
        lv_where_clause = io_tech_request_context->get_osql_where_clause( ).
        SELECT * FROM ztempinfo_b03
          INTO CORRESPONDING FIELDS OF TABLE et_entityset
          WHERE (lv_where_clause).
*    DATA: lr_memo TYPE /IWBEP/T_COD_SELECT_OPTIONS,
*          lr_role TYPE /IWBEP/T_COD_SELECT_OPTIONS,
*          lr_projod TYPE /IWBEP/T_COD_SELECT_OPTIONS,
*          lr_date TYPE /IWBEP/T_COD_SELECT_OPTIONS.
*
*    IF it_filter_select_options IS INITIAL.
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset.
*    ELSE.
*      " 만약 필터 정보가 들어왔다면, 필터 적용
*      LOOP AT it_filter_select_options INTO DATA(ls_filter).
*        CASE ls_filter-property.
*          WHEN 'Memo'.
*            APPEND LINES OF ls_filter-select_options TO lr_memo.
*          WHEN 'Role'.
*            APPEND LINES OF ls_filter-select_options TO lr_role.
*          WHEN 'Projod'.
*            APPEND LINES OF ls_filter-select_options TO lr_projod.
*          WHEN 'Assigndate'.
*            APPEND LINES OF ls_filter-select_options TO lr_date.
*          WHEN OTHERS.
*        ENDCASE.
*      ENDLOOP.
*
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset
*        WHERE Memo IN lr_memo
*          AND Role IN lr_role
*          AND projod IN lr_projod
*          AND assigndate IN lr_date.
*    ENDIF.
**********************************************************************
*    IF iv_filter_string IS INITIAL.
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset.
*    ELSE.
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset
*        WHERE (iv_filter_string).
*    ENDIF.
  endmethod.
```
</br>
</br>

---

</br>

## < sap.ui.model.odata.v2.ODataModel CRUD 메서드 정리 >
</br>

### 1) UTC 기준 Date 처리 및 DatePicker
- `UTC` → 전 세계 공통으로 사용하는 표준 시간 기준
- `UTC+9` → 한국에서 사용하는 현지 시간 기준 (UTC보다 9시간 빠름)
- UTC/UTC+9 혼용 시 날짜·시간 변환 과정에서 하루 밀림(±1일) 오류가 발생할 수 있음
</br>
</br>

- `sap.ui.core.format.DateFormat.getInstance({ pattern: "yyyyMMdd", UTC: true })` → 날짜를 UTC 기준으로 yyyyMMdd 형식 문자열로 변환하는 포맷 객체 생성
- `format()` → Date / Number 객체를 문자열로 변환하는 함수
- `parse()` → 문자열을 Date / Number 객체로 변환하는 함수
```java
let oDateFormat = sap.ui.core.format.DateFormat.getInstance({
  pattern: "yyyy-MM-dd",
  UTC: true
});

oDateFormat.format(oDate);   // Date → 문자열
oDateFormat.parse("2026-02-03"); // 문자열 → Date
```
- 서버 DateTime → 문자열로 표시
- JS Date → `sap.ui.model.type.Date`, OData DateTime 문자열 → `sap.ui.model.odata.type.DateTime`, formatter는 선택
```html
<Text text="{
  path: 'Writedate',
  type: 'sap.ui.model.odata.type.DateTime',
  formatOptions: { pattern: 'yyyy-MM-dd' }
}" />
```
</br>
</br>

- DatePicker는 화면 표시용(displayFormat)과 내부 처리용(value/valueFormat, dateValue)을 분리해 날짜 입력·처리를 안정적으로 하는 컨트롤
```html
<DatePicker
    displayFormat="yyyy-MM-dd"   <!-- 화면에 보이는 날짜 형식 -->
    valueFormat="yyyy-MM-dd"     <!-- 내부에서 문자열로 관리되는 형식 -->
    value="2026-02-03"            <!-- 문자열(String) 값 바인딩 -->
    dateValue="{/Writedate}"      <!-- Date 객체(Date) 바인딩 -->
/>
```
</br>
</br>

### 1) Read
- OData Model이 `read()` 를 호출하면 키 유무에 따라 `GET_ENTITY` 또는 `GET_ENTITYSET` 이 실행되어 DB 데이터를 조회함
- BAS 코드
```java
// test1
onReadEntitySet: function() {
    // this._oPersonModel => oData V2 Model
    let oModel = this.getView().getModel("view");

    this._oPersonModel.read("/PersonSet('9001')", {
        success: function(oReturn) {
            // Request 요청이 성공하면, succcess 함수가 실행됨
            // console.log("Read EntitySet 성공!", oReturn);
            // oModel.setProperty("/salary", oReturn.results[0].Memo);
            oModel.setProperty("/name/FirstName", oReturn.Firstname);
            oModel.setProperty("/name/LastName", oReturn.Lastname);
        }.bind(this),
        error: function(oError) {
            console.log("Read EntitySet 에러!", oError);
        }
    })
},
```
- SAP GUI 코드
```abap
" ZCL_ZCODE_PERSON2_DPC_EXT : PERSONSET_GET_ENTITY
  method PERSONSET_GET_ENTITY.
    DATA: ls_data   TYPE zcl2person. "DB Tab 구조

    LOOP AT it_key_tab INTO DATA(ls_key).
      CASE ls_key-name.
        WHEN 'Perno'.
          ls_data-perno = ls_key-value.
      ENDCASE.
    ENDLOOP.

    SELECT SINGLE *
      FROM zcl2person
      INTO @DATA(ls_result)
      WHERE perno = @ls_data-perno.

    IF sy-subrc = 0.
      MOVE-CORRESPONDING ls_result TO er_entity.
    ENDIF.

  endmethod.
```
```abap
" ZCL_ZCODE_PERSON2_DPC_EXT : PERSONSET_GET_ENTITYSET
  method PERSONSET_GET_ENTITYSET.
    SELECT * FROM ZCL2PERSON
      INTO TABLE ET_ENTITYSET.
  endmethod.
```
</br>
</br>

### 2) Create 
- `?` 가 들어간 파라미터는 옵셔널, 아닌 것은 필수 값
<img width="592" height="35" alt="image" src="https://github.com/user-attachments/assets/34eb1a57-53c3-4fd0-90d2-92390d1e19a5" />

</br>

- `alt` 로 선택 후에 `Ctrl + shift + 화살표 =>` 누르면 한번에 선택 가능
</br>
</br>

- 화면에서 전달한 Body 데이터를 OData가 받아 `CREATE_ENTITY` 에서 DB에 신규 데이터를 INSERT함
- BAS 코드
```java
// test1
onCreate: function() {
    let oDataModel = this.getView().getModel("view");
    let oData = oDataModel.getData();
    let oBody = {
        Perno       : oData.Perno,
        Firstname   : oData.Firstname,
        Lastname    : oData.Lastname,
        Memo        : oData.Memo
    }
    debugger;
    this._oPersonModel.create("/PersonSet", oBody, {
        success: function() {
            sap.m.MessageToast.show("성공!");
        },
        error: function(error) {
            console.log("Create EntitySet 에러!", error);
        }
    })
},
```
- SAP GUI 코드
```abap
" ZCL_ZCODE_PERSON2_DPC_EXT : PERSONSET_CREATE_ENTITY
  method PERSONSET_CREATE_ENTITY.
    DATA: ls_entity TYPE ZCL_ZCODE_PERSON2_mpc=>ts_person,
          ls_data   TYPE zcl2person.

    io_data_provider->read_entry_data(
      IMPORTING es_data = ls_entity
    ).
    CHECK sy-subrc = 0.
    MOVE-CORRESPONDING ls_entity TO ls_data.

    INSERT zcl2person FROM ls_data.

    IF sy-subrc = 0.
      MOVE ls_entity TO er_entity.
    ENDIF.
  endmethod.
```
</br>
</br>

### 3) Update
- 키 기반 Path로 `update()` 를 호출하면 UPDATE_ENTITY에서 해당 키의 DB 데이터를 수정함
- BAS 코드
```java
// test1
onUpdate: function() {
    // 여기서 사용자 입력값에 따라 oDataModel update 로직 수행
    // 우선 사용자 입력값이 들어있는 view 모델을 가져옴
    let oModel = this.getView().getModel("view");
    let oData = oModel.getData();

    let sPath = this._oPersonModel.createKey("/PersonSet", {
        Perno : oData.Perno
    }) // 경로를 만들어줌. 예시: "/PersonSet('1000')"

    let oBody = {
        Perno       : oData.Perno,
        Firstname   : oData.Firstname,
        Lastname    : oData.Lastname,
        Memo        : oData.Memo
    }
    debugger;
    this._oPersonModel.update(sPath, oBody, {
        success: function(oReturn) {
            sap.m.MessageToast.show(oReturn);
        },
        error: function() {
            sap.m.MessageToast.show("수정 에러 발생!");
        }
    });
},
```
- SAP GUI 코드
```abap
" ZCL_ZCODE_PERSON2_DPC_EXT : PERSONSET_UPDATE_ENTITY
  method PERSONSET_UPDATE_ENTITY.
    DATA: ls_entity TYPE ZCL_ZCODE_PERSON2_mpc=>ts_person,
          ls_data   TYPE zcl2person.

    io_data_provider->read_entry_data(
      IMPORTING es_data = ls_entity
    ).

    IF sy-subrc = 0.
      MOVE-CORRESPONDING ls_entity TO ls_data.
      UPDATE zcl2person FROM ls_data.
    ENDIF.
  endmethod.
```
</br>
</br>

### 4) Refresh
- refresh()는 서버를 다시 호출하여 `GET_ENTITYSET` 을 재실행해 최신 데이터를 다시 가져옴
- BAS 코드
```java
// test1
onRefresh: function() {
    this._oPersonModel.refresh();
}
```

</br>
</br>

### 5) Delete
- 키 기반 Path로 `remove()` 를 호출하면 DELETE_ENTITY에서 해당 키의 DB 데이터를 삭제함
- BAS 코드
```java
// test1
onDelete: function() {
    let oModel = this.getView().getModel("view");
    let oData = oModel.getData();

    let sPath = this._oPersonModel.createKey("/PersonSet", {
        Perno : oData.Perno
    }) // 경로를 만들어줌. 예시: "/PersonSet('1000')"

    this._oPersonModel.remove(sPath, {
        success: function() {
            sap.m.MessageToast.show("삭제 완료!");
        },
        error: function() {
            sap.m.MessageToast.show("삭제 에러!");
        }
    })
}
```
- SAP GUI 코드
```abap
" ZCL_ZCODE_PERSON2_DPC_EXT : PERSONSET_DELETE_ENTITY
  method PERSONSET_DELETE_ENTITY.
    DATA: ls_data   TYPE zcl2person.

    LOOP AT it_key_tab INTO DATA(ls_key).
      CASE ls_key-name.
        WHEN 'Perno'.
          ls_data-perno = ls_key-value.
      ENDCASE.
    ENDLOOP.

    DELETE zcl2person FROM ls_data.
  endmethod.
```
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1 : OData Filter를 이용한 EntitySet 조회 실습
- 필터 사용
<img width="599" height="281" alt="image" src="https://github.com/user-attachments/assets/bbf57f49-9fde-4002-ae11-17dfa2646b23" />

</br>
</br>

**1) SAP GUI 코드**
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_GET_ENTITYSET
  method EMPLOYEESET_GET_ENTITYSET.
    DATA: lv_where_clause TYPE string.
        " 전체 필터 조건을 SQL WHERE 절 문자열로 변환
        lv_where_clause = io_tech_request_context->get_osql_where_clause( ).
        SELECT * FROM ztempinfo_b03
          INTO CORRESPONDING FIELDS OF TABLE et_entityset
          WHERE (lv_where_clause).
*    DATA: lr_memo TYPE /IWBEP/T_COD_SELECT_OPTIONS,
*          lr_role TYPE /IWBEP/T_COD_SELECT_OPTIONS,
*          lr_projod TYPE /IWBEP/T_COD_SELECT_OPTIONS,
*          lr_date TYPE /IWBEP/T_COD_SELECT_OPTIONS.
*
*    IF it_filter_select_options IS INITIAL.
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset.
*    ELSE.
*      " 만약 필터 정보가 들어왔다면, 필터 적용
*      LOOP AT it_filter_select_options INTO DATA(ls_filter).
*        CASE ls_filter-property.
*          WHEN 'Memo'.
*            APPEND LINES OF ls_filter-select_options TO lr_memo.
*          WHEN 'Role'.
*            APPEND LINES OF ls_filter-select_options TO lr_role.
*          WHEN 'Projod'.
*            APPEND LINES OF ls_filter-select_options TO lr_projod.
*          WHEN 'Assigndate'.
*            APPEND LINES OF ls_filter-select_options TO lr_date.
*          WHEN OTHERS.
*        ENDCASE.
*      ENDLOOP.
*
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset
*        WHERE Memo IN lr_memo
*          AND Role IN lr_role
*          AND projod IN lr_projod
*          AND assigndate IN lr_date.
*    ENDIF.
**********************************************************************
*    IF iv_filter_string IS INITIAL.
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset.
*    ELSE.
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset
*        WHERE (iv_filter_string).
*    ENDIF.
  endmethod.
```
</br>

**2) Main.controller.js**
```java
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/Filter", 
    "sap/ui/model/FilterOperator"
], (Controller, Filter, FilterOperator) => {
    "use strict";

    return Controller.extend("project1.controller.Main", {
        onInit() {
            this.oModel = this.getOwnerComponent().getModel();
        },
        onPress: function() {
            let oTable = this.getView().byId("idEmployee");
            let oItem = oTable.getSelectedItem();
            let oData = oItem.getBindingContext().getObject();
            this.oModel.read(`/EmployeeSet(Empno='${oData.Empno}',Projod='${oData.Projod}')`, {
                success: function(oReturn) {
                    sap.m.MessageBox.information(
                        `Empno:  ${oReturn.Empno}
                        Memo:  ${oReturn.Memo} 
                        Projod:  ${oReturn.Projod} 
                        Role:  ${oReturn.Role} `,
                        { title: "m.table 버튼 조회" }
                    );
                }.bind(this),
                error: function(oError) {
                    console.log("Read EntitySet 에러!", oError);
                }
            })
        },
        onSelectionChange: function(oEvent) {
            let sPath = oEvent.getParameters().listItem.getBindingContext().getPath();
            let oData = this.oModel.getProperty(sPath);
            this.oModel.read(`/EmployeeSet(Empno='${oData.Empno}',Projod='${oData.Projod}')`, {
                success: function(oReturn) {
                    sap.m.MessageBox.information(
                        `Empno:  ${oReturn.Empno}
                        Memo:  ${oReturn.Memo} 
                        Projod:  ${oReturn.Projod} 
                        Role:  ${oReturn.Role} `,
                        { title: "m.table 행 클릭 조회" }
                    );
                }.bind(this),
                error: function(oError) {
                    console.log("Read EntitySet 에러!", oError);
                }
            })
        },
        onReadEntitySet: function() {
            // new Filter(path, operator, value1, value2(operator가 BT 인 경우에 씀))
            
            // let aFilter = []
            // let oFilter = new Filter("Memo", FilterOperator.Contains, "TEST2 MEMO");
            // aFilter.push(oFilter);
            let oDateFormat = sap.ui.core.format.DateFormat.getInstance({
                pattern: "yyyyMMdd",
                UTC: true
            });
            let oStartDate = oDateFormat.parse("20260119");
            let oEndDate = oDateFormat.parse("20260701");

            let oFilter = [];
            oFilter.push(new Filter("Memo", FilterOperator.Contains, "TEST2 MEMO"));
            // oFilter.push(new Filter("Role", FilterOperator.Contains, "TEST2"));
            // oFilter.push(new Filter("Projod", FilterOperator.NE, "TEST2")); // 5000번 데이터 띄우기
            oFilter.push(new Filter("Assigndate", FilterOperator.BT, oStartDate, oEndDate));

            this.oModel.read("/EmployeeSet", {
                filters: oFilter, //aFilters,
                success: function(oReturn) {
                    sap.m.MessageToast.show("조회 완료, 콘솔창 확인!");
                    console.log("onReadEntitySet 전체 조회 성공 : ", oReturn.results);
                }
            })
        },
        onPress2: function() {
            let oTable = this.byId("idEmployee2");
            let oIndex = oTable.getSelectedIndex();

            if (oIndex < 0) return sap.m.MessageToast.show("데이터를 선택하세요.");

            let oData = oTable.getContextByIndex(oIndex).getObject();
            let sPath = `/EmployeeSet(Empno='${oData.Empno}',Projod='${oData.Projod}')`;
            // 위와 같이 전체 데이터를 가져와서, sPath 를 구성할 수도 있고,
            // this.byId("idTable").getContextByIndex(iSelectNo).getPath() 를 사용해서
            // 해당 Row의 바인딩 경로 문자열 전체를 얻을 수도 있음 
            this.oModel.read(sPath, {
                success: function(oReturn) {
                    sap.m.MessageToast.show("ui.table 버튼으로 1건 조회", oReturn);
                }.bind(this),
                error: function(oError) {
                    console.log("Read EntitySet 에러!", oError);
                }
            })
        },
        onRowSelect: function(oEvent) {
            let oRowIndex = oEvent.getParameter("rowIndex");
            let oContext = oEvent.getParameter("rowContext");
            let oData = oContext.getObject();
            this.oModel.read(`/EmployeeSet(Empno='${oData.Empno}',Projod='${oData.Projod}')`, {
                success: function(oReturn) {
                    sap.m.MessageBox.information(
                        `Empno:  ${oReturn.Empno}
                        Memo:  ${oReturn.Memo} 
                        Projod:  ${oReturn.Projod} 
                        Role:  ${oReturn.Role} `,
                        { title: "ui.table 행 클릭 조회" }
                    );
                }.bind(this),
                error: function(oError) {
                    console.log("Read EntitySet 에러!", oError);
                }
            })
        }
    });
});
```
</br>

**3) Main.view.xml**
```html
<mvc:View controllerName="project1.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:t="sap.ui.table"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <VBox >
            <Table id="idEmployee"
                class="sapUiSmallMarginBottom"
                inset="false"
                mode="SingleSelectLeft"
                selectionChange="onSelectionChange"
                items="{/EmployeeSet}">
                <headerToolbar>
                    <OverflowToolbar>
                        <content>
                            <Title text="Employee" level="H2"/>
                            <ToolbarSpacer />
                            <Button text="클릭" press="onPress"/>
                        </content>
                    </OverflowToolbar>
                </headerToolbar>
                <infoToolbar>
                    <OverflowToolbar>
                        <Label text="Employee"/>
                    </OverflowToolbar>
                </infoToolbar>
                <columns>
                    <Column><Text text="EMPNO" /></Column>
                    <Column><Text text="PROJOD" /></Column>
                    <Column><Text text="ASSIGNDATE" /></Column>
                    <Column><Text text="ROLE" /></Column>
                    <Column><Text text="MEMO" /></Column>
                </columns>
                <items>
                    <ColumnListItem vAlign="Middle">
                        <cells>
                            <Text text="{Empno}" />
                            <Text text="{Projod}" />
                            <Text text="{
                                path: 'Assigndate',
                                type: 'sap.ui.model.type.DateTime',
                                formatOptions: { pattern : 'yyyy-MM-dd' }
                            }" />
                            <Text text="{Role}" />
                            <Text text="{Memo}" />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>

            <t:Table rows="{/EmployeeSet}"
                    id="idEmployee2"
                    selectionMode="Single"
                    selectionBehavior="RowOnly"
                    rowSelectionChange="onRowSelect">
                <t:extension>
                    <OverflowToolbar>
                        <Title text="Employee" level="H2"/>
                        <ToolbarSpacer />
                        <Button text="EntitySet" press="onReadEntitySet"/>
                        <Button text="클릭" press="onPress2"/>
                    </OverflowToolbar>
                </t:extension>
                <t:columns>
                    <t:Column>
                        <Label text="EMPNO" />
                        <t:template>
                            <Text text="{Empno}" />
                        </t:template>
                    </t:Column>

                    <t:Column>
                        <Label text="PROJOD" />
                        <t:template>
                            <Text text="{Projod}" />
                        </t:template>
                    </t:Column>

                    <t:Column>
                        <Label text="ASSIGNDATE" />
                        <t:template>
                            <Text text="{
                                path: 'Assigndate',
                                type: 'sap.ui.model.type.DateTime',
                                formatOptions: { pattern : 'yyyy-MM-dd' }
                            }" />
                        </t:template>
                    </t:Column>

                    <t:Column>
                        <Label text="ROLE" />
                        <t:template>
                            <Text text="{Role}" />
                        </t:template>
                    </t:Column>

                    <t:Column>
                        <Label text="MEMO" />
                        <t:template>
                            <Text text="{Memo}" />
                        </t:template>
                    </t:Column>
                </t:columns>
            </t:Table>
        </VBox>
    </Page>
</mvc:View>
```
</br>
</br>
</br>

### 실습 2 : 테이블 선택 기반 CRUD 처리 실습
- CRUD 프로그램 실습
<img width="616" height="281" alt="image" src="https://github.com/user-attachments/assets/34703b4a-e106-415d-b024-21c6cd81a825" />
</br>
</br>

**1) SAP GUI 코드**
- GET_ENTITYSET
```abap
" ZCL_ZCODE_PERSON2_DPC_EXT : PERSONSET_GET_ENTITYSET
  method PERSONSET_GET_ENTITYSET.
    SELECT * FROM ZCL2PERSON
      INTO TABLE ET_ENTITYSET.
  endmethod.
```
- GET_ENTITY
```abap
" ZCL_ZCODE_PERSON2_DPC_EXT : PERSONSET_GET_ENTITY
  method PERSONSET_GET_ENTITY.
    DATA: ls_data   TYPE zcl2person. "DB Tab 구조

    LOOP AT it_key_tab INTO DATA(ls_key).
      CASE ls_key-name.
        WHEN 'Perno'.
          ls_data-perno = ls_key-value.
      ENDCASE.
    ENDLOOP.

    SELECT SINGLE *
      FROM zcl2person
      INTO @DATA(ls_result)
      WHERE perno = @ls_data-perno.

    IF sy-subrc = 0.
      MOVE-CORRESPONDING ls_result TO er_entity.
    ENDIF.
  endmethod.
```
- CREATE_ENTITY
```abap
" ZCL_ZCODE_PERSON2_DPC_EXT : PERSONSET_CREATE_ENTITY
  method PERSONSET_CREATE_ENTITY.
    DATA: ls_entity TYPE ZCL_ZCODE_PERSON2_mpc=>ts_person,
          ls_data   TYPE zcl2person.

    io_data_provider->read_entry_data(
      IMPORTING es_data = ls_entity
    ).
    CHECK sy-subrc = 0.
    MOVE-CORRESPONDING ls_entity TO ls_data.

    INSERT zcl2person FROM ls_data.

    IF sy-subrc = 0.
      MOVE ls_entity TO er_entity.
    ENDIF.
  endmethod.
```
- UPDATE_ENTITY
```abap
" ZCL_ZCODE_PERSON2_DPC_EXT : PERSONSET_UPDATE_ENTITY
  method PERSONSET_UPDATE_ENTITY.
    DATA: ls_entity TYPE ZCL_ZCODE_PERSON2_mpc=>ts_person,
          ls_data   TYPE zcl2person.

    io_data_provider->read_entry_data(
      IMPORTING es_data = ls_entity
    ).

    IF sy-subrc = 0.
      MOVE-CORRESPONDING ls_entity TO ls_data.
      UPDATE zcl2person FROM ls_data.
    ENDIF.
  endmethod.
```
- DELETE_ENTITY
```abap
" ZCL_ZCODE_PERSON2_DPC_EXT : PERSONSET_DELETE_ENTITY
  method PERSONSET_DELETE_ENTITY.
    DATA: ls_data   TYPE zcl2person.

    LOOP AT it_key_tab INTO DATA(ls_key).
      CASE ls_key-name.
        WHEN 'Perno'.
          ls_data-perno = ls_key-value.
      ENDCASE.
    ENDLOOP.

    DELETE zcl2person FROM ls_data.
  endmethod.
```
</br>

**2) Main.controller.js**
```java
// test1
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel"   // 사용할 라이브러리 추가
], (Controller, JSONModel) => {
    "use strict";

    return Controller.extend("test1.controller.Main", {
        onInit() {
            this._oPersonModel = this.getOwnerComponent().getModel("ZCODE_PERSON2_SRV");

            let oModel = this.getOwnerComponent().getModel(); // 기본 (빈문자열) 모델을 가져옴
            let oMainModel = this.getOwnerComponent().getModel("main"); // main 모델을 가져옴

            // 해당 라인에서 디버깅이 실행됨. 단, 개발자도구가 켜져있는 상태여야 함
            // debugger; 

            let oData = {
                name : { 
                    FirstName : "홍", 
                    LastName : "길동"
                 },
                age : 30,
                salary : "4000만원",
                list : [
                    { ProductNo : "P001", ProdectName : "책상", price : 10000 },
                    { ProductNo : "P002", ProdectName : "키보드", price : 5000 },
                    { ProductNo : "P003", ProdectName : "물티슈", price : 1000 },
                    { ProductNo : "P004", ProdectName : "의자", price :30000 }
                ],
                Combo : [
                    { text : "Block", key : "Block" },
                    { text : "Grid Large", key : "GridLarge" },
                    { text : "Grid Small", key : "GridSmall" }
                ]
            };
            let oJSONModel = new JSONModel(oData);
            // 모델 이름 생략 시 빈 문자열
            // 기존에 기본모델이 존재한다면 해당 모델을 덮어씀
            // 따라서 모델 이름을 부여해서 각 모델을 구분할 수 있도록 함
            // this.getView().setModel(모델객체, 모델이름); 
            this.getView().setModel(oJSONModel, "view"); 

            // 모델에 들어있는 데이터를 화면에 표시하기 위해서
            // "바인딩(Binding)" 이라는 것을 사용
            // 기본 문법
            // <tag name="{모델이름>/경로}" />  모델 이름이 있는 경우
            // <tag name="{/경로}" />           모델 이름이 없는 경우(기본)
            // 경로는 JSON 객체의 key 값으로 접근
            // => {모델이름>/key1/key2} 와 같이 하위로 내려갈 수 있음
        },
        onPress: function () {
            let oModel = this.getView().getModel("view");
            let oData = oModel.getProperty("/");            // oModel.getData();
            sap.m.MessageBox.information(
                `이름:  ${oData.name.FirstName}${oData.name.LastName} 
                나이:  ${oData.age} 
                연봉:  ${oData.salary}`
            );
        },
        onSelectionChange: function(oEvent) {
            let oModel = this.getView().getModel();
            let sPath = oEvent.getParameters().listItem.getBindingContext().getPath();
            let oData = oModel.getProperty(sPath);
            sap.m.MessageBox.information(
                `Carrid:  ${oData.Carrid} 
                Carrname:  ${oData.Carrname} 
                Currcode:  ${oData.Currcode}
                Url:  ${oData.Url}`
            );
        },
        onReadEntitySet: function() {
            // this._oPersonModel => oData V2 Model
            let oModel = this.getView().getModel("view");
    
            this._oPersonModel.read("/PersonSet('9001')", {
                success: function(oReturn) {
                    // Request 요청이 성공하면, succcess 함수가 실행됨
                    // console.log("Read EntitySet 성공!", oReturn);
                    // oModel.setProperty("/salary", oReturn.results[0].Memo);
                    oModel.setProperty("/name/FirstName", oReturn.Firstname);
                    oModel.setProperty("/name/LastName", oReturn.Lastname);
                }.bind(this),
                error: function(oError) {
                    console.log("Read EntitySet 에러!", oError);
                }
            })
        },
        onCreate: function() {
            let oDataModel = this.getView().getModel("view");
            let oData = oDataModel.getData();
            let oBody = {
                Perno       : oData.Perno,
                Firstname   : oData.Firstname,
                Lastname    : oData.Lastname,
                Memo        : oData.Memo
            }
            debugger;
            this._oPersonModel.create("/PersonSet", oBody, {
                success: function() {
                    sap.m.MessageToast.show("성공!");
                },
                error: function(error) {
                    console.log("Create EntitySet 에러!", error);
                }
            })
        },
        onSelectionChangePerson: function(oEvent) {
            let oModel = this.getView().getModel("view");   // JSONModel (이름: view) 호출
            let oParam = oEvent.getParameters();    // oEvent 객체의 파라미터들 가져오기
            if(oParam.selected) {   // 만약 row가 선택됐다면
                // 해당 Row의 바인딩 정보를 가져옴 (바인딩된 모델중, ZCODE_PERSON2_SRV 모델에 대해)
                let oData = oParam.listItem.getBindingContext("ZCODE_PERSON2_SRV").getObject();
                // view 모델에 내가 선택한 데이터를 적용
                oModel.setData(oData, true); // JSONModel (이름: view)의 필드명이 동일해서 가능한 것
            }
        },
        onUpdate: function() {
            // 여기서 사용자 입력값에 따라 oDataModel update 로직 수행
            // 우선 사용자 입력값이 들어있는 view 모델을 가져옴
            let oModel = this.getView().getModel("view");
            let oData = oModel.getData();

            let sPath = this._oPersonModel.createKey("/PersonSet", {
                Perno : oData.Perno
            }) // 경로를 만들어줌. 예시: "/PersonSet('1000')"

            let oBody = {
                Perno       : oData.Perno,
                Firstname   : oData.Firstname,
                Lastname    : oData.Lastname,
                Memo        : oData.Memo
            }
            debugger;
            this._oPersonModel.update(sPath, oBody, {
                success: function(oReturn) {
                    sap.m.MessageToast.show(oReturn);
                },
                error: function() {
                    sap.m.MessageToast.show("수정 에러 발생!");
                }
            });
        },
        onRefresh: function() {
            this._oPersonModel.refresh();
        },
        onDelete: function() {
            let oModel = this.getView().getModel("view");
            let oData = oModel.getData();

            let sPath = this._oPersonModel.createKey("/PersonSet", {
                Perno : oData.Perno
            }) // 경로를 만들어줌. 예시: "/PersonSet('1000')"

            this._oPersonModel.remove(sPath, {
                success: function() {
                    sap.m.MessageToast.show("삭제 완료!");
                },
                error: function() {
                    sap.m.MessageToast.show("삭제 에러!");
                }
            })
        }
    });
});
```
</br>

**3) Main.view.xml**
```html
// test1
<mvc:View controllerName="test1.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns:l = "sap.ui.layout"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <l:Grid containerQuery="true" 
                class="sapUiSmallMargin"
                defaultSpan="XL3 L4 M4 S12">
                <Input value="{view>/Perno}" description="Person No."/>
                <Input value="{view>/Firstname}" description="First Name"/>
                <Input value="{view>/Lastname}" description="Last Name"/>
                <Input value="{view>/Memo}" description="Memo"/>
        </l:Grid>

        <!-- sap.m.table 추가 -->
        <Table id="idPersonTable"
            inset="false"
            mode="SingleSelectMaster"
            selectionChange="onSelectionChangePerson"
            items="{ZCODE_PERSON2_SRV>/PersonSet}">
            <headerToolbar>
                <OverflowToolbar>
                    <content>
                        <Title text="Person" level="H2"/>
                        <Button text="EntitySet" press="onReadEntitySet" />
                        <Button text="Create" press="onCreate" />
                        <Button text="Update" press="onUpdate" />
                        <Button text="Delete" press="onDelete" />
                        <Button icon="sap-icon://refresh" press="onRefresh" />
                    </content>
                </OverflowToolbar>
            </headerToolbar>
            <infoToolbar>
                <OverflowToolbar>
                    <Label text="Person"/>
                </OverflowToolbar>
            </infoToolbar>
            <columns>
                <Column><Text text="Perno" /></Column>
                <Column><Text text="Name" /></Column>
                <Column><Text text="Memo" /></Column>
            </columns>
            <items>
                <ColumnListItem vAlign="Middle">
                    <cells>
                        <Text text="{ZCODE_PERSON2_SRV>Perno}" />
                        <ObjectIdentifier title="{ZCODE_PERSON2_SRV>Firstname}" text="{ZCODE_PERSON2_SRV>Lastname}"/>
                        <Text text="{ZCODE_PERSON2_SRV>Memo}" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>

        <Table id="idProductsTable"
            inset="false"
            mode="SingleSelectLeft"
            selectionChange="onSelectionChange"
            items="{/Carriers}">
            <headerToolbar>
                <OverflowToolbar>
                    <content>
                        <Title text="Products" level="H2"/>
                        <ToolbarSpacer />
                        <Button text="버튼" press="onPress" />
                    </content>
                </OverflowToolbar>
            </headerToolbar>
            <infoToolbar>
                <OverflowToolbar>
                    <Label text="Wide range of available products"/>
                </OverflowToolbar>
            </infoToolbar>
            <columns>
                <Column><Text text="Carrid" /></Column>
                <Column><Text text="Carrname" /></Column>
                <Column><Text text="Currcode" /></Column>
                <Column><Text text="Url" /></Column>
            </columns>
            <items>
                <ColumnListItem vAlign="Middle">
                    <cells>
                        <Text text="{Carrid}" />
                        <Text text="{Carrname}" />
                        <Text text="{Currcode}" />
                        <Text text="{Url}" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>
    </Page>
</mvc:View>
```

</br>
</br>
</br>

### 과제 1 : 테이블 선택 후 다이얼로그를 통한 데이터 수정 실습
- CRUD 프로그램 실습
<img width="739" height="300" alt="image" src="https://github.com/user-attachments/assets/b8cf4b20-472f-4401-8d48-e3133c543ddd" />

</br>
</br>

**1) SAP GUI 코드**
- UPDATE_ENTITY
```abap
" ZCL_ZCODE_PERSON2_DPC_EXT : PERSONSET_UPDATE_ENTITY
  method PERSONSET_UPDATE_ENTITY.
    DATA: ls_entity TYPE ZCL_ZCODE_PERSON2_mpc=>ts_person,
          ls_data   TYPE zcl2person.

    io_data_provider->read_entry_data(
      IMPORTING es_data = ls_entity
    ).

    IF sy-subrc = 0.
      MOVE-CORRESPONDING ls_entity TO ls_data.
      UPDATE zcl2person FROM ls_data.
    ENDIF.
  endmethod.
```

</br>

**2) Main.controller.js**
```java
// assignment1
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/Filter",
    "sap/ui/model/FilterOperator",
     "sap/ui/model/json/JSONModel",
     "sap/ui/core/Fragment"
], (Controller, Filter, FilterOperator, JSONModel, Fragment) => {
    "use strict";

    return Controller.extend("assignment1.controller.Main", {
        onInit() {
            this.oInputModel = new JSONModel();     
            this.getView().setModel(this.oInputModel, "oInputModel");   
            this.oDataModel = this.getOwnerComponent().getModel();  
        },
        onSearch: function() {
            let oInput = this.oInputModel.getData();    // 입력값 (필터)
            let oFilter = [];
            let oDateFormat = sap.ui.core.format.DateFormat.getInstance({
                pattern: "yyyyMMdd",
                UTC: true
            });
            let oStartDate = oDateFormat.parse(oInput.Assigndate);
            let oEndDate = oDateFormat.parse("20260701");
            oFilter.push(new Filter("Assigndate", FilterOperator.BT, oStartDate, oEndDate));
            oFilter.push(new Filter("Memo", FilterOperator.EQ, oInput.Memo));

            this.byId("idEmployeeTable").getBinding("items").filter(oFilter);
        },
        onSelectionChange: function(oEvent) {
            let oData = oEvent.getParameters().listItem.getBindingContext().getObject();    // 선택한 열의 데이터 가져오기
            let oModel = new JSONModel(oData);      // 선택한 열의 데이터로 모델 생성 -> 다이얼로그에서 쓰기 위함
            let oDialog = sap.ui.getCore().byId("idDialog");    

            if(oDialog) {      
                oDialog.setModel(oModel, "oDialogModel");
                oDialog.open();
            }
            else {
                Fragment.load({
                    name: "assignment1.view.fragment.Dialog",        
                    type: "XML",        
                    controller: this    
                }).then(function(oDialog) {
                    oDialog.setModel(oModel, "oDialogModel");
                    oDialog.open();
                }.bind(this))
            }
        },
        onSave: function() {
            let oModel = sap.ui.getCore().byId("idDialog").getModel("oDialogModel");    // 다이얼로그에서 수정한 데이터 값
            let oData = oModel.getData();
            oData.Assigndate.setMinutes(
                oData.Assigndate.getMinutes() - oData.Assigndate.getTimezoneOffset()
            );

            let sPath = this.oDataModel.createKey("/EmployeeSet", {
                Empno : oData.Empno,
                Projod : oData.Projod
            })
            this.oDataModel.update(sPath, oData, {
                success: function() {
                    sap.m.MessageToast.show("수정 성공!");
                    this.oDataModel.refresh();
                }.bind(this),
                error: function() {
                    sap.m.MessageToast.show("수정 에러!");
                }
            })
        },
        onClose: function(oEvent) {
            oEvent.getSource().getParent().close();
        }
    });
});
```
</br>

**3) Main.view.xml**
```html
// assignment1
<mvc:View controllerName="assignment1.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:f="sap.f"
    xmlns:layout="sap.ui.layout"
    xmlns:fb="sap.ui.comp.filterbar"
    xmlns="sap.m">
    <f:DynamicPage id="dynamicPageId" headerExpanded="true" toggleHeaderOnTitleClick="false">
        <!-- DynamicPage Title -->
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title text="Header Title"/>
                </f:heading>
                <!-- <f:content>
                    <OverflowToolbar>
                    </OverflowToolbar>
                </f:content> -->
            </f:DynamicPageTitle>
        </f:title>
        <!-- DynamicPage Header -->
        <f:header>
            <f:DynamicPageHeader pinnable="false">
                <fb:FilterBar id="filterbar" search="onSearch" persistencyKey="myPersKey" useToolbar="false" showGoOnFB="true" showFilterConfiguration="false">
                    <fb:filterGroupItems>
                        <fb:FilterGroupItem name="Assigndate" groupName="Group1" label="Assign Date" visibleInFilterBar="true">
                            <fb:control>
                                <DatePicker value="{oInputModel>/Assigndate}" />
                            </fb:control>
                        </fb:FilterGroupItem>
                        <fb:FilterGroupItem name="Memo" groupName="Group1" label="Memo" visibleInFilterBar="true">
                            <fb:control>
                                <Input value="{oInputModel>/Memo}"/>
                            </fb:control>
                        </fb:FilterGroupItem>
                        <!-- <fb:FilterGroupItem name="Search" groupName="Group1" visibleInFilterBar="true">
                            <fb:control>
                                <Button text="검색버튼" press="onPress" />
                            </fb:control>
                        </fb:FilterGroupItem> -->
                    </fb:filterGroupItems>
                </fb:FilterBar>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>
            <Table id="idEmployeeTable"
                    sticky="HeaderToolbar,ColumnHeaders"
                    inset="false"
                    items="{/EmployeeSet}"
                    selectionChange="onSelectionChange"
                    class="sapFDynamicPageAlignContent"
                    mode="SingleSelectLeft"
                    width="auto">
                <headerToolbar>
                    <Toolbar>
                        <Title text="Products" level="H2"/>
                    </Toolbar>
                </headerToolbar>
                <columns>
                    <Column width="12em">
                        <Text text="Empno" />
                    </Column>
                    <Column width="12em">
                        <Text text="Projod" />
                    </Column>
                    <Column width="12em">
                        <Text text="Assigndate" />
                    </Column>
                    <Column width="12em">
                        <Text text="Role" />
                    </Column>
                    <Column width="12em">
                        <Text text="Memo" />
                    </Column>
                </columns>
                <items>
                    <ColumnListItem>
                        <cells>
                            <Text text="{Empno}" />
                            <Text text="{Projod}" />
                            <Text text="{
                                path: 'Assigndate',
                                type: 'sap.ui.model.type.DateTime',
                                formatOptions: { pattern : 'yyyy-MM-dd' }
                            }" />
                            <Text text="{Role}" />
                            <Text text="{Memo}" />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </f:content>
    </f:DynamicPage>
</mvc:View>
```
</br>

**4) Dialog.fragment.xml**
```html
// assignment1
<c:FragmentDefinition 
    xmlns="sap.m" 
    xmlns:f="sap.ui.layout.form"
    xmlns:c="sap.ui.core">
    <Dialog id="idDialog"
            title="Select List"
            contentHeight="40%"
            contentWidth="20%">
        <content>
            <f:SimpleForm
                layout="ColumnLayout"
                columnsXL="1"
                columnsL="1"
                columnsM="1">
                <f:content>
                    <Label text="Empno"/>
                    <Input value="{oDialogModel>/Empno}" />
                    <Label text="Projod"/>
                    <Input value="{oDialogModel>/Projod}" />
                    <Label text="Assign date"/>
                    <DatePicker
                        dateValue="{oDialogModel>/Assigndate}"
                        displayFormat="yyyy-MM-dd"
                    />
                    <Label text="Role"/>
                    <Input value="{oDialogModel>/Role}" />
                    <Label text="Memo"/>
                    <Input value="{oDialogModel>/Memo}" />
                </f:content>
            </f:SimpleForm>
        </content>
        <buttons>
            <Button text="저장" press=".onSave" />
            <Button text="닫기" press=".onClose" />
        </buttons>
    </Dialog>
</c:FragmentDefinition>
```
</br>
</br>

---

</br>

# 02/09
</br>

## <  핵심 개념 >
- **1) 조회(GET)는 HTTP 가능, 데이터 변경(Create/Update/Delete)은 HTTPS 필수**
- **2) sap.ui.model.odata.v2.ODataModel CRUD 메서드**
- **3) Header–Item 구조 OData 서비스 구현**

</br>
</br>

---

</br>

## < 추가적인 내용 >
</br>

- 외부(OData) 호출로 실행되는 DPC_EXT 메소드 디버깅을 위해 External Breakpoint 설정
- 오른쪽 마우스 클릭으로 설정 가능
<img width="523" height="323" alt="image" src="https://github.com/user-attachments/assets/26704ad0-f422-4243-8533-f5264f80e8d7" />
</br>
</br>
</br>

- `GET`: FilterOperator.EQ 조건으로 특정 필드 값이 정확히 일치하는 데이터만 조회하는 OData 필터 조건
<img width="752" height="404" alt="image" src="https://github.com/user-attachments/assets/7fe1ff26-aaf6-4bc6-a118-8e7a29b51ed8" />
</br>
</br>
</br>

- `sap.ui.model.odata.v2.ODataModel` 로 검색하면 OData CRUD(Create/Read/Update/Delete) 메소드들을 한 번에 확인할 수 있음
<img width="614" height="347" alt="image" src="https://github.com/user-attachments/assets/ce95e16e-be58-4fc0-b8e5-290b2d333fbe" />
</br>
</br>
</br>

---

</br>

## < sap.ui.model.odata.v2.ODataModel CRUD 메서드 정리 >
</br>

### 1) Create
- `ZCL_ZCODE_PERSON2_MPC=>TS_PERSON` : 화면에서 보내는 Person 데이터 구조
- `io_data_provider->read_entry_data` : 화면 입력값을 ABAP 변수로 읽어옴
- `er_entity` : 저장 결과를 화면으로 다시 전달
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_CREATE_ENTITY

  method EMPLOYEESET_CREATE_ENTITY.
* POST 요청을 통해 실제 DB TABLE에 데이터를 추가하는 과정
* BODY 에 담긴 생성 데이터를 io_data_provider를 통해 가져옴
* DB Table에 Insert 후, 처리 결과를 ER_ENTITY로 전달

    " Entity 구조(UI5 ↔ OData 통신용)와 DB 테이블 구조 분리
    DATA: ls_entity TYPE ZCL_ZGWEMP_B03_MPC=>ts_employee,
          ls_data TYPE ztempinfo_b03.

    " es_data에 Request Body(JSON) 정보가 들어옴
    io_data_provider->read_entry_data( IMPORTING es_data = ls_entity ).
    CHECK sy-subrc = 0.
    MOVE-CORRESPONDING ls_entity TO ls_data.

* 실제 DB에 추가하기 전, 데이터 작업 가능
    ls_data-memo = '이건 메모야~~'.
    INSERT ztempinfo_b03 FROM ls_data.
    IF sy-subrc = 0.
      MOVE-CORRESPONDING ls_entity TO er_entity.
    ENDIF.
  endmethod.
```
- SAP Gateway Client에서 POST(Create) 요청으로 JSON 데이터를 보내고, DB에 저장된 결과가 OData 응답으로 그대로 반환되는 화면
- 조회(GET)는 HTTP 가능, 데이터 변경(Create/Update/Delete)은 HTTPS 필수
<img width="632" height="366" alt="image" src="https://github.com/user-attachments/assets/cf01e657-90d9-49c0-a80f-11526fff16d4" />
</br>
</br>
</br>
</br>

### 2) Update
- `ZCL_ZCODE_PERSON2_MPC=>TS_PERSON` : 화면에서 보내는 Person 데이터 구조
- `UPDATE_ENTITY` 는 응답으로 데이터를 돌려줄 필요가 없어서 `er_entity` 가 없어도 정상임
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_UPDATE_ENTITY

  METHOD employeeset_update_entity.
* PUT 요청을 통해서 실제 테이블에 데이터를 변경하는 과정
* BODY에 담긴 변경 대상 데이터를 io_data_provider로 얻어옴
* DB Update를 진행

    DATA: ls_entity TYPE zcl_zgwemp_b03_mpc=>ts_employee,
          ls_data   TYPE ztempinfo_b03.
    io_data_provider->read_entry_data( IMPORTING es_data = ls_entity ).

    SELECT SINGLE * FROM ztempinfo_b03
      INTO ls_data
      WHERE empno = ls_entity-empno
        AND projod = ls_entity-projod.
    IF sy-subrc = 0.
      " 만약, 별도의 DATA 세팅이 필요한 경우 여기서 ㅈ가성
      " LS_DATA-MEMO = '이건 변경이야'.
      ls_data-memo = ls_entity-memo.
      ls_data-assigndate = ls_entity-assigndate.
      ls_data-role = ls_entity-role.
      UPDATE ztempinfo_b03 FROM ls_data.
    ENDIF.
  ENDMETHOD.
```
- SAP Gateway Client에서 PUT(UPDATE) 요청으로 특정 Entity를 수정하고, UPDATE_ENTITY가 실행되어 DB 데이터가 변경되는 테스트 화면
<img width="623" height="347" alt="image" src="https://github.com/user-attachments/assets/337c1a2b-df31-458c-bd93-936a54d8ad50" />
</br>
</br>
</br>
</br>

### 3) Delete
- DELETE 요청 시 URL로 전달된 키 값(`it_key_tab`)을 DB 구조에 매핑하여 해당 레코드를 테이블에서 삭제
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_DELETE_ENTITY

  METHOD employeeset_delete_entity.
    " Delete 요청을 통해서 실제 테이블 데이터를 삭제
    " IT_KEY_TAB 파라미터에 들어온 값을 갖고
    " 해당되는 데이터를 DB Table에서 삭제

    " 1. DB 테이블과 동일한 구조의 변수 선언
    " 2. IT_KEY_TAB 파라미터에 들어온 값으로 변수에 키 값 세팅
    " 3. 변수에 해당되는 레코드를 DB Table에서 삭제
    "    delete <db tab> FROM <structure>

    " 실제 테스트.Body 없이 HTTP Method, URL만 구성
    " => /EntitySet(key1='값',key2='값')

    DATA: ls_data TYPE ztempinfo_b03.

    LOOP AT it_key_tab INTO DATA(ls_key).
      ls_data-(ls_key-name) = ls_key-value.
*      CASE ls_key-name.
*        WHEN 'Empno'.
*          ls_data-empno = ls_key-value.
*        WHEN 'Projod'.
*          ls_data-projod = ls_key-value.
*        WHEN OTHERS.
*      ENDCASE.
    ENDLOOP.

    DELETE ztempinfo_b03 FROM ls_data.
  ENDMETHOD.
```
- SAP Gateway Client에서 DELETE 요청으로 특정 Entity를 삭제하면 DELETE_ENTITY가 실행되어 DB 데이터가 삭제됨을 확인하는 테스트 화면
<img width="673" height="334" alt="image" src="https://github.com/user-attachments/assets/c0f25fe0-313c-4425-bc91-dbecd49e9777" />
</br>
</br>
</br>
</br>

---

</br>

## < Header–Item 구조 OData 서비스 구현 >
</br>

**1) DDIC 구조 기반 Header / Item Entity 생성**
- ABAP DDIC 구조(Header, Item)를 Import하여 OData Entity Type과 EntitySet을 생성
  
<img width="676" height="361" alt="image" src="https://github.com/user-attachments/assets/6e0c39cb-4d8b-4d1b-8091-fc447b0ec3fe" />

<img width="683" height="365" alt="image" src="https://github.com/user-attachments/assets/d61fe763-f994-494c-ae52-ce3cd4c6e1b5" />
</br>
</br>
</br>
</br>

**2) Header–Item Association 생성 (1:N 관계 설정)**
- Header와 Item Entity를 Carrid 키로 연결하여 1:N 관계의 Association 및 Navigation Property를 생성

<img width="323" height="249" alt="image" src="https://github.com/user-attachments/assets/11a4a940-063d-4caf-86c3-1f4fb444fdb5" />

<img width="252" height="251" alt="image" src="https://github.com/user-attachments/assets/79aa0ff0-dab8-41cc-94eb-ec0aa9cf84c2" />

<img width="760" height="239" alt="image" src="https://github.com/user-attachments/assets/6ef6fafb-2dde-46da-8886-de483c25efb6" />

<img width="694" height="96" alt="image" src="https://github.com/user-attachments/assets/0614ec84-189e-4575-92c7-e25ce10060f9" />

<img width="711" height="135" alt="image" src="https://github.com/user-attachments/assets/4db70a20-18a5-4a78-bccd-8c4b1fbe1578" />

<img width="720" height="75" alt="image" src="https://github.com/user-attachments/assets/b07d1492-8d61-4cb7-a67b-b985b5b081cb" />
</br>
</br>
</br>
</br>

**3) Header–Item OData 서비스 클래스 생성 및 서비스 활성화**
- Header–Item 모델을 기반으로 MPC/DPC 클래스를 생성하고, OData 서비스를 등록·활성화하여 외부에서 호출 가능하도록 설정

<img width="516" height="406" alt="image" src="https://github.com/user-attachments/assets/907562da-2d0f-4ffe-afff-0d1ee717a557" />

<img width="853" height="426" alt="image" src="https://github.com/user-attachments/assets/2e217943-5f49-4b69-afd2-c9444bd0cb91" />
</br>
</br>
</br>
</br>

**4) $expand를 이용한 Header–Item 연계 조회 테스트**
- SAP Gateway Client에서 HeaderSet 조회 시 `$expand=ItemSet` 을 사용해 Header와 하위 Item 데이터를 한 번에 조회
```html
/HeaderSet?$format=json&$expand=ItemSet
```
<img width="804" height="461" alt="image" src="https://github.com/user-attachments/assets/d7a6770b-ede9-43d1-be5c-3aceacca7f16" />
</br>
</br>
</br>
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1 : SAP OData 서비스를 이용해 Employee 데이터를 조회·생성·수정·삭제(CRUD)
- CRUD 구현 실습
- FilterBar로 조건 조회, 테이블에서 선택한 데이터를 Create/Update 다이얼로그로 처리, OData CRUD 실습
</br>
</br>

**1) SAP GUI 코드**
- GET_ENTITYSET
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_GET_ENTITYSET

  method EMPLOYEESET_GET_ENTITYSET.
    DATA: lv_where_clause TYPE string.
        " 전체 필터 조건을 SQL WHERE 절 문자열로 변환
        lv_where_clause = io_tech_request_context->get_osql_where_clause( ).
        SELECT * FROM ztempinfo_b03
          INTO CORRESPONDING FIELDS OF TABLE et_entityset
          WHERE (lv_where_clause).
*    DATA: lr_memo TYPE /IWBEP/T_COD_SELECT_OPTIONS,
*          lr_role TYPE /IWBEP/T_COD_SELECT_OPTIONS,
*          lr_projod TYPE /IWBEP/T_COD_SELECT_OPTIONS,
*          lr_date TYPE /IWBEP/T_COD_SELECT_OPTIONS.
*
*    IF it_filter_select_options IS INITIAL.
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset.
*    ELSE.
*      " 만약 필터 정보가 들어왔다면, 필터 적용
*      LOOP AT it_filter_select_options INTO DATA(ls_filter).
*        CASE ls_filter-property.
*          WHEN 'Memo'.
*            APPEND LINES OF ls_filter-select_options TO lr_memo.
*          WHEN 'Role'.
*            APPEND LINES OF ls_filter-select_options TO lr_role.
*          WHEN 'Projod'.
*            APPEND LINES OF ls_filter-select_options TO lr_projod.
*          WHEN 'Assigndate'.
*            APPEND LINES OF ls_filter-select_options TO lr_date.
*          WHEN OTHERS.
*        ENDCASE.
*      ENDLOOP.
*
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset
*        WHERE Memo IN lr_memo
*          AND Role IN lr_role
*          AND projod IN lr_projod
*          AND assigndate IN lr_date.
*    ENDIF.
**********************************************************************
*    IF iv_filter_string IS INITIAL.
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset.
*    ELSE.
*      SELECT * FROM ztempinfo_b03
*        INTO CORRESPONDING FIELDS OF TABLE et_entityset
*        WHERE (iv_filter_string).
*    ENDIF.
  endmethod.
```
- GET_ENTITY
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_GET_ENTITY

  method EMPLOYEESET_GET_ENTITY.
    DATA: ls_data TYPE ztempinfo_b03.

    "/EntitySet(key1='값1',key2='값2')
    LOOP AT it_key_tab INTO DATA(ls_key).
      CASE ls_key-name. " 키 프로퍼티의 이름(Entity기준)
        WHEN 'Empno'.
          ls_data-empno = ls_key-value.
        WHEN 'Projod'.
          ls_data-projod = ls_key-value.
        WHEN OTHERS.
      ENDCASE.
    ENDLOOP.

    SELECT SINGLE * FROM ztempinfo_b03
      INTO @DATA(ls_result)
      WHERE empno = @ls_data-empno
        AND projod = @ls_data-projod.

    IF sy-subrc = 0.
      MOVE-CORRESPONDING ls_result TO er_entity.
    ENDIF.
  endmethod.
```
- CREATE_ENTITY
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_CREATE_ENTITY

  method EMPLOYEESET_CREATE_ENTITY.
* POST 요청을 통해 실제 DB TABLE에 데이터를 추가하는 과정
* BODY 에 담긴 생성 데이터를 io_data_provider를 통해 가져옴
* DB Table에 Insert 후, 처리 결과를 ER_ENTITY로 전달

    " Entity 구조(UI5 ↔ OData 통신용)와 DB 테이블 구조 분리
    DATA: ls_entity TYPE ZCL_ZGWEMP_B03_MPC=>ts_employee,
          ls_data TYPE ztempinfo_b03.

    " es_data에 Request Body(JSON) 정보가 들어옴
    io_data_provider->read_entry_data( IMPORTING es_data = ls_entity ).
    CHECK sy-subrc = 0.
    MOVE-CORRESPONDING ls_entity TO ls_data.

* 실제 DB에 추가하기 전, 데이터 작업 가능
    ls_data-memo = '이건 메모야~~'.
    INSERT ztempinfo_b03 FROM ls_data.
    IF sy-subrc = 0.
      MOVE-CORRESPONDING ls_entity TO er_entity.
    ENDIF.
  endmethod.
```
- UPDATE_ENTITY
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_UPDATE_ENTITY

  METHOD employeeset_update_entity.
* PUT 요청을 통해서 실제 테이블에 데이터를 변경하는 과정
* BODY에 담긴 변경 대상 데이터를 io_data_provider로 얻어옴
* DB Update를 진행

    DATA: ls_entity TYPE zcl_zgwemp_b03_mpc=>ts_employee,
          ls_data   TYPE ztempinfo_b03.
    io_data_provider->read_entry_data( IMPORTING es_data = ls_entity ).

    SELECT SINGLE * FROM ztempinfo_b03
      INTO ls_data
      WHERE empno = ls_entity-empno
        AND projod = ls_entity-projod.
    IF sy-subrc = 0.
      " 만약, 별도의 DATA 세팅이 필요한 경우 여기서 ㅈ가성
      " LS_DATA-MEMO = '이건 변경이야'.
      ls_data-memo = ls_entity-memo.
      ls_data-assigndate = ls_entity-assigndate.
      ls_data-role = ls_entity-role.
      UPDATE ztempinfo_b03 FROM ls_data.
    ENDIF.
  ENDMETHOD.
```
- DELETE_ENTITY
```abap
" ZCL_ZGWEMP_B03_DPC_EXT : EMPLOYEESET_DELETE_ENTITY

  METHOD employeeset_delete_entity.
    " Delete 요청을 통해서 실제 테이블 데이터를 삭제
    " IT_KEY_TAB 파라미터에 들어온 값을 갖고
    " 해당되는 데이터를 DB Table에서 삭제

    " 1. DB 테이블과 동일한 구조의 변수 선언
    " 2. IT_KEY_TAB 파라미터에 들어온 값으로 변수에 키 값 세팅
    " 3. 변수에 해당되는 레코드를 DB Table에서 삭제
    "    delete <db tab> FROM <structure>

    " 실제 테스트.Body 없이 HTTP Method, URL만 구성
    " => /EntitySet(key1='값',key2='값')

    DATA: ls_data TYPE ztempinfo_b03.

    LOOP AT it_key_tab INTO DATA(ls_key).
      ls_data-(ls_key-name) = ls_key-value.
*      CASE ls_key-name.
*        WHEN 'Empno'.
*          ls_data-empno = ls_key-value.
*        WHEN 'Projod'.
*          ls_data-projod = ls_key-value.
*        WHEN OTHERS.
*      ENDCASE.
    ENDLOOP.

    DELETE ztempinfo_b03 FROM ls_data.
  ENDMETHOD.
```
</br>
</br>

**2) Main.controller.js**
```java
// assignment1

sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/Filter",
    "sap/ui/model/FilterOperator",
     "sap/ui/model/json/JSONModel",
     "sap/ui/core/Fragment"
], (Controller, Filter, FilterOperator, JSONModel, Fragment) => {
    "use strict";

    return Controller.extend("assignment1.controller.Main", {
        onInit() {
            this.oInputModel = new JSONModel();     
            this.getView().setModel(this.oInputModel, "oInputModel");   
            this.oDataModel = this.getOwnerComponent().getModel();  
        },
        onSearch: function() {
            let oInput = this.oInputModel.getData();    // 입력값 (필터)
            let oFilter = [];
            let oDateFormat = sap.ui.core.format.DateFormat.getInstance({
                pattern: "yyyyMMdd",
                UTC: true
            });
            let oStartDate = oDateFormat.parse(oInput.Assigndate);
            let oEndDate = oDateFormat.parse("20260701");
            oFilter.push(new Filter("Assigndate", FilterOperator.BT, oStartDate, oEndDate));
            oFilter.push(new Filter("Memo", FilterOperator.EQ, oInput.Memo));

            this.byId("idEmployeeTable").getBinding("items").filter(oFilter);
        },
        onSelectionChange: function(oEvent) {
            // let oData = oEvent.getParameters().listItem.getBindingContext().getObject();    // 선택한 열의 데이터 가져오기
            // let oModel = new JSONModel(oData);      // 선택한 열의 데이터로 모델 생성 -> 다이얼로그에서 쓰기 위함
            // let oDialog = sap.ui.getCore().byId("idUpdateDialog");    

            // if(oDialog) {      
            //     oDialog.setModel(oModel, "oUpdateModel");
            //     oDialog.open();
            // }
            // else {
            //     Fragment.load({
            //         name: "assignment1.view.fragment.UpdateDialog",        
            //         type: "XML",        
            //         controller: this    
            //     }).then(function(oDialog) {
            //         oDialog.setModel(oModel, "oUpdateModel");
            //         oDialog.open();
            //     }.bind(this))
            // }
        },
        onCreate: function() {
            let oModel = new JSONModel();     
            let oDialog = sap.ui.getCore().byId("idCreateDialog");    

            if(oDialog) {      
                oDialog.open();
            }
            else {
                Fragment.load({
                    name: "assignment1.view.fragment.CreateDialog",        
                    type: "XML",        
                    controller: this    
                }).then(function(oDialog) {
                    oDialog.setModel(oModel, "oCreateModel");
                    oDialog.open();
                }.bind(this))
            }
        },
        onCreateButton: function() {
            let oData = sap.ui.getCore().byId("idCreateDialog").getModel("oCreateModel").getData();
            oData.Assigndate.setMinutes(
                oData.Assigndate.getMinutes() - oData.Assigndate.getTimezoneOffset()
            );
            let oBody = {
                Empno   : oData.Empno,
                Projod  : oData.Projod,
                Assigndate  : oData.Assigndate,
                Role    : oData.Role,
                Memo    : oData.Memo
            }
            this.oDataModel.create("/EmployeeSet", oBody, {
                success: function() {
                    sap.m.MessageToast.show("생성 성공!");
                },
                error: function() {
                    sap.m.MessageToast.show("생성 에러!");
                }
            })
        },
        onClose2: function(oEvent) {
            oEvent.getSource().getParent().close();
        },
        onUpdate: function() {
            let oData = this.byId("idEmployeeTable").getSelectedItem().getBindingContext().getObject();    // 선택한 열의 데이터 가져오기
            let oModel = new JSONModel(oData);      // 선택한 열의 데이터로 모델 생성 -> 다이얼로그에서 쓰기 위함
            let oDialog = sap.ui.getCore().byId("idUpdateDialog");    

            if(oDialog) {      
                oDialog.open();
            }
            else {
                Fragment.load({
                    name: "assignment1.view.fragment.UpdateDialog",        
                    type: "XML",        
                    controller: this    
                }).then(function(oDialog) {
                    oDialog.setModel(oModel, "oUpdateModel");
                    oDialog.open();
                }.bind(this))
            }
        },
        onUpdateButton: function() {
            let oModel = sap.ui.getCore().byId("idUpdateDialog").getModel("oUpdateModel");    // 다이얼로그에서 수정한 데이터 값
            let oData = oModel.getData();

            oData.Assigndate.setMinutes(
                oData.Assigndate.getMinutes() - oData.Assigndate.getTimezoneOffset()
            );

            let sPath = this.oDataModel.createKey("/EmployeeSet", {
                Empno : oData.Empno,
                Projod : oData.Projod
            })
            this.oDataModel.update(sPath, oData, {
                success: function() {
                    sap.m.MessageToast.show("수정 성공!");
                    this.oDataModel.refresh();
                }.bind(this),
                error: function() {
                    sap.m.MessageToast.show("수정 에러!");
                }
            })
        },
        onClose: function(oEvent) {
            oEvent.getSource().getParent().close();
        },
        onDelete: function() {
            let oData = this.byId("idEmployeeTable").getSelectedItem().getBindingContext().getObject(); 
            let sPath = this.oDataModel.createKey("/EmployeeSet", {
                Empno: oData.Empno,
                Projod : oData.Projod
            });
            this.oDataModel.remove(sPath);
            sap.m.MessageToast.show("삭제 성공!");
        }
    });
});
```
</br>
</br>

**3) Main.view.xml**
```html
// assignment1

<mvc:View controllerName="assignment1.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:f="sap.f"
    xmlns:layout="sap.ui.layout"
    xmlns:fb="sap.ui.comp.filterbar"
    xmlns="sap.m">
    <f:DynamicPage id="dynamicPageId" headerExpanded="true" toggleHeaderOnTitleClick="false">
        <!-- DynamicPage Title -->
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title text="Header Title"/>
                </f:heading>
                <!-- <f:content>
                    <OverflowToolbar>
                    </OverflowToolbar>
                </f:content> -->
            </f:DynamicPageTitle>
        </f:title>
        <!-- DynamicPage Header -->
        <f:header>
            <f:DynamicPageHeader pinnable="false">
                <fb:FilterBar id="filterbar" search="onSearch" persistencyKey="myPersKey" useToolbar="false" showGoOnFB="true" showFilterConfiguration="false">
                    <fb:filterGroupItems>
                        <fb:FilterGroupItem name="Assigndate" groupName="Group1" label="Assign Date" visibleInFilterBar="true">
                            <fb:control>
                                <DatePicker value="{oInputModel>/Assigndate}" />
                            </fb:control>
                        </fb:FilterGroupItem>
                        <fb:FilterGroupItem name="Memo" groupName="Group1" label="Memo" visibleInFilterBar="true">
                            <fb:control>
                                <Input value="{oInputModel>/Memo}"/>
                            </fb:control>
                        </fb:FilterGroupItem>
                        <!-- <fb:FilterGroupItem name="Search" groupName="Group1" visibleInFilterBar="true">
                            <fb:control>
                                <Button text="검색버튼" press="onPress" />
                            </fb:control>
                        </fb:FilterGroupItem> -->
                    </fb:filterGroupItems>
                </fb:FilterBar>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>
            <Table id="idEmployeeTable"
                    sticky="HeaderToolbar,ColumnHeaders"
                    inset="false"
                    items="{/EmployeeSet}"
                    selectionChange="onSelectionChange"
                    class="sapFDynamicPageAlignContent"
                    mode="SingleSelectLeft"
                    width="auto">
                <headerToolbar>
                    <Toolbar>
                        <Title text="Products" level="H2"/>
                        <Button text="생성" press="onCreate"/>
                        <Button text="수정" press="onUpdate"/>
                        <Button text="삭제" press="onDelete"/>
                    </Toolbar>
                </headerToolbar>
                <columns>
                    <Column width="12em">
                        <Text text="Empno" />
                    </Column>
                    <Column width="12em">
                        <Text text="Projod" />
                    </Column>
                    <Column width="12em">
                        <Text text="Assigndate" />
                    </Column>
                    <Column width="12em">
                        <Text text="Role" />
                    </Column>
                    <Column width="12em">
                        <Text text="Memo" />
                    </Column>
                </columns>
                <items>
                    <ColumnListItem>
                        <cells>
                            <Text text="{Empno}" />
                            <Text text="{Projod}" />
                            <Text text="{
                                path: 'Assigndate',
                                type: 'sap.ui.model.type.DateTime',
                                formatOptions: { pattern : 'yyyy-MM-dd' }
                            }" />
                            <Text text="{Role}" />
                            <Text text="{Memo}" />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </f:content>
    </f:DynamicPage>
</mvc:View>
```
</br>
</br>

**4) CreateDialog.fragment.xml**
```html
// assignment1

<c:FragmentDefinition 
    xmlns="sap.m" 
    xmlns:f="sap.ui.layout.form"
    xmlns:c="sap.ui.core">
    <Dialog id="idCreateDialog"
            title="Create Dialog"
            contentHeight="50%"
            contentWidth="20%">
        <content>
            <f:SimpleForm
                layout="ColumnLayout"
                columnsXL="1"
                columnsL="1"
                columnsM="1">
                <f:content>
                    <Label text="Empno"/>
                    <Input value="{oCreateModel>/Empno}" />
                    <Label text="Projod"/>
                    <Input value="{oCreateModel>/Projod}" />
                    <Label text="Assign date"/>
                    <DatePicker
                        dateValue="{oCreateModel>/Assigndate}"
                        displayFormat="yyyy-MM-dd"
                    />
                    <Label text="Role"/>
                    <Input value="{oCreateModel>/Role}" />
                    <Label text="Memo"/>
                    <Input value="{oCreateModel>/Memo}" />
                </f:content>
            </f:SimpleForm>
        </content>
        <buttons>
            <Button text="생성" press=".onCreateButton" />
            <Button text="닫기" press=".onClose2" />
        </buttons>
    </Dialog>
</c:FragmentDefinition>
```
</br>
</br>

**5) UpdateDialog.fragment.xml**
```html
// assignment1

<c:FragmentDefinition 
    xmlns="sap.m" 
    xmlns:f="sap.ui.layout.form"
    xmlns:c="sap.ui.core">
    <Dialog id="idUpdateDialog"
            title="Update Dialog"
            contentHeight="50%"
            contentWidth="20%">
        <content>
            <f:SimpleForm
                layout="ColumnLayout"
                columnsXL="1"
                columnsL="1"
                columnsM="1">
                <f:content>
                    <Label text="Empno"/>
                    <Input value="{oUpdateModel>/Empno}" />
                    <Label text="Projod"/>
                    <Input value="{oUpdateModel>/Projod}" />
                    <Label text="Assign date"/>
                    <DatePicker
                        dateValue="{oUpdateModel>/Assigndate}"
                        displayFormat="yyyy-MM-dd"
                    />
                    <Label text="Role"/>
                    <Input value="{oUpdateModel>/Role}" />
                    <Label text="Memo"/>
                    <Input value="{oUpdateModel>/Memo}" />
                </f:content>
            </f:SimpleForm>
        </content>
        <buttons>
            <Button text="수정" press=".onUpdateButton" />
            <Button text="닫기" press=".onClose" />
        </buttons>
    </Dialog>
</c:FragmentDefinition>
```
</br>
</br>
</br>

### 실습 1에서 수정한 버전 : Filter를 oData Read에서 적용
- 화면 출력하는 모델을 JSON Model로 바꿈
- oData에서 Read할 때 필터링

**1) Main.controller.js**
```java
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/Filter",
    "sap/ui/model/FilterOperator",
     "sap/ui/model/json/JSONModel",
     "sap/ui/core/Fragment"
], (Controller, Filter, FilterOperator, JSONModel, Fragment) => {
    "use strict";

    return Controller.extend("assignment1.controller.Main", {
        onInit() {
            this.oInputModel = new JSONModel();
            this.oMainModel = new JSONModel();     
            this.getView().setModel(this.oInputModel, "oInputModel");   
            this.getView().setModel(this.oMainModel, "oMainModel");   
            this.oDataModel = this.getOwnerComponent().getModel();  
            this.oDataModel.read("/EmployeeSet", {
                success: function(oReturn) {
                    this.oMainModel.setData(oReturn.results);
                }.bind(this),
            })
        },
        onSearch: function() {
            let oInput = this.oInputModel.getData();    // 입력값 (필터)
            let oFilter = [];
            let oDateFormat = sap.ui.core.format.DateFormat.getInstance({
                pattern: "yyyyMMdd",
                UTC: true
            });
            let oStartDate = oDateFormat.parse(oInput.Assigndate);
            let oEndDate = oDateFormat.parse("20260701");
            debugger;
            if (oStartDate) {
                oFilter.push(
                    new Filter("Assigndate", FilterOperator.BT, oStartDate, oEndDate)
                );
            }
            if(oInput.Memo) {
                oFilter.push(new Filter("Memo", FilterOperator.EQ, oInput.Memo));
            }
            this.oDataModel.read("/EmployeeSet", {
                filters: oFilter,
                success: function(oReturn) {
                    this.oMainModel.setData(oReturn.results);
                    debugger;
                    sap.m.MessageToast.show("필터 성공!");
                }.bind(this),
                error: function() { 
                    sap.m.MessageToast.show("필터 에러!");
                }
            })
            // this.byId("idEmployeeTable").getBinding("items").filter(oFilter);
        },
        onCreate: function() {
            let oModel = new JSONModel();     
            let oDialog = sap.ui.getCore().byId("idCreateDialog");    

            if(oDialog) {      
                oDialog.open();
            }
            else {
                Fragment.load({
                    name: "assignment1.view.fragment.CreateDialog",        
                    type: "XML",        
                    controller: this    
                }).then(function(oDialog) {
                    oDialog.setModel(oModel, "oCreateModel");
                    oDialog.open();
                }.bind(this))
            }
        },
        onCreateButton: function() {
            let oData = sap.ui.getCore().byId("idCreateDialog").getModel("oCreateModel").getData();
            if (oData.Assigndate) {
                oData.Assigndate.setMinutes(
                    oData.Assigndate.getMinutes() - oData.Assigndate.getTimezoneOffset()
                );
            }
            let oBody = {
                Empno   : oData.Empno,
                Projod  : oData.Projod,
                Assigndate  : oData.Assigndate,
                Role    : oData.Role,
                Memo    : oData.Memo
            }
            this.oDataModel.create("/EmployeeSet", oBody, {
                success: function() {
                    sap.m.MessageToast.show("생성 성공!");
                },
                error: function() {
                    sap.m.MessageToast.show("생성 에러!");
                }
            })
            this.oDataModel.read("/EmployeeSet", {
                success: function(oReturn) {
                    this.oMainModel.setData(oReturn.results);
                }.bind(this)
            })
        },
        onClose2: function(oEvent) {
            oEvent.getSource().getParent().close();
        },
        onUpdate: function() {
            let oData = this.byId("idEmployeeTable").getSelectedItem().getBindingContext("oMainModel").getObject();    // 선택한 열의 데이터 가져오기
            let oModel = new JSONModel(oData);      // 선택한 열의 데이터로 모델 생성 -> 다이얼로그에서 쓰기 위함
            let oDialog = sap.ui.getCore().byId("idUpdateDialog");    

            if(oDialog) {      
                oDialog.open();
            }
            else {
                Fragment.load({
                    name: "assignment1.view.fragment.UpdateDialog",        
                    type: "XML",        
                    controller: this    
                }).then(function(oDialog) {
                    oDialog.setModel(oModel, "oUpdateModel");
                    oDialog.open();
                }.bind(this))
            }
        },
        onUpdateButton: function() {
            let oModel = sap.ui.getCore().byId("idUpdateDialog").getModel("oUpdateModel");    // 다이얼로그에서 수정한 데이터 값
            let oData = oModel.getData();

            oData.Assigndate.setMinutes(
                oData.Assigndate.getMinutes() - oData.Assigndate.getTimezoneOffset()
            );

            let sPath = this.oDataModel.createKey("/EmployeeSet", {
                Empno : oData.Empno,
                Projod : oData.Projod
            })
            this.oDataModel.update(sPath, oData, {
                success: function() {
                    sap.m.MessageToast.show("수정 성공!");
                    this.oDataModel.read("/EmployeeSet", {
                        success: function(oReturn) {
                            this.oMainModel.setData(oReturn.results);
                        }.bind(this)
                    })
                }.bind(this),
                error: function() {
                    sap.m.MessageToast.show("수정 에러!");
                }
            })
            this.oDataModel.read("/EmployeeSet", {
                success: function(oReturn) {
                    this.oMainModel.setData(oReturn.results);
                }.bind(this)
            })
        },
        onClose: function(oEvent) {
            oEvent.getSource().getParent().close();
        },
        onDelete: function() {
            let oData = this.byId("idEmployeeTable").getSelectedItem().getBindingContext("oMainModel").getObject(); 
            let sPath = this.oDataModel.createKey("/EmployeeSet", {
                Empno: oData.Empno,
                Projod : oData.Projod
            });
            this.oDataModel.remove(sPath, {
                success: function () {
                    sap.m.MessageToast.show("삭제 성공!");
                    this.oDataModel.read("/EmployeeSet", {
                        success: function(oReturn) {
                            this.oMainModel.setData(oReturn.results);
                        }.bind(this)
                    })
                }.bind(this)
            });
        }
    });
});
```
</br>
</br>

**2) Main.view.xml**
```html
<mvc:View controllerName="assignment1.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:f="sap.f"
    xmlns:layout="sap.ui.layout"
    xmlns:fb="sap.ui.comp.filterbar"
    xmlns="sap.m">
    <f:DynamicPage id="dynamicPageId" headerExpanded="true" toggleHeaderOnTitleClick="false">
        <!-- DynamicPage Title -->
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title text="Header Title"/>
                </f:heading>
                <!-- <f:content>
                    <OverflowToolbar>
                    </OverflowToolbar>
                </f:content> -->
            </f:DynamicPageTitle>
        </f:title>
        <!-- DynamicPage Header -->
        <f:header>
            <f:DynamicPageHeader pinnable="false">
                <fb:FilterBar id="filterbar" search="onSearch" persistencyKey="myPersKey" useToolbar="false" showGoOnFB="true" showFilterConfiguration="false">
                    <fb:filterGroupItems>
                        <fb:FilterGroupItem name="Assigndate" groupName="Group1" label="Assign Date" visibleInFilterBar="true">
                            <fb:control>
                                <DatePicker value="{oInputModel>/Assigndate}" />
                            </fb:control>
                        </fb:FilterGroupItem>
                        <fb:FilterGroupItem name="Memo" groupName="Group1" label="Memo" visibleInFilterBar="true">
                            <fb:control>
                                <Input value="{oInputModel>/Memo}"/>
                            </fb:control>
                        </fb:FilterGroupItem>
                        <!-- <fb:FilterGroupItem name="Search" groupName="Group1" visibleInFilterBar="true">
                            <fb:control>
                                <Button text="검색버튼" press="onPress" />
                            </fb:control>
                        </fb:FilterGroupItem> -->
                    </fb:filterGroupItems>
                </fb:FilterBar>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>
            <Table id="idEmployeeTable"
                    sticky="HeaderToolbar,ColumnHeaders"
                    inset="false"
                    items="{oMainModel>/}"
                    selectionChange="onSelectionChange"
                    class="sapFDynamicPageAlignContent"
                    mode="SingleSelectLeft"
                    width="auto">
                <headerToolbar>
                    <Toolbar>
                        <Title text="Products" level="H2"/>
                        <Button text="생성" press="onCreate" type="Emphasized"/>
                        <Button text="수정" press="onUpdate" type="Emphasized"/>
                        <Button text="삭제" press="onDelete" type="Emphasized"/>
                    </Toolbar>
                </headerToolbar>
                <columns>
                    <Column width="12em">
                        <Text text="Empno" />
                    </Column>
                    <Column width="12em">
                        <Text text="Projod" />
                    </Column>
                    <Column width="12em">
                        <Text text="Assigndate" />
                    </Column>
                    <Column width="12em">
                        <Text text="Role" />
                    </Column>
                    <Column width="12em">
                        <Text text="Memo" />
                    </Column>
                </columns>
                <items>
                    <ColumnListItem>
                        <cells>
                            <Text text="{oMainModel>Empno}" />
                            <Text text="{oMainModel>Projod}" />
                            <Text text="{
                                path: 'oMainModel>Assigndate',
                                type: 'sap.ui.model.type.DateTime',
                                formatOptions: { pattern : 'yyyy-MM-dd' }
                            }" />
                            <Text text="{oMainModel>Role}" />
                            <Text text="{oMainModel>Memo}" />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </f:content>
    </f:DynamicPage>
</mvc:View>
```
</br>
</br>

---

</br>

# 02/10
</br>

## <  핵심 개념 >
- **1) Header–Item 구조 OData 서비스 구현**
- **2) DatePicker / DateRangeSelection 정리**
</br>
</br>

---

</br>

## < Header–Item 구조 OData 서비스 구현 >
</br>

### 1) Read (GET)
</br>

**1) HEADERSET_GET_ENTITYSET**
- Header 엔티티 전체 목록을 조회하는 기본 EntitySet 조회 메서드
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : HEADERSET_GET_ENTITYSET

  method HEADERSET_GET_ENTITYSET.
    SELECT * FROM zscarrcl2_b03
      INTO TABLE et_entityset.
  endmethod.
```
</br>

**2) ITEMSET_GET_ENTITYSET**
- 특정 Header(Carrid)에 속한 Item 목록을 조회하는 Item EntitySet 메서드
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : ITEMSET_GET_ENTITYSET

  method ITEMSET_GET_ENTITYSET.
    DATA lv_carrid TYPE s_carr_id.
    DATA lt_data TYPE TABLE OF zspflicl2_b03.

    LOOP AT it_key_tab INTO DATA(ls_key).
      IF ls_key-name EQ 'Carrid'.
        MOVE ls_key-value TO lv_carrid.
      ENDIF.
    ENDLOOP.

    SELECT * FROM ZSPFLICL2_B03
      INTO TABLE lt_data
      WHERE carrid = lv_carrid.
    IF sy-subrc = 0.
      MOVE-CORRESPONDING lt_data TO et_entityset.
    ENDIF.
  endmethod.
```
</br>

**3) /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITY**
- `$expand` 요청 시 Header 1건과 연관된 ItemSet을 함께 조회해 한 번에 반환하는 메서드
</br>

- `copy_data_to_ref` → ABAP 내부 구조(또는 테이블) 데이터를 OData 응답(`er_entity` / `er_entityset`)으로 변환·출력하는 메서드
- `lv_nav = 'ITEMSET'` → `$expand` 로 처리한 Navigation Property(ItemSet) 이름을 Gateway에 알려주는 값
- `et_expanded_tech_clauses` → `$expand` 요청 중 실제로 처리한 Navigation Property들을 Gateway에 전달하는 파라미터
- `er_entity` → 조회·가공된 단일 Entity 결과를 OData 응답으로 내려보내는 출력 파라미터

<img width="518" height="323" alt="image" src="https://github.com/user-attachments/assets/21524dd0-fb91-4aac-b01a-26cedd4070d5" />

```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITY

  method /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITY.
    TYPES BEGIN OF ty_headeritem.
      INCLUDE TYPE ZCL_ZGWHEADITEM_B03_MPC=>ts_header.
      TYPES ItemSet TYPE TABLE OF ZCL_ZGWHEADITEM_B03_MPC=>ts_item WITH DEFAULT KEY.
    TYPES END OF ty_headeritem.
    DATA: lv_carrid TYPE s_carr_id,
          ls_header_item TYPE ty_headeritem,
          lv_nav TYPE string VALUE 'ITEMSET'.

    LOOP AT it_key_tab INTO DATA(ls_key).
      IF ls_key-name EQ 'Carrid'.
        MOVE ls_key-value TO lv_carrid.
      ENDIF.
    ENDLOOP.

    " Header 조회
    SELECT SINGLE * FROM zscarrcl2_b03
      INTO CORRESPONDING FIELDS OF ls_header_item
      WHERE carrid = lv_carrid.
    if sy-subrc = 0.
      " Item 조회 (Navigation Property 이름에 맞춰 데이터 채움)
      SELECT * FROM zspflicl2_b03
        INTO CORRESPONDING FIELDS OF TABLE ls_header_item-itemset
        WHERE carrid = lv_carrid.
    ENDIF.

    " 결과 출력(ER_ENTITY)
    copy_data_to_ref(
      EXPORTING is_data = ls_header_item
      CHANGING cr_data = er_entity ).

    " Navigation Property 데이터 처리 완료되었다고 알려주는 파라미터
    INSERT lv_nav INTO TABLE et_expanded_tech_clauses.
  endmethod.
```
</br>

**4) /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITYSET**
- `$expand` 요청으로 Header 여러 건과 각 Header의 ItemSet을 함께 조회할 때 사용하는 메서드
</br>

- `copy_data_to_ref` → ABAP 내부 구조(또는 테이블) 데이터를 OData 응답(`er_entity` / `er_entityset`)으로 변환·출력하는 메서드
- `lv_nav = 'ITEMSET'` → `$expand` 로 처리한 Navigation Property(ItemSet) 이름을 Gateway에 알려주는 값
- `et_expanded_tech_clauses` → `$expand` 요청 중 실제로 처리한 Navigation Property들을 Gateway에 전달하는 파라미터
- `er_entityset` → 조회·가공된 결과(Entity 여러 건)를 OData 응답으로 내려보내는 출력 파라미터
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITYSET

  method /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITYSET.
    TYPES BEGIN OF ts_headeritem.
      INCLUDE TYPE ZCL_ZGWHEADITEM_B03_MPC=>ts_header.
      TYPES ItemSet TYPE TABLE OF ZCL_ZGWHEADITEM_B03_MPC=>ts_item WITH DEFAULT KEY.
    TYPES END OF ts_headeritem.

    TYPES tt_headeritem TYPE STANDARD TABLE OF
      ts_headeritem WITH DEFAULT KEY.

    DATA: lt_header_item_set TYPE tt_headeritem,
          lt_header_db TYPE TABLE OF ZSCARRCL2_B03,
          lt_item_db TYPE TABLE OF ZSPFLICL2_B03,
          lv_nav TYPE string VALUE 'ITEMSET'.
    FIELD-SYMBOLS <fs> TYPE ts_headeritem.

    " 1. Header 조회하고, Headeritem 구조체에 헤더 적용
    SELECT * FROM zscarrcl2_b03
      INTO TABLE lt_header_db.
    IF sy-subrc = 0.
      MOVE-CORRESPONDING lt_header_db TO lt_header_item_set.

      " 2-1. Header에 맞는 Item 조회
      SELECT * FROM zspflicl2_b03
        FOR ALL ENTRIES IN @lt_header_db
        WHERE carrid = @lt_header_db-carrid
        INTO TABLE @lt_item_db.

      " 2-2. Item 루프 돌면서, HeaderItem 구조체의 ItemSet테이블에 적용
      LOOP AT lt_item_db ASSIGNING FIELD-SYMBOL(<fs_item>).
        UNASSIGN <fs>.
        ASSIGN lt_header_item_set[ carrid = <fs_item>-carrid ] TO <fs>.
        APPEND <fs_item> TO <fs>-itemset.
      ENDLOOP.

      " 3. 결과 출력 (ER_ENTITYSET)
      copy_data_to_ref(
        EXPORTING is_data = lt_header_item_set
        CHANGING cr_data = er_entityset
      ).
      INSERT lv_nav INTO TABLE et_expanded_tech_clauses.
    ENDIF.
  endmethod.
```
</br>

**5) Get Gateway로 확인 가능**
```html
/HeaderSet?$format=json&$expand=ItemSet
```
<img width="644" height="167" alt="image" src="https://github.com/user-attachments/assets/4f537639-2bc0-48de-8220-705ab26ad9b2" />
</br>
</br>
</br>
</br>

### 2) Create (POST)
- Header 1건과 그에 속한 Item 여러 건을 한 번에 받아 각각의 DB 테이블에 생성한 뒤, 생성 결과를 응답으로 반환하는 메서드
</br>

- `io_data_provider->read_entry_data` → 요청 payload(body)에 담긴 입력 데이터를 ABAP 구조로 읽어오는 메서드
- `er_deep_entity` → Deep Create 수행 후 생성된 Header–Item 구조를 OData 응답으로 반환하는 출력 파라미터
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : /IWBEP/IF_MGW_APPL_SRV_RUNTIME~CREATE_DEEP_ENTITY

  method /IWBEP/IF_MGW_APPL_SRV_RUNTIME~CREATE_DEEP_ENTITY.
    TYPES BEGIN OF ts_headeritem.
      INCLUDE TYPE ZCL_ZGWHEADITEM_B03_MPC=>ts_header.
      TYPES ItemSet TYPE TABLE OF ZCL_ZGWHEADITEM_B03_MPC=>ts_item WITH DEFAULT KEY.
    TYPES END OF ts_headeritem.

    DATA: ls_create_data TYPE ts_headeritem,
          ls_header TYPE ZCL_ZGWHEADITEM_B03_mpc=>ts_header,
          lt_item TYPE ZCL_ZGWHEADITEM_B03_mpc=>tt_item.
    CASE iv_entity_name.
      WHEN 'Header'.
        io_data_provider->read_entry_data(
          IMPORTING es_data = ls_create_data
        ).

        " 받아온 Header-Item 데이터 분리
        MOVE-CORRESPONDING ls_create_data TO ls_header.
        MOVE-CORRESPONDING ls_create_data-itemset TO lt_item.

        " 각 DB Table에 Create
        INSERT zscarrcl2_b03 FROM ls_header.
        IF sy-subrc = 0.
          INSERT zspflicl2_b03 FROM TABLE lt_item.
          IF sy-subrc <> 0.
            ROLLBACK WORK.  " item insert 실패 시 전체 롤백
          ENDIF.
        ENDIF.

        " 결과 출력 (ER_DEEP_ENTITY)
        copy_data_to_ref(
          EXPORTING is_data = ls_create_data
          CHANGING cr_data = er_deep_entity
        ).
    ENDCASE.
  endmethod.
```

<img width="940" height="682" alt="image" src="https://github.com/user-attachments/assets/3ac5c726-7f61-48a0-acf2-67f377e82d8b" />
</br>
</br>
</br>
</br>
</br>
</br>

---

</br>

## < DatePicker / DateRangeSelection 정리 >
</br>

**1) `DATS` 일 때**
- 서버에 "yyyyMMdd" 문자열로 보내기
- UTC 보정 필요 없음
- JS에서 그냥 문자열 그대로 전송하면 끝
```html
<DatePicker
  value="{oModel>/Date}"
  valueFormat="yyyyMMdd"   
/>
```

**2) `Edm.Date`**
- `type.Date` 사용
- Date 객체 그대로 사용
- UTC 보정 필요 없음
```html
<DatePicker
  value="{
    path: 'oModel>/Date',
    type: 'sap.ui.model.type.Date'
  }"
/>
```

**3) `Edm.DateTime`**
- Date 객체 사용
- 반드시 UTC 보정 필요
```html
fixUTC: function(oDate) {
    if (!oDate) return null;
    return new Date(oDate.getTime() - (oDate.getTimezoneOffset() * 60000));
}
```
</br>
</br>
</br>

```java
oData.Assigndate.setMinutes(
    oData.Assigndate.getMinutes() - oData.Assigndate.getTimezoneOffset()
);

// Edm.DateTime 타입 서버 전송 시 필수
fixUTC: function(oDate) {
    if (!oDate) return null;
    return new Date(oDate.getTime() - (oDate.getTimezoneOffset() * 60000));
}
```
```java
let oDateFormat = sap.ui.core.format.DateFormat.getInstance({
    pattern: "yyyy-MM-dd",
    UTC: true
});
let oStartDate = oDateFormat.parse(oInput.Assigndate);
let oEndDate = oDateFormat.parse("20260701");
```
```html
<!-- 1) type.Date + formatOptions -->
<DatePicker
  value="{
    path: 'oInputModel>/Assigndate',
    type: 'sap.ui.model.type.Date',
    formatOptions: { pattern: 'yyyy-MM-dd' }
  }"
/>

<!-- 2) type.Date + formatOptions (yyyyMMdd) -->
<DatePicker
  value="{
    path: 'oInputModel>/Assigndate',
    type: 'sap.ui.model.type.Date',
    formatOptions: { pattern: 'yyyyMMdd' }
  }"
/>

<!-- 3) valueFormat + displayFormat -->
<DatePicker
  value="{oInputModel>/Assigndate}"
  valueFormat="yyyyMMdd"
  displayFormat="yyyy-MM-dd"
/>

<!-- 4) valueFormat만 -->
<DatePicker
  value="{oInputModel>/Assigndate}"
  valueFormat="yyyyMMdd"
/>

<!-- 5) displayFormat만 -->
<DatePicker
  value="{oInputModel>/Assigndate}"
  displayFormat="yyyy-MM-dd"
/>

<!-- ===================================================== -->
<!-- 6) DateRangeSelection + type.Date + formatOptions -->
<DateRangeSelection
  dateValue="{
    path: 'oInputModel>/StartDate',
    type: 'sap.ui.model.type.Date',
    formatOptions: { pattern: 'yyyy-MM-dd' }
  }"
  secondDateValue="{
    path: 'oInputModel>/EndDate',
    type: 'sap.ui.model.type.Date',
    formatOptions: { pattern: 'yyyy-MM-dd' }
  }"
/>

<!-- 7) DateRangeSelection + valueFormat / displayFormat -->
<DateRangeSelection
  dateValue="{oInputModel>/StartDate}"
  secondDateValue="{oInputModel>/EndDate}"
  valueFormat="yyyyMMdd"
  displayFormat="yyyy-MM-dd"
/>
```
```yaml
[1) type.Date + formatOptions]
화면 : 2026-07-01
JS   : Date 객체
parse() : 필요 없음
의미 : 모델 타입을 Date로 고정, pattern은 화면용

[2) type.Date + formatOptions (yyyyMMdd)]
화면 : 20260701
JS   : Date 객체
parse() : 필요 없음
의미 : 패턴이 달라도 모델은 Date

[3) valueFormat + displayFormat]
화면 : 2026-07-01
JS   : "20260701" (문자열)
parse() : 필요
의미 : valueFormat=모델용, displayFormat=화면용

[4) valueFormat만]
화면 : 20260701
JS   : "20260701"
parse() : 필요
의미 : 화면/모델 포맷 동일, 문자열 기반

[5) displayFormat만]
화면 : 2026-07-01
JS   : 문자열(형식 불명확)
parse() : 상황 따라 필요
의미 : 모델 포맷 제어 안 됨 (비추천)

--------------------------------------------------------

[6) DateRangeSelection + type.Date + formatOptions]
화면 : 2026-07-01 ~ 2026-07-31
JS   : 
  StartDate = Date 객체
  EndDate   = Date 객체
parse() : 필요 없음
의미 : 날짜 범위를 Date 객체로 안전하게 처리 (⭐추천)

[7) DateRangeSelection + valueFormat / displayFormat]
화면 : 2026-07-01 ~ 2026-07-31
JS   :
  StartDate = "20260701"
  EndDate   = "20260731"
parse() : 필요
의미 : 서버/ABAP yyyyMMdd 포맷에 맞춘 범위 검색
```
</br>
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1
- header-item oData 서비스 연결 실습
</br>

**1) SAP GUI 코드**
- `HEADERSET_GET_ENTITYSET`
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : HEADERSET_GET_ENTITYSET

  method HEADERSET_GET_ENTITYSET.
    SELECT * FROM zscarrcl2_b03
      INTO TABLE et_entityset.
  endmethod.
```
- `ITEMSET_GET_ENTITYSET`
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : ITEMSET_GET_ENTITYSET

  method ITEMSET_GET_ENTITYSET.
    DATA lv_carrid TYPE s_carr_id.
    DATA lt_data TYPE TABLE OF zspflicl2_b03.

    LOOP AT it_key_tab INTO DATA(ls_key).
      IF ls_key-name EQ 'Carrid'.
        MOVE ls_key-value TO lv_carrid.
      ENDIF.
    ENDLOOP.

    SELECT * FROM ZSPFLICL2_B03
      INTO TABLE lt_data
      WHERE carrid = lv_carrid.
    IF sy-subrc = 0.
      MOVE-CORRESPONDING lt_data TO et_entityset.
    ENDIF.
  endmethod.
```
- `/IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITY`
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITY

  method /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITY.
    TYPES BEGIN OF ty_headeritem.
      INCLUDE TYPE ZCL_ZGWHEADITEM_B03_MPC=>ts_header.
      TYPES ItemSet TYPE TABLE OF ZCL_ZGWHEADITEM_B03_MPC=>ts_item WITH DEFAULT KEY.
    TYPES END OF ty_headeritem.
    DATA: lv_carrid TYPE s_carr_id,
          ls_header_item TYPE ty_headeritem,
          lv_nav TYPE string VALUE 'ITEMSET'.

    LOOP AT it_key_tab INTO DATA(ls_key).
      IF ls_key-name EQ 'Carrid'.
        MOVE ls_key-value TO lv_carrid.
      ENDIF.
    ENDLOOP.

    " Header 조회
    SELECT SINGLE * FROM zscarrcl2_b03
      INTO CORRESPONDING FIELDS OF ls_header_item
      WHERE carrid = lv_carrid.
    if sy-subrc = 0.
      " Item 조회 (Navigation Property 이름에 맞춰 데이터 채움)
      SELECT * FROM zspflicl2_b03
        INTO CORRESPONDING FIELDS OF TABLE ls_header_item-itemset
        WHERE carrid = lv_carrid.
    ENDIF.

    " 결과 출력(ER_ENTITY)
    copy_data_to_ref(
      EXPORTING is_data = ls_header_item
      CHANGING cr_data = er_entity ).

    " Navigation Property 데이터 처리 완료되었다고 알려주는 파라미터
    INSERT lv_nav INTO TABLE et_expanded_tech_clauses.
  endmethod.
```
- `/IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITYSET`
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITYSET

  method /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITYSET.
    TYPES BEGIN OF ts_headeritem.
      INCLUDE TYPE ZCL_ZGWHEADITEM_B03_MPC=>ts_header.
      TYPES ItemSet TYPE TABLE OF ZCL_ZGWHEADITEM_B03_MPC=>ts_item WITH DEFAULT KEY.
    TYPES END OF ts_headeritem.

    TYPES tt_headeritem TYPE STANDARD TABLE OF
      ts_headeritem WITH DEFAULT KEY.

    DATA: lt_header_item_set TYPE tt_headeritem,
          lt_header_db TYPE TABLE OF ZSCARRCL2_B03,
          lt_item_db TYPE TABLE OF ZSPFLICL2_B03,
          lv_nav TYPE string VALUE 'ITEMSET'.
    FIELD-SYMBOLS <fs> TYPE ts_headeritem.

    " 1. Header 조회하고, Headeritem 구조체에 헤더 적용
    SELECT * FROM zscarrcl2_b03
      INTO TABLE lt_header_db.
    IF sy-subrc = 0.
      MOVE-CORRESPONDING lt_header_db TO lt_header_item_set.

      " 2-1. Header에 맞는 Item 조회
      SELECT * FROM zspflicl2_b03
        FOR ALL ENTRIES IN @lt_header_db
        WHERE carrid = @lt_header_db-carrid
        INTO TABLE @lt_item_db.

      " 2-2. Item 루프 돌면서, HeaderItem 구조체의 ItemSet테이블에 적용
      LOOP AT lt_item_db ASSIGNING FIELD-SYMBOL(<fs_item>).
        UNASSIGN <fs>.
        ASSIGN lt_header_item_set[ carrid = <fs_item>-carrid ] TO <fs>.
        APPEND <fs_item> TO <fs>-itemset.
      ENDLOOP.

      " 3. 결과 출력 (ER_ENTITYSET)
      copy_data_to_ref(
        EXPORTING is_data = lt_header_item_set
        CHANGING cr_data = er_entityset
      ).
      INSERT lv_nav INTO TABLE et_expanded_tech_clauses.
    ENDIF.
  endmethod.
```
- `/IWBEP/IF_MGW_APPL_SRV_RUNTIME~CREATE_DEEP_ENTITY`
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : /IWBEP/IF_MGW_APPL_SRV_RUNTIME~CREATE_DEEP_ENTITY

  method /IWBEP/IF_MGW_APPL_SRV_RUNTIME~CREATE_DEEP_ENTITY.
    TYPES BEGIN OF ts_headeritem.
      INCLUDE TYPE ZCL_ZGWHEADITEM_B03_MPC=>ts_header.
      TYPES ItemSet TYPE TABLE OF ZCL_ZGWHEADITEM_B03_MPC=>ts_item WITH DEFAULT KEY.
    TYPES END OF ts_headeritem.

    DATA: ls_create_data TYPE ts_headeritem,
          ls_header TYPE ZCL_ZGWHEADITEM_B03_mpc=>ts_header,
          lt_item TYPE ZCL_ZGWHEADITEM_B03_mpc=>tt_item.
    CASE iv_entity_name.
      WHEN 'Header'.
        io_data_provider->read_entry_data(
          IMPORTING es_data = ls_create_data
        ).

        " 받아온 Header-Item 데이터 분리
        MOVE-CORRESPONDING ls_create_data TO ls_header.
        MOVE-CORRESPONDING ls_create_data-itemset TO lt_item.

        " 각 DB Table에 Create
        INSERT zscarrcl2_b03 FROM ls_header.
        IF sy-subrc = 0.
          INSERT zspflicl2_b03 FROM TABLE lt_item.
          IF sy-subrc <> 0.
            ROLLBACK WORK.  " item insert 실패 시 전체 롤백
          ENDIF.
        ENDIF.

        " 결과 출력 (ER_DEEP_ENTITY)
        copy_data_to_ref(
          EXPORTING is_data = ls_create_data
          CHANGING cr_data = er_deep_entity
        ).
    ENDCASE.
  endmethod.
```
</br>
</br>

**2) Main.controller.js**
```java
// assignment1

sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/Filter",
    "sap/ui/model/FilterOperator",
     "sap/ui/model/json/JSONModel",
     "sap/ui/core/Fragment"
], (Controller, Filter, FilterOperator, JSONModel, Fragment) => {
    "use strict";

    return Controller.extend("assignment1.controller.Main", {
        onInit() {
            this.oHeaderModel = this.getOwnerComponent().getModel("ZGWHEADITEM_B03_SRV");  
            this.oHeaderModel.read("/HeaderSet", {
                urlParameters: { "$expand": "ItemSet" },
                success: function(oReturn) {
                    sap.m.MessageToast.show("Header 전체 조회 성공!");
                    console.log(oReturn.results);
                    debugger;
                }.bind(this),
                error: function() { 
                    sap.m.MessageToast.show("Header 전체 조회 에러!");
                }
            })

            this.oInputModel = new JSONModel();
            this.oMainModel = new JSONModel();     
            this.getView().setModel(this.oInputModel, "oInputModel");   
            this.getView().setModel(this.oMainModel, "oMainModel");   
            this.oDataModel = this.getOwnerComponent().getModel();  
            this.oDataModel.read("/EmployeeSet", {
                success: function(oReturn) {
                    this.oMainModel.setData(oReturn.results);
                }.bind(this),
            })
        },
        onSearch: function() {
            let oInput = this.oInputModel.getData();    // 입력값 (필터)
            let oFilter = [];
            let oDateFormat = sap.ui.core.format.DateFormat.getInstance({
                pattern: "yyyy-MM-dd",
                UTC: true
            });
            let oStartDate = oDateFormat.parse(oInput.Assigndate);
            let oEndDate = oDateFormat.parse("20260701");

            if (oStartDate) {
                oFilter.push(
                    new Filter("Assigndate", FilterOperator.BT, oStartDate, oEndDate)
                );
            }
            if(oInput.Memo) {
                oFilter.push(new Filter("Memo", FilterOperator.EQ, oInput.Memo));
            }
            this.oDataModel.read("/EmployeeSet", {
                filters: oFilter,
                success: function(oReturn) {
                    this.oMainModel.setData(oReturn.results);
                    debugger;
                    sap.m.MessageToast.show("필터 성공!");
                }.bind(this),
                error: function() { 
                    sap.m.MessageToast.show("필터 에러!");
                }
            })
            // this.byId("idEmployeeTable").getBinding("items").filter(oFilter);
        },
        onCreate: function() {
            let oModel = new JSONModel();     
            let oDialog = sap.ui.getCore().byId("idCreateDialog");    

            if(oDialog) {      
                oDialog.open();
            }
            else {
                Fragment.load({
                    name: "assignment1.view.fragment.CreateDialog",        
                    type: "XML",        
                    controller: this    
                }).then(function(oDialog) {
                    oDialog.setModel(oModel, "oCreateModel");
                    oDialog.open();
                }.bind(this))
            }
        },
        onCreateButton: function() {
            let oData = sap.ui.getCore().byId("idCreateDialog").getModel("oCreateModel").getData();
            if (oData.Assigndate) {
                oData.Assigndate.setMinutes(
                    oData.Assigndate.getMinutes() - oData.Assigndate.getTimezoneOffset()
                );
            }
            let oBody = {
                Empno   : oData.Empno,
                Projod  : oData.Projod,
                Assigndate  : oData.Assigndate,
                Role    : oData.Role,
                Memo    : oData.Memo
            }
            this.oDataModel.create("/EmployeeSet", oBody, {
                success: function() {
                    sap.m.MessageToast.show("생성 성공!");
                },
                error: function() {
                    sap.m.MessageToast.show("생성 에러!");
                }
            })
            this.oDataModel.read("/EmployeeSet", {
                success: function(oReturn) {
                    this.oMainModel.setData(oReturn.results);
                }.bind(this)
            })
        },
        onClose2: function(oEvent) {
            sap.ui.getCore().byId("idCreateDialog").getModel("oCreateModel").setData({});
            oEvent.getSource().getParent().close();
        },
        onUpdate: function() {
            let oData = this.byId("idEmployeeTable").getSelectedItem().getBindingContext("oMainModel").getObject();    // 선택한 열의 데이터 가져오기
            let oModel = new JSONModel(oData);      // 선택한 열의 데이터로 모델 생성 -> 다이얼로그에서 쓰기 위함
            let oDialog = sap.ui.getCore().byId("idUpdateDialog");    

            if(oDialog) {      
                oDialog.open();
            }
            else {
                Fragment.load({
                    name: "assignment1.view.fragment.UpdateDialog",        
                    type: "XML",        
                    controller: this    
                }).then(function(oDialog) {
                    oDialog.setModel(oModel, "oUpdateModel");
                    oDialog.open();
                }.bind(this))
            }
        },
        onUpdateButton: function() {
            let oModel = sap.ui.getCore().byId("idUpdateDialog").getModel("oUpdateModel");    // 다이얼로그에서 수정한 데이터 값
            let oData = oModel.getData();

            oData.Assigndate.setMinutes(
                oData.Assigndate.getMinutes() - oData.Assigndate.getTimezoneOffset()
            );

            let sPath = this.oDataModel.createKey("/EmployeeSet", {
                Empno : oData.Empno,
                Projod : oData.Projod
            })
            this.oDataModel.update(sPath, oData, {
                success: function() {
                    sap.m.MessageToast.show("수정 성공!");
                    this.oDataModel.read("/EmployeeSet", {
                        success: function(oReturn) {
                            this.oMainModel.setData(oReturn.results);
                        }.bind(this)
                    })
                }.bind(this),
                error: function() {
                    sap.m.MessageToast.show("수정 에러!");
                }
            })
            this.oDataModel.read("/EmployeeSet", {
                success: function(oReturn) {
                    this.oMainModel.setData(oReturn.results);
                }.bind(this)
            })
        },
        onClose: function(oEvent) {
            oEvent.getSource().getParent().close();
        },
        onDelete: function() {
            let oData = this.byId("idEmployeeTable").getSelectedItem().getBindingContext("oMainModel").getObject(); 
            let sPath = this.oDataModel.createKey("/EmployeeSet", {
                Empno: oData.Empno,
                Projod : oData.Projod
            });
            this.oDataModel.remove(sPath, {
                success: function () {
                    sap.m.MessageToast.show("삭제 성공!");
                    this.oDataModel.read("/EmployeeSet", {
                        success: function(oReturn) {
                            this.oMainModel.setData(oReturn.results);
                        }.bind(this)
                    })
                }.bind(this)
            });
        }
    });
});
```
</br>
</br>

**3) Main.view.xml**
```html
// assignment1

<mvc:View controllerName="assignment1.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:f="sap.f"
    xmlns:layout="sap.ui.layout"
    xmlns:fb="sap.ui.comp.filterbar"
    xmlns="sap.m">
    <f:DynamicPage id="dynamicPageId" headerExpanded="true" toggleHeaderOnTitleClick="false">
        <!-- DynamicPage Title -->
        <f:title>
            <f:DynamicPageTitle>
                <f:heading>
                    <Title text="Header Title"/>
                </f:heading>
                <!-- <f:content>
                    <OverflowToolbar>
                    </OverflowToolbar>
                </f:content> -->
            </f:DynamicPageTitle>
        </f:title>
        <!-- DynamicPage Header -->
        <f:header>
            <f:DynamicPageHeader pinnable="false">
                <fb:FilterBar id="filterbar" search="onSearch" persistencyKey="myPersKey" useToolbar="false" showGoOnFB="true" showFilterConfiguration="false">
                    <fb:filterGroupItems>
                        <fb:FilterGroupItem name="Assigndate" groupName="Group1" label="Assign Date" visibleInFilterBar="true">
                            <fb:control>
                                <DatePicker value="{oInputModel>/Assigndate}"
                                            valueFormat="yyyy-MM-dd"
                                            displayFormat="yyyy-MM-dd" />
                            </fb:control>
                        </fb:FilterGroupItem>
                        <fb:FilterGroupItem name="Memo" groupName="Group1" label="Memo" visibleInFilterBar="true">
                            <fb:control>
                                <Input value="{oInputModel>/Memo}"/>
                            </fb:control>
                        </fb:FilterGroupItem>
                        <!-- <fb:FilterGroupItem name="Search" groupName="Group1" visibleInFilterBar="true">
                            <fb:control>
                                <Button text="검색버튼" press="onPress" />
                            </fb:control>
                        </fb:FilterGroupItem> -->
                    </fb:filterGroupItems>
                </fb:FilterBar>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>
            <Table id="idEmployeeTable"
                    sticky="HeaderToolbar,ColumnHeaders"
                    inset="false"
                    items="{oMainModel>/}"
                    selectionChange="onSelectionChange"
                    class="sapFDynamicPageAlignContent"
                    mode="SingleSelectLeft"
                    width="auto">
                <headerToolbar>
                    <Toolbar>
                        <Title text="Products" level="H2"/>
                        <Button text="생성" press="onCreate" type="Emphasized"/>
                        <Button text="수정" press="onUpdate" type="Emphasized"/>
                        <Button text="삭제" press="onDelete" type="Emphasized"/>
                    </Toolbar>
                </headerToolbar>
                <columns>
                    <Column width="12em">
                        <Text text="Empno" />
                    </Column>
                    <Column width="12em">
                        <Text text="Projod" />
                    </Column>
                    <Column width="12em">
                        <Text text="Assigndate" />
                    </Column>
                    <Column width="12em">
                        <Text text="Role" />
                    </Column>
                    <Column width="12em">
                        <Text text="Memo" />
                    </Column>
                </columns>
                <items>
                    <ColumnListItem>
                        <cells>
                            <Text text="{oMainModel>Empno}" />
                            <Text text="{oMainModel>Projod}" />
                            <Text text="{
                                path: 'oMainModel>Assigndate',
                                type: 'sap.ui.model.type.DateTime',
                                formatOptions: { pattern : 'yyyy-MM-dd' }
                            }" />
                            <Text text="{oMainModel>Role}" />
                            <Text text="{oMainModel>Memo}" />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </f:content>
    </f:DynamicPage>
</mvc:View>
```
</br>
</br>

**4) CreateDialog.fragment.xml**
```html
// assignment1

<c:FragmentDefinition 
    xmlns="sap.m" 
    xmlns:f="sap.ui.layout.form"
    xmlns:c="sap.ui.core">
    <Dialog id="idCreateDialog"
            title="Create Dialog"
            contentHeight="50%"
            contentWidth="20%">
        <content>
            <f:SimpleForm
                layout="ColumnLayout"
                columnsXL="1"
                columnsL="1"
                columnsM="1">
                <f:content>
                    <Label text="Empno"/>
                    <Input value="{oCreateModel>/Empno}" />
                    <Label text="Projod"/>
                    <Input value="{oCreateModel>/Projod}" />
                    <Label text="Assign date"/>
                    <DatePicker
                        dateValue="{oCreateModel>/Assigndate}"
                        displayFormat="yyyy-MM-dd"
                    />
                    <Label text="Role"/>
                    <Input value="{oCreateModel>/Role}" />
                    <Label text="Memo"/>
                    <Input value="{oCreateModel>/Memo}" />
                </f:content>
            </f:SimpleForm>
        </content>
        <buttons>
            <Button text="생성" press=".onCreateButton" />
            <Button text="닫기" press=".onClose2" />
        </buttons>
    </Dialog>
</c:FragmentDefinition>
```
</br>
</br>

**5) UpdateDialog.fragment.xml**
```html
// assignment1

<c:FragmentDefinition 
    xmlns="sap.m" 
    xmlns:f="sap.ui.layout.form"
    xmlns:c="sap.ui.core">
    <Dialog id="idUpdateDialog"
            title="Update Dialog"
            contentHeight="50%"
            contentWidth="20%">
        <content>
            <f:SimpleForm
                layout="ColumnLayout"
                columnsXL="1"
                columnsL="1"
                columnsM="1">
                <f:content>
                    <Label text="Empno"/>
                    <Input value="{oUpdateModel>/Empno}" />
                    <Label text="Projod"/>
                    <Input value="{oUpdateModel>/Projod}" />
                    <Label text="Assign date"/>
                    <DatePicker
                        dateValue="{oUpdateModel>/Assigndate}"
                        displayFormat="yyyy-MM-dd"
                    />
                    <Label text="Role"/>
                    <Input value="{oUpdateModel>/Role}" />
                    <Label text="Memo"/>
                    <Input value="{oUpdateModel>/Memo}" />
                </f:content>
            </f:SimpleForm>
        </content>
        <buttons>
            <Button text="수정" press=".onUpdateButton" />
            <Button text="닫기" press=".onClose" />
        </buttons>
    </Dialog>
</c:FragmentDefinition>
```
</br>
</br>
</br>
</br>
</br>

### 실습 2
- Header-Item Create 구현 실습
<img width="425" height="265" alt="image" src="https://github.com/user-attachments/assets/69c3337a-1582-45a4-a178-cc74e1ccedb4" />
</br>

<img width="549" height="305" alt="image" src="https://github.com/user-attachments/assets/baf59017-1d98-4a60-9ffc-11002129e7a2" />
</br>

<img width="556" height="356" alt="image" src="https://github.com/user-attachments/assets/9c72afb2-91c0-45b9-b4c3-4d7b4f20e7de" />
</br>
</br>
</br>
</br>
</br>

**1) SAP GUI 코드**
- `HEADERSET_GET_ENTITYSET`
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : HEADERSET_GET_ENTITYSET

  method HEADERSET_GET_ENTITYSET.
    SELECT * FROM zscarrcl2_b03
      INTO TABLE et_entityset.
  endmethod.
```
- `ITEMSET_GET_ENTITYSET`
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : ITEMSET_GET_ENTITYSET

  method ITEMSET_GET_ENTITYSET.
    DATA lv_carrid TYPE s_carr_id.
    DATA lt_data TYPE TABLE OF zspflicl2_b03.

    LOOP AT it_key_tab INTO DATA(ls_key).
      IF ls_key-name EQ 'Carrid'.
        MOVE ls_key-value TO lv_carrid.
      ENDIF.
    ENDLOOP.

    SELECT * FROM ZSPFLICL2_B03
      INTO TABLE lt_data
      WHERE carrid = lv_carrid.
    IF sy-subrc = 0.
      MOVE-CORRESPONDING lt_data TO et_entityset.
    ENDIF.
  endmethod.
```
- `/IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITY`
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITY

  method /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITY.
    TYPES BEGIN OF ty_headeritem.
      INCLUDE TYPE ZCL_ZGWHEADITEM_B03_MPC=>ts_header.
      TYPES ItemSet TYPE TABLE OF ZCL_ZGWHEADITEM_B03_MPC=>ts_item WITH DEFAULT KEY.
    TYPES END OF ty_headeritem.
    DATA: lv_carrid TYPE s_carr_id,
          ls_header_item TYPE ty_headeritem,
          lv_nav TYPE string VALUE 'ITEMSET'.

    LOOP AT it_key_tab INTO DATA(ls_key).
      IF ls_key-name EQ 'Carrid'.
        MOVE ls_key-value TO lv_carrid.
      ENDIF.
    ENDLOOP.

    " Header 조회
    SELECT SINGLE * FROM zscarrcl2_b03
      INTO CORRESPONDING FIELDS OF ls_header_item
      WHERE carrid = lv_carrid.
    if sy-subrc = 0.
      " Item 조회 (Navigation Property 이름에 맞춰 데이터 채움)
      SELECT * FROM zspflicl2_b03
        INTO CORRESPONDING FIELDS OF TABLE ls_header_item-itemset
        WHERE carrid = lv_carrid.
    ENDIF.

    " 결과 출력(ER_ENTITY)
    copy_data_to_ref(
      EXPORTING is_data = ls_header_item
      CHANGING cr_data = er_entity ).

    " Navigation Property 데이터 처리 완료되었다고 알려주는 파라미터
    INSERT lv_nav INTO TABLE et_expanded_tech_clauses.
  endmethod.
```
- `/IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITYSET`
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITYSET

  method /IWBEP/IF_MGW_APPL_SRV_RUNTIME~GET_EXPANDED_ENTITYSET.
    TYPES BEGIN OF ts_headeritem.
      INCLUDE TYPE ZCL_ZGWHEADITEM_B03_MPC=>ts_header.
      TYPES ItemSet TYPE TABLE OF ZCL_ZGWHEADITEM_B03_MPC=>ts_item WITH DEFAULT KEY.
    TYPES END OF ts_headeritem.

    TYPES tt_headeritem TYPE STANDARD TABLE OF
      ts_headeritem WITH DEFAULT KEY.

    DATA: lt_header_item_set TYPE tt_headeritem,
          lt_header_db TYPE TABLE OF ZSCARRCL2_B03,
          lt_item_db TYPE TABLE OF ZSPFLICL2_B03,
          lv_nav TYPE string VALUE 'ITEMSET'.
    FIELD-SYMBOLS <fs> TYPE ts_headeritem.

    " 1. Header 조회하고, Headeritem 구조체에 헤더 적용
    SELECT * FROM zscarrcl2_b03
      INTO TABLE lt_header_db.
    IF sy-subrc = 0.
      MOVE-CORRESPONDING lt_header_db TO lt_header_item_set.

      " 2-1. Header에 맞는 Item 조회
      SELECT * FROM zspflicl2_b03
        FOR ALL ENTRIES IN @lt_header_db
        WHERE carrid = @lt_header_db-carrid
        INTO TABLE @lt_item_db.

      " 2-2. Item 루프 돌면서, HeaderItem 구조체의 ItemSet테이블에 적용
      LOOP AT lt_item_db ASSIGNING FIELD-SYMBOL(<fs_item>).
        UNASSIGN <fs>.
        ASSIGN lt_header_item_set[ carrid = <fs_item>-carrid ] TO <fs>.
        APPEND <fs_item> TO <fs>-itemset.
      ENDLOOP.

      " 3. 결과 출력 (ER_ENTITYSET)
      copy_data_to_ref(
        EXPORTING is_data = lt_header_item_set
        CHANGING cr_data = er_entityset
      ).
      INSERT lv_nav INTO TABLE et_expanded_tech_clauses.
    ENDIF.
  endmethod.
```
- `/IWBEP/IF_MGW_APPL_SRV_RUNTIME~CREATE_DEEP_ENTITY`
```abap
" ZCL_ZGWHEADITEM_B03_DPC_EXT : /IWBEP/IF_MGW_APPL_SRV_RUNTIME~CREATE_DEEP_ENTITY

  method /IWBEP/IF_MGW_APPL_SRV_RUNTIME~CREATE_DEEP_ENTITY.
    TYPES BEGIN OF ts_headeritem.
      INCLUDE TYPE ZCL_ZGWHEADITEM_B03_MPC=>ts_header.
      TYPES ItemSet TYPE TABLE OF ZCL_ZGWHEADITEM_B03_MPC=>ts_item WITH DEFAULT KEY.
    TYPES END OF ts_headeritem.

    DATA: ls_create_data TYPE ts_headeritem,
          ls_header TYPE ZCL_ZGWHEADITEM_B03_mpc=>ts_header,
          lt_item TYPE ZCL_ZGWHEADITEM_B03_mpc=>tt_item.
    CASE iv_entity_name.
      WHEN 'Header'.
        io_data_provider->read_entry_data(
          IMPORTING es_data = ls_create_data
        ).

        " 받아온 Header-Item 데이터 분리
        MOVE-CORRESPONDING ls_create_data TO ls_header.
        MOVE-CORRESPONDING ls_create_data-itemset TO lt_item.

        " 각 DB Table에 Create
        INSERT zscarrcl2_b03 FROM ls_header.
        IF sy-subrc = 0.
          INSERT zspflicl2_b03 FROM TABLE lt_item.
          IF sy-subrc <> 0.
            ROLLBACK WORK.  " item insert 실패 시 전체 롤백
          ENDIF.
        ENDIF.

        " 결과 출력 (ER_DEEP_ENTITY)
        copy_data_to_ref(
          EXPORTING is_data = ls_create_data
          CHANGING cr_data = er_deep_entity
        ).
    ENDCASE.
  endmethod.
```
</br>
</br>

**2) Main.controller.js**
```java
// assignment2

sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel",
    "sap/ui/core/Fragment",
    "sap/ui/model/Sorter"
], (Controller, JSONModel, Fragment, Sorter) => {
    "use strict";

    return Controller.extend("assignment2.controller.Main", {
        onInit() {
            this.oHeaderModel = this.getOwnerComponent().getModel();  
            // this.oHeaderModel.read("/HeaderSet", {
            //     urlParameters: {
            //         "$expand" : "ItemSet",
            //     },
            //     success: function() {
            //         sap.m.MessageToast.show("Header 조회 성공!");
            //     },
            //     error: function() {
            //         sap.m.MessageToast.show("Header 조회 실패!");
            //     }
            // })
            this.oItemNodel = this.getOwnerComponent().getModel();  
        },
        onSelectionChange: function(oEvent) {
            let sPath = oEvent.getParameters().listItem.getBindingContext().getPath();
            this.byId("idItemTable").bindElement(sPath);
        },
        onCreate: function() {
            let oData = {
                Carrid : "",
                Carrname : "",
                Currcode : "",
                ItemSet: [ {
                    Carrid : "",
                    Connid : "",
                    Cityfrom : "",
                    Airpfrom : "",
                    Cityto : "",
                    Airpto : ""
                } ]
            };
            let oModel = new JSONModel(oData); 
            let oDialog = sap.ui.getCore().byId("idCreateDialog");    

            if(oDialog) {   
                let oData = {
                    Carrid : "",
                    Carrname : "",
                    Currcode : "",
                    ItemSet: [ {
                        Carrid : "",
                        Connid : "",
                        Cityfrom : "",
                        Airpfrom : "",
                        Cityto : "",
                        Airpto : ""
                    } ]
                };
                this._oDialog.getModel("oCreateModel").setData(oData);   
                this._oDialog.open();
            }
            else {
                Fragment.load({
                    name: "assignment2.view.fragment.CreateDialog",        
                    type: "XML",        
                    controller: this    
                }).then(function(oDialog) {
                    this._oDialog = oDialog;
                    this._oDialog.setModel(oModel, "oCreateModel");
                    this._oDialog.open();
                }.bind(this))
            }
        },
        onAddLine: function() {
            let oModel = this._oDialog.getModel("oCreateModel");
            let oData = oModel.getProperty("/ItemSet");
            oData.push({
                Carrid : "",
                Connid : "",
                Cityfrom : "",
                Airpfrom : "",
                Cityto : "",
                Airpto : ""
            });
            oModel.setProperty("/ItemSet", oData);
        },
        onCreateSave: function() {
            let oData = this._oDialog.getModel("oCreateModel").getData();
            let oItems = [];
            for (let i=0; i<oData.ItemSet.length; i++) {
                let oInputRow = oData.ItemSet[i]; 
                oItems.push({
                    Carrid   : oData.Carrid,      
                    Connid   : oInputRow.Connid,
                    Cityfrom : oInputRow.Cityfrom,
                    Airpfrom : oInputRow.Airpfrom,
                    Cityto   : oInputRow.Cityto,
                    Airpto   : oInputRow.Airpto
                });
            }
            let oBody = {
                Carrid : oData.Carrid,
                Carrname : oData.Carrname,
                Currcode : oData.Currcode,
                ItemSet: oItems
            };
            this.oHeaderModel.create("/HeaderSet", oBody, {
                success: function() {
                    sap.m.MessageToast.show("생성 성공!");
                    this._oDialog.close();
                }.bind(this),
                error: function() {
                    sap.m.MessageToast.show("생성 실패!");
                }
            });
        },
        onCreateClose: function(oEvent) {
            oEvent.getSource().getParent().close();
        }
    });
});
```
</br>
</br>

**3) Main.view.xml**
```html
// assignment2

<mvc:View controllerName="assignment2.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <Table id="idHeaderTable"
                sticky="HeaderToolbar,ColumnHeaders"
                inset="false"
                items="{/HeaderSet}"
                selectionChange="onSelectionChange"
                class="sapFDynamicPageAlignContent"
                mode="SingleSelectLeft"
                width="auto"
                updateFinished="onHeaderUpdateFinished">
            <headerToolbar>
                <Toolbar>
                    <Title text="Header Table" level="H2" />
                    <Button text="생성" press="onCreate" />
                    <Button text="수정" press="onUpdate" />
                    <Button text="삭제" press="onDelete" />
                </Toolbar>
            </headerToolbar>
            <columns>
                <Column width="12em">
                    <Text text="Carrid" />
                </Column>
                <Column width="12em">
                    <Text text="Carrname" />
                </Column>
                <Column width="12em">
                    <Text text="Currcode" />
                </Column>
            </columns>
            <items>
                <ColumnListItem>
                    <cells>
                        <Text text="{Carrid}" />
                        <Text text="{Carrname}" />
                        <Text text="{Currcode}" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>
        <Toolbar class="sapUiMediumMarginTop" visible="false"/>
        <Table id="idItemTable"
                visible="true"
                sticky="HeaderToolbar,ColumnHeaders"
                inset="false"
                items="{ItemSet}"
                class="sapFDynamicPageAlignContent"
                width="auto">
            <headerToolbar>
                <Toolbar>
                    <Title text="Item Table" level="H2" />
                </Toolbar>
            </headerToolbar>
            <columns>
                <Column width="12em">
                    <Text text="Carrid" />
                </Column>
                <Column width="12em">
                    <Text text="Connid" />
                </Column>
                <Column width="12em">
                    <Text text="Cityfrom" />
                </Column>
                <Column width="12em">
                    <Text text="Airpfrom" />
                </Column>
                <Column width="12em">
                    <Text text="Cityto" />
                </Column>
                <Column width="12em">
                    <Text text="Airpto" />
                </Column>
            </columns>
            <items>
                <ColumnListItem>
                    <cells>
                        <Text text="{Carrid}" />
                        <Text text="{Connid}" />
                        <Text text="{Cityfrom}" />
                        <Text text="{Airpfrom}" />
                        <Text text="{Cityto}" />
                        <Text text="{Airpto}" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>
    </Page>
</mvc:View>
```
</br>
</br>

**4) CreateDialog.fragment.xml**
```html
" assignment2

<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.ui.layout.form">
    <Dialog id="idCreateDialog" title="데이터 생성" contentWidth="600px">
        <content>
            <f:SimpleForm editable="true">
                <f:content>
                    <core:Title text="Header Create" />
                    <Label text="Carrid" />
                    <Input value="{oCreateModel>/Carrid}" maxLength="3"/>
                    <Label text="Carrname" />
                    <Input value="{oCreateModel>/Carrname}" />
                    <Label text="Currcode" />
                    <Input value="{oCreateModel>/Currcode}" />
                </f:content>
            </f:SimpleForm>

            <Table items="{oCreateModel>/ItemSet}">
                <headerToolbar>
                    <OverflowToolbar>
                        <Title text="Item Create" />
                        <ToolbarSpacer />
                        <Button icon="sap-icon://add" text="행 추가" press="onAddLine" />
                    </OverflowToolbar>
                </headerToolbar>
                <columns>
                    <Column><Text text="Connid" /></Column>
                    <Column><Text text="Cityfrom" /></Column>
                    <Column><Text text="Airpfrom" /></Column>
                    <Column><Text text="Cityto" /></Column>
                    <Column><Text text="Airpto" /></Column>
                </columns>
                <items>
                    <ColumnListItem>
                        <cells>
                            <Input value="{oCreateModel>Connid}" />
                            <Input value="{oCreateModel>Cityfrom}" />
                            <Input value="{oCreateModel>Airpfrom}" />
                            <Input value="{oCreateModel>Cityto}" />
                            <Input value="{oCreateModel>Airpto}" />
                        </cells>
                    </ColumnListItem>
                </items>
            </Table>
        </content>
        <beginButton>
            <Button text="생성" type="Emphasized" press="onCreateSave" />
        </beginButton>
        <endButton>
            <Button text="닫기" press="onCreateClose" />
        </endButton>
    </Dialog>
</core:FragmentDefinition>
```
</br>
</br>

---

</br>

# 02/11
</br>

## <  핵심 개념 >
- **1) npm 기반 프론트엔드 배포 절차 정리**
- **2) SAP UI5 테마 커스터마이징 (TCODE - FIORI LAUNCHPAD : `/n/ui2/flp`), TCODE - 테마 : `/n/ui5/theme_designer`)**
- **3) Fiori Launchpad 타일 생성부터 권한 부여까지 전체 설정 가이드**
</br>
</br>

---

</br>

## < npm 기반 프론트엔드 배포 절차 정리 >
</br>

### 1) `cd project path` 로 경로 이동

<img width="573" height="433" alt="image" src="https://github.com/user-attachments/assets/b6d052ac-f52e-4b6a-8c39-cd8c91af0e13" />
</br>
</br>

### 2) npm 배포 명령어 실행 순서
- 최초 1회 실행

  - npm run build
  - npm run deploy-config
  - npm run deploy
- 2번째 배포부터
  
  - npm run build
  - npm run deploy
</br>

### 3) Fiori 프로젝트를 ABAP 서버에 배포하기 위한 초기 배포 설정 과정

<img width="418" height="200" alt="image" src="https://github.com/user-attachments/assets/a13f03c7-552d-4c9f-b3bc-d18f014f08e1" />
</br>
</br>

### 4) FIORI ABAP REPOSITORY 배포 및 CTS TRANSPORT 연계 설정
- FIORI 배포 결과물이 dist 폴더로 생성됨
- 배포 설정 정보는 `ui5-deploy.yaml` 파일에 저장됨
- APP NAME은 ABAP 저장소 규칙에 따라 대문자로 설정됨 (`ZUIPROG_B03_01`)
- ABAP REPOSITORY에 등록되어 CTS TRANSPORT와 연계됨
- CTS TRANSPORT를 통해 다른 시스템으로 이관 가능한 프로그램임

<img width="476" height="204" alt="image" src="https://github.com/user-attachments/assets/7b620fec-7067-43a4-871f-d16125edbaad" />
</br>
</br>

### 5) npm run deploy 실행으로 FIORI 애플리케이션이 ABAP 저장소에 정상 배포됨

<img width="479" height="250" alt="image" src="https://github.com/user-attachments/assets/d3adcf98-380d-4e6a-bbc2-2e3460aaef36" />
</br>
</br>

- SE80에서 ZUIPROG_B03_01 BSP APPLICATION이 생성되어 ABAP 저장소에 등록된 상태임
<img width="323" height="274" alt="image" src="https://github.com/user-attachments/assets/c3d362c2-6bae-4ffb-a901-42dcd8e21fd2" />
</br>
</br>

### 6) BAS에서 코드 변경 후에 `npm run build` -> `npm run deploy` 하고 SAP GUI 확인 시 변경된 것을 확인 가능

<img width="649" height="217" alt="image" src="https://github.com/user-attachments/assets/8105de01-554a-40e4-be98-54bf53acd451" />
</br>
</br>
</br>
</br>
</br>
</br>

---

</br>

## < SAP UI5 테마 커스터마이징 (TCODE - FIORI LAUNCHPAD : `/n/ui2/flp`), TCODE - 테마 : `/n/ui5/theme_designer`) >
</br>

### 1) ABAP 시스템으로 배포하면서 CTS TRANSPORT를 지정
- 기존 CTS를 선택하면 기존 이관 요청에 포함되고, 새로 생성하면 새로운 TRANSPORT REQUEST로 생성되어 관리됨

<img width="352" height="160" alt="image" src="https://github.com/user-attachments/assets/2a194397-1c0e-4b6a-8fb7-b49c91c7afc5" />

<img width="439" height="116" alt="image" src="https://github.com/user-attachments/assets/9e257597-bb7d-46d6-8bb4-91f33868611e" />
</br>
</br>
</br>

### 2) `npm run build` -> `npm run deploy-config` -> `npm run deploy` 후에 ABAP 패키지(ZPACB03_01)에 정상 등록된 것을 확인 가능

<img width="580" height="251" alt="image" src="https://github.com/user-attachments/assets/2f3de493-e25d-4b9a-bbba-0501fd47f0e7" />
</br>
</br>
</br>

### 3) `/n/ui2/flp` 명령어로 FIORI LAUNCHPAD에 접속

<img width="697" height="253" alt="image" src="https://github.com/user-attachments/assets/4497ba3e-0f84-4476-9253-5d2f31f5f39b" />
</br>
</br>
</br>


### 4) `/n/ui5/theme_designer` 명령어로 FIORI 테마를 커스터마이징(로고·색상·배경 등 변경) 가능
- 테마 변경 후 ‘저장’은 임시저장, ‘저장 및 작성’은 최종 활성화, ‘닫기’는 편집 종료 후 다음 단계로 이동

<img width="718" height="319" alt="image" src="https://github.com/user-attachments/assets/01d1c3b3-9728-41ce-949a-f54c9803a1d5" />

<img width="718" height="321" alt="image" src="https://github.com/user-attachments/assets/dab8c803-0be0-4716-a091-4012c4568b2c" />
</br>
</br>

- 기존 SAP_HORIZON 테마를 기준으로 새로운 커스텀 테마(NCODEB03, NCODEB03 Theme)를 생성하여 저장

<img width="434" height="191" alt="image" src="https://github.com/user-attachments/assets/d5446ef4-112c-45d0-895b-991b715c11e2" />
</br>
</br>
</br>

### 5) 생성한 커스텀 테마(NCODEB03)를 선택하여 편집·저장·삭제·이름변경 등 가능

<img width="839" height="353" alt="image" src="https://github.com/user-attachments/assets/aa58dce8-f895-4a00-b1a4-a017ae5d05f7" />

<img width="696" height="311" alt="image" src="https://github.com/user-attachments/assets/935855c7-7f3f-4fb7-9a0a-073dad840c17" />

<img width="732" height="328" alt="image" src="https://github.com/user-attachments/assets/7ef4fef9-52ae-48f0-b6ad-6b949064ef4e" />
</br>
</br>
</br>

### 6) Fiori Launchpad 설정(Settings)에서 생성한 커스텀 테마(NCODEB03)를 선택·저장하여 사용자 화면에 적용

<img width="804" height="371" alt="image" src="https://github.com/user-attachments/assets/f1d7afc6-fbd7-4f15-86b5-c854fbde04fe" />

<img width="805" height="380" alt="image" src="https://github.com/user-attachments/assets/d63fa4de-bf3e-4d7e-8be2-ff13cd8e17bb" />

<img width="718" height="325" alt="image" src="https://github.com/user-attachments/assets/0a239337-60ab-47fd-873f-9c936174ca39" />
</br>
</br>
</br>
</br>
</br>

---

</br>

## < Fiori Launchpad 타일 생성부터 권한 부여까지 전체 설정 가이드 >
</br>

**1) 카탈로그 및 그룹 생성 (TCODE - 카탈로그 : `/n/ui2/flpd_cust`)**
- 카탈로그 생성

  - 카탈로그 타이틀: `[B##] My catalog`
  - 카탈로그 ID: `ZCAID_B##`
- 타일 생성

  - 시멘틱 오브젝트: `ZSOB##_01`
  - Action: `display`
  - Target Mapping 설정 → 연결할 프로그램(앱) 지정
- 그룹 생성

  - 그룹 ID: `ZGRID_B##`
  - 생성한 타일을 해당 그룹에 추가
 
**2) 권한 부여 (TCODE - Role : `PFCG`)**
- 생성한 카탈로그와 그룹에 대해 역할(Role)을 생성
- 해당 역할을 사용자에게 할당하여 실행 권한 부여
</br>

### 1) Fiori Launchpad에서 새로운 Catalog를 생성
- 클라이언트 100번인지 확인
  
<img width="755" height="363" alt="image" src="https://github.com/user-attachments/assets/7de45df5-4bb9-4b74-bb42-87d75d7cb472" />
</br>

<img width="227" height="247" alt="image" src="https://github.com/user-attachments/assets/2e6425da-e9c5-45c6-b93e-072909361e76" />
</br>
</br>
</br>

### 2) 특정 Catalog(카테고리) 안에서 Static 타일을 생성하고, Semantic Object/Action으로 앱을 연결

<img width="744" height="245" alt="image" src="https://github.com/user-attachments/assets/edb12ca3-05f1-443b-8a2f-565089f56108" />
</br>
</br>

<img width="631" height="215" alt="image" src="https://github.com/user-attachments/assets/6efe4f70-3f39-4966-98db-b8001380c0dc" />
</br>
</br>

<img width="621" height="446" alt="image" src="https://github.com/user-attachments/assets/077c07ae-d0d5-4051-a127-e4c18691b1e4" />
</br>
</br>
</br>

### 3) Catalog 안에서 Target Mapping을 생성하고, manifest.json의 앱 ID를 연결해 Semantic Object/Action으로 Fiori를 매핑

<img width="729" height="431" alt="image" src="https://github.com/user-attachments/assets/33f9d540-9e9f-4f6e-aeaf-9feb46601287" />
</br>
</br>

<img width="479" height="298" alt="image" src="https://github.com/user-attachments/assets/028233be-6cda-45cf-8808-29d4c541fd9e" />
</br>
</br>

<img width="677" height="357" alt="image" src="https://github.com/user-attachments/assets/6f74babd-c472-4f63-964c-5a3d43d881aa" />
</br>
</br>

- Catalog 안에서 생성된 Target Mapping을 수정도 가능함

<img width="646" height="486" alt="image" src="https://github.com/user-attachments/assets/1a56df74-a3da-4fde-a51d-2ec44ca13e90" />
</br>
</br>

- Catalog 안에 생성된 타일을 복사하거나 삭제도 가능

<img width="551" height="331" alt="image" src="https://github.com/user-attachments/assets/39c7a9a7-4f2e-4ed5-9b1e-68714bbd9ae8" />

</br>
</br>
</br>

### 4) Fiori Launchpad에서 새로운 Group을 생성하고, 해당 그룹에 타일을 배치
<img width="639" height="507" alt="image" src="https://github.com/user-attachments/assets/6a8cdfdf-8dd5-42d3-8f1a-ccaaf9b942dd" />
</br>
</br>

<img width="292" height="335" alt="image" src="https://github.com/user-attachments/assets/38405cb9-cc6b-44a4-9359-7fa4203d754a" />
</br>
</br>
</br>

### 5) Catalog에 만든 타일을 선택해서 Group에 추가하고, Launchpad 홈 화면에 배치

<img width="375" height="444" alt="image" src="https://github.com/user-attachments/assets/156797b1-518a-4437-a4ce-a343835ecccd" />
</br>
</br>

<img width="604" height="535" alt="image" src="https://github.com/user-attachments/assets/29755527-8351-4989-8636-9a3b7895b1b7" />
</br>
</br>
</br>

### 6) `PFCG` (Role Maintenance)에서 Single Role을 생성해 사용자에게 Fiori Catalog/Group 권한을 부여

<img width="931" height="292" alt="image" src="https://github.com/user-attachments/assets/1d9605af-612d-4528-9aaf-e3deef4d5642" />
</br>
</br>
</br>

### 7) `PFCG` 에서 Fiori Launchpad Catalog를 추가해 해당 Role에 앱 권한을 연결
<img width="844" height="500" alt="image" src="https://github.com/user-attachments/assets/5703bd7b-ae40-4d9a-87df-0362fc628bff" />
</br>
</br>

<img width="828" height="284" alt="image" src="https://github.com/user-attachments/assets/53422c02-dd50-4862-af50-ff2a65df0c68" />
</br>
</br>
</br>

### 8) `PFCG` 에서 Fiori Launchpad Group을 추가해 사용자의 홈 화면에 타일이 보이도록 연결

<img width="779" height="494" alt="image" src="https://github.com/user-attachments/assets/03a83572-4106-44ae-a391-43ddfb8b14d9" />
</br>
</br>

<img width="778" height="134" alt="image" src="https://github.com/user-attachments/assets/42a33bed-3819-4cad-a81d-f6929e7fad99" />
</br>
</br>
</br>

### 9) `PFCG` 의 User 탭에서 해당 Role을 사용자에게 할당

<img width="773" height="408" alt="image" src="https://github.com/user-attachments/assets/be3f9af8-8988-4486-aeaf-794c5caf8e78" />
</br>
</br>
</br>
</br>
</br>

---

</br>

## < 실습 >
</br>

### 실습 1 : 배포한 UI5 앱을 FLP에 타일로 등록하고 권한까지 연결하는 실습

</br>

<img width="351" height="196" alt="image" src="https://github.com/user-attachments/assets/db7d4391-b209-41e5-83e1-c8c17ffb00d6" />

</br>
</br>
</br>

- Static 타일에서 제목·아이콘 설정 후 Semantic Object(ZSOB3_02)와 Action(display)으로 앱을 연결
<img width="607" height="410" alt="image" src="https://github.com/user-attachments/assets/3de3183a-513b-4ccc-b895-357f79e824a5" />
</br>
</br>

- Catalog에 Target Mapping을 새로 추가해 Semantic Object/Action으로 앱을 연결
<img width="958" height="251" alt="image" src="https://github.com/user-attachments/assets/dffce9e7-398f-41cb-896e-168306721f0b" />
</br>
</br>

- 카탈로그의 타일을 선택해 특정 Group에 추가
<img width="406" height="355" alt="image" src="https://github.com/user-attachments/assets/28772165-5fec-413b-8b0b-76c7d88f6699" />
</br>
</br>

- Launchpad 홈 화면의 해당 Group에 추가한 타일이 정상적으로 표시
<img width="604" height="414" alt="image" src="https://github.com/user-attachments/assets/90280b07-3438-4dc3-962f-2a7e784ce6ab" />
</br>
</br>
</br>
</br>

---

</br>

# 02/12
</br>

## < 연습 : Header-Item Read로 읽기 (수정본) >
- 아이템만 생성하려고 했는데 아이템만 생성하는 코드를 안짜서 생성은 못짰음
- 라우팅 복습
- Sort 적용 (테이블에)

<img width="647" height="338" alt="image" src="https://github.com/user-attachments/assets/49608e80-5a6a-4281-8f7f-36d31f11e44a" />
</br>
</br>

<img width="673" height="295" alt="image" src="https://github.com/user-attachments/assets/2ec8c1a2-b963-4452-9a63-39ef7ba594fe" />

</br>
</br>
</br>
</br>

### 1) manifest.json
```json
// assignment2_1

"routes": [
{
  "name": "RouteMain",
  "pattern": ":?query:",
  "target": [
    "TargetMain"
  ]
},
{
  "name": "RouteCreateItem",
  "pattern": "CreateItem/{pa1}",
  "target": [
    "TargetCreateItem"
  ]
}
],
"targets": {
"TargetMain": {
  "id": "Main",
  "name": "Main"
},
"TargetCreateItem": {
  "id": "CreateItem",
  "name": "CreateItem"
}
}
```
</br>
</br>

### 2) Main.controller.js
```java
// assignment2_1

sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel"
], (Controller, JSONModel) => {
    "use strict";

    return Controller.extend("assignment21.controller.Main", {
        onInit() {
            this.oInputModel = new JSONModel();
            this.oHeaderModel = new JSONModel();
            this.oItemModel = new JSONModel({
                ItemSet: []
            });
            this.getOwnerComponent().setModel(this.oInputModel, "oInputModel");
            this.getOwnerComponent().setModel(this.oHeaderModel, "oHeaderModel");
            this.getOwnerComponent().setModel(this.oItemModel, "oItemModel");
            this.oDataModel = this.getOwnerComponent().getModel();

            this.oDataModel.read("/HeaderSet", {
                urlParameters: {
                    "$expand" : "ItemSet",
                },
                success: function(oReturn) {
                    let ItemSet = [];
                    this.oHeaderModel.setData(oReturn.results);
                    for(let i=0; i<oReturn.results.length; i++) {
                        for(let j=0; j<oReturn.results[i].ItemSet.results.length; j++) {
                            ItemSet.push(oReturn.results[i].ItemSet.results[j]);
                        }
                    }
                    this.oItemModel.setProperty("/ItemSet", ItemSet);
                }.bind(this),
                error: function() {
                    sap.m.MessageToast.show("Header 조회 실패!");
                }
            })

        },
        onPress: function() {
            let oRouter = this.getOwnerComponent().getRouter();
            let pa1 = this.getView().byId("idHeaderTable").getSelectedItem().getBindingContext("oHeaderModel").getObject().Carrid;
            oRouter.navTo("RouteCreateItem", { pa1: pa1 });
        }
    });
});
```
</br>
</br>

### 3) Main.view.xml
```html
// assignment2_1

<mvc:View controllerName="assignment21.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <Table id="idHeaderTable"
                sticky="HeaderToolbar,ColumnHeaders"
                inset="false"
                items="{oHeaderModel>/}"
                selectionChange="onSelectionChange"
                class="sapFDynamicPageAlignContent"
                mode="SingleSelectLeft"
                width="auto"
                updateFinished="onHeaderUpdateFinished">
            <headerToolbar>
                <Toolbar>
                    <Title text="Header Table" level="H2" />
                    <Button text="생성" press="onPress"/>
                </Toolbar>
            </headerToolbar>
            <columns>
                <Column width="12em">
                    <Text text="Carrid" />
                </Column>
                <Column width="12em">
                    <Text text="Carrname" />
                </Column>
                <Column width="12em">
                    <Text text="Currcode" />
                </Column>
            </columns>
            <items>
                <ColumnListItem>
                    <cells>
                        <Text text="{oHeaderModel>Carrid}" />
                        <Text text="{oHeaderModel>Carrname}" />
                        <Text text="{oHeaderModel>Currcode}" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>
        <Toolbar class="sapUiMediumMarginTop" visible="true"/>
        <Table id="idItemTable"
                visible="true"
                sticky="HeaderToolbar,ColumnHeaders"
                inset="false"
                items="{oItemModel>/ItemSet}"
                class="sapFDynamicPageAlignContent"
                width="auto">
            <headerToolbar>
                <Toolbar>
                    <Title text="Item Table" level="H2" />
                </Toolbar>
            </headerToolbar>
            <columns>
                <Column width="12em">
                    <Text text="Carrid" />
                </Column>
                <Column width="12em">
                    <Text text="Connid" />
                </Column>
                <Column width="12em">
                    <Text text="Cityfrom" />
                </Column>
                <Column width="12em">
                    <Text text="Airpfrom" />
                </Column>
                <Column width="12em">
                    <Text text="Cityto" />
                </Column>
                <Column width="12em">
                    <Text text="Airpto" />
                </Column>
            </columns>
            <items>
                <ColumnListItem>
                    <cells>
                        <Text text="{oItemModel>Carrid}" />
                        <Text text="{oItemModel>Connid}" />
                        <Text text="{oItemModel>Cityfrom}" />
                        <Text text="{oItemModel>Airpfrom}" />
                        <Text text="{oItemModel>Cityto}" />
                        <Text text="{oItemModel>Airpto}" />
                    </cells>
                </ColumnListItem>
            </items>
        </Table>
    </Page>
</mvc:View>
```
</br>
</br>

### 4) CreateItem.controller.js
```java
// assignment2_1

sap.ui.define([
    "sap/ui/core/mvc/Controller"
], (Controller) => {
    "use strict";

    return Controller.extend("assignment21.controller.Detail", {
        onInit() {
            const oRouter = this.getOwnerComponent().getRouter();
            oRouter.getRoute("RouteCreateItem").attachPatternMatched(this._attachPatternMatched, this);
        },
        _attachPatternMatched: function(oEvent) {
            let gv_carrid = oEvent.getParameters().arguments.pa1;
            let oInputModel = this.getOwnerComponent().getModel("oInputModel");
            let oHeaderModel = this.getOwnerComponent().getModel("oHeaderModel");
            let oItemModel = this.getOwnerComponent().getModel("oItemModel");
            if (!oHeaderModel || !oItemModel) {
                return;
            }
            let oHeaderData = oHeaderModel.getData();
            let oHeaderRow = oHeaderData.find(function(item) {
                return item.Carrid === gv_carrid
            })
            oInputModel.setData({
                "Carrid": oHeaderRow.Carrid,
                "Carrname": oHeaderRow.Carrname,
                "Currcode": oHeaderRow.Currcode
            })

            // let oItemData = oItemModel.getProperty("/ItemSet");
            // let oItemRow = oItemData.find(function(item) {
            //     return item.Carrid === gv_carrid
            // })
            // // filter를 사용하면 gv_carrid와 일치하는 모든 행을 배열로 담음
            // let oItemRow = oItemData.filter(function(item) {
            //     return item.Carrid === gv_carrid;
            // });
            debugger;
        },
        onNavButtonPress: function() {
            let oRouter = this.getOwnerComponent().getRouter();
            oRouter.navTo("RouteMain");
        },
        onSave: function() {
            let oInputModel = this.getOwnerComponent().getModel("oInputModel");
            let oItemModel = this.getOwnerComponent().getModel("oItemModel");
            let oData = oInputModel.getData();
            let oItem = [];
            oItem.push({
                Carrid   : oData.Carrid,      
                Connid   : oData.Connid,
                Cityfrom : oData.Cityfrom,
                Airpfrom : oData.Airpfrom,
                Cityto   : oData.Cityto,
                Airpto   : oData.Airpto
            });
            // oItemModel.create("/ItemSet", oItem, {
            //     success: function() {
            //         sap.m.MessageToast.show("생성 성공!");
            //     },
            //     error: function() {
            //         sap.m.MessageToast.show("생성 실패!");
            //     }
            // });
        }
    }); 
});
```
</br>
</br>

### 5) CreateItem.view.xml
```html
// assignment2_1

<mvc:View controllerName="assignment21.controller.CreateItem"
    xmlns:mvc="sap.ui.core.mvc"
	xmlns:f="sap.ui.layout.form"
    xmlns="sap.m">
    <Page id="page2" showNavButton="true" navButtonPress="onNavButtonPress" title="{i18n>title}">
        <VBox class="sapUiSmallMargin">
            <f:SimpleForm id="SimpleFormChange1"
                editable="true"
                layout="ResponsiveGridLayout"
                title="Header"
                labelSpanXL="3"
                labelSpanL="3"
                labelSpanM="3"
                labelSpanS="12"
                adjustLabelSpan="false"
                emptySpanXL="4"
                emptySpanL="4"
                emptySpanM="4"
                emptySpanS="0"
                columnsXL="1"
                columnsL="1"
                columnsM="1"
                singleContainerFullSize="false">
                <f:content>
                    <Label text="Carrid" />
                    <Input id="Carrid" value="{oInputModel>/Carrid}" editable="false"/>
                    <Label text="Carrname" />
                    <Input id="Carrname" value="{oInputModel>/Carrname}" editable="false"/>
                    <Label text="Currcode" />
                    <Input id="Currcode" value="{oInputModel>/Currcode}" editable="false"/>                   
                </f:content>
            </f:SimpleForm>

            <f:SimpleForm id="SimpleFormChange2"
                editable="true"
                layout="ResponsiveGridLayout"
                labelSpanXL="3"
                labelSpanL="3"
                labelSpanM="3"
                labelSpanS="12"
                adjustLabelSpan="false"
                emptySpanXL="4"
                emptySpanL="4"
                emptySpanM="4"
                emptySpanS="0"
                columnsXL="1"
                columnsL="1"
                columnsM="1"
                singleContainerFullSize="false" >
                <f:toolbar>
                    <Toolbar class="sapUiLargeMarginTop">
                        <Title text="Item" />
                        <ToolbarSpacer />
                        <Button text="생성" type="Transparent" press="onSave" />
                    </Toolbar>
                </f:toolbar>
                <f:content>
                    <Label text="Connid" />
                    <Input id="Connid" value="{oInputModel>/Connid}" />
                    <Label text="Cityfrom" />
                    <Input id="Cityfrom" value="{oInputModel>/Cityfrom}" />
                    <Label text="Airpfrom" />
                    <Input id="Airpfrom" value="{oInputModel>/Airpfrom}" />       
                    <Label text="Cityto" />
                    <Input id="Cityto" value="{oInputModel>/AirpfCitytorom}" />    
                    <Label text="Airpto" />
                    <Input id="Airpto" value="{oInputModel>/Airpto}" />                
                </f:content>
            </f:SimpleForm>
        </VBox>
    </Page>
</mvc:View>
```
</br>
</br>
</br>

---

</br>


## < 과제 : Dialog를 이용한 CRUD 프로그램 >
- 다이얼로그의 요소들에 대해 .byId 로 접근하는 실습
- 타일 등록 실습

<img width="670" height="408" alt="image" src="https://github.com/user-attachments/assets/06cd67d2-dec9-447e-8673-5abf9fab4f83" />

<img width="940" height="470" alt="image" src="https://github.com/user-attachments/assets/756932e2-ec00-47c5-8e5c-b6072ea031f0" />
</br>
</br>

- 결과 화면
<img width="940" height="437" alt="image" src="https://github.com/user-attachments/assets/bdd23028-8966-425c-9180-b82f6a9ea86a" />

<img width="940" height="309" alt="image" src="https://github.com/user-attachments/assets/f5e30bca-63e7-4c42-8b4e-9d102bee1c34" />
</br>
</br>
</br>
</br>

### 1) SAP GUI 코드
- GET_ENTITYSET
```abap
" ZCL_ZGWMEMBER_B03_DPC_EXT : MEMBERENTITYSET_GET_ENTITYSET

method MEMBERENTITYSET_GET_ENTITYSET.
  DATA: lr_name  TYPE /iwbep/t_cod_select_options,
        lr_erdat TYPE /iwbep/t_cod_select_options,
        lr_aedat TYPE /iwbep/t_cod_select_options.

  LOOP AT it_filter_select_options INTO DATA(ls_filter).
    CASE ls_filter-property.
      WHEN 'Name'.
        APPEND LINES OF ls_filter-select_options TO lr_name.
      WHEN 'Erdat'.
        APPEND LINES OF ls_filter-select_options TO lr_erdat.
      WHEN 'Aedat'.
        APPEND LINES OF ls_filter-select_options TO lr_aedat.
    ENDCASE.
  ENDLOOP.

  SELECT * FROM zn2member_b03
    INTO CORRESPONDING FIELDS OF TABLE @et_entityset
    WHERE name  IN @lr_name
      AND erdat IN @lr_erdat
      AND aedat IN @lr_aedat.

endmethod.
```
- GET_ENTITY
```abap
" ZCL_ZGWMEMBER_B03_DPC_EXT : MEMBERENTITYSET_GET_ENTITY

  method MEMBERENTITYSET_GET_ENTITY.
    DATA: ls_data TYPE zn2member_b03.

    LOOP AT it_key_tab INTO DATA(ls_key).
      ls_data-(ls_key-name) = ls_key-value.
    ENDLOOP.

    SELECT SINGLE * FROM zn2member_b03
      INTO @DATA(ls_ressult)
      WHERE id = @ls_data-id.
    IF sy-subrc = 0.
      MOVE-CORRESPONDING ls_ressult TO er_entity.
    ENDIF.
  endmethod.
```
- CREATE_ENTITY
```abap
" ZCL_ZGWMEMBER_B03_DPC_EXT : MEMBERENTITYSET_CREATE_ENTITY

  method MEMBERENTITYSET_CREATE_ENTITY.
    DATA: ls_entity TYPE ZCL_ZGWMEMBER_B03_MPC=>TS_MEMBERENTITY,
          ls_data TYPE zn2member_b03.

    io_data_provider->read_entry_data( IMPORTING es_data = ls_entity ).
    CHECK sy-subrc = 0.
    MOVE-CORRESPONDING ls_entity TO ls_data.
    ls_data-erdat = sy-datum.
    ls_data-erzet = sy-uzeit.
    ls_data-ernam = sy-uname.
    INSERT zn2member_b03 FROM ls_data.
    MOVE ls_entity TO er_entity.
  endmethod.
```
- UPDATE_ENTITY
```abap
" ZCL_ZGWMEMBER_B03_DPC_EXT : MEMBERENTITYSET_UPDATE_ENTITY

  method MEMBERENTITYSET_UPDATE_ENTITY.
    DATA: ls_data TYPE zn2member_b03,
          ls_entity TYPE ZCL_ZGWMEMBER_B03_MPC=>TS_MEMBERENTITY.
    io_data_provider->read_entry_data( IMPORTING es_data = ls_entity ).
    CHECK sy-subrc = 0.

    SELECT SINGLE * FROM zn2member_b03
      INTO ls_data
      WHERE id = ls_entity-id.

    ls_data-name = ls_entity-name.
    ls_data-age = ls_entity-age.
    ls_data-aedat = sy-datum.
    ls_data-aezet = sy-uzeit.
    ls_data-aenam = sy-uname.
    UPDATE zn2member_b03 FROM ls_data.
  endmethod.
```
- DELETE_ENTITY
```abap
" ZCL_ZGWMEMBER_B03_DPC_EXT : MEMBERENTITYSET_DELETE_ENTITY

  method MEMBERENTITYSET_DELETE_ENTITY.
    DATA: ls_data TYPE zn2member_b03.

    LOOP AT it_key_tab INTO DATA(ls_key).
      ls_data-(ls_key-name) = ls_key-value.
    ENDLOOP.

    DELETE zn2member_b03 FROM ls_data.
  endmethod.
```
</br>
</br>

### 2) Main.controller.js
```java
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel",
    "sap/ui/core/Fragment",
    "sap/ui/model/Filter",
    "sap/ui/model/FilterOperator",
    "sap/ui/model/Sorter"
], (Controller, JSONModel, Fragment, Filter, FilterOperator, Sorter) => {
    "use strict";

    return Controller.extend("zuimemberb03.controller.Main", {
        onInit() {
            this.oDataModel = this.getOwnerComponent().getModel();
            this.oInputModel = new JSONModel();
            this.oMainModel = new JSONModel();
            this.getView().setModel(this.oInputModel, "oInputModel");
            this.getView().setModel(this.oMainModel, "oMainModel");
            this.oDataRead();
        },
        FixUTC: function(oDate) {
            if (!oDate) return null;
            return new Date(oDate.getTime() - (oDate.getTimezoneOffset() * 60000));
        },
        onSearch: function() {
            this.oDataRead();
        },
        oDataRead: function() {
            let oData = this.oInputModel.getData();
            let oFilter = [];
            
            if(oData.Name) {
                oFilter.push(new Filter("Name", FilterOperator.Contains, oData.Name));
            }
            if(oData.ErdatStart && oData.ErdatEnd) {
                oFilter.push(new Filter("Erdat", FilterOperator.BT, this.FixUTC(oData.ErdatStart), this.FixUTC(oData.ErdatEnd)));
            }
            if(oData.AedatStart && oData.AedatEnd) {
                oFilter.push(new Filter("Aedat", FilterOperator.BT, this.FixUTC(oData.AedatStart), this.FixUTC(oData.AedatEnd)));
            }

            this.oDataModel.read("/MemberEntitySet", {          // 화면에 oData 리프레쉬
                filters: oFilter,
                success: function(oReturn) {
                    this.oMainModel.setData(oReturn.results);
                }.bind(this),
                error: function() {
                    sap.m.MessageToast.show("read 에러!");
                }
            })
        },
        formatAge: function(sAge) {
            if (!sAge) return "";
            return Number(sAge);
        },
        onrowSelectionChange: function(oEvent) {
            let oRow = oEvent.getParameter("rowContext");
            if(!oRow) return;
            let oData = oRow.getObject();
            // let oData = oEvent.getParameters().rowContext.getObject();
            let oModel = new JSONModel(oData);  
             
            if(this._oDialog) {   
                this.byId("idCreate").setEnabled(false);
                this.byId("idUpdate").setEnabled(true);
                this.byId("idDelete").setEnabled(true);
                this.byId("idOption").setSelectedKey("Update");
                this.byId("idId").setEnabled(false);
                this.byId("idName").setEnabled(true);
                this.byId("idAge").setEnabled(true);

                this._oDialog.setModel(oModel, "oDialogModel");        
                this._oDialog.open();
            }
            else {
                Fragment.load({
                    id: this.getView().getId(),     // 다이얼로그를 현재 뷰의 ID 체계에 편입시켜 this.byId()로 접근 가능하게 만듦
                    name: "zuimemberb03.view.fragment.oDialog",        
                    type: "XML",        
                    controller: this    
                }).then(function(oDialog) {
                    this.byId("idCreate").setEnabled(false);
                    this.byId("idUpdate").setEnabled(true);
                    this.byId("idDelete").setEnabled(true);
                    this.byId("idOption").setSelectedKey("Update");
                    this.byId("idId").setEnabled(false);
                    this.byId("idName").setEnabled(true);
                    this.byId("idAge").setEnabled(true);

                    this._oDialog = oDialog;
                    this._oDialog.setModel(oModel, "oDialogModel");
                    this.getView().addDependent(this._oDialog) // 다이얼로그를 현재 뷰에 종속시켜 뷰의 모델(데이터)과 ID 체계를 공유하도록 설정
                    this._oDialog.open();
                }.bind(this))
            }
        },
        onCreate: function() {
            let oModel = new JSONModel();

            if(this._oDialog) { 
                this.byId("idCreate").setEnabled(true);
                this.byId("idUpdate").setEnabled(false);
                this.byId("idDelete").setEnabled(false);
                this.byId("idOption").setSelectedKey("Create");
                this.byId("idId").setEnabled(true);
                this.byId("idName").setEnabled(true);
                this.byId("idAge").setEnabled(true);

                this._oDialog.setModel(oModel, "oDialogModel");     
                this._oDialog.open();
            }
            else {
                Fragment.load({
                    id: this.getView().getId(),     // 다이얼로그를 현재 뷰의 ID 체계에 편입시켜 this.byId()로 접근 가능하게 만듦
                    name: "zuimemberb03.view.fragment.oDialog",        
                    type: "XML",        
                    controller: this    
                }).then(function(oDialog) {
                    this.byId("idCreate").setEnabled(true);
                    this.byId("idUpdate").setEnabled(false);
                    this.byId("idDelete").setEnabled(false);
                    this.byId("idId").setEnabled(true);
                    this.byId("idName").setEnabled(true);
                    this.byId("idAge").setEnabled(true);
                    this.byId("idOption").setSelectedKey("Create");

                    this._oDialog = oDialog;
                    this._oDialog.setModel(oModel, "oDialogModel");
                    this.getView().addDependent(this._oDialog) // 다이얼로그를 현재 뷰에 종속시켜 뷰의 모델(데이터)과 ID 체계를 공유하도록 설정
                    this._oDialog.open();
                }.bind(this))
            }
        },
        onSelectChange: function() {
            let oKey = this.byId("idOption").getSelectedKey();
            
            if(oKey === "Update") {
                this.byId("idId").setEnabled(false);
                this.byId("idName").setEnabled(true);
                this.byId("idAge").setEnabled(true);
            }
            else if(oKey === "Delete") {
                this.byId("idId").setEnabled(false);
                this.byId("idName").setEnabled(false);
                this.byId("idAge").setEnabled(false);
            }
        },
        onSave: function() {
            let oKey = this.byId("idOption").getSelectedKey();
            let oModel = this._oDialog.getModel("oDialogModel");
            let oData = oModel.getData();

            if(oKey === "Create") {
                let oBody = {
                    Id: oData.Id,
                    Name: oData.Name,
                    Age: oData.Age
                }
                this.oDataModel.create("/MemberEntitySet", oBody, {
                    success: function() {
                        sap.m.MessageToast.show("Create 성공!");
                    },
                    error: function() {
                        sap.m.MessageToast.show("Create 실패!");
                    }
                })
                this.oDataRead();
            } 
            else if(oKey === "Update") {
                let sPath = this.oDataModel.createKey("/MemberEntitySet", {
                    Id : oData.Id
                }) 
                let oBody = {
                    Id: oData.Id,
                    Name: oData.Name,
                    Age: oData.Age
                }
                this.oDataModel.update(sPath, oBody, {
                    success: function() {
                        sap.m.MessageToast.show("Update 성공!");
                    },
                    error: function() {
                        sap.m.MessageToast.show("Update 실패!");
                    }
                })
                this.oDataRead();
            }
            else if(oKey === "Delete") {
                let sPath = this.oDataModel.createKey("/MemberEntitySet", {
                    Id : oData.Id
                }) 
                this.oDataModel.remove(sPath, {
                    success: function() {
                        sap.m.MessageToast.show("Delete 성공!");
                    },
                    error: function() {
                        sap.m.MessageToast.show("Delete 실패!");
                    }
                })
                this.oDataRead();
            }
        },
        onClose: function() {
            this._oDialog.close();
        }
    });
});
```
</br>
</br>

### 3) Main.view.xml
```html
<mvc:View controllerName="zuimemberb03.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:fb="sap.ui.comp.filterbar"
    xmlns:t="sap.ui.table"
    xmlns:core="sap.ui.core"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <content>
            <fb:FilterBar id="filterbar" persistencyKey="myPersKey" useToolbar="false" search=".onSearch" filterChange=".onFilterChange" afterVariantLoad=".onAfterVariantLoad">
                <fb:filterGroupItems>
                    <fb:FilterGroupItem name="Name" label="이름" groupName="Group1" visibleInFilterBar="true">
                        <fb:control>
                            <Input value="{oInputModel>/Name}"/>
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem name="Erdat" label="생성일" groupName="Group1" visibleInFilterBar="true">
                        <fb:control>
                            <DateRangeSelection
                                id="idErdat"
                                change="handleChange"
                                value= "{
                                    'type': 'sap.ui.model.type.DateInterval',
                                    'parts': [
                                        {
                                            'type': 'sap.ui.model.type.Date',
                                            'path': 'oInputModel>/ErdatStart'
                                        },
                                        {
                                            'type': 'sap.ui.model.type.Date',
                                            'path': 'oInputModel>/ErdatEnd'
                                        }
                                    ]
                                }"/>
                        </fb:control>
                    </fb:FilterGroupItem>
                    <fb:FilterGroupItem name="Aedat" label="변경일" groupName="Group1" visibleInFilterBar="true">
                        <fb:control>
                            <DateRangeSelection
                                id="idAedat"
                                change="handleChange"
                                value= "{
                                    'type': 'sap.ui.model.type.DateInterval',
                                    'parts': [
                                        {
                                            'type': 'sap.ui.model.type.Date',
                                            'path': 'oInputModel>/AedatStart'
                                        },
                                        {
                                            'type': 'sap.ui.model.type.Date',
                                            'path': 'oInputModel>/AedatEnd'
                                        }
                                    ]
                                }"/>
                        </fb:control>
                    </fb:FilterGroupItem>
                </fb:filterGroupItems>
            </fb:FilterBar>

            <t:Table id="idTable" 
                rows="{
                    path: 'oMainModel>/',
                    sorter: {
                        path: 'Id', 
                        descending: false
                    }
                }"
                selectionMode="Single"
                rowSelectionChange="onrowSelectionChange"
                paste="onPaste"
                selectionBehavior="Row"
                ariaLabelledBy="title">
                <t:extension>
                    <OverflowToolbar style="Clear">
                        <Title id="title" text="CRUD 프로그램"/>
                        <Button text="Create" press="onCreate" />
                    </OverflowToolbar>
                </t:extension>
                <t:columns>
                    <t:Column width="12rem">
                        <Label text="Id" />
                        <t:template>
                            <Text text="{oMainModel>Id}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="12rem">
                        <Label text="Name" />
                        <t:template>
                            <Text text="{oMainModel>Name}"/>
                        </t:template>
                    </t:Column>
                    <t:Column width="12rem">
                        <Label text="Age" />
                        <t:template>
                            <Text text="{
                                path: 'oMainModel>Age',
                                formatter: '.formatAge'
                            }"/>
                        </t:template>
                    </t:Column>
                    <t:Column width="12rem">
                        <Label text="Ernam" />
                        <t:template>
                            <Text text="{oMainModel>Ernam}"/>
                        </t:template>
                    </t:Column>
                    <t:Column width="12rem">
                        <Label text="Erdat" />
                        <t:template>
                            <Text text="{
                                path: 'oMainModel>Erdat',
                                type: 'sap.ui.model.type.DateTime',
                                formatOptions: { pattern : 'yyyy-MM-dd' }
                            }" />
                        </t:template>
                    </t:Column>
                    <t:Column width="12rem">
                        <Label text="Erzet" />
                        <t:template>
                            <Text text="{
                                path: 'oMainModel>Erzet',
                                type: 'sap.ui.model.odata.type.Time',
                                formatOptions: {
                                    pattern: 'HH:mm:ss'
                                }
                            }" />
                        </t:template>
                    </t:Column>
                    <t:Column width="12rem">
                        <Label text="Aenam" />
                        <t:template>
                            <Text text="{oMainModel>Aenam}"/>
                        </t:template>
                    </t:Column>
                    <t:Column width="12rem">
                        <Label text="Aedat" />
                        <t:template>
                            <Text text="{
                                path: 'oMainModel>Aedat',
                                type: 'sap.ui.model.type.DateTime',
                                formatOptions: { pattern : 'yyyy-MM-dd' }
                            }" />
                        </t:template>
                    </t:Column>
                    <t:Column width="12rem">
                        <Label text="Aezet" />
                        <t:template>
                            <Text text="{
                                path: 'oMainModel>Aezet',
                                type: 'sap.ui.model.odata.type.Time',
                                formatOptions: {
                                    pattern: 'HH:mm:ss'
                                }
                            }" />
                        </t:template>
                    </t:Column>
                </t:columns>
            </t:Table>
        </content>
    </Page>
</mvc:View>
```
</br>
</br>

### 4) oDialog.fragment.xml
```html
<c:FragmentDefinition id="idFragment"
    xmlns="sap.m" 
    xmlns:f="sap.ui.layout.form"
    xmlns:c="sap.ui.core">
    <Dialog id="idDialog"
            title="Details"
            contentHeight="50%"
            contentWidth="20%">
        <content>
            <VBox class="sapUiSmallMargin">
                <f:SimpleForm id="SimpleFormChange354"
                    editable="true"
                    layout="ResponsiveGridLayout"
                    title="Address"
                    labelSpanXL="3"
                    labelSpanL="3"
                    labelSpanM="3"
                    labelSpanS="12"
                    adjustLabelSpan="false"
                    emptySpanXL="4"
                    emptySpanL="4"
                    emptySpanM="4"
                    emptySpanS="0"
                    columnsXL="1"
                    columnsL="1"
                    columnsM="1"
                    singleContainerFullSize="false" >
                    <f:content>
                        <Select id="idOption" change="onSelectChange" >
                            <items>
                                <c:Item id="idCreate" text="Create" key="Create" enabled="false" />
                                <c:Item id="idUpdate" text="Update" key="Update" enabled="true" />
                                <c:Item id="idDelete" text="Delete" key="Delete" enabled="true" />
                            </items>
                        </Select>
                        <Label text="Id" id="id1"/>
                        <Input id="idId" value="{oDialogModel>/Id}" enabled="false"/>
                        <Label text="Name" />
                        <Input id="idName" value="{oDialogModel>/Name}" enabled="true"/>
                        <Label text="Age" />
                        <Input id="idAge" value="{oDialogModel>/Age}" enabled="true"/>
                    </f:content>
                </f:SimpleForm>
            </VBox>
        </content>
        <buttons>
            <Button text="Save" press=".onSave" />
            <Button text="Close" press=".onClose" />
        </buttons>
    </Dialog>
</c:FragmentDefinition>
```

</br>
</br>

### 4) 타일 생성
- 최초 1회 실행
  - npm run build
  - npm run deploy-config
  - npm run deploy
- 2번째 배포부터(코드 수정 시)
  - npm run build
  - npm run deploy
 
<img width="491" height="245" alt="image" src="https://github.com/user-attachments/assets/a90f0fb1-1133-4424-b63c-e6bdc1b09aa6" />
</br>
</br>

- SAP GUI에서 확인 가능
<img width="345" height="290" alt="image" src="https://github.com/user-attachments/assets/b3d5d0c0-0565-4ac3-b3e2-d15489647623" />
</br>
</br>

- 카탈로그 생성
<img width="648" height="325" alt="image" src="https://github.com/user-attachments/assets/10e89401-feaf-4df4-8813-be12bff47a99" />
</br>
</br>

<img width="827" height="228" alt="image" src="https://github.com/user-attachments/assets/91854f33-0d61-4d4a-af22-6edad3f875b5" />
</br>
</br>

<img width="726" height="292" alt="image" src="https://github.com/user-attachments/assets/361cee95-eea8-43df-b07e-a3246420cb97" />
</br>
</br>

- 타겟 맵핑 생성 후 그룹에 추가
<img width="864" height="215" alt="image" src="https://github.com/user-attachments/assets/d899f905-2e27-4e58-9650-1929a39bf49e" />
</br>
</br>

- 추가 안되면 직접 추가 가능
<img width="356" height="361" alt="image" src="https://github.com/user-attachments/assets/989e495d-a865-4315-9c82-f611a6fbb517" />
</br>
</br>

<img width="1008" height="219" alt="image" src="https://github.com/user-attachments/assets/e8654cc1-cc0e-4134-9ce4-ffd8fc04953f" />
</br>
</br>
</br>
</br>


