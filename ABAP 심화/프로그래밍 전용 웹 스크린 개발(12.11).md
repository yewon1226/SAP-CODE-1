## < ABAP 개념 >
</br>

### < 프로그램 타입 >
- 둘 다 DB CRUD 작업 가능
</br>

**1) Type 1 – Executable Program (Report Program)**
- 바로 실행 가능한 일반 프로그램
- SE38/SE80에서 바로 Run 가능

**2) Type M – Module Pool Program**
- 스크린 기반 프로그램
- 단독 실행 불가 → 반드시 `T-code` 필요
- 프로그램명: `SAPMZ` , `SAPMY` 로 시작
- 생성 방식은 일반 프로그램과 비슷
- 단, `Top Include` 체크 후 생성

</br>
</br>

### < 스크린 동작 흐름 >
**1) PBO (Process Before Output)**
- 스크린 출력 전에 실행되는 로직
- 100번 스크린이 뜨기 전에 필요한 초기 세팅을 여기서 처리

**2) PAI (Process After Input)**
- 스크린 표시 후, 사용자가 입력 → 이벤트 발생 후 실행
- 버튼 클릭, 엔터 입력 후 로직 처리

<img width="464" height="319" alt="image" src="https://github.com/user-attachments/assets/7652d97a-c07c-4772-a476-bd09e6538d14" />
</br>
</br>
</br>
</br>

### < 스크린 속성(Screen Attributes) >
- `Normal(View)` : 일반 화면
- `Subscreen` : 화면 내 포함되는 하위 화면 (fragment 느낌)
- `Modal Dialog Box` : 팝업 형태
- `Selection Screen` : 선택 화면

</br>
</br>

### < OK-CODE란? >
- 스크린과 프로그램 간에 사용자 명령(Function Code)을 주고받는 필드
- 시스템 변수 `sy-ucomm`
  
  - OK-CODE 값이 실제 저장되는 시스템 필드
    
    - 사용자가 버튼/엔터 입력 → OK-CODE 생성
    - 이 값이 `sy-ucomm` 에 들어옴
    - PAI에서 `CASE sy-ucomm` 으로 분기 처리
- 시스템 변수 'sy-dynnr' : 현재 실행 중인 스크린 번호를 알려줌

</br>
</br>

---

</br>

## < module pool program 생성 >
- 모듈풀(Type M)은 T-code를 만들어야만 실행 가능 (Report와 달리 직접 실행 불가)
- Module Pool Include 구조
  
  - `I01` : Input 관련 로직
  - `O01` : Output 관련 로직
  - `F01` : Function·기능 로직
- `Next Screen` : 다음에 어떤 화면을 띄울지 결정
  
  - `next dynpro = 0` 은 빈값과 같음
  - 현재 화면 처리 후 자동으로 ‘뒤로가기(back)’
  - `next dynpro = Default` → 현재 화면 유지
- 9000번 이상은 사용 금지 (CBO 영역이므로 충돌 위험)

</br>
</br>

### < Module Pool 기본 생성 및 T-Code 실행 >
</br>

**1) 프로그램 생성 후 프로그램에 스크린 생성**

<img width="421" height="320" alt="image" src="https://github.com/user-attachments/assets/c82fc429-0d39-45b3-8a72-3b8d9cd00985" />
</br>
</br>

**2) 스크린 dynpro 지정**

<img width="565" height="369" alt="image" src="https://github.com/user-attachments/assets/580bf983-2d39-4cb6-ac75-542825de91de" />
</br>
</br>

- 엔터 치면 뒤로가기 설정하고 싶으면 `next dynpro = 0`
<img width="564" height="433" alt="image" src="https://github.com/user-attachments/assets/4896f30e-0df5-49f3-887d-ee1c110f13c6" />

</br>
</br>

**3) 스크린에서 Layout 클릭**

<img width="579" height="384" alt="image" src="https://github.com/user-attachments/assets/46bde9cf-13e3-4905-8626-b105ad58e8df" />
</br>
</br>

**4) 스크린창에서 text 생성**

<img width="676" height="344" alt="image" src="https://github.com/user-attachments/assets/2df2ff1b-d20f-486e-b9c9-3f61f9c85563" />
</br>
</br>

**5) TCODE 생성 - program에 생성**

<img width="528" height="359" alt="image" src="https://github.com/user-attachments/assets/8328e9ba-17f2-4a73-a936-ff6ac3fff6f1" />
</br>
</br>

**6) TCODE 생성 - program and dynpro 체크**

<img width="586" height="372" alt="image" src="https://github.com/user-attachments/assets/0e69a724-19d3-4d59-8a57-abf9efe4bb7f" />
</br>
</br>

**7) TCODE 생성 - screen number 고려해서 생성**

<img width="597" height="429" alt="image" src="https://github.com/user-attachments/assets/47fbb42f-02bb-426e-96ce-794f115f1c76" />

</br>
</br>

**8) TCODE 생성 -  TCODE 입력시 창 열림**
- `/OZTCODESCREENB03` 입력시 이 창이 띄워짐
-	위 버튼 비활성화 -> 스크린마다 다르게 버튼 설정 가능
<img width="350" height="231" alt="image" src="https://github.com/user-attachments/assets/b71ee012-d91c-4c6a-8aec-cc81d15065f2" />

</br>
</br>
</br>
</br>
</br>
</br>

---

</br>

## < 스크린 파일 내 PBO, PAI 모듈 생성 >
- 스크린 필드명과 ABAP 프로그램의 필드명을 동일하게 해야 연결됨.
</br>

**1) 스크린 파일 열기** 

<img width="435" height="204" alt="image" src="https://github.com/user-attachments/assets/3dcc5695-3756-4fce-8e9c-777fa1901393" />
</br>
</br>

**2) 모듈 `STATUS_0100` 와 `USER_COMMAND_0100` 생성** 

<img width="596" height="262" alt="image" src="https://github.com/user-attachments/assets/ecbde80e-6778-4eac-8640-8e83d30bf762" />

</br>
</br>

**3) `STATUS_0100` 안에 있는 `PF_STATUS` 랑 `TITLEBAR` 생성** 

<img width="581" height="174" alt="image" src="https://github.com/user-attachments/assets/158e8a48-0af7-4715-8e9a-9f2df9504033" />
</br>
</br>

<img width="533" height="340" alt="image" src="https://github.com/user-attachments/assets/40317b12-abbb-4701-b894-4cd8a61fa110" />
</br>
</br>

<img width="540" height="164" alt="image" src="https://github.com/user-attachments/assets/2f8c92d9-f224-44fa-9e5f-69506a12caf0" />
</br>
</br>

<img width="573" height="142" alt="image" src="https://github.com/user-attachments/assets/610331b4-9625-4f1f-b72a-5f5ce51714b7" />
</br>
</br>

**4) 타이틀이 바뀐 것을 확인** 

<img width="412" height="258" alt="image" src="https://github.com/user-attachments/assets/5c6d40c9-47a5-495a-905f-21c4648690c4" />
</br>
</br>
</br>
</br>
</br>
</br>

### < 스크린 Layout 기능 >
</br>

**1) 스크린의 Layout에서 다양하게 구성 가능**

<img width="518" height="416" alt="image" src="https://github.com/user-attachments/assets/baa5878e-248a-444e-9cb1-ca9ec07970b9" />
</br>
</br>

**2) TCODE 검색으로 결과 확인 가능**

<img width="523" height="389" alt="image" src="https://github.com/user-attachments/assets/7c53ec59-3f18-4c93-bf25-29b9079eb865" />
</br>
</br>
</br>
</br>

---

</br>

## < ABAP ↔ 스크린 코드 모음 >
- **가장 중요한 점 : TCODE 생성**
</br>

### 1) ABAP 프로그램에서 구조 선언

- 무조건 구조체로만 생성
- OK_CODE 추가 필수. 타입은 반드시 `SY-UCOMM`
```abap
TABLES: sdyn_conn, scarr.
DATA OK_CODE TYPE sy-ucomm.
```
</br>
</br>

### 2) 스크린에서도 같은 이름을 사용 / OK_CODE 추가 필수

- 이름이 동일하면 자동으로 ABAP 변수와 값이 동기화됨
- PBO/PAI에서 MOVE 구문 필요 없음
```abap
SDYN_CONN-CARRID
SDYN_CONN-CONNID
OK_CODE
```
</br>
</br>

### 3) sy-dynnr (현재 스크린 번호)
- 현재 실행 중인 스크린 번호를 알려줌
```abap
sy-dynnr
```
</br>
</br>

### 4) 뒤로가기 (Back) 처리
- next screen 을 0으로 주면 뒤로가기(back) 기능 수행
- PAI에서 엔터/버튼 후 해당 구문 실행 시 이전 화면으로 돌아감
```abap
LEAVE TO SCREEN 0.
```
</br>
</br>

### 5) 필드 초기화 (CLEAN)
- 입력, 출력 필드 초기화 가능
```abap
MODULE clear_fields OUTPUT.
  CLEAR INPUT01.
  CLEAR OK_CODE.
ENDMODULE.
```
</br>
</br>

### 6) TCODE 생성 (TCODE를 생성해야 실행이 됨)

</br>
</br>
</br>

---
</br>

## < ABAP ↔ 스크린 코드 예제 >
</br>

**1) 상단 두번째 그림 클릭 시 DB 테이블 목록을 선택 가능**

<img width="474" height="206" alt="image" src="https://github.com/user-attachments/assets/39ef0a75-d2c5-42e6-8830-659d879ec19a" />

</br>
</br>

**2) 테이블명 입력 후 get from dictionary 클릭**

<img width="559" height="113" alt="image" src="https://github.com/user-attachments/assets/0ee1f644-3b66-4474-955a-73b4fcfc21ec" />

</br>
</br>

**3) 화면에 출력하고 싶은 필드 선택**

<img width="480" height="336" alt="image" src="https://github.com/user-attachments/assets/19e72e7f-7991-44d5-8bb6-f99584fb55de" />

</br>
</br>

**4) 입력/출력 창 지정**
- 버튼들 더블클릭 후에 속성 설정 가능
    
<img width="480" height="275" alt="image" src="https://github.com/user-attachments/assets/dbdf677f-5ac3-4850-9cfd-2421f88c17f6" />
</br>
</br>

- input 값에 required 선택 시 필수값 지정
  
<img width="375" height="252" alt="image" src="https://github.com/user-attachments/assets/ff465ba0-48ca-4e44-ad5e-501a273f02b1" />

- input 선택 해제 시 output 용으로 변경

<img width="424" height="252" alt="image" src="https://github.com/user-attachments/assets/c20a3b8f-6c12-4dc6-8cec-d986c5ea9be8" />

</br>
</br>

**5) 스크린 파일 `element list`에 `OK_CODE` 필드 추가**

<img width="652" height="313" alt="image" src="https://github.com/user-attachments/assets/f7d67885-0da2-40ee-9554-f42c5d4c2292" />

</br>
</br>

**6) `TOP` 파일에 변수 선언**
- tables 선언, OK_CODE 데이터로 선언 필수 
```abap
PROGRAM SAPMZMDPB03_001.

TABLES: SDYN_CONN. " 스크린 안에 생성한
                   " Table/Structure

DATA: INPUT01 TYPE C, " 입출력 필드
      OK_CODE TYPE SY-UCOMM. " OK_CODE
```
</br>

**4) 스크린 파일 코드에 PBO, PAI 모듈 추가**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE CLEAR_FIELDS.

PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
```
</br>

**5) PAI 코드 추가**
```abap
MODULE user_command_0100 INPUT.
  CASE INPUT01.
    WHEN 'X'.
      SELECT SINGLE CARRID CONNID CITYFROM CITYTO
        INTO CORRESPONDING FIELDS OF SDYN_CONN
        FROM SPFLI
        WHERE CARRID = SDYN_CONN-CARRID
          AND CONNID = SDYN_CONN-CONNID.
    WHEN 'E'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**6) PBO 코드 추가**
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'. " Application 버튼들 등 설정
 SET TITLEBAR 'T100'.
ENDMODULE.

MODULE clear_fields OUTPUT.
  CLEAR INPUT01.
  CLEAR OK_CODE.
ENDMODULE.
```
</br>

**7) TCODE 생성**

<img width="559" height="392" alt="image" src="https://github.com/user-attachments/assets/a366e09f-45b7-4db3-9a08-b3904f732747" />
</br>
</br>

**8) 결과 확인**

<img width="652" height="331" alt="image" src="https://github.com/user-attachments/assets/a922ceab-571f-46c6-83c8-e620163e85c9" />

</br>
</br>

---

</br>

## < 실습 코드 >
### 실습 1

**1) 인풋 3개 필수값으로 지정**

<img width="620" height="386" alt="image" src="https://github.com/user-attachments/assets/a3a604f3-eba2-4c67-bfb1-cd29d0f82c66" />
</br>
</br>

**2) 스크린 파일 `element list`에서 `OK_CODE` 추가**

<img width="623" height="349" alt="image" src="https://github.com/user-attachments/assets/95ea6ac0-944a-4048-9c8c-fc5e80964fa2" />
</br>
</br>

**3) `TOP` 파일에 변수 선언**
- tables 선언, OK_CODE 데이터로 선언 필수 
```abap
*&---------------------------------------------------------------------*
*& Include MZBC410_SOLUTION_TOP                     - Module Pool      SAPMZBC410_SOLUTION_03
*&---------------------------------------------------------------------*
PROGRAM SAPMZBC410_SOLUTION_03.

TABLES: SDYN_CONN.

DATA: exit_button TYPE C,
      OK_CODE TYPE SY-UCOMM,
      gs_data TYPE SDYN_CONN,
      gv_subrc TYPE sy-subrc.
```
</br>

**4) 스크린 파일 코드에 PBO, PAI 모듈 추가**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
*
PROCESS AFTER INPUT.
  MODULE CHECK_SFLIGHT.
  MODULE USER_COMMAND_0100.
```
</br>

**5) PAI 코드 추가**
```abap
*&---------------------------------------------------------------------*
*& Include          MZBC410_SOLUTION_I01
*&---------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_0100  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE user_command_0100 INPUT.

  IF exit_button = 'X'.
    LEAVE TO SCREEN 0.
  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*
*&      Module  CHECK_SFLIGHT  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE check_sflight INPUT.

  SELECT SINGLE * FROM sflight
    INTO CORRESPONDING FIELDS OF gs_data
    WHERE carrid = SDYN_CONN-carrid
      AND connid = SDYN_CONN-connid
      AND fldate = SDYN_CONN-fldate.

  IF sy-subrc <> 0.
    gv_subrc = 4.
    message text-007 TYPE 'I'.
  ENDIF.

ENDMODULE.
```
</br>

**6) PBO 코드 추가**
```abap
*&---------------------------------------------------------------------*
*& Include          MZBC410_SOLUTION_O01
*&------------------------------------+---------------------------------*
*&---------------------------------------------------------------------*
*& Module STATUS_0100 OUTPUT
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
MODULE status_0100 OUTPUT.
  IF gv_subrc <> 0.
    CLEAR SDYN_CONN.
    gv_subrc = 0.
  ELSE.
    MOVE-CORRESPONDING gs_data TO SDYN_CONN.
  ENDIF.
ENDMODULE.
```
</br>

**7) TCODE 생성**

<img width="542" height="382" alt="image" src="https://github.com/user-attachments/assets/c5ade457-68f6-4730-b72c-b83ea00b645b" />
