## <  핵심 개념 >
</br>

- **1) `CALL SUBSCREEN`**
- **2)**
- **3)**

</br>

- **`LEAVE TO SCREEN 0`** 같은 화면 전환 명령은 **`PAI`** 에서만
- **`SCREEN-INPUT`** 같은 화면 속성 변경은 **`PBO`** 에서만
- 사용자 입력 기반 SELECT는 **`PAI`** , 조회 결과 화면 반영/속성 변경은 **`PBO`**
- **OK_CODE 초기화** 코드 꼭 넣어줘야 함 ( 보통 **`PBO`** 에서 )
- **`OK_CODE`** 케이스문은 **`PAI`** 에서
- LOOP AT SCREEN 사용시 **`MODIFY SCREEN`** 넣기
- **`FIELD / CHAIN`** 은 무조건 **PAI** 에서만 구현
- **`AT EXIT-COMMAND`** 은 무조건 **PAI** 에서만 구현
- **`AT EXIT-COMMAND`** 는 Screen 코드에서 **맨 위** 에 두는 게 좋음
- **서로 다른 스크린의 버튼** 은 같은 MODULE에서 처리하면 **안됨**
- **즉시 반응** = **`Function Code`** 필수
- **버튼** → **`Function Code`** 만 OK_CODE로 옴
- **라디오·체크** → 보통 **`Name`** 값(X)으로 판단 ( `Function Code` 지정 필수 )

</br>

---

</br>

## < 서브스크린 (Subscreen) >
- 메인 화면에 `Subscreen Area` (예약 영역) 를 미리 정의
- 실행 시 다른 Screen( `Subscreen` )을 해당 영역에 채워 넣음
- 메인 화면은 유지되며 부분 화면을 재사용·동적으로 교체 가능
- 서브스크린은 영역 1개당 1개만 표시되며, 영역을 여러 개 만들면 여러 개를 동시에 띄울 수 있음
</br>

### < Subscreen 제약사항 정리 >
- LOOP 문 내부 사용 불가
  - `LOOP AT SCREEN` , `LOOP AT itab` 등 반복문 안에서 `CALL SUBSCREEN` 사용 ❌
- CHAIN … ENDCHAIN 내부 사용 불가
- OK Code 필드 가질 수 없음
- 스크린 번호(Screen No.)는 유니크해야 함
- 화면 제어 명령 사용 불가
  - 타이틀, 메뉴, 버튼은 메인 스크린에서만 설정
</br>
</br>

### < `CALL SUBSCREEN` >
- `CALL SUBSCREEN` 은 화면 전환이 아님
- 메인 스크린 안의 `Subscreen Area` 에 다른 Screen을 포함시키는 동작
- 메인 스크린의 흐름(PBO/PAI) 안에서 서브스크린의 PBO/PAI도 함께 실행됨
- 시스템변수 `SY-CPROG` = 현재 호출된(실행 중인) ABAP 프로그램명
</br>

- PBO에서 사용 (서브스크린 지정)
- `INCLUDING` 은 PBO에서만 사용
```abap
CALL SUBSCREEN <subscreen_area>
  INCLUDING <program> <dynpro>.
```
- PAI에서 사용 (입력 처리)
```abap
CALL SUBSCREEN <subscreen_area>.
```
```abap
PROCESS BEFORE OUTPUT.
  CALL SUBSCREEN sub1
    INCLUDING SY-CPROG '0101'.

PROCESS AFTER INPUT.
  CALL SUBSCREEN sub1.
```
</br>
</br>

### < `CALL SUBSCREEN` 예제 >
</br>

**1) 메인 스크린 Layout에 `Subscreen Area` 정의**

<img width="381" height="338" alt="image" src="https://github.com/user-attachments/assets/6c0e373f-b0d1-4018-ad6f-f1ca417b747d" />

</br>
</br>

<img width="407" height="334" alt="image" src="https://github.com/user-attachments/assets/9f55763e-9639-4ce3-82f5-2a5951dfa53e" />
</br>
</br>

- 스크린 생성 시 `Dynpro Type` 을 `Subscreen` 으로 설정
<img width="480" height="314" alt="image" src="https://github.com/user-attachments/assets/642f35c6-806b-4b9a-b02e-38530152fa33" />

</br>
</br>
</br>

**2) Screen 100 에서 모듈 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE set_subscreen.
 MODULE CLEAR_OK_CODE.

  " SUB 라는 이름의 서브스크린 공간에 서브스크린을 세팅함
  " sy-cprog : 현재 프로그램 이름
  " gv_dynnr : TOP에 추가한 변수이며 '0110' 과 같은 서브스크린 번호가 들어감
  CALL SUBSCREEN SUB
  INCLUDING SY-CPROG gv_dynnr.

PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
   CALL SUBSCREEN SUB.
```
</br>

**3) `TOP` 모듈 생성**
```abap
PROGRAM SAPMZB03006.

DATA: OK_CODE TYPE sy-ucomm.
DATA: RAD1 TYPE C,
      RAD2 TYPE C,
      RAD3 TYPE C VALUE 'X'.
DATA: gv_dynnr TYPE sy-dynnr.
```
</br>

**4) `PAI` 모듈 생성**
```abap
MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN 'EXIT' OR 'CANCEL'.
      LEAVE PROGRAM.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**5) `PBO` 모듈 생성**
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100' WITH sy-uname.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE set_subscreen OUTPUT.
  CASE 'X'.
    WHEN RAD1.
      gv_dynnr = '0110'.
    WHEN RAD2.
      gv_dynnr = '0120'.
    WHEN RAD3.
      gv_dynnr = '0130'.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR OK_CODE.
ENDMODULE.
```
</br>
</br>

---

</br>

## < 펑션그룹을 활용한 서브스크린 데이터 공유 >
- 서브스크린은 `Function Group` 안에 정의 가능
- 같은 Function Group의 글로벌 데이터(전역변수)를 서브스크린에서 직접 사용 가능
- PBO/PAI에서 `Function Module` 호출로 데이터 EXPORT / IMPORT 가능
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1
</br>

- 문제
  
<img width="391" height="234" alt="image" src="https://github.com/user-attachments/assets/972bf0b6-b73c-4140-a8a4-20be7ba81441" />
</br>
</br>
</br>
</br>

**1) 200 Screen Layout 생성**
- 체크 박스 즉시 반응 시키려면 `Function code` 무조건 설정해야 함

<img width="458" height="309" alt="image" src="https://github.com/user-attachments/assets/4022d7d7-b302-46cf-84e8-c7aba5e35552" />
</br>
</br>
</br>
</br>

**2) Screen 코드 수정 및 생성**
- 100 Screen 코드 생성
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE set_subscreen.
 MODULE CLEAR_OK_CODE.

  " SUB 라는 이름의 서브스크린 공간에 서브스크린을 세팅함
  " sy-cprog : 현재 프로그램 이름
  " gv_dynnr : TOP에 추가한 변수이며 '0110' 과 같은 서브스크린 번호가 들어감
  CALL SUBSCREEN SUB
  INCLUDING SY-CPROG gv_dynnr.

PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
   CALL SUBSCREEN SUB.
```
- 200 Screen 코드 생성
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0200.
 MODULE set_subscreen2.
 MODULE CLEAR_OK_CODE.
   CALL SUBSCREEN SUB2
   INCLUDING sy-cprog gv_dynnr.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0200.
   CALL SUBSCREEN SUB2.
```
</br>
</br>

**3) `TOP` 모듈 수정**
```abap
PROGRAM SAPMZB03006.

DATA: OK_CODE TYPE sy-ucomm.
DATA: RAD1 TYPE C,
      RAD2 TYPE C,
      RAD3 TYPE C VALUE 'X',
      CHK1 TYPE C,
      CHK2 TYPE C VALUE 'X'.
DATA: gv_dynnr TYPE sy-dynnr.
```
</br>
</br>

**4) `PAI` 모듈 수정**
```abap
MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN 'EXIT' OR 'CANCEL'.
      LEAVE PROGRAM.
    WHEN '200BUTTON'.
      LEAVE TO SCREEN 200.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0200 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN 'EXIT' OR 'CANCEL'.
      LEAVE PROGRAM.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>
</br>

**5) `PBO` 모듈 수정**
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100' WITH sy-uname.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE set_subscreen OUTPUT.
  CASE 'X'.
    WHEN RAD1.
      gv_dynnr = '0110'.
    WHEN RAD2.
      gv_dynnr = '0120'.
    WHEN RAD3.
      gv_dynnr = '0130'.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE set_subscreen2 OUTPUT.
  IF CHK1 = 'X' AND CHK2 = 'X'.
    MESSAGE '입력값이 2개 입니다.' TYPE 'E' DISPLAY LIKE 'I'.
  ELSE.
    CASE 'X'.
      WHEN CHK1.
        gv_dynnr = '0140'.
      WHEN CHK2.
        gv_dynnr = '0150'.
      WHEN OTHERS.
    ENDCASE.
  ENDIF.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR OK_CODE.
ENDMODULE.
```
</br>
</br>

**6) 결과 확인**
- 체크에 따라 서브스크린이 달라짐
  
<img width="469" height="270" alt="image" src="https://github.com/user-attachments/assets/4175ec54-93b6-46f5-b8be-3f8e85984167" />
</br>
</br>
</br>
</br>
