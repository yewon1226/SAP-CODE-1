## <  핵심 개념 >
</br>

- **1) ALV 표준 툴바 버튼 제어**
- **2) ALV Field Catalog**
</br>

- **SELECT-OPTIONS는 `Selection Screen` 에서만 가능**

</br>
</br>

---

</br>

## < ABAP 객체 생성 기본 문법 >
</br>

### 1) ALV Grid 이벤트 처리 정리
- ALV 화면에서 발생하는 사용자 동작을 처리
- `CL_GUI_ALV_GRID` : ALV Grid 이벤트를 제공하는 클래스
</br>

- `Instance Attribute` → 객체마다 메모리 가지는 속성 (DATA)
- `Instance Method` → 객체마다 호출되는 메서드 (METHODS)
- `Static Attribute` → 클래스마다 하나만 존재하는 속성 (CLASS-DATA)
- `Static Method` → 클래스마다 하나만 존재하는 메서드 (CLASS-METHODS)
- `Constants` → 값 변경 불가한 고정값 (CONSTANTS)
</br>
</br>

**< ALV Grid 이벤트 / 파라미터 >**
- 이벤트: 언제 발생했는가
- 파라미터: 발생했을 때 어떤 정보가 넘어오는가

| 이벤트 | 설명 |
|--------|------|
| `DOUBLE_CLICK` | 셀을 더블클릭했을 때 발생 |
| `PRINT_TOP_OF_PAGE` | 출력 시 페이지 상단 처리 |
| `USER_COMMAND` | ALV 버튼 클릭 시 발생 |
| `TOOLBAR` | ALV 툴바 생성 시 발생 |
  
| 파라미터 | 설명 |
|----------|------|
| `ES_ROW_NO` | 더블클릭한 행 번호 |
| `E_COLUMN` | 더블클릭한 컬럼명 |
| `E_UCOMM` | 눌린 버튼의 Function Code |
| `E_OBJECT` | 툴바 버튼 추가/제어 객체 |
| `E_INTERACTIVE` | 인터랙티브 ALV 여부 |
</br>
</br>

**1) CLASS-METHODS (정적 메서드)**
- 객체 생성 없이 클래스명으로 바로 호출
- 공통 로직, 이벤트 핸들러에 자주 사용
- 인스턴스 속성 사용 불가

**2) METHODS (인스턴스 메서드)**
- 객체 생성(CREATE OBJECT) 후에만 호출
- 객체별 인스턴스 속성 사용 가능
- 객체 상태(속성)를 사용하는 로직에 사용
</br>
</br>

- `CLASS-METHODS` : 정적(static) 메서드,  `METHODS` : 인스턴스 메서드
- `<handler_class>` : 이벤트 핸들러 클래스명
- `<handler_method>` : 이벤트 처리 메소드명
- `<event_name>` : 발생 이벤트명
- `<event_class>` : 이벤트를 가진 클래스
- `<param_1>, <param_2>` : 이벤트 파라미터
```abap
*************** C01 ****************
CLASS <handler_class> DEFINITION.
  [PUBLIC | PROTECTED | PRIVATE] SECTION.
    [CLASS-]METHODS <handler_method>
      FOR EVENT <event_name> OF <event_class>
      IMPORTING
        <param_1>
        <param_2>
        sender.
ENDCLASS.

CLASS <handler_class> IMPLEMENTATION.
  METHOD <handler_method>.
  ENDMETHOD.
ENDCLASS.

*************** PBO ****************
SET HANDLER <handler_class>=><handler_method> FOR <event_object>.

CALL METHOD <event_object>->set_table_for_first_display
  EXPORTING
    i_structure_name = '<DDIC 구조>'
  CHANGING
    it_outtab        = <itab>
```
- `SENDER` → 이벤트를 발생시킨 객체(오브젝트) 참조
```abap
*************** C01 ****************
CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
  CLASS-METHODS: ON_DOUBLE_CLICK
    FOR EVENT DOUBLE_CLICK OF CL_GUI_ALV_GRID
    IMPORTING ES_ROW_NO E_COLUMN SENDER.
  " CL_GUI_ALV_GRID 클래스의 더블클릭 이벤트가 발생하면
  " ON_DOUBLE_CLICK 이라는 메서드를 실행하겠다
ENDCLASS.

CLASS lcl_event_handler IMPLEMENTATION.
  "더블클릭 이벤트의 메서드 구현
  METHOD ON_DOUBLE_CLICK.
    IF SENDER = GO_ALV.
      MESSAGE I004(ZMCB03) WITH ES_ROW_NO-row_id        " 더블클릭된 ALV 행 번호
                                E_COLUMN-fieldname.     " 더블클릭된 ALV 컬럼명
    ENDIF.
  ENDMETHOD.
ENDCLASS.

*************** PBO ****************
SET HANDLER lcl_event_handler=>on_double_click FOR go_alv.

CALL METHOD go_alv->set_table_for_first_display
  EXPORTING
    i_structure_name     = 'SBOOK'
  CHANGING
    it_outtab            = gt_data
```
</br>
</br>

### 2) ALV Hotspot 이벤트 처리
- ALV 컬럼을 클릭 가능한 링크(밑줄)로 표시하는 기능
- 필드카탈로그 생성 시(PBO) `gs_fcat-hotspot = 'X'` 로 적용
```abap
*************** F01 ****************
CLEAR gs_fcat.
gs_fcat-fieldname = '<HOTSPOT_FIELD>'.
gs_fcat-hotspot   = 'X'.      " 클릭 가능한 링크(밑줄) 처리
APPEND gs_fcat TO gt_fcat.

*************** C01 ****************
CLASS <handler_class> DEFINITION.
  PUBLIC SECTION.
    CLASS-METHODS <handler_method>
      FOR EVENT hotspot_click OF cl_gui_alv_grid
      IMPORTING e_row_id e_column_id sender.
ENDCLASS.

CLASS <handler_class> IMPLEMENTATION.
  METHOD <handler_method>.
    " e_row_id-row_id        : 클릭된 행 번호
    " e_column_id-fieldname : 클릭된 컬럼명
  ENDMETHOD.
ENDCLASS.

*************** PBO ****************
SET HANDLER <handler_class>=><handler_method> FOR go_alv.

CALL METHOD go_alv->set_table_for_first_display
  EXPORTING
    i_structure_name = '<DDIC>'
  CHANGING
    it_outtab        = <itab>
    it_fieldcatalog  = gt_fcat.
```
```abap
*************** F01 ****************
CLEAR gs_fcat.
gs_fcat-fieldname = 'PHONE'.   " 핫스팟 적용 컬럼
gs_fcat-hotspot   = 'X'.       " 핫스팟(링크) 활성화
APPEND gs_fcat TO gt_fcat.

*************** C01 ****************
CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
    CLASS-METHODS on_hotspot_click
      FOR EVENT hotspot_click OF cl_gui_alv_grid
      IMPORTING
        es_row_no     " 클릭된 행 정보 (row_id)
        e_column_id  " 클릭된 컬럼 정보 (fieldname)
        sender.
ENDCLASS.

CLASS lcl_event_handler IMPLEMENTATION.
  METHOD on_hotspot_click.
    IF sender = go_alv.
      MESSAGE I004(ZMCB03)
        WITH es_row_no-row_id        " 클릭된 행 번호
             e_column_id-fieldname. " 클릭된 컬럼명
    ENDIF.
  ENDMETHOD.
ENDCLASS.

*************** PBO ****************
SET HANDLER lcl_event_handler=>on_hotspot_click FOR go_alv.
```
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1
</br>
</br>

- 문제
- 전 exercise 코드에서 추가
<img width="374" height="208" alt="image" src="https://github.com/user-attachments/assets/90e9c079-c318-4291-9848-07923ecc223d" />
</br>
</br>

**1) `F01` 모듈 수정**
```abap
*&---------------------------------------------------------------------*
*& Include          ZBC405_03_ALV_F01
*&---------------------------------------------------------------------*

FORM set_fcat.
  CLEAR gs_fcat.
  gs_fcat-fieldname = 'SEATSOCC'.
  gs_fcat-do_sum = 'X'.
  gs_fcat-hotspot = 'X'.    " 핫스팟 추가
  APPEND gs_fcat TO gt_fcat.
ENDFORM.
```
</br>
</br>

**2) `C01` 모듈 수정**
```abap
*&---------------------------------------------------------------------*
*& Include          ZBC405_03_ALV_C01_3
*&---------------------------------------------------------------------*

CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
    CLASS-METHODS: on_double_click
      FOR EVENT double_click OF cl_gui_alv_grid
      IMPORTING es_row_no sender.

    CLASS-METHODS: on_hotspot_click
      FOR EVENT hotspot_click OF cl_gui_alv_grid
      IMPORTING es_row_no sender.
ENDCLASS.

CLASS lcl_event_handler IMPLEMENTATION.
  METHOD on_double_click.
    IF sender = go_alv_grid.
      DATA: total_seat TYPE int4.

      READ TABLE gt_flight INTO gs_flight INDEX es_row_no-row_id.
      IF sy-subrc <> 0.
        MESSAGE i075(bc405_408).
        EXIT.
      ENDIF.

      total_seat = gs_flight-seatsocc + gs_flight-seatsocc_b + gs_flight-seatsocc_f.
      MESSAGE 'Total:' && total_seat TYPE 'I'.
    ENDIF.
  ENDMETHOD.

  METHOD on_hotspot_click.
    IF sender = go_alv_grid.
      READ TABLE gt_flight INTO gs_flight INDEX es_row_no-row_id.
      IF gs_flight-excp = '1'.
        MESSAGE '빨간색 입니다.' TYPE 'I'.
      ELSEIF gs_flight-excp = '2'.
        MESSAGE '노란색 입니다.' TYPE 'I'.
      ELSE.
        MESSAGE '초록색 입니다.' TYPE 'I'.
      ENDIF.
    ENDIF.
  ENDMETHOD.
endclass.
```
</br>
</br>

**3) `PBO` 모듈 수정**
```abap
*&---------------------------------------------------------------------*
*& Include          ZBC405_03_ALV_O01
*&---------------------------------------------------------------------*

MODULE create_and_transfer OUTPUT.
    SET HANDLER lcl_event_handler=>on_double_click FOR go_alv_grid.
    SET HANDLER lcl_event_handler=>on_hotspot_click FOR go_alv_grid.

    CALL METHOD go_alv_grid->set_table_for_first_display
      EXPORTING
        i_structure_name              = 'SFLIGHT'
      CHANGING
        it_outtab                     = gt_flight
        IT_FIELDCATALOG               = gt_fcat
ENDMODULE.
```
