## <  핵심 개념 >
</br>

- **1) ALV Grid 이벤트 처리 정리 (`CLASS-METHODS`)**
- **2) ALV Hotspot 이벤트 처리**
</br>

- **C01(INCLUDE)은 TOP 바로 아래에 두는 게 정석**
</br>
</br>

---

</br>

## < ABAP 객체 생성 기본 문법 >
</br>

### 1) ALV 표준 툴바 확장 (TOOLBAR 이벤트)
- `TOOLBAR` : 툴바에 버튼을 추가/구성
- `USER_COMMAND` : 버튼 클릭 시 동작 처리
  
| 값 | 의미 |
|----|------|
| `0` | 일반 버튼 |
| `1` | 메뉴 + 표준 버튼 |
| `2` | 메뉴 |
| `3` | 구분선 (Separator) |
| `4` | 선택 버튼 |
| `5` | 체크박스 버튼 |
| `6` | 메뉴 엔트리 |

```abap
*************** C01 ****************
CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
    CLASS-METHODS on_toolbar
      FOR EVENT toolbar OF cl_gui_alv_grid
      IMPORTING e_object e_interactive sender.

    CLASS-METHODS on_user_command
      FOR EVENT user_command OF cl_gui_alv_grid
      IMPORTING e_ucomm sender.
ENDCLASS.


CLASS lcl_event_handler IMPLEMENTATION.
  METHOD on_toolbar.
    DATA ls_button TYPE stb_button.

    CLEAR ls_button.
    ls_button-function  = '<FUNC_CODE>'.
    ls_button-icon      = <ICON>.
    ls_button-text      = '<TEXT>'.
    ls_button-quickinfo = '<QUICKINFO>'.
    ls_button-butn_type = '0'.

    INSERT ls_button INTO TABLE e_object->mt_toolbar.
  ENDMETHOD.


  METHOD on_user_command.
    CASE e_ucomm.
      WHEN '<FUNC_CODE>'.
        " 버튼 클릭 시 처리 로직
      WHEN OTHERS.
    ENDCASE.
  ENDMETHOD.
ENDCLASS.

*************** PBO ****************
SET HANDLER lcl_event_handler=>on_toolbar      FOR go_alv.
SET HANDLER lcl_event_handler=>on_user_command FOR go_alv.

CALL METHOD go_alv->set_table_for_first_display
  EXPORTING
    i_structure_name = '<DDIC 구조>'
  CHANGING
    it_outtab        = <itab>.

```
```abap
*************** C01 ****************
CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
  CLASS-METHODS: ON_TOOLBAR FOR EVENT TOOLBAR
    OF CL_GUI_ALV_GRID IMPORTING E_OBJECT,
      ON_USER_COMMAND FOR EVENT USER_COMMAND
    OF CL_GUI_ALV_GRID IMPORTING E_UCOMM.
ENDCLASS.

CLASS lcl_event_handler IMPLEMENTATION.
  METHOD ON_TOOLBAR.
    DATA ls_button TYPE STB_BUTTON.
    ls_button-butn_type = 3.
    INSERT ls_button INTO TABLE e_object->mt_toolbar.

    CLEAR ls_button.
    ls_button-function = 'CUSTOM_TB'.
    ls_button-icon = ICON_FLIGHT.
    ls_button-quickinfo = 'This is tooltip~~'.
    ls_button-butn_type = 0.
    ls_button-text = 'flight'.
    INSERT ls_button INTO TABLE e_object->mt_toolbar.
  ENDMETHOD.

  METHOD ON_USER_COMMAND.
    DATA: lv_row TYPE I,
          lv_col TYPE I.

    CASE E_UCOMM.
      WHEN 'CUSTOM_TB'.
        MESSAGE 'flight' TYPE 'I'.
      WHEN OTHERS.
    ENDCASE.
  ENDMETHOD.
ENDCLASS.

*************** PBO ****************
SET HANDLER lcl_event_handler=>on_toolbar FOR go_alv.
SET HANDLER lcl_event_handler=>on_user_command FOR go_alv.

CALL METHOD go_alv->set_table_for_first_display
  EXPORTING
    i_structure_name              = 'SBOOK'
  CHANGING
    it_outtab                     = gt_data
```
</br>
</br>
</br>

### 2) ALV 셀 버튼(Button) 동적 생성 및 클릭 이벤트 처리
- 조건에 따라 ALV 특정 셀을 버튼으로 표시하고, 버튼 클릭 시 해당 행 데이터를 기준으로 동작을 처리
- `LVC_S_STYL` → ALV 셀 단위 스타일(버튼/입력불가 등) 정의 구조
- `LVC_T_STYL` → 셀 스타일을 여러 개 담는 내부테이블(행·컬럼별 적용용)
</br>

- ALV에서 셀 단위로 버튼/비활성 등 UI 스타일을 다르게 적용하기 위해 사용하는 방식
- `cl_gui_alv_grid=>mc_style_button` → ALV 셀을 “클릭 가능한 버튼 형태” 로 표시하는 스타일 상수
- `gs_cell_style-fieldname` → 버튼/스타일을 적용할 ALV 컬럼(필드)명 지정
- `gs_cell_style-style` → 해당 컬럼 셀에 적용할 UI 스타일(버튼, 비활성 등) 지정
- `gs_layout-stylefname` → ALV 데이터 구조에서 셀 스타일 정보를 담고 있는 필드명 연결
</br>

<img width="464" height="222" alt="image" src="https://github.com/user-attachments/assets/ceb7e53e-2aa1-451a-a292-50d109b49cc8" />
</br>
</br>

```abap
*************** TOP ****************
DATA: BEGIN OF gs_data.
        INCLUDE TYPE <DB_STRUCTURE>.
DATA: <BUTTON_FIELD> TYPE c LENGTH 10,
      <STYLE_FIELD>  TYPE lvc_t_styl,
     END OF gs_data.

DATA: gt_data       TYPE STANDARD TABLE OF gs_data,
      gs_cell_style TYPE lvc_s_styl.


*************** C01 ****************
CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
    CLASS-METHODS on_button_click
      FOR EVENT button_click OF cl_gui_alv_grid
      IMPORTING es_row_no es_col_id.
ENDCLASS.

CLASS lcl_event_handler IMPLEMENTATION.
  METHOD on_button_click.
    IF es_col_id-fieldname = '<BUTTON_FIELD>'.
    ENDIF.
  ENDMETHOD.
ENDCLASS.


*************** F01 ****************
FORM set_button.
  LOOP AT gt_data INTO gs_data.
    gs_cell_style-fieldname = '<BUTTON_FIELD>'.
    gs_cell_style-style     = cl_gui_alv_grid=>mc_style_button.
    APPEND gs_cell_style TO gs_data-<STYLE_FIELD>.
    gs_data-<BUTTON_FIELD> = '<BUTTON_TEXT>'.
    MODIFY gt_data FROM gs_data.
  ENDLOOP.
ENDFORM.


*************** PBO ****************
SET HANDLER lcl_event_handler=>on_button_click FOR <ALV_OBJECT>.
gs_layout-stylefname = '<STYLE_FIELD>'.

CALL METHOD <ALV_OBJECT>->set_table_for_first_display
  CHANGING it_outtab = gt_data.
```
```abap
*************** TOP ****************
DATA: BEGIN OF gs_data.
        INCLUDE TYPE sbook.
DATA: display_bookings TYPE c LENGTH 10,   " 버튼 텍스트
      it_cell_style    TYPE LVC_T_STYL,     " 셀 스타일
     END OF gs_data.
DATA gs_cell_style TYPE LVC_S_STYL.

*************** C01 ****************
CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
  CLASS-METHODS: on_button_click
    FOR EVENT button_click OF CL_GUI_ALV_GRID
    IMPORTING ES_ROW_NO ES_COL_ID.
ENDCLASS.

CLASS lcl_event_handler IMPLEMENTATION.
  METHOD on_button_click.
    IF ES_COL_ID-fieldname = 'DISPLAY_BOOKINGS'.
      READ TABLE gt_data INTO gs_data INDEX es_row_no-row_id.
      MESSAGE gs_data-class TYPE 'I'.
    ENDIF.
  ENDMETHOD.
ENDCLASS.

*************** F01 ****************
FORM get_data.
  SELECT * FROM sbook
    INTO CORRESPONDING FIELDS OF TABLE gt_data.

  LOOP AT gt_data INTO gs_data.
    IF gs_data-loccuram >= 800.
      " excp_fld 초록일 때, 버튼도 표시하도록 함
      gs_cell_style-fieldname = 'DISPLAY_BOOKINGS'.
      gs_cell_Style-style = cl_gui_alv_grid=>MC_STYLE_BUTTON.
      APPEND gs_cell_style TO gs_data-it_cell_style.
      gs_data-display_bookings = 'Detail'. " 버튼Text
    ENDIF.

    MODIFY gt_data FROM gs_data.
    CLEAR: gs_data, gs_cell_style.
  ENDLOOP.
ENDFORM.


FORM set_layout.
  gs_layout-stylefname = 'IT_CELL_STYLE'.
ENDFORM.


FORM set_fieldcat.
  CLEAR gs_fcat.
  gs_fcat-fieldname = 'DISPLAY_BOOKINGS'.
  gs_fcat-col_pos = 3.
  gs_fcat-coltext = 'Display Detail'.
  APPEND gs_fcat TO gt_fcat.
ENDFORM.

*************** PBO ****************
SET HANDLER lcl_event_handler=>on_button_click FOR go_alv.

CALL METHOD go_alv->set_table_for_first_display
  EXPORTING
    is_layout        = gs_layout
  CHANGING
    it_outtab        = gt_data
    it_fieldcatalog  = gt_fcat.
```
</br>
</br>

---

</br>

## < ALV Control 주요 메소드 및 추가적인 이벤트 정리 >
</br>

- 메서드 = 객체의 상태를 조회하거나 동작을 수행하는 클래스 내부 함수

| Method | 설명 |
|------|------|
| **get_current_cell** | 현재 커서가 위치한 셀의 좌표와 값 반환 |
| **get_selected_cells** | 사용자가 선택한 셀들의 좌표와 값 반환 |
| **get_selected_columns** | 선택된 컬럼 이름 목록 반환 |
| **get_selected_rows** | 선택된 행 번호(Row Index) 반환 |
| **get_subtotals** | ALV Grid에 설정된 현재 소계(Subtotal) 정보 반환 |
| **set_toolbar_interactive** | ALV 툴바 이벤트를 강제로 발생시킴 |
| **set_user_command** | 현재 USER-COMMAND 값을 강제로 덮어씀 |
</br>


### 1) get_current_cell
- 현재 커서가 위치한 ALV 셀의 행·컬럼 인덱스를 가져오는 메서드
```abap
CALL METHOD <alv_grid>->get_current_cell
  IMPORTING
    e_row = <row_index>
    e_col = <col_index>.
```
- 커스텀 툴바 버튼(`CUSTOM_TB`) 클릭 시 현재 커서가 있는 ALV 셀의 행·컬럼을 조회
```abap
CLASS-METHODS on_user_command
  FOR EVENT user_command OF cl_gui_alv_grid
  IMPORTING e_ucomm.

METHOD on_user_command.
  DATA: lv_row TYPE i,   " 현재 행 번호
        lv_col TYPE i.   " 현재 컬럼 번호

  CASE e_ucomm.
    WHEN 'CUSTOM_TB'.   " 툴바 버튼 클릭 시
      CALL METHOD go_alv->get_current_cell
        IMPORTING
          e_row = lv_row
          e_col = lv_col.
      MESSAGE 'Row: ' && lv_row && ', Col: ' && lv_col TYPE 'I'.
    WHEN OTHERS.
  ENDCASE.
ENDMETHOD.
```
</br>

**2) set_user_command**
</br>
</br>

</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1
</br>

- 새로 구성하는 실습
- alv 2개, hotspot 실습
  
<img width="384" height="223" alt="image" src="https://github.com/user-attachments/assets/e891f22d-5304-45f1-b709-97a0ac023e6f" />
</br>
</br>
</br>

**1) `Report program` 에서 `Include` 파일 생성**
```abap
*&---------------------------------------------------------------------*
*& Report ZALV_SPFLI_B03
*&---------------------------------------------------------------------*

INCLUDE ZALV_SPFLI_B03_TOP.
INCLUDE ZALV_SPFLI_B03_C01.
INCLUDE ZALV_SPFLI_B03_O01.
INCLUDE ZALV_SPFLI_B03_I01.
INCLUDE ZALV_SPFLI_B03_F01.

START-OF-SELECTION.
  PERFORM get_data.
  CALL SCREEN 100.
```
</br>

**2) `TOP` 모듈 생성**
```abap
*&---------------------------------------------------------------------*
*& Include          ZALV_SPFLI_B03_TOP
*&---------------------------------------------------------------------*

DATA: OK_CODE TYPE sy-ucomm.
DATA: go_cont TYPE REF TO cl_gui_custom_container,
      go_alv TYPE REF TO cl_gui_alv_grid,
      go_cont2 TYPE REF TO cl_gui_custom_container,
      go_alv2 TYPE REF TO cl_gui_alv_grid,
      gt_fcat TYPE LVC_T_FCAT,
      gs_fcat TYPE LVC_S_FCAT.

DATA: gs_sflight TYPE sflight,
      gt_sflight TYPE TABLE OF sflight,
      gv_index TYPE I.

DATA: BEGIN OF gs_data,
        carrid TYPE spfli-carrid,
        carrname TYPE scarr-carrname,
        connid TYPE spfli-connid,
        cityfrom TYPE spfli-cityfrom,
        cityto TYPE spfli-cityto,
        airpfrom TYPE spfli-airpfrom,
        airpto TYPE spfli-airpto,
      END OF gs_data.
DATA: gt_data LIKE TABLE OF gs_data.

PARAMETERS: pa_carr TYPE spfli-carrid DEFAULT 'AZ'.
SELECT-OPTIONS: so_con FOR gs_data-connid.
```
</br>

**3) `F01` 모듈 생성**
```abap
*&---------------------------------------------------------------------*
*& Include          ZALV_SPFLI_B03_F01
*&---------------------------------------------------------------------*

FORM get_data.
  DATA: gt_scarr TYPE TABLE OF scarr,
        gs_scarr TYPE scarr.

  SELECT carrid connid cityfrom cityto airpfrom airpto FROM spfli
    INTO CORRESPONDING FIELDS OF TABLE gt_data
    WHERE carrid = pa_carr
      AND connid IN so_con.
  SELECT carrid carrname FROM scarr
    INTO CORRESPONDING FIELDS OF TABLE gt_scarr
    FOR ALL ENTRIES IN gt_data
    WHERE carrid = gt_data-carrid.

  LOOP AT gt_data INTO gs_data.
    READ TABLE gt_scarr INTO gs_scarr WITH KEY carrid = gs_data-carrid
      TRANSPORTING carrname.
    gs_data-carrname = gs_scarr-carrname.
    MODIFY gt_data FROM gs_data TRANSPORTING carrname.
  ENDLOOP.

ENDFORM.

*&---------------------------------------------------------------------*

FORM get_sflight.
  READ TABLE gt_data INTO gs_data INDEX gv_index.
  SELECT * FROM sflight
    INTO CORRESPONDING FIELDS OF TABLE gt_sflight
    WHERE carrid = gs_data-carrid
      AND connid = gs_data-connid.
ENDFORM.

*&---------------------------------------------------------------------*

FORM set_fcat.
  CLEAR gs_fcat.
  gs_fcat-fieldname = 'CARRID'.
  gs_fcat-ref_field = 'CARRID'.
  gs_fcat-ref_table = 'SPFLI'.
  gs_fcat-hotspot = 'X'.
  APPEND gs_fcat TO gt_fcat.

  CLEAR gs_fcat.
  gs_fcat-fieldname = 'CARRNAME'.
  gs_fcat-ref_field = 'CARRNAME'.
  gs_fcat-ref_table = 'SCARR'.
  APPEND gs_fcat TO gt_fcat.

  CLEAR gs_fcat.
  gs_fcat-fieldname = 'CONNID'.
  gs_fcat-ref_field = 'CONNID'.
  gs_fcat-ref_table = 'SPFLI'.
  APPEND gs_fcat TO gt_fcat.

  CLEAR gs_fcat.
  gs_fcat-fieldname = 'CITYFROM'.
  gs_fcat-ref_field = 'CITYFROM'.
  gs_fcat-ref_table = 'SPFLI'.
  APPEND gs_fcat TO gt_fcat.

  CLEAR gs_fcat.
  gs_fcat-fieldname = 'CITYTO'.
  gs_fcat-ref_field = 'CITYTO'.
  gs_fcat-ref_table = 'SPFLI'.
  APPEND gs_fcat TO gt_fcat.

  CLEAR gs_fcat.
  gs_fcat-fieldname = 'AIRPFROM'.
  gs_fcat-ref_field = 'AIRPFROM'.
  gs_fcat-ref_table = 'SPFLI'.
  APPEND gs_fcat TO gt_fcat.

    CLEAR gs_fcat.
  gs_fcat-fieldname = 'AIRPTO'.
  gs_fcat-ref_field = 'AIRPTO'.
  gs_fcat-ref_table = 'SPFLI'.
  APPEND gs_fcat TO gt_fcat.

ENDFORM.

*&---------------------------------------------------------------------*

FORM free_alv.
  IF GO_ALV2 IS NOT INITIAL.
    GO_ALV2->FREE( ).
  ENDIF.
  IF GO_CONT2 IS NOT INITIAL.
    GO_CONT2->FREE( ).
  ENDIF.
  FREE: GO_ALV2, GO_CONT2.
ENDFORM.
```
</br>

**4) `C01` 모듈 생성**
```abap
*&---------------------------------------------------------------------*
*& Include          ZALV_SPFLI_B03_C01
*&---------------------------------------------------------------------*

CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
  CLASS-METHODS: ON_HOTSPOT_CLICK
    FOR EVENT HOTSPOT_CLICK OF CL_GUI_ALV_GRID
    IMPORTING E_ROW_ID SENDER.
ENDCLASS.


CLASS lcl_event_handler IMPLEMENTATION.
  METHOD ON_HOTSPOT_CLICK.
    IF SENDER = GO_ALV.
      gv_index = E_ROW_ID-index.
      PERFORM get_sflight.
      CALL SCREEN 110.
    ENDIF.
  ENDMETHOD.
ENDCLASS.
```
</br>

**5) `PBO` 모듈 생성**
```abap
*&---------------------------------------------------------------------*
*& Include          ZALV_SPFLI_B03_O01
*&---------------------------------------------------------------------*

MODULE status_0100 OUTPUT.
  SET PF-STATUS 'S100'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE init_alv OUTPUT.
  IF go_cont IS INITIAL.
    CREATE OBJECT go_cont
      EXPORTING
        container_name              = 'AREA'
      EXCEPTIONS
        cntl_error                  = 1
        cntl_system_error           = 2
        create_error                = 3
        lifetime_error              = 4
        lifetime_dynpro_dynpro_link = 5
        OTHERS                      = 6.
    IF sy-subrc <> 0.
    ENDIF.

    CREATE OBJECT go_alv
      EXPORTING
        i_parent          = go_cont
      EXCEPTIONS
        error_cntl_create = 1
        error_cntl_init   = 2
        error_cntl_link   = 3
        error_dp_create   = 4
        others            = 5.
    IF sy-subrc <> 0.
    ENDIF.

    PERFORM set_fcat.
    SET HANDLER lcl_event_handler=>on_hotspot_click FOR go_alv.
    CALL METHOD go_alv->set_table_for_first_display
      CHANGING
        it_outtab                     = gt_data
        it_fieldcatalog               = gt_fcat
      EXCEPTIONS
        invalid_parameter_combination = 1
        program_error                 = 2
        too_many_lines                = 3
        others                        = 4.
    IF sy-subrc <> 0.
    ENDIF.
  ENDIF.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0110 OUTPUT.
 SET PF-STATUS 'S110'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE init_alv2 OUTPUT.
  IF go_cont2 IS INITIAL.
    CREATE OBJECT go_cont2
      EXPORTING
        container_name              = 'AREA2'
      EXCEPTIONS
        cntl_error                  = 1
        cntl_system_error           = 2
        create_error                = 3
        lifetime_error              = 4
        lifetime_dynpro_dynpro_link = 5
        others                      = 6.
    IF sy-subrc <> 0.
    ENDIF.

    CREATE OBJECT go_alv2
      EXPORTING
        i_parent          = go_cont2
      EXCEPTIONS
        error_cntl_create = 1
        error_cntl_init   = 2
        error_cntl_link   = 3
        error_dp_create   = 4
        others            = 5.
    IF sy-subrc <> 0.
    ENDIF.

    CALL METHOD go_alv2->set_table_for_first_display
      EXPORTING
        i_structure_name              = 'SFLIGHT'
      CHANGING
        it_outtab                     = gt_sflight
      EXCEPTIONS
        invalid_parameter_combination = 1
        program_error                 = 2
        too_many_lines                = 3
        others                        = 4.
    IF sy-subrc <> 0.
    ENDIF.

  ENDIF.
ENDMODULE.
```
</br>

**6) `PAI` 모듈 생성**
```abap
*&---------------------------------------------------------------------*
*& Include          ZALV_SPFLI_B03_I01
*&---------------------------------------------------------------------*

MODULE exit INPUT.
  CASE OK_CODE.
    WHEN 'EXIT'.
      LEAVE PROGRAM.
    WHEN 'CANCEL'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0110 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      PERFORM free_alv.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**7) 결과 확인**

<img width="423" height="102" alt="image" src="https://github.com/user-attachments/assets/0336d2c5-97f0-46db-9709-17cb3433a6b6" />
</br>

<img width="470" height="164" alt="image" src="https://github.com/user-attachments/assets/4c4c5b8d-8711-428a-b928-30b01aa655cd" />
</br>

<img width="472" height="193" alt="image" src="https://github.com/user-attachments/assets/69b1f9a6-1e38-40b3-b325-dd25f24d2f93" />

