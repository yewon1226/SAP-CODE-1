## <  핵심 개념 >
</br>

- **1) Pushbutton**
- **2) Selection Screen 필드 제어**

</br>
</br>

---

</br>

## < ALV 화면 구성 >
</br>

- **ALV 기본 툴바 버튼 기능 설명**
<img width="444" height="337" alt="image" src="https://github.com/user-attachments/assets/4e7d929d-9c27-4a8b-aede-4acf4a0965b2" />

</br>
</br>
</br>

- **상단 영역**
- `List Header` (선택) : ALV 제목/설명
- `Application Toolbar` : 정렬·필터·엑셀 버튼 (클릭 시 이벤트 발생)
</br>

- **중앙(Data Area)**
- `Column Header` : 컬럼 제목 + 정렬 기준
- `Key Column` : 왼쪽 고정 핵심 컬럼
- `Selection Button` (선택) : 행 선택용 체크/아이콘
- `Data` : 실제 조회 데이터
</br>

- **하단 영역**
- `Total Column` : 합계 대상 컬럼
- `Aggregation Row` : 합계 / 평균 / 최소 / 최대

<img width="490" height="346" alt="image" src="https://github.com/user-attachments/assets/5a287e4b-e177-4673-99a7-acdc4164259f" />
</br>
</br>


<img width="495" height="393" alt="image" src="https://github.com/user-attachments/assets/c069f6ba-2f59-4113-a372-eaa7a211bf23" />
</br>
</br>

### < ALV 마우스 사용 >
- **행 선택** : 클릭 (Ctrl = 다중)
- **컬럼 선택** : 헤더 클릭 (Ctrl = 다중)
- **컬럼 이동** : 드래그
- **폭 조절** : 컬럼 경계 드래그
- **헤더 우클릭** : 복사 / 숨김 / 자동폭 / 고정
</br>
</br>

### < ALV Subtotals >
- `Total` : 전체 데이터 합계 → 맨 아래 1줄
- `Subtotal` : 기준 컬럼별 그룹 합계 → 그룹마다 표시

<img width="465" height="361" alt="image" src="https://github.com/user-attachments/assets/5be7e416-eda5-42ea-a17d-f8bf3a0f0a0d" />
</br>
</br>
</br>
</br>
</br>

---

</br>

## < ABAP 객체 생성 기본 문법 >
- **Area는 Container로, Container는 ALV Grid로 연결됨**
- **클래스** : 객체의 설계도
- **인스턴스(객체)** : 클래스로 생성된 실제 실체
- **참조 변수** : 객체를 가리키는 포인터 변수
</br>
</br>

**1) 참조 변수 선언**
- 객체를 담는 변수가 아니라 객체를 가리키는 참조 변수
- 실제 객체는 아직 없음
```abap
DATA: <ref_var> TYPE REF TO <class_name>.
```
```abap
DATA: go_alv TYPE REF TO cl_gui_alv_grid.
```
</br>
</br>

**2) 객체 생성**
- `CREATE OBJECT` 로 실제 객체 생성 (생성자 자동 호출)
- 생성 시 생성자(CONSTRUCTOR) 호출
- 필요한 값은 `EXPORTING` 으로 전달
- PBO에서 INITIAL 체크 후 1회 생성, Container → ALV 순서
```abap
IF <ref_var> IS INITIAL.
  CREATE OBJECT <ref_var>
    EXPORTING
      <param> = <value>.
    EXCEPTIONS
      <exception_1> = <rc_1>
ENDIF.
```
- `container_name` → Screen의 Area와 연결
- `i_parent` → ALV ↔ Container 연결
```abap
MODULE init_alv OUTPUT.
  IF go_container IS INITIAL.
    CREATE OBJECT go_container
      EXPORTING
        container_name = 'MY_CONTROL_AREA'.

    CREATE OBJECT go_alv
      EXPORTING
        i_parent = go_container.
  ENDIF.
ENDMODULE.
```
</br>
</br>

**3) ALV 컨트롤 인스턴스 해제**
- 화면 종료 시 PAI에서 ALV/Container → free 호출로 자원 해제
- PAI(EXIT, CANCEL) 에서 수행
```abap
FORM free_control_resources.
  CALL METHOD <alv_ref>->free.
  CALL METHOD <container_ref>->free.
  FREE: <alv_ref>, <container_ref>.
ENDFORM.
```
- `->FREE()` : 객체가 사용하는 GUI 컨트롤 자원 해제
- `FREE ref` : 참조 변수만 해제(값 INITIAL로 초기화)
```abap
MODULE exit_commands_0100 INPUT.    " PAI
  CASE ok_code.
    WHEN 'EXIT' OR 'CANCEL'.
      PERFORM free_control_resources.
      LEAVE PROGRAM.
  ENDCASE.
ENDMODULE.

FORM free_control_resources.        " F01
  CALL METHOD go_alv->free.
  CALL METHOD go_container->free.
  FREE: go_alv, go_container.
ENDFORM.
```
</br>
</br>

**4) ALV Grid 데이터 표시**
- ALV Grid에 처음으로 데이터를 출력하는 메서드
- 내부 테이블( `it_outtab` )의 데이터를 기준으로 화면 구성
- `i_structure_name` 에 지정한 DDIC 구조 기준으로 ALV 컬럼 구조가 자동 출력됨
```abap
CALL METHOD <alv_ref>->set_table_for_first_display
  EXPORTING
    i_structure_name = '<DDIC_STRUCTURE>'
  CHANGING
    it_outtab        = <internal_table>
  EXCEPTIONS
    invalid_parameter_combination = 1
    program_error                 = 2
    too_many_lines                = 3
    others                        = 4.
```
```abap
DATA: gt_flight TYPE STANDARD TABLE OF sflight.

CALL METHOD go_alv->set_table_for_first_display
  EXPORTING
    i_structure_name = 'SFLIGHT'
  CHANGING
    it_outtab        = gt_flight
  EXCEPTIONS
    invalid_parameter_combination = 1
    program_error                 = 2
    too_many_lines                = 3
    others                        = 4.
```
</br>
</br>

**5) ALV 데이터 갱신**
- ALV Grid를 다시 생성하지 않고 부 테이블 변경 내용을 화면에 반영
```abap
CALL METHOD <alv_ref>->refresh_table_display
  EXPORTING
    is_stable = <lvc_s_stbl>
  EXCEPTIONS
    finished = 1
    others   = 2.
```
```abap
CALL METHOD go_alv->refresh_table_display
  EXPORTING
    is_stable = VALUE lvc_s_stbl( row = 'X' col = 'X' )
  EXCEPTIONS
    finished = 1
    others   = 2.
```
</br>
</br>
</br>

---

</br>

## < ABAP 객체 생성 예제 >
</br>

**1) 참조 변수 선언**
- `CL_GUI_CUSTOM_CONTAINER` : Screen의 Area와 연결되는 컨테이너
- `CL_GUI_ALV_GRID` : Container 안에서 데이터를 표시하는 ALV Grid 객체
```abap
REPORT ZPROGB03_0028.

DATA: OK_CODE TYPE sy-ucomm.
DATA: gs_flight TYPE sflight,
      gt_flight TYPE TABLE OF sflight.

" Container 참조변수 생성 (아직 객체 생성되기 전)
DATA: go_cont TYPE REF TO CL_GUI_CUSTOM_CONTAINER,
      " ALV 참조변수 생성 (아직 객체 생성되기 전)
      go_alv TYPE REF TO CL_GUI_ALV_GRID.

PARAMETERS: pa_car TYPE s_carr_id.
SELECT-OPTIONS: so_con FOR gs_flight-connid,
                so_fdt FOR gs_flight-fldate.

INCLUDE ZPROGB03_0028_O01.  " PBO
INCLUDE ZPROGB03_0028_I01.  " PAI
INCLUDE ZPROGB03_0028_F01.

START-OF-SELECTION.

PERFORM get_data.
CALL SCREEN 100.
```
</br>
</br>
</br>

**2) `Screen` 에 모듈 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE INIT_ALV.
 MODULE CLEAR_OK_CODE.

PROCESS AFTER INPUT.
 MODULE EXIT AT EXIT-COMMAND.
 MODULE USER_COMMAND_0100.
```
</br>
</br>
</br>

**3) `PAI` 에 ALV 컨트롤 인스턴스 해제**
```abap
FORM get_data.
  SELECT *
    FROM sflight
    INTO TABLE gt_flight
    WHERE carrid = pa_car
      AND connid IN so_con
      AND fldate IN so_fdt.
  IF sy-subrc = 0.

  ENDIF.
ENDFORM.

*&---------------------------------------------------------------------*

FORM free_alv.
  IF GO_ALV IS NOT INITIAL.
    GO_ALV->FREE( ).
  ENDIF.
  IF GO_CONT IS NOT INITIAL.
    GO_CONT->FREE( ).
  ENDIF.
  FREE: GO_ALV, GO_CONT.
ENDFORM.
```
```abap
MODULE exit INPUT.
  CASE OK_CODE.
    WHEN 'EXIT'.
      PERFORM FREE_ALV.
      LEAVE PROGRAM.
    WHEN 'CANCEL'.
      PERFORM FREE_ALV.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>
</br>
</br>

**4) `PBO` 에 객체 생성 및 ALV Grid 데이터 표시**
- `Custom Container` 객체 생성
  
<img width="377" height="363" alt="image" src="https://github.com/user-attachments/assets/6d99dc1d-c5bd-4140-b21a-e41130485067" />
</br>
</br>

- `ALV Grid` 객체 생성

<img width="375" height="359" alt="image" src="https://github.com/user-attachments/assets/90735023-c617-449e-98ad-6b3eed0e0f61" />
</br>
</br>

- ALV Grid 메서드 호출
<img width="384" height="362" alt="image" src="https://github.com/user-attachments/assets/e2594dd2-511b-4721-b9c6-b9e5ec7d13ab" />
</br>
</br>

- `PBO` 에 객체 생성 및 ALV Grid 데이터 표시
- `SET_TABLE_FOR_FIRST_DISPLAY` : 내부 테이블 데이터를 ALV Grid에 최초로 표시하는 메서드
- SET_TABLE* 하고 f4 누르면 자동완성
- `REFRESH_TABLE_DISPLAY` : 내부 테이블 변경 내용을 ALV Grid에 다시 표시(갱신)하는 메서드
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR OK_CODE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE init_alv OUTPUT.
  " 1. SCREEN에 Custom Area 추가
  " 2. Container Control 생성 (AREA와 연결)
  IF go_cont IS INITIAL. " 최초 1번만 실행
    CREATE OBJECT go_cont
      EXPORTING
        container_name              = 'AREA'
      EXCEPTIONS
        cntl_error                  = 1
        cntl_system_error           = 2
        create_error                = 3
        lifetime_error              = 4
        lifetime_dynpro_dynpro_link = 5
        others                      = 6.

    IF sy-subrc <> 0.
      MESSAGE  'Container 생성 중 오류 발생' TYPE 'E'.
    ENDIF.

    " 3. ALV Grid 생성
    CREATE OBJECT go_alv
      EXPORTING
        i_parent          = go_cont " Container와 연결
      EXCEPTIONS
        error_cntl_create = 1
        error_cntl_init   = 2
        error_cntl_link   = 3
        error_dp_create   = 4
        others            = 5.

    IF sy-subrc <> 0.
      MESSAGE 'ALV Grid 생성 중 오류 발생' TYPE 'E'.
    ENDIF.

    " 4. ALV Grid 안에 Data Display
    CALL METHOD go_alv->set_table_for_first_display
      EXPORTING
        i_structure_name              = 'SFLIGHT'
      CHANGING
        it_outtab                     = gt_flight
      EXCEPTIONS
        invalid_parameter_combination = 1
        program_error                 = 2
        too_many_lines                = 3
        others                        = 4.

    IF sy-subrc <> 0.
*     Implement suitable error handling here
    ENDIF.
  ELSE.
    " 최초에 1번 생성괸 후, 두번째부터는 ELSE구문을 실행한다
    CALL METHOD go_alv->refresh_table_display
      EXCEPTIONS
        finished       = 1
        others         = 2.

    IF sy-subrc <> 0.
*     Implement suitable error handling here
    ENDIF.

  ENDIF.

ENDMODULE.
```
</br>
</br>
</br>

**5) 결과 확인**

<img width="475" height="127" alt="image" src="https://github.com/user-attachments/assets/a7190486-1fe1-40c7-be7f-222564219cbc" />
</br>

<img width="574" height="174" alt="image" src="https://github.com/user-attachments/assets/9b72474e-7ab8-47fd-a1f1-5c8b5a0c0e48" />
</br>
</br>
</br>
</br>

---

</br>

## < ALV 레이아웃 Variant 저장 옵션 (I_SAVE) >
</br>

**1) `I_SAVE` (저장 범위)**
- 프로그램 실행 시 자동 적용 여부 지정
- `A` : Global / Local 레이아웃 모두 저장 가능
- `U` : Local(사용자별) 레이아웃만 저장 가능
- `X` : Global(공용) 레이아웃만 저장 가능
- `space` : 레이아웃 저장 불가
```abap
i_save = '<A|U|X|space>'.      " ' ' (공백 문자) 쓰지 않기. '' 는 가능.
```
</br>

**2) `I_DEFAULT` (기본 레이아웃)**
- 프로그램 실행 시 자동 적용 여부 지정
- `space` : 레이아웃은 저장되지만 자동 적용 안 됨
- `X` : 해당 레이아웃을 기본(Default) 으로 저장 → 실행 시 자동 적용
```abap
i_default = '<X|space>'.
```
</br>

**3) `<ls_variant>-report`**
- 레이아웃 Variant가 속한 프로그램명
- Variant 저장/조회에 필수
- 보통 항상 sy-cprog 사용
```abap
<ls_variant>-report = sy-cprog.
```
</br>

**4) `<ls_variant>-variant`**
- 적용할 레이아웃(Variant) 이름
- Selection Screen에서 입력받은 Variant를 ALV에 적용할 때 사용
```abap
<ls_variant>-variant = <p_var>.
```
</br>

**5) `<ls_variant>-handle`**
- 같은 프로그램에서 여러 ALV Grid 구분용 식별자
- ALV 1개면 생략 가능
```abap
<ls_variant>-handle = '1'.
```
</br>

**6) `<ls_variant>-username`**
- 특정 사용자 전용 Variant 지정
- 대부분 시스템이 자동 처리 → 직접 설정 거의 안 함
```abap
<ls_variant>-username = sy-uname.
```
</br>

**7) <ls_variant>-text**
- 레이아웃 설명 텍스트
- Variant 저장 화면에서 입력·표시되는 값
```abap
<ls_variant>-text = 'Flight ALV Layout'.
```
</br>
</br>
</br>

### 1) ALV 레이아웃 Variant 저장
- `<ls_variant>-report = sy-cprog.` 는 필수
```abap
DATA: <ls_variant> TYPE disvariant,
      <lv_save>    TYPE c LENGTH 1.

<ls_variant>-report = sy-cprog.
<lv_save> = '<A|U|X|space>'.

CALL METHOD <alv_ref>->set_table_for_first_display
  EXPORTING
    is_variant = <ls_variant>
    i_save     = <lv_save>
    i_default  = '<X|space>'
  CHANGING
    it_outtab  = <itab>.
```
```abap
DATA: gs_variant TYPE disvariant,
      gv_save    TYPE c LENGTH 1.

gs_variant-report = sy-cprog.
gv_save = 'A'.   " Global / Local 모두 저장

CALL METHOD go_alv_grid->set_table_for_first_display
  EXPORTING
    is_variant = gs_variant
    i_save     = gv_save
    i_default  = 'X'
  CHANGING
    it_outtab  = gt_bookings.
```
</br>

### 2) Selection Screen에서 Variant 전달
```abap
DATA <ls_variant> TYPE disvariant.
PARAMETERS <p_var> TYPE disvariant-variant.

<ls_variant>-report  = sy-cprog.
<ls_variant>-variant = <p_var>.

CALL METHOD <alv_ref>->set_table_for_first_display
  EXPORTING
    is_variant = <ls_variant>
  CHANGING
    it_outtab  = <itab>.
```
```abap
DATA gv_variant TYPE disvariant.
PARAMETERS pa_lv TYPE disvariant-variant.

gv_variant-report  = sy-cprog.
gv_variant-variant = pa_lv.

CALL METHOD go_alv_grid->set_table_for_first_display
  EXPORTING
    is_variant = gv_variant
  CHANGING
    it_outtab  = gt_bookings.
```
</br>
</br>
</br>
</br>

## < ALV 레이아웃 Variant 저장 옵션 (I_SAVE) 예제 >
</br>

**1) `TOP` 모듈 수정**
```abap
DATA: gs_variant TYPE disvariant.

INITIALIZATION.
  PERFORM set_options.
  gs_variant-report = sy-cprog.
  gs_variant-username = sy-uname.
  gs_variant-handle = 'MAIN'.
  " handle : 하나의 화면에 여러개의 ALV가 있는 경우
  "          각 ALV마다 구분자가 필요하므로 구분자 지정해줌
```
</br>

**2) `PBO` 의 `init_alv` 모듈 수정**
```abap
" 4. ALV Grid 안에 Data display
    CALL METHOD go_alv->set_table_for_first_display
      EXPORTING
        i_structure_name              = 'SBOOK'
        is_variant                    = gs_variant
        i_save                        = 'A' " A, X, U, ''
        i_default                     = 'X'
      CHANGING
        it_outtab                     = gt_data
      EXCEPTIONS
        invalid_parameter_combination = 1
        program_error                 = 2
        too_many_lines                = 3
        others                        = 4.
```
</br>

**3) `Variant` 지정**
- 레이아웃 수정 후 레이아웃 저장
  
<img width="511" height="174" alt="image" src="https://github.com/user-attachments/assets/2066b032-4300-445e-b15d-6943b89a5324" />
</br>
</br>

- `/` 로 시작 → Global(공용) 레이아웃
- `/` 없음 → Local(개인) 레이아웃

<img width="435" height="351" alt="image" src="https://github.com/user-attachments/assets/fbab5ce1-d915-4938-a262-f83736fe20f4" />
</br>

<img width="435" height="361" alt="image" src="https://github.com/user-attachments/assets/fd7a76e1-0a81-4205-b3d7-70edded26b4d" />
</br>
</br>

</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1
- ALV 실습
</br>
</br>

**1) Program 에 모듈 생성**
```abap
REPORT ZPROGB03_0029.

INCLUDE ZPROGB03_0029_TOP.
INCLUDE ZPROGB03_0029_O01.
INCLUDE ZPROGB03_0029_I01.
INCLUDE ZPROGB03_0029_F01.
```
</br>
</br>

**2) `TOP` 모듈 생성**
```abap
DATA: gt_data TYPE TABLE OF sbook,
      gs_data LIKE LINE OF gt_data.

DATA: ok_code TYPE sy-ucomm,
      go_cont TYPE REF TO cl_gui_custom_container,
      go_alv  TYPE REF TO cl_gui_alv_grid.

SELECTION-SCREEN BEGIN OF BLOCK blk1 WITH FRAME.
  SELECT-OPTIONS: so_car FOR gs_data-carrid,
                  so_con FOR gs_data-connid,
                  so_fdt FOR gs_data-fldate.
SELECTION-SCREEN END OF BLOCK blk1.

INITIALIZATION.
  PERFORM set_options.

START-OF-SELECTION.
  PERFORM GET_DATA.
  CALL SCREEN 100.
```
</br>
</br>

**3) `F01` 모듈 생성**
```abap
FORM set_options.
  so_fdt-sign = 'I'.
  so_fdt-option = 'BT'.
  so_fdt-low = sy-datum(4) && '0101'. " 매년 첫째날
  so_fdt-high = sy-datum(4) && '1231'. " 매년 마지막날
  APPEND so_fdt.

  so_car-sign = 'I'.
  so_car-option = 'GT'.
  so_car-low = 'AZ'.
  APPEND so_car.

  CLEAR so_car.
  so_car-sign = 'E'.
  so_car-option = 'EQ'.
  so_car-low = 'LH'.
  APPEND so_car.
ENDFORM.

*&---------------------------------------------------------------------*

FORM get_data.
  SELECT * FROM SBOOK
    INTO TABLE gt_data
    WHERE carrid IN so_car
      AND connid IN so_con
      AND fldate IN so_fdt.
ENDFORM.
```
</br>
</br>

**4) `PBO` 모듈 생성**
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100' WITH sy-uname sy-datum sy-uzeit.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE init_alv OUTPUT.
  " 1. 100번 스크린 Layout에 Area 추가
  " 2. 만약 Container 가 만들어지기 전이라면, 객체 생성함
  "    Custom Container 생성
  IF go_cont IS INITIAL.
    CREATE OBJECT go_cont
      EXPORTING
        container_name              = 'AREA'
      EXCEPTIONS
        cntl_error                  = 1
        cntl_system_error           = 2
        create_error                = 3
        lifetime_error              = 4
        lifetime_dynpro_dynpro_link = 5
        others                      = 6.
    IF sy-subrc <> 0.
*     MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*                WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.

    " 3. ALV Grid 객체 생성해서 Container와 연결
    CREATE OBJECT go_alv
      EXPORTING
        i_parent          = go_cont
      EXCEPTIONS
        error_cntl_create = 1
        error_cntl_init   = 2
        error_cntl_link   = 3
        error_dp_create   = 4
        others            = 5.
    IF sy-subrc <> 0.
*     MESSAGE ID SY-MSGID TYPE SY-MSGTY NUMBER SY-MSGNO
*                WITH SY-MSGV1 SY-MSGV2 SY-MSGV3 SY-MSGV4.
    ENDIF.

    " 4. ALV Grid 안에 Data display
    CALL METHOD go_alv->set_table_for_first_display
      EXPORTING
        i_structure_name              = 'SBOOK'
      CHANGING
        it_outtab                     = gt_data
      EXCEPTIONS
        invalid_parameter_combination = 1
        program_error                 = 2
        too_many_lines                = 3
        others                        = 4
            .
    IF sy-subrc <> 0.
*     Implement suitable error handling here
    ENDIF.

  ENDIF.
ENDMODULE.
```
</br>
</br>

**5) `PAI` 모듈 생성**
```abap
MODULE exit INPUT.
  CASE OK_CODE.
    WHEN 'EXIT'.
      LEAVE PROGRAM.
    WHEN 'CANCEL'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>
</br>

**6) 결과 확인**

<img width="488" height="141" alt="image" src="https://github.com/user-attachments/assets/0593593a-ab76-4ee7-a844-32473cfcbab4" />
</br>

<img width="515" height="238" alt="image" src="https://github.com/user-attachments/assets/3e58a92f-1c2d-4be3-af54-f6a5e9ea0fb8" />
</br>
</br>
</br>
</br>
</br>

### 실습 2
- 문제
<img width="356" height="208" alt="image" src="https://github.com/user-attachments/assets/f0ef060a-6af1-4039-baf9-1cb3d57ad293" />
</br>
</br>
</br>
</br>
</br>

**1) Program 에 모듈 생성**
```abap
REPORT ZBC405_03_ALV.

INCLUDE ZBC405_03_ALV_TOP.
INCLUDE ZBC405_03_ALV_O01.
INCLUDE ZBC405_03_ALV_I01.
INCLUDE ZBC405_03_ALV_F01.

START-OF-SELECTION.

*PERFORM get_data.
PERFORM get_data2.
CALL SCREEN 100.
```
</br>
</br>

**2) `TOP` 모듈 생성**
```abap
DATA: OK_CODE TYPE sy-ucomm,
      go_container TYPE REF TO cl_gui_custom_container,
      go_alv_grid TYPE REF TO cl_gui_alv_grid.

DATA: gs_flight TYPE sflight,
      gt_flight TYPE TABLE OF sflight.

DATA: gs_flight2 TYPE BC400_S_FLIGHT,
      gt_flight2 TYPE TABLE OF BC400_S_FLIGHT.

SELECT-OPTIONS: so_car FOR gs_flight-carrid,
                so_con FOR gs_flight-connid.
```
</br>
</br>

**3) `F01` 모듈 생성**
```abap
FORM get_data.
  SELECT * FROM sflight
    INTO TABLE gt_flight
    WHERE carrid IN so_car
      AND connid IN so_con.
ENDFORM.

*&---------------------------------------------------------------------*

FORM get_data2.
  SELECT carrid connid fldate seatsmax seatsocc FROM sflight
    INTO CORRESPONDING FIELDS OF TABLE gt_flight2
    WHERE carrid IN so_car
      AND connid IN so_con.

  LOOP AT gt_flight2 INTO gs_flight2.
    gs_flight2-PERCENTAGE = ( gs_flight2-seatsocc / gs_flight2-seatsmax ) * 100.
    MODIFY gt_flight2 FROM gs_flight2.
  ENDLOOP.
ENDFORM.

*&---------------------------------------------------------------------*

FORM free_alv.
  IF go_container IS INITIAL.
    go_container->free( ).
  ENDIF.
  IF go_alv_grid IS INITIAL.
    go_alv_grid->free( ).
  ENDIF.
  FREE: go_container, go_alv_grid.
ENDFORM.
```
</br>
</br>

**4) `PBO` 모듈 생성**
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE create_and_transfer OUTPUT.
  IF go_container IS INITIAL.
    CREATE OBJECT go_container
      EXPORTING
        container_name              = 'MY_CONTROL_AREA'
      EXCEPTIONS
        cntl_error                  = 1
        cntl_system_error           = 2
        create_error                = 3
        lifetime_error              = 4
        lifetime_dynpro_dynpro_link = 5
        others                      = 6.
    IF sy-subrc <> 0.
      MESSAGE A010(BC405_408).
    ENDIF.

    CREATE OBJECT go_alv_grid
      EXPORTING
        i_parent          = go_container
      EXCEPTIONS
        error_cntl_create = 1
        error_cntl_init   = 2
        error_cntl_link   = 3
        error_dp_create   = 4
        others            = 5.
    IF sy-subrc <> 0.
      MESSAGE A010(BC405_408).
    ENDIF.

    CALL METHOD go_alv_grid->set_table_for_first_display
      EXPORTING
        i_structure_name              = 'BC400_S_FLIGHT'
      CHANGING
        it_outtab                     = gt_flight2
      EXCEPTIONS
        invalid_parameter_combination = 1
        program_error                 = 2
        too_many_lines                = 3
        others                        = 4.
    IF sy-subrc <> 0.
      MESSAGE A012(BC405_408).
    ENDIF.


  ENDIF.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR OK_CODE.
ENDMODULE.
```
</br>
</br>

**5) `PAI` 모듈 생성**
```abap
MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE exit INPUT.
  CASE OK_CODE.
    WHEN 'EXIT'.
      LEAVE PROGRAM.
      PERFORM free_alv.
    WHEN 'CANCEL'.
      PERFORM free_alv.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>
</br>

**6) 결과 확인**

<img width="500" height="103" alt="image" src="https://github.com/user-attachments/assets/91faf0f7-6bcc-4e33-91bf-32f8557a5f2a" />
</br>

<img width="506" height="227" alt="image" src="https://github.com/user-attachments/assets/dc02a463-7156-409c-ae94-416c3b6eb75b" />

</br>
</br>
</br>
</br>
</br>
