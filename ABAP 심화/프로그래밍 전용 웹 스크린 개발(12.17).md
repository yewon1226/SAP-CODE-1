## <  핵심 개념 >
</br>

- **1) FIELD / CHAIN 입력 체크 방식**

</br>

- **`LEAVE TO SCREEN 0`** 같은 화면 전환 명령은 **`PAI`** 에서만
- **`SCREEN-INPUT`** 같은 화면 속성 변경은 **`PBO`** 에서만
- 사용자 입력 기반 SELECT는 **`PAI`** , 조회 결과 화면 반영/속성 변경은 **`PBO`**
- **OK_CODE 초기화** 코드 꼭 넣어줘야 함 ( 보통 **`PBO`** 에서)
- **`OK_CODE`** 케이스문은 **`PAI`** 에서
- LOOP AT SCREEN 사용시 **`MODIFY SCREEN`** 넣기
- **`FIELD / CHAIN`** 은 무조건 **PAI** 에서만 구현
- **`AT EXIT-COMMAND`** 은 무조건 **PAI** 에서만 구현

</br>

---

</br>

## < PAI FIELD / CHAIN 입력 체크 방식 >
- **`FIELD / CHAIN`** 은 무조건 **PAI** 에서만 구현
- 화면에 입력된 값을 기준으로 검증하기 위해 사용
</br>

### 1) 기본형 (옵션 없음) – 항상 실행
- PAI 발생 시 무조건 MODULE 실행
- 값 입력 여부, 변경 여부 모두 무관
</br>

- **단일값 체크 (FIELD)**
```abap
FIELD <field> MODULE <module>.
```
```abap
FIELD SCARR-CARRID MODULE CHECK_INPUT.
```
- **다중값 체크 (CHAIN)**
```abap
CHAIN.
  FIELD: <field1>, <field2>.
  MODULE <module>.
ENDCHAIN.
```
```abap
CHAIN.
  FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
  MODULE CHECK_INPUTS.
ENDCHAIN.
```
</br>
</br>

### 2) 입력값 존재 기준 (ON INPUT / ON CHAIN-INPUT)
- 값이 입력된 경우에만 MODULE 실행
- 다중 값 체크 시 CHAIN 내 하나라도 값이 있으면 실행 (OR 조건)
</br>

- **단일값 체크 (ON INPUT)**
```abap
FIELD <field> MODULE <module> ON INPUT.
```
```abap
FIELD SCARR-CARRID MODULE CHECK_INPUT ON INPUT.
```
- **다중값 체크 (ON CHAIN-INPUT)**
```abap
CHAIN.
  FIELD: <field1>, <field2>.
  MODULE <module> ON CHAIN-INPUT.
ENDCHAIN.
```
```abap
CHAIN.
  FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
  MODULE CHECK_INPUTS ON CHAIN-INPUT.
ENDCHAIN.
```
</br>
</br>

### 3) 값 변경 기준 (ON REQUEST / ON CHAIN-REQUEST)
- 이전 값과 비교하여 변경되었을 때만 MODULE 실행
- 다중 값 체크 시 CHAIN 내 하나라도 값이 변경되면 실행
- 값의 존재 여부와 무관하게, 이전 값과 달라지기만 하면 실행 ( 값이 있다가 빈 값이어도 실행 )
</br>

- **단일값 체크 (ON REQUEST)**
```abap
FIELD <field> MODULE <module> ON REQUEST.
```
```abap
FIELD SCARR-CARRID MODULE CHECK_INPUT ON REQUEST.
```
- **다중값 체크 (ON CHAIN-REQUEST)**
```abap
CHAIN.
  FIELD: <field1>, <field2>.
  MODULE <module> ON CHAIN-REQUEST.
ENDCHAIN.
```
```abap
CHAIN.
  FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
  MODULE CHECK_INPUTS ON CHAIN-REQUEST.
ENDCHAIN.
```
</br>
</br>
</br>

## < PAI FIELD / CHAIN 예제 >
</br>

**1) `Layout` 설정**

<img width="538" height="255" alt="image" src="https://github.com/user-attachments/assets/f839bae4-e194-4514-b412-e8e6838c230b" />

</br>
</br>

**2) `Screen` 코드에서 모듈 생성 ( PAI, PBO )**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE INIT_DATA.
*
PROCESS AFTER INPUT.
  MODULE EXIT AT EXIT-COMMAND.

**********************************************************************

* FIELD SCARR-CARRID MODULE CHECK_INPUT. " 단일값 체크
*
* CHAIN. " 다중값 체크
*  FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
*  MODULE CHECK_INPUTS.
* ENDCHAIN.

**********************************************************************

*  " 단일값 체크 : ON INPUT 값이 있을때만 체크하도록 설정
*  FIELD SCARR-CARRID MODULE CHECK_INPUT ON INPUT.
*
*  " 다중값 체크 : ON CHAIN-INPUT 값이 있을때만 체크하도록 설정
*  CHAIN.
*    FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
*    MODULE CHECK_INPUTS ON CHAIN-INPUT.
*  ENDCHAIN.
* MODULE USER_COMMAND_0100.

**********************************************************************

   " 단일값 체크 : ON REQUEST 값이 변경되었을 때 체크하도록 설정
  FIELD SCARR-CARRID MODULE CHECK_INPUT ON REQUEST.

  " 다중값 체크 : ON CHAIN-REQUEST 값이 변경되었을 때만 체크하도록 설정
  CHAIN.
    FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
    MODULE CHECK_INPUTS ON CHAIN-REQUEST.
  ENDCHAIN.
 MODULE USER_COMMAND_0100.
```
</br>

**3) `PAI` 에서 모듈 생성**
```abap
" 단일입력
MODULE check_input INPUT.
  IF SCARR-CARRID IS NOT INITIAL.
    SELECT SINGLE CARRID
      FROM SPFLI " 여기엔 AB값이 없음
      INTO SCARR-CARRID
      WHERE CARRID = SCARR-CARRID.
    IF sy-subrc <> 0.
      MESSAGE '해당 항공사 데이터는 존재하지 않습니다.' TYPE 'E'.
    ENDIF.
  ENDIF.
ENDMODULE.

" 다중입력
MODULE check_inputs INPUT.
  IF SDYN_CONN-CARRID IS NOT INITIAL AND
     SDYN_CONN-CONNID IS NOT INITIAL.
    SELECT SINGLE *
      FROM SPFLI
      INTO CORRESPONDING FIELDS OF SDYN_CONN
      WHERE CARRID = SDYN_CONN-CARRID
        AND CONNID = SDYN_CONN-CONNID.
    IF sy-subrc <> 0.
      MESSAGE '해당 항공사의 항공편이 존재하지 않습니다.' TYPE 'E'.
    ENDIF.
  ENDIF.
ENDMODULE.
```

</br>
</br>
</br>

---

</br>

## < AT EXIT-COMMAND >
- **`AT EXIT-COMMAND`** 은 무조건 **PAI** 에서만 구현
- PF-STATUS에서 Function Type = E(Exit) 로 정의된 커맨드만 대상으로 동작함
- 메시지 E로 화면 진행이 막힌 상태에서, 사용자가 “종료”를 선택했을 때 빠져나가기 위한 용도
</br>
</br>

**1) `Function Type` 설정**
- `EXIT` , `CANCEL` 일 때 `Function Type` 을 `E` 로 설정

<img width="669" height="331" alt="image" src="https://github.com/user-attachments/assets/b0aae6c7-d74c-49c6-887c-1824e4d1c110" />

</br>
</br>
</br>
</br>

**2) `PAI` 모듈 생성**
- Screen 코드에서 모듈 생성
```abap
PROCESS AFTER INPUT.
  MODULE <module_name> AT EXIT-COMMAND.
```
```abap
PROCESS AFTER INPUT.
  MODULE EXIT AT EXIT-COMMAND.
```
- 해당 PAI 모듈에서 코드 작성
```abap
MODULE exit INPUT.
  CASE OK_CODE.
    WHEN 'EXIT'.
      LEAVE PROGRAM. " 프로그램 종료
    WHEN 'CANCEL'.
      LEAVE TO SCREEN 0. " 스크린 종료
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>
</br>

**3) 결과 확인**
- `EXIT` , `CANCEL` 누르면 에러가 나도 빠져나올 수 있음 ( `BACK` 은 불가능 )

<img width="580" height="383" alt="image" src="https://github.com/user-attachments/assets/5c8e4e7b-c752-4f23-b7d2-928950bfda70" />
</br>
</br>
</br>
</br>
