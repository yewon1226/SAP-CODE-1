## < ABAP 개념 및 문법 >
</br>

**< Module pool 구조 >**
- 모듈풀 프로그램 하나 → 트랜잭션코드 하나와 연결
  
**1) TOP(Include)**
- 전역 변수(Global Variables) 선언
- 화면(Screen)에서 사용할 변수들도 여기에서 선언함

**2) F01 (Include)**
- 로컬 변수(Local Variables)
- FORM 루틴(Function Routines)들 선언

</br>
</br>
</br>

## < SCREEN 필드 속성 제어 >
- PAI에서 버튼 클릭 이벤트 발생 → PBO에서 SCREEN 테이블을 수정하여 스크린의 속성 변경 가능
  
  - 입력 가능(Input) → 입력 불가(Output only)
  - Visible → Invisible
  - Active → Inactive 등
    
- SCREEN 테이블은 헤더라인 있는 INTERNAL TABLE
  - ABAP 모듈풀에서 스크린 필드 속성을 변경할 때 사용하는 시스템 내부 테이블
</br>
</br>

**1) SCREEN은 헤더라인을 포함한 구조 => `into`절 생략 가능**

- 일반 인터널 테이블
```abap
LOOP AT screen INTO screen.
```
- screen (헤더라인이므로 into절 생략 가능)
```abap
LOOP AT screen.
  " screen-name
  " screen-input
ENDLOOP.
```
</br>
</br>

**2) SCREEN 속성 변경은 `MODIFY SCREEN` 필수**
- SCREEN 내부 테이블에서 특정 필드를 수정하면 반드시 다음 구문을 넣어야 실제 스크린에 반영됨
- 각 필드의 속성에 접근해서 변경할 수 있음
- SCREEN 속성 값은 `1 = TRUE` , `0 = FALSE`

<img width="548" height="365" alt="image" src="https://github.com/user-attachments/assets/e438b436-a6ad-4dae-96d9-a4aaf6bab111" />
</br>
</br>

```abap
MODULE modify_screen OUTPUT.

  LOOP AT SCREEN. 
    IF screen-group1 = 'SEL'.
      screen-input = 1.
    ENDIF.

    IF screen-name = 'FIELD1'.
      screen-active = 0.          " 여기까지는 헤더 부분만 변경. 
    ENDIF.                        " 스크린 변경하고 싶으면 아래 MODIFY를 해줘야 함.
    MODIFY SCREEN.
  ENDLOOP.

ENDMODULE.
```

</br>
</br>

**3) 그룹(Group1, Group2 등) 속성 활용 → 일괄 제어 가능**
- 스크린 필드별로 그룹 코드 지정 가능
- 특정 그룹 필드 전체를 한 번에 제어할 수 있어 편리함
```abap
LOOP AT SCREEN.
  IF screen-group1 = 'GRP1'.
    screen-input = '0'. " GRP1 그룹 전체 입력 불가 처리
  ENDIF.
  MODIFY SCREEN.
ENDLOOP.
```

</br>
</br>

**4) 구현 위치는 무조건 PBO**
- 스크린 속성 변경은 PBO에서 수행해야 반영됨
- 필드 속성 변경 후 반드시 `MODIFY SCREEN` 사용
```abap
MODIFY SCREEN.
```
</br>
</br>
</br>

## < SCREEN 관련 함수 >

**1) SCREEN-INVISIBLE**
- 화면에서 아예 안 보이게 함
- 필드/라벨/입력칸/화면 공간 사라짐 (빈칸처럼 보임)
```abap
SCREEN-invisible = 1.
```
```abap
IF screen-group2 = 'FLT'.    " GROUP2가 FLT인 필드들은 화면에서 완전 제거
  screen-invisible = 1.
ENDIF.
```
</br>
</br>

**2) SCREEN-INPUT**
- 보이긴 하지만 수정 불가(비활성화)
- 조회 결과는 보여주되 수정은 막고 싶을 때 사용
```abap
SCREEN-input = 0.
```

</br>
</br>

---

</br>

## < 버튼 이벤트 처리 >
</br>

**1) 버튼 생성 후 속성 창에서 FctCode 필드 입력 (펑션코드)**

<img width="433" height="386" alt="image" src="https://github.com/user-attachments/assets/3771a73a-832f-4fb0-a529-83a9880fa9cf" />
</br>
</br>

**2) 입력필드 6개 묶어서 `GROUP1` 지정**

<img width="468" height="376" alt="image" src="https://github.com/user-attachments/assets/0a41e9b3-9292-4a5f-b2f3-7e185c4486b5" />
</br>
</br>

**3) 스크린 필드에 `OK_CODE` 추가**

<img width="556" height="336" alt="image" src="https://github.com/user-attachments/assets/1c44dc39-2c62-46b9-a57e-aa36e7081a8b" />
</br>
</br>

**4) 스크린 창에서 모듈 `PBO` , `PAI` 생성**

```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
   MODULE MODIFY_SCREEN.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
```
</br>

**5) `PBO` - 타이틀에 변수 채워서 설정**

- '&1 &2 &3' : 타이틀에 변수를 설정할 수 있음

<img width="537" height="132" alt="image" src="https://github.com/user-attachments/assets/99b90233-b96f-406d-bc97-1c6d6f792f2c" />
</br>
</br>

**6) `PBO` - 표준 버튼을 어떤 `OKCODE` 로 동작시킬지 설정**

- 이름 지정 시 그 이름으로 `OKCODE` 로 받아서 처리 가능
```abap
SET TITLEBAR '타이틀바_이름' WITH <값1> <값2> <값3> ...
```

<img width="591" height="336" alt="image" src="https://github.com/user-attachments/assets/d8a80673-5514-47e1-a54f-bd9d9ed112eb" />

</br>
</br>

**7) `TOP` 모듈 구현**

```abap
*&---------------------------------------------------------------------*
*& Include MZB03002_TOP                             - Module Pool      SAPMZB03002
*&---------------------------------------------------------------------*
PROGRAM sapmzb03002.

TABLES: sdyn_conn.

DATA: ok_code TYPE sy-ucomm,
      gv_mod  TYPE i. " 변경모드 값을 받을 변수
```
</br>

**8) `PAI` 모듈 구현**
```abap
*&---------------------------------------------------------------------*
*& Include          MZB03002_I01
*&---------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_0100  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'CHBTN'.
      IF gv_mod = 1.
        gv_mod = 0.
      ELSE.
        gv_mod = 1.
      ENDIF.
    WHEN 'BACK' OR 'EXIT' OR 'CANCEL'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**9) `PBO` 모듈 구현**
```abap
*&---------------------------------------------------------------------*
*& Include          MZB03002_O01
*&---------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*& Module STATUS_0100 OUTPUT
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100' WITH sy-datum sy-uzeit sy-uname.
ENDMODULE.
*&---------------------------------------------------------------------*
*& Module MODIFY_SCREEN OUTPUT
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
MODULE modify_screen OUTPUT.
  " 헤더가 있는 itab인 SCREEN을 한 건씩 돌면서 동적 처리
  LOOP AT SCREEN.   " INTO SCREEN이 생략
    " SCREEN의 Element 중, group1 값이 'MOD'인 경우
    IF SCREEN-GROUP1 = 'MOD'.
      " Input 속성에 gv_mod 변수 값을 적용함
      SCREEN-INPUT = gv_mod. " 0 또는 1
    ENDIF.

    " Header-Line에 있는 itab 이라서, 작업한 Header를
    " Itab(Body)에 적용시켜야 함
    MODIFY SCREEN. "변경사항 반영
  ENDLOOP.
ENDMODULE.
```
</br>

**9) TCODE 설정**

<img width="571" height="394" alt="image" src="https://github.com/user-attachments/assets/89ecff27-c6a2-4114-8dff-df2a534187ee" />

</br>
</br>

**10) 결과 확인**

<img width="465" height="316" alt="image" src="https://github.com/user-attachments/assets/32e64b3d-0c48-4144-8e58-5e6b3a007644" />

</br>
</br>
</br>
</br>

---

</br>

## < 실습 코드 >

### 실습 1
</br>

- 문제
<img width="413" height="145" alt="image" src="https://github.com/user-attachments/assets/9381f16c-f73c-4c18-9077-490ef574ed21" />
</br>
</br>

**1) 버튼 생성 후 속성 창에서 FctCode 필드 입력 (펑션코드)**

<img width="566" height="319" alt="image" src="https://github.com/user-attachments/assets/313b5f4b-436d-4f83-8e49-9d3fecd0b853" />
</br>
</br>

**2) 스크린 필드에 `OK_CODE` 추가**

<img width="574" height="344" alt="image" src="https://github.com/user-attachments/assets/b3590a1c-497c-4ea7-882b-dbd3ee47e63a" />
</br>
</br>

**3) 스크린 창에서 모듈 `PBO` , `PAI` 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
*
PROCESS AFTER INPUT.
  MODULE CHECK_SFLIGHT.
  MODULE USER_COMMAND_0100.
```
</br>

**4) `TOP` 모듈 구현**
```abap
*&---------------------------------------------------------------------*
*& Include MZBC410_SOLUTION_TOP                     - Module Pool      SAPMZBC410_SOLUTION_03
*&---------------------------------------------------------------------*
PROGRAM SAPMZBC410_SOLUTION_03.

TABLES: SDYN_CONN.

DATA: exit_button TYPE C,
      OK_CODE TYPE SY-UCOMM,
      gs_data TYPE SDYN_CONN,
      gv_subrc TYPE sy-subrc,
      gs_data2 LIKE SDYN_CONN,
      gv_button TYPE I.
```
</br>

**5) `PAI` 모듈 구현**
```abap
*&---------------------------------------------------------------------*
*& Include          MZBC410_SOLUTION_I01
*&---------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_0100  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE user_command_0100 INPUT.

  IF exit_button = 'X'.
    LEAVE TO SCREEN 0.
  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*
*&      Module  CHECK_SFLIGHT  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE check_sflight INPUT.

  IF OK_CODE = 'FCBTN'.
    gv_button = 1.

    SELECT SINGLE * FROM sflight
      INTO CORRESPONDING FIELDS OF gs_data
      WHERE carrid = SDYN_CONN-carrid
        AND connid = SDYN_CONN-connid
        AND fldate = SDYN_CONN-fldate.

    IF sy-subrc <> 0.
      gv_subrc = 4.
      message text-007 TYPE 'I'.
    ENDIF.
  ENDIF.

ENDMODULE.
```
</br>

**6) `PBO` 모듈 구현**
```abap
*&---------------------------------------------------------------------*
*& Include          MZBC410_SOLUTION_O01
*&------------------------------------+---------------------------------*
*&---------------------------------------------------------------------*
*& Module STATUS_0100 OUTPUT
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
MODULE status_0100 OUTPUT.

  IF gv_button = 1.
    IF gv_subrc <> 0.
      CLEAR SDYN_CONN.
      gv_subrc = 0.
    ELSE.
      MOVE-CORRESPONDING gs_data TO SDYN_CONN.
    ENDIF.
  ELSE.
    gv_button = 0.
  ENDIF.

ENDMODULE.
```
</br>
</br>
</br>

### 실습 2 (과제)
</br>

- 문제

<img width="663" height="666" alt="image" src="https://github.com/user-attachments/assets/59f1e4d6-f2ab-4182-b626-f0e7326db716" />
</br>
</br>

<img width="503" height="473" alt="image" src="https://github.com/user-attachments/assets/2da81cca-14f1-4bca-88e5-945136ae6632" />
</br>
</br>

<img width="660" height="370" alt="image" src="https://github.com/user-attachments/assets/42457db3-b08c-4ab1-a211-d45201d1ff1b" />
</br>
</br>
</br>

**1) 버튼 생성 후 속성 창에서 FctCode 필드 입력 (펑션코드)**

- `SCARR` 는 `FCBTN01` , `SFLIGHT` 는 `FCBTN02` , `검색` 은 `FCBTN03`
<img width="603" height="452" alt="image" src="https://github.com/user-attachments/assets/53b2a934-37fb-41ef-a478-72526c2abf72" />

</br>
</br>

**2) 스크린 필드에 `OK_CODE` 추가**

<img width="626" height="464" alt="image" src="https://github.com/user-attachments/assets/13d15983-080c-45b3-9d9e-6b63731e2d93" />
</br>
</br>


**3) 스크린 창에서 모듈 `PBO` , `PAI` 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
```
</br>

**4) `TOP` 모듈 구현**
```abap
*&---------------------------------------------------------------------*
*& Include SAPMZPRACTICE02B03_TOP                   - Module Pool      SAPMZPRACTICE02B03
*&---------------------------------------------------------------------*
PROGRAM SAPMZPRACTICE02B03.

TABLES: ZSCARRFLIGHT_B03.

DATA: OK_CODE TYPE sy-ucomm,
      gv_button1 TYPE I,
      gv_button2 TYPE I,    " VISIBLE 제어를 위한 플래그 (ex: scarr만 눌렀을 때)
      gv_result_btn1 TYPE I,
      gv_result_btn2 TYPE I,
      gv_result_btn3 TYPE I,   " 결과를 표시하기 위한 플래그 (ex: scarr -> 검색까지)
      gs_data TYPE ZSCARRFLIGHT_B03.
```
</br>

**4) `PAI` 모듈 구현**
```abap
*&---------------------------------------------------------------------*
*& Include          SAPMZPRACTICE02B03_I01
*&---------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*&      Module  USER_COMMAND_0100  INPUT
*&---------------------------------------------------------------------*
*       text
*----------------------------------------------------------------------*
MODULE user_command_0100 INPUT.

  CASE OK_CODE.
    WHEN 'FCBTN01'.   " SCARR 눌렀을 때
      CLEAR: ZSCARRFLIGHT_B03-CARRNAME,
             ZSCARRFLIGHT_B03-CURRCODE,
             ZSCARRFLIGHT_B03-PRICE,
             ZSCARRFLIGHT_B03-CURRENCY,
             ZSCARRFLIGHT_B03-PLANETYPE,
             ZSCARRFLIGHT_B03-SEATSMAX,
             ZSCARRFLIGHT_B03-SEATSOCC.
      gv_button1 = 1.
    WHEN 'FCBTN02'.   " SFLIGHT 눌렀을 때
      CLEAR: ZSCARRFLIGHT_B03-CARRNAME,
             ZSCARRFLIGHT_B03-CURRCODE,
             ZSCARRFLIGHT_B03-PRICE,
             ZSCARRFLIGHT_B03-CURRENCY,
             ZSCARRFLIGHT_B03-PLANETYPE,
             ZSCARRFLIGHT_B03-SEATSMAX,
             ZSCARRFLIGHT_B03-SEATSOCC.
      gv_button2 = 1.
    WHEN 'FCBTN03'.   " 검색 눌렀을 때
      CLEAR: gs_data.
      IF gv_button1 = 1.
        SELECT SINGLE CARRNAME CURRCODE FROM scarr
          INTO CORRESPONDING FIELDS OF gs_data
           WHERE carrid = ZSCARRFLIGHT_B03-CARRID.
        gv_result_btn1 = 1.
      ELSEIF gv_button2 = 1.
        SELECT SINGLE PRICE CURRENCY PLANETYPE SEATSMAX SEATSOCC FROM sflight
          INTO CORRESPONDING FIELDS OF gs_data
          WHERE carrid = ZSCARRFLIGHT_B03-CARRID
            AND connid = ZSCARRFLIGHT_B03-CONNID
            AND fldate = ZSCARRFLIGHT_B03-FLDATE.
        gv_result_btn2 = 1.
      ELSE.
        SELECT SINGLE A~CARRNAME A~CURRCODE B~PRICE B~CURRENCY B~PLANETYPE B~SEATSMAX B~SEATSOCC
          INTO CORRESPONDING FIELDS OF gs_data
          FROM scarr AS A INNER JOIN sflight AS B
            ON A~CARRID = B~CARRID
          WHERE A~carrid = ZSCARRFLIGHT_B03-CARRID
            AND B~connid = ZSCARRFLIGHT_B03-CONNID
            AND B~fldate = ZSCARRFLIGHT_B03-FLDATE.
        gv_result_btn3 = 1.
      ENDIF.
    WHEN OTHERS.
  ENDCASE.

ENDMODULE.
```
</br>

**5) `PBO` 모듈 구현**
```abap
*&---------------------------------------------------------------------*
*& Include          SAPMZPRACTICE02B03_O01
*&---------------------------------------------------------------------*
*&---------------------------------------------------------------------*
*& Module STATUS_0100 OUTPUT
*&---------------------------------------------------------------------*
*&
*&---------------------------------------------------------------------*
MODULE status_0100 OUTPUT.
  IF gv_result_btn1 = 1.    " SCARR -> 검색 눌렀을 때
    LOOP AT SCREEN.
      IF SCREEN-GROUP2 = 'FLT'.
        SCREEN-invisible = 1.
        SCREEN-input = 0.
      ENDIF.
      MODIFY SCREEN.
    ENDLOOP.

    MOVE-CORRESPONDING gs_data TO ZSCARRFLIGHT_B03.
    gv_button1 = 0.
    gv_result_btn1 = 0.

  ELSEIF gv_result_btn2 = 1.    " SFLIGHT -> 검색 눌렀을 때
    LOOP AT SCREEN.
      IF SCREEN-GROUP1 = 'CAR'.
        SCREEN-invisible = 1.
        SCREEN-input = 0.
      ENDIF.
      MODIFY SCREEN.
    ENDLOOP.

    MOVE-CORRESPONDING gs_data TO ZSCARRFLIGHT_B03.
    gv_button2 = 0.
    gv_result_btn2 = 0.

  ELSEIF gv_result_btn3 = 1.    " 검색 눌렀을 때
    MOVE-CORRESPONDING gs_data TO ZSCARRFLIGHT_B03.
    gv_result_btn3 = 0.
  ENDIF.
ENDMODULE.
```
