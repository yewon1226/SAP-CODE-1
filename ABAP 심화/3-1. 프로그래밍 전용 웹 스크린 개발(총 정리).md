# 12/11
</br>
</br>
## <  핵심 개념 >
</br>

- **1) `module pool program` 생성 방법 ( 일반 프로그램 생성 방법에서 include 파일 포함 )**
- **2) 모듈풀 프로그램은 무조건 `TCODE` 생성해야 함**

</br>

---

</br>

## < ABAP 개념 >
</br>

### < 프로그램 타입 >
- 둘 다 DB CRUD 작업 가능
- Report / Module Pool 모두 INCLUDE 사용 가능
</br>

**1) Type 1 – Executable Program (Report Program)**
- 바로 실행 가능한 일반 프로그램
- SE38/SE80에서 바로 Run 가능

**2) Type M – Module Pool Program**
- 스크린 기반 프로그램
- 단독 실행 불가 → 반드시 `T-code` 필요
- 프로그램명: `SAPMZ` , `SAPMY` 로 시작
- 생성 방식은 일반 프로그램과 비슷
- 단, `Top Include` 체크 후 생성

</br>
</br>

### < 스크린 동작 흐름 >
**1) PBO (Process Before Output)**
- 스크린 출력 전에 실행되는 로직
- 100번 스크린이 뜨기 전에 필요한 초기 세팅을 여기서 처리

**2) PAI (Process After Input)**
- 스크린 표시 후, 사용자가 입력 → 이벤트 발생 후 실행
- 버튼 클릭, 엔터 입력 후 로직 처리

<img width="464" height="319" alt="image" src="https://github.com/user-attachments/assets/7652d97a-c07c-4772-a476-bd09e6538d14" />
</br>
</br>
</br>
</br>

### < 스크린 속성(Screen Attributes) >
- `Normal(View)` : 일반 화면
- `Subscreen` : 화면 내 포함되는 하위 화면 (fragment 느낌)
- `Modal Dialog Box` : 팝업 형태
- `Selection Screen` : 선택 화면

</br>
</br>

### < OK-CODE란? >
- 스크린과 프로그램 간에 사용자 명령(Function Code)을 주고받는 필드
- 시스템 변수 `sy-ucomm`
  
  - OK-CODE 값이 실제 저장되는 시스템 필드
    
    - 사용자가 버튼/엔터 입력 → OK-CODE 생성
    - 이 값이 `sy-ucomm` 에 들어옴
    - PAI에서 `CASE sy-ucomm` 으로 분기 처리
- 시스템 변수 'sy-dynnr' : 현재 실행 중인 스크린 번호를 알려줌

</br>
</br>

---

</br>

## < module pool program 생성 >
- 모듈풀(Type M)은 T-code를 만들어야만 실행 가능 (Report와 달리 직접 실행 불가)
- Module Pool Include 구조
  
  - `I01` : Input 관련 로직
  - `O01` : Output 관련 로직
  - `F01` : Function·기능 로직
- `Next Screen` : 다음에 어떤 화면을 띄울지 결정
  
  - `next dynpro = 0` 은 빈값과 같음
  - 현재 화면 처리 후 자동으로 ‘뒤로가기(back)’
  - `next dynpro = Default` → 현재 화면 유지
- 9000번 이상은 사용 금지 (CBO 영역이므로 충돌 위험)

</br>
</br>

### < Module Pool 기본 생성 및 T-Code 실행 >
</br>

**1) 프로그램 생성 후 프로그램에 스크린 생성**

<img width="421" height="320" alt="image" src="https://github.com/user-attachments/assets/c82fc429-0d39-45b3-8a72-3b8d9cd00985" />
</br>
</br>

**2) 스크린 dynpro 지정**

<img width="565" height="369" alt="image" src="https://github.com/user-attachments/assets/580bf983-2d39-4cb6-ac75-542825de91de" />
</br>
</br>

- 엔터 치면 뒤로가기 설정하고 싶으면 `next dynpro = 0`
<img width="564" height="433" alt="image" src="https://github.com/user-attachments/assets/4896f30e-0df5-49f3-887d-ee1c110f13c6" />

</br>
</br>

**3) 스크린에서 Layout 클릭**

<img width="579" height="384" alt="image" src="https://github.com/user-attachments/assets/46bde9cf-13e3-4905-8626-b105ad58e8df" />
</br>
</br>

**4) 스크린창에서 text 생성**

<img width="676" height="344" alt="image" src="https://github.com/user-attachments/assets/2df2ff1b-d20f-486e-b9c9-3f61f9c85563" />
</br>
</br>

**5) TCODE 생성 - program에 생성**

<img width="528" height="359" alt="image" src="https://github.com/user-attachments/assets/8328e9ba-17f2-4a73-a936-ff6ac3fff6f1" />
</br>
</br>

**6) TCODE 생성 - program and dynpro 체크**

<img width="586" height="372" alt="image" src="https://github.com/user-attachments/assets/0e69a724-19d3-4d59-8a57-abf9efe4bb7f" />
</br>
</br>

**7) TCODE 생성 - screen number 고려해서 생성**

<img width="597" height="429" alt="image" src="https://github.com/user-attachments/assets/47fbb42f-02bb-426e-96ce-794f115f1c76" />

</br>
</br>

**8) TCODE 생성 -  TCODE 입력시 창 열림**
- `/OZTCODESCREENB03` 입력시 이 창이 띄워짐
-	위 버튼 비활성화 -> 스크린마다 다르게 버튼 설정 가능
<img width="350" height="231" alt="image" src="https://github.com/user-attachments/assets/b71ee012-d91c-4c6a-8aec-cc81d15065f2" />

</br>
</br>
</br>
</br>
</br>
</br>

---

</br>

## < 스크린 파일 내 PBO, PAI 모듈 생성 >
- 스크린 필드명과 ABAP 프로그램의 필드명을 동일하게 해야 연결됨.
</br>

**1) 스크린 파일 열기** 

<img width="435" height="204" alt="image" src="https://github.com/user-attachments/assets/3dcc5695-3756-4fce-8e9c-777fa1901393" />
</br>
</br>

**2) 모듈 `STATUS_0100` 와 `USER_COMMAND_0100` 생성** 

<img width="596" height="262" alt="image" src="https://github.com/user-attachments/assets/ecbde80e-6778-4eac-8640-8e83d30bf762" />

</br>
</br>

**3) `STATUS_0100` 안에 있는 `PF_STATUS` 랑 `TITLEBAR` 생성** 

<img width="581" height="174" alt="image" src="https://github.com/user-attachments/assets/158e8a48-0af7-4715-8e9a-9f2df9504033" />
</br>
</br>

<img width="533" height="340" alt="image" src="https://github.com/user-attachments/assets/40317b12-abbb-4701-b894-4cd8a61fa110" />
</br>
</br>

<img width="540" height="164" alt="image" src="https://github.com/user-attachments/assets/2f8c92d9-f224-44fa-9e5f-69506a12caf0" />
</br>
</br>

<img width="573" height="142" alt="image" src="https://github.com/user-attachments/assets/610331b4-9625-4f1f-b72a-5f5ce51714b7" />
</br>
</br>

**4) 타이틀이 바뀐 것을 확인** 

<img width="412" height="258" alt="image" src="https://github.com/user-attachments/assets/5c6d40c9-47a5-495a-905f-21c4648690c4" />
</br>
</br>
</br>
</br>
</br>
</br>

### < 스크린 Layout 기능 >
</br>

**1) 스크린의 Layout에서 다양하게 구성 가능**

<img width="518" height="416" alt="image" src="https://github.com/user-attachments/assets/baa5878e-248a-444e-9cb1-ca9ec07970b9" />
</br>
</br>

**2) TCODE 검색으로 결과 확인 가능**

<img width="523" height="389" alt="image" src="https://github.com/user-attachments/assets/7c53ec59-3f18-4c93-bf25-29b9079eb865" />
</br>
</br>
</br>
</br>

---

</br>

## < ABAP ↔ 스크린 코드 모음 >
- **가장 중요한 점 : TCODE 생성**
</br>

### 1) ABAP 프로그램에서 구조 선언

- 무조건 구조체로만 생성
- OK_CODE 추가 필수. 타입은 반드시 `SY-UCOMM`
```abap
TABLES: sdyn_conn, scarr.
DATA OK_CODE TYPE sy-ucomm.
```
</br>
</br>

### 2) 스크린에서도 같은 이름을 사용 / OK_CODE 추가 필수

- 이름이 동일하면 자동으로 ABAP 변수와 값이 동기화됨
- PBO/PAI에서 MOVE 구문 필요 없음
```abap
SDYN_CONN-CARRID
SDYN_CONN-CONNID
OK_CODE
```
</br>
</br>

### 3) sy-dynnr (현재 스크린 번호)
- 현재 실행 중인 스크린 번호를 알려줌
```abap
sy-dynnr
```
</br>
</br>

### 4) 뒤로가기 (Back) 처리
- next screen 을 0으로 주면 뒤로가기(back) 기능 수행
- PAI에서 엔터/버튼 후 해당 구문 실행 시 이전 화면으로 돌아감
```abap
LEAVE TO SCREEN 0.
```
</br>
</br>

### 5) 필드 초기화 (CLEAN)
- 입력, 출력 필드 초기화 가능
```abap
MODULE clear_fields OUTPUT.
  CLEAR INPUT01.
  CLEAR OK_CODE.
ENDMODULE.
```
</br>
</br>

### 6) TCODE 생성 (TCODE를 생성해야 실행이 됨)

</br>
</br>
</br>

---
</br>

## < ABAP ↔ 스크린 코드 예제 >
</br>

**1) 상단 두번째 그림 클릭 시 DB 테이블 목록을 선택 가능**

<img width="474" height="206" alt="image" src="https://github.com/user-attachments/assets/39ef0a75-d2c5-42e6-8830-659d879ec19a" />

</br>
</br>

**2) 테이블명 입력 후 get from dictionary 클릭**

<img width="559" height="113" alt="image" src="https://github.com/user-attachments/assets/0ee1f644-3b66-4474-955a-73b4fcfc21ec" />

</br>
</br>

**3) 화면에 출력하고 싶은 필드 선택**

<img width="480" height="336" alt="image" src="https://github.com/user-attachments/assets/19e72e7f-7991-44d5-8bb6-f99584fb55de" />

</br>
</br>

**4) 입력/출력 창 지정**
- 버튼들 더블클릭 후에 속성 설정 가능
    
<img width="480" height="275" alt="image" src="https://github.com/user-attachments/assets/dbdf677f-5ac3-4850-9cfd-2421f88c17f6" />
</br>
</br>

- input 값에 required 선택 시 필수값 지정
  
<img width="375" height="252" alt="image" src="https://github.com/user-attachments/assets/ff465ba0-48ca-4e44-ad5e-501a273f02b1" />

- input 선택 해제 시 output 용으로 변경

<img width="424" height="252" alt="image" src="https://github.com/user-attachments/assets/c20a3b8f-6c12-4dc6-8cec-d986c5ea9be8" />

</br>
</br>

**5) 스크린 파일 `element list`에 `OK_CODE` 필드 추가**

<img width="652" height="313" alt="image" src="https://github.com/user-attachments/assets/f7d67885-0da2-40ee-9554-f42c5d4c2292" />

</br>
</br>

**6) `TOP` 파일에 변수 선언**
- tables 선언, OK_CODE 데이터로 선언 필수 
```abap
PROGRAM SAPMZMDPB03_001.

TABLES: SDYN_CONN. " 스크린 안에 생성한
                   " Table/Structure

DATA: INPUT01 TYPE C, " 입출력 필드
      OK_CODE TYPE SY-UCOMM. " OK_CODE
```
</br>

**4) 스크린 파일 코드에 PBO, PAI 모듈 추가**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE CLEAR_FIELDS.

PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
```
</br>

**5) PAI 코드 추가**
```abap
MODULE user_command_0100 INPUT.
  CASE INPUT01.
    WHEN 'X'.
      SELECT SINGLE CARRID CONNID CITYFROM CITYTO
        INTO CORRESPONDING FIELDS OF SDYN_CONN
        FROM SPFLI
        WHERE CARRID = SDYN_CONN-CARRID
          AND CONNID = SDYN_CONN-CONNID.
    WHEN 'E'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**6) PBO 코드 추가**
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'. " Application 버튼들 등 설정
 SET TITLEBAR 'T100'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_fields OUTPUT.
  CLEAR INPUT01.
  CLEAR OK_CODE.
ENDMODULE.
```
</br>

**7) TCODE 생성**

<img width="559" height="392" alt="image" src="https://github.com/user-attachments/assets/a366e09f-45b7-4db3-9a08-b3904f732747" />
</br>
</br>

**8) 결과 확인**

<img width="652" height="331" alt="image" src="https://github.com/user-attachments/assets/a922ceab-571f-46c6-83c8-e620163e85c9" />

</br>
</br>

---

</br>

## < 실습 코드 >
### 실습 1

**1) 스크린 `Layout` 디자인**

<img width="620" height="386" alt="image" src="https://github.com/user-attachments/assets/a3a604f3-eba2-4c67-bfb1-cd29d0f82c66" />
</br>
</br>

**2) 스크린 파일 `element list`에서 `OK_CODE` 추가**

<img width="623" height="349" alt="image" src="https://github.com/user-attachments/assets/95ea6ac0-944a-4048-9c8c-fc5e80964fa2" />
</br>
</br>

**3) `TOP` 파일에 변수 선언**
- tables 선언, OK_CODE 데이터로 선언 필수 
```abap
PROGRAM SAPMZBC410_SOLUTION_03.

TABLES: SDYN_CONN.

DATA: exit_button TYPE C,
      OK_CODE TYPE SY-UCOMM,
      gs_data TYPE SDYN_CONN,
      gv_subrc TYPE sy-subrc.
```
</br>

**4) 스크린 파일 코드에 PBO, PAI 모듈 추가**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
*
PROCESS AFTER INPUT.
  MODULE CHECK_SFLIGHT.
  MODULE USER_COMMAND_0100.
```
</br>

**5) PAI 코드 추가**
```abap
MODULE user_command_0100 INPUT.

  IF exit_button = 'X'.
    LEAVE TO SCREEN 0.
  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*

MODULE check_sflight INPUT.

  SELECT SINGLE * FROM sflight
    INTO CORRESPONDING FIELDS OF gs_data
    WHERE carrid = SDYN_CONN-carrid
      AND connid = SDYN_CONN-connid
      AND fldate = SDYN_CONN-fldate.

  IF sy-subrc <> 0.
    gv_subrc = 4.
    message text-007 TYPE 'I'.
  ENDIF.

ENDMODULE.
```
</br>

**6) PBO 코드 추가**
```abap
MODULE status_0100 OUTPUT.
  IF gv_subrc <> 0.
    CLEAR SDYN_CONN.
    gv_subrc = 0.
  ELSE.
    MOVE-CORRESPONDING gs_data TO SDYN_CONN.
  ENDIF.
ENDMODULE.
```
</br>

**7) TCODE 생성**

<img width="542" height="382" alt="image" src="https://github.com/user-attachments/assets/c5ade457-68f6-4730-b72c-b83ea00b645b" />
</br>
</br>

**8) 결과 확인**
- 입력 값 입력 후에 엔터 치면 결과 출력, `X` 입력 후 엔터 치면 뒤로가기
  
<img width="492" height="339" alt="image" src="https://github.com/user-attachments/assets/5e884687-7bb1-47af-a3b9-15f8b588d209" />
</br>
</br>
</br>
</br>

### 실습 2
</br>

- 문제
<img width="471" height="249" alt="image" src="https://github.com/user-attachments/assets/8a73e537-7367-468b-82b7-01306c4bbba5" />
</br>
</br>
</br>

**1) 스크린 `Layout` 디자인**

<img width="525" height="376" alt="image" src="https://github.com/user-attachments/assets/97c0df65-cb89-4410-8d35-55cd1f5c71ad" />

</br>
</br>

**2) 스크린 파일 `element list`에서 `OK_CODE` 추가**

<img width="606" height="249" alt="image" src="https://github.com/user-attachments/assets/1613c966-2636-4245-9b84-02dc8ce29cf6" />

</br>
</br>

**3) `TOP` 파일에 변수 선언**
- tables 선언, OK_CODE 데이터로 선언 필수 
```abap
PROGRAM SAPMZPRACTICE01B03.

TABLES: smeal.

DATA: OK_CODE TYPE sy-ucomm,
      gt_data TYPE TABLE OF smeal.
```
</br>

**4) 스크린 파일 코드에 PBO, PAI 모듈 추가**
```abap
PROCESS BEFORE OUTPUT.
* MODULE STATUS_0100.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
```
</br>

**5) PAI 코드 추가**
```abap
MODULE user_command_0100 INPUT.

  SELECT * FROM smeal
    INTO CORRESPONDING FIELDS OF TABLE gt_data
    WHERE carrid = SMEAL-CARRID.

  cl_demo_output=>display( gt_data ).

  LEAVE TO SCREEN 0.

ENDMODULE.
```
</br>

**6) TCODE 생성**

<img width="604" height="426" alt="image" src="https://github.com/user-attachments/assets/ffe9d3ad-2924-42dc-88d0-b1c2984205ca" />

</br>
</br>

**7) 결과 확인**
- 입력 값 입력 후에 엔터 치면 테이블 출력
  
<img width="307" height="195" alt="image" src="https://github.com/user-attachments/assets/04c34b4c-cc6d-4cbc-bb71-fea1538821d4" />
</br>
</br>

<img width="403" height="388" alt="image" src="https://github.com/user-attachments/assets/1a9e35ea-328f-4eb2-aeda-649ff7ae24e5" />

</br>
</br>
</br>
</br>

</br>
</br>

# 12/12

</br>
</br>
## <  핵심 개념 >
</br>

- **1) SCREEN 필드 속성 제어 ( `SCREEN-INVISIBLE` , `SCREEN-INPUT` )**
- **2) 그룹(Group1, Group2 등) 속성 활용 → `IF screen-group1 = 'GRP1'.`**
- **3) `LOOP AT screen.` ( `MODIFY SCREEN` 필수 )**
- **4) Dynpro 스크린 제어 ( `SET SCREEN` , `CALL SCREEN` , `LEAVE SCREEN` , `LEAVE TO SCREEN` )**
- **5) 버튼 생성 후 속성 창에서 `FctCode` 필드 입력 ( 펑션코드 )**

</br>

---

</br>

## < ABAP 개념 및 문법 >
</br>

**< Module pool 구조 >**
- 모듈풀 프로그램 하나 → 트랜잭션코드 하나와 연결
  
**1) TOP(Include)**
- 전역 변수(Global Variables) 선언
- 화면(Screen)에서 사용할 변수들도 여기에서 선언함

**2) F01 (Include)**
- 로컬 변수(Local Variables)
- FORM 루틴(Function Routines)들 선언

</br>
</br>
</br>

## < SCREEN 필드 속성 제어 >
- PAI에서 버튼 클릭 이벤트 발생 → PBO에서 SCREEN 테이블을 수정하여 스크린의 속성 변경 가능
  
  - 입력 가능(Input) → 입력 불가(Output only)
  - Visible → Invisible
  - Active → Inactive 등
    
- SCREEN 테이블은 헤더라인 있는 INTERNAL TABLE
  - ABAP 모듈풀에서 스크린 필드 속성을 변경할 때 사용하는 시스템 내부 테이블

- **스크린 속성 변경은 PBO 한 번 지나가면 다시 초기화**
</br>
</br>

**1) SCREEN은 헤더라인을 포함한 구조 => `into`절 생략 가능**

- 일반 인터널 테이블
```abap
LOOP AT screen INTO screen.
```
- screen (헤더라인이므로 into절 생략 가능)
```abap
LOOP AT screen.
  " screen-name
  " screen-input
ENDLOOP.
```
</br>
</br>

**2) SCREEN 속성 변경은 `MODIFY SCREEN` 필수**
- SCREEN 내부 테이블에서 특정 필드를 수정하면 반드시 다음 구문을 넣어야 실제 스크린에 반영됨
- 각 필드의 속성에 접근해서 변경할 수 있음
- SCREEN 속성 값은 `1 = TRUE` , `0 = FALSE`

<img width="548" height="365" alt="image" src="https://github.com/user-attachments/assets/e438b436-a6ad-4dae-96d9-a4aaf6bab111" />
</br>
</br>

```abap
MODULE modify_screen OUTPUT.

  LOOP AT SCREEN. 
    IF screen-group1 = 'SEL'.
      screen-input = 1.
    ENDIF.

    IF screen-name = 'FIELD1'.
      screen-active = 0.          " 여기까지는 헤더 부분만 변경. 
    ENDIF.                        " 스크린 변경하고 싶으면 아래 MODIFY를 해줘야 함.
    MODIFY SCREEN.
  ENDLOOP.

ENDMODULE.
```

</br>
</br>

**3) 그룹(Group1, Group2 등) 속성 활용 → 일괄 제어 가능**
- 스크린 필드별로 그룹 코드 지정 가능
- 특정 그룹 필드 전체를 한 번에 제어할 수 있어 편리함
```abap
LOOP AT SCREEN.
  IF screen-group1 = 'GRP1'.
    screen-input = '0'. " GRP1 그룹 전체 입력 불가 처리
  ENDIF.
  MODIFY SCREEN.
ENDLOOP.
```

</br>
</br>

**4) 구현 위치는 무조건 PBO**
- 스크린 속성 변경은 PBO에서 수행해야 반영됨
- 필드 속성 변경 후 반드시 `MODIFY SCREEN` 사용
```abap
MODIFY SCREEN.
```
</br>
</br>
</br>

## < SCREEN 관련 함수 >

**1) SCREEN-INVISIBLE**
- 화면에서 아예 안 보이게 함
- 필드/라벨/입력칸/화면 공간 사라짐 (빈칸처럼 보임)
```abap
SCREEN-invisible = 1.
```
```abap
IF screen-group2 = 'FLT'.    " GROUP2가 FLT인 필드들은 화면에서 완전 제거
  screen-invisible = 1.
ENDIF.
```
</br>
</br>

**2) SCREEN-INPUT**
- 보이긴 하지만 수정 불가(비활성화)
- 조회 결과는 보여주되 수정은 막고 싶을 때 사용
```abap
SCREEN-input = 0.
```

</br>
</br>

---

</br>

## < Dynpro 스크린 제어 (다음 스크린 설정) >
**< SET SCREEN vs CALL SCREEN >**
- `SET SCREEN` : 다음 화면 예약 → 화면 교체
- `CALL SCREEN` : 지금 화면 호출 → 화면 쌓기(스택)

</br>

### 1) SET SCREEN
- 다음에 실행할 화면을 미리 지정 (화면 전환 X)
- 이전 화면은 스택에서 제거됨
- `LEAVE SCREEN` 과 함께 사용해야 효과 있음
```abap
SET SCREEN 300.
```
- **예시 1 : SET SCREEN + LEAVE SCREEN**
- 현재 화면을 종료하고 300번 화면으로 이동
```abap
SET SCREEN 300.
LEAVE SCREEN.
```
- **예시 2 : SET SCREEN + LEAVE TO SCREEN 0**
- 상황 1 : 상위 Dynpro 흐름의 Next Screen = 200 (Initial Screen이 아님 + 상위 Dynpro 존재)
```abap
SET SCREEN 300.
LEAVE TO SCREEN 0.  " 200으로 이동
```
- 상황 2 : 상위 Dynpro 흐름의 Next Screen = 0 (Initial Screen)
```abap
SET SCREEN 300.
LEAVE TO SCREEN 0.  " 프로그램 종료
```
</br>
</br>

### 2) CALL SCREEN
- `CALL SCREEN` 으로 온 화면에서 `LEAVE SCREEN` 은 자신의 `Next Dynpro`로, `LEAVE TO SCREEN 0` 은 호출 흐름의 `Next Screen` 으로 이동
- 현재 화면 일시 중단 후 화면 실행. (화면 전환 O)
- 현재 화면은 스택에 유지됨 (복귀 가능)
- 호출한 쪽에서 LEAVE SCREEN을 쓰지 않음
```abap
CALL SCREEN 300.
```
- **예시 1 : CALL SCREEN + LEAVE SCREEN**
- Screen 300의 Next Dynpro = 400 이면 400으로 이동
- Screen 300의 Next Dynpro = 0 이면 100으로 이동
```abap
" Screen 100
CALL SCREEN 300.
```
```abap
" Screen 300
LEAVE SCREEN.
```
- **예시 2 : CALL SCREEN + LEAVE TO SCREEN 0**
- `SCREEN 0` → 상위 Dynpro 흐름의 Next Screen
- CALL SCREEN 구문 바로 아래 구문으로 이동 (CALL 코드 아래 코드가 있으면 거기부터 실행)
- 200으로 이동
```abap
" Screen 100 (Next Screen = 200)
CALL SCREEN 300.
```
```abap
" Screen 300
LEAVE TO SCREEN 0.
```
</br>
</br>

### 3) LEAVE SCREEN
- 현재 화면을 종료
- 어디로 갈지는 주변 흐름에 따라 결정
```abap
LEAVE SCREEN.
```
- **예시 1 : CALL SCREEN 안에서**
- Screen 300의 Next Dynpro = 0 => 100으로 이동
- Screen 300의 Next Dynpro = 400 => 400으로 이동
- 100으로 이동
```abap
" Screen 100
CALL SCREEN 300.

" Screen 300
LEAVE SCREEN.
```
- **예시 2 : SET SCREEN과 함께**
- 현재 화면을 닫고 예약된 300번 화면이 실행
```abap
SET SCREEN 300.
LEAVE SCREEN.
```
</br>
</br>

### 4) LEAVE TO SCREEN
- `SET SCREEN 300.` + `LEAVE SCREEN.` 의 축약형
- 현재 화면 종료 후 300번 화면으로 전환
- 이전 화면으로 돌아올 수 없음
```abap
LEAVE TO SCREEN 300.
```
- CALL SCREEN으로 열린 화면 → 호출한 화면 흐름의 Next Screen으로 이동
- 없으면 → 가장 최근 CALL SCREEN 호출자 흐름으로 복귀
```abap
LEAVE TO SCREEN 0.
```
</br>
</br>

### 5) LEAVE PROGRAM
- 프로그램 전체 종료
```abap
LEAVE PROGRAM.
```
</br>
</br>

---

</br>

## < 버튼 이벤트 처리 >
</br>

**1) 버튼 생성 후 속성 창에서 FctCode 필드 입력 (펑션코드)**

<img width="433" height="386" alt="image" src="https://github.com/user-attachments/assets/3771a73a-832f-4fb0-a529-83a9880fa9cf" />
</br>
</br>

**2) 입력필드 6개 묶어서 `GROUP1` 지정**

<img width="468" height="376" alt="image" src="https://github.com/user-attachments/assets/0a41e9b3-9292-4a5f-b2f3-7e185c4486b5" />
</br>
</br>

**3) 스크린 필드에 `OK_CODE` 추가**

<img width="556" height="336" alt="image" src="https://github.com/user-attachments/assets/1c44dc39-2c62-46b9-a57e-aa36e7081a8b" />
</br>
</br>

**4) 스크린 창에서 모듈 `PBO` , `PAI` 생성**

```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
   MODULE MODIFY_SCREEN.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
```
</br>

**5) `PBO` - 타이틀에 변수 채워서 설정**

- '&1 &2 &3' : 타이틀에 변수를 설정할 수 있음

<img width="537" height="132" alt="image" src="https://github.com/user-attachments/assets/99b90233-b96f-406d-bc97-1c6d6f792f2c" />
</br>
</br>

**6) `PBO` - 표준 버튼을 어떤 `OKCODE` 로 동작시킬지 설정**

- 이름 지정 시 그 이름으로 `OKCODE` 로 받아서 처리 가능
```abap
SET TITLEBAR '타이틀바_이름' WITH <값1> <값2> <값3> ...
```

<img width="591" height="336" alt="image" src="https://github.com/user-attachments/assets/d8a80673-5514-47e1-a54f-bd9d9ed112eb" />

</br>
</br>

**7) `TOP` 모듈 구현**

```abap
PROGRAM sapmzb03002.

TABLES: sdyn_conn.

DATA: ok_code TYPE sy-ucomm,
      gv_mod  TYPE i. " 변경모드 값을 받을 변수
```
</br>

**8) `PAI` 모듈 구현**
```abap
MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'CHBTN'.
      IF gv_mod = 1.
        gv_mod = 0.
      ELSE.
        gv_mod = 1.
      ENDIF.
    WHEN 'BACK' OR 'EXIT' OR 'CANCEL'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**9) `PBO` 모듈 구현**
- 시스템변수 : `SY-DATUM` = 오늘 날짜, `SY-UZEIT` = 현재 시간, `SY-UNAME` = 로그인 사용자 ID
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100' WITH sy-datum sy-uzeit sy-uname.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE modify_screen OUTPUT.
  " 헤더가 있는 itab인 SCREEN을 한 건씩 돌면서 동적 처리
  LOOP AT SCREEN.   " INTO SCREEN이 생략
    " SCREEN의 Element 중, group1 값이 'MOD'인 경우
    IF SCREEN-GROUP1 = 'MOD'.
      " Input 속성에 gv_mod 변수 값을 적용함
      SCREEN-INPUT = gv_mod. " 0 또는 1
    ENDIF.

    " Header-Line에 있는 itab 이라서, 작업한 Header를
    " Itab(Body)에 적용시켜야 함
    MODIFY SCREEN. "변경사항 반영
  ENDLOOP.
ENDMODULE.
```
</br>

**9) TCODE 설정**

<img width="571" height="394" alt="image" src="https://github.com/user-attachments/assets/89ecff27-c6a2-4114-8dff-df2a534187ee" />

</br>
</br>

**10) 결과 확인**
- 버튼 클릭시 필드 입력 여부가 바뀜 ( `screen-input` 변경 )
<img width="465" height="316" alt="image" src="https://github.com/user-attachments/assets/32e64b3d-0c48-4144-8e58-5e6b3a007644" />

</br>
</br>
</br>
</br>

---

</br>


## < 실습 코드 >

### 실습 1
</br>

- 문제
<img width="413" height="145" alt="image" src="https://github.com/user-attachments/assets/9381f16c-f73c-4c18-9077-490ef574ed21" />
</br>
</br>

**1) 버튼 생성 후 속성 창에서 FctCode 필드 입력 (펑션코드)**

<img width="566" height="319" alt="image" src="https://github.com/user-attachments/assets/313b5f4b-436d-4f83-8e49-9d3fecd0b853" />
</br>
</br>

**2) 스크린 필드에 `OK_CODE` 추가**

<img width="574" height="344" alt="image" src="https://github.com/user-attachments/assets/b3590a1c-497c-4ea7-882b-dbd3ee47e63a" />
</br>
</br>

**3) 스크린 창에서 모듈 `PBO` , `PAI` 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
*
PROCESS AFTER INPUT.
  MODULE CHECK_SFLIGHT.
  MODULE USER_COMMAND_0100.
```
</br>

**4) `TOP` 모듈 구현**
```abap
PROGRAM SAPMZBC410_SOLUTION_03.

TABLES: SDYN_CONN.

DATA: exit_button TYPE C,
      OK_CODE TYPE SY-UCOMM,
      gs_data TYPE SDYN_CONN,
      gv_subrc TYPE sy-subrc,
      gs_data2 LIKE SDYN_CONN,
      gv_button TYPE I.
```
</br>

**5) `PAI` 모듈 구현**
```abap
MODULE user_command_0100 INPUT.

  IF exit_button = 'X'.
    LEAVE TO SCREEN 0.
  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*

MODULE check_sflight INPUT.

  IF OK_CODE = 'FCBTN'.
    gv_button = 1.

    SELECT SINGLE * FROM sflight
      INTO CORRESPONDING FIELDS OF gs_data
      WHERE carrid = SDYN_CONN-carrid
        AND connid = SDYN_CONN-connid
        AND fldate = SDYN_CONN-fldate.

    IF sy-subrc <> 0.
      gv_subrc = 4.
      message text-007 TYPE 'I'.
    ENDIF.
  ENDIF.

ENDMODULE.
```
</br>

**6) `PBO` 모듈 구현**
```abap
MODULE status_0100 OUTPUT.

  IF gv_button = 1.
    IF gv_subrc <> 0.
      CLEAR SDYN_CONN.
      gv_subrc = 0.
    ELSE.
      MOVE-CORRESPONDING gs_data TO SDYN_CONN.
    ENDIF.
  ELSE.
    gv_button = 0.
  ENDIF.

ENDMODULE.
```
</br>

**7) 결과 확인**
- `PUSH` 버튼 클릭 시
<img width="479" height="321" alt="image" src="https://github.com/user-attachments/assets/0f50c4f5-2a6d-4335-827e-cf6d8c4b1b2b" />
</br>
</br>

- 버튼 클릭 시 결과 생성
<img width="481" height="344" alt="image" src="https://github.com/user-attachments/assets/6a103613-7bfb-4107-960a-b531b605849e" />

</br>
</br>
</br>
</br>
</br>

### 실습 2 (과제)
</br>

- 문제

<img width="663" height="666" alt="image" src="https://github.com/user-attachments/assets/59f1e4d6-f2ab-4182-b626-f0e7326db716" />
</br>
</br>

<img width="503" height="473" alt="image" src="https://github.com/user-attachments/assets/2da81cca-14f1-4bca-88e5-945136ae6632" />
</br>
</br>

<img width="660" height="370" alt="image" src="https://github.com/user-attachments/assets/42457db3-b08c-4ab1-a211-d45201d1ff1b" />
</br>
</br>
</br>
</br>
</br>

**1) 버튼 생성 후 속성 창에서 FctCode 필드 입력 (펑션코드)**

- `SCARR` 는 `FCBTN01` , `SFLIGHT` 는 `FCBTN02` , `검색` 은 `FCBTN03`
<img width="603" height="452" alt="image" src="https://github.com/user-attachments/assets/53b2a934-37fb-41ef-a478-72526c2abf72" />

</br>
</br>

**2) 스크린 필드에 `OK_CODE` 추가**

<img width="626" height="464" alt="image" src="https://github.com/user-attachments/assets/13d15983-080c-45b3-9d9e-6b63731e2d93" />
</br>
</br>


**3) 스크린 창에서 모듈 `PBO` , `PAI` 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
```
</br>

**4) `TOP` 모듈 구현**
```abap
PROGRAM SAPMZPRACTICE02B03.

TABLES: ZSCARRFLIGHT_B03.

DATA: OK_CODE TYPE sy-ucomm,
      gv_button1 TYPE I,
      gv_button2 TYPE I,    " VISIBLE 제어를 위한 플래그 (ex: scarr만 눌렀을 때)
      gv_result_btn1 TYPE I,
      gv_result_btn2 TYPE I,
      gv_result_btn3 TYPE I,   " 결과를 표시하기 위한 플래그 (ex: scarr -> 검색까지)
      gs_data TYPE ZSCARRFLIGHT_B03.
```
</br>

**4) `PAI` 모듈 구현**
```abap
MODULE user_command_0100 INPUT.

  CASE OK_CODE.
    WHEN 'FCBTN01'.   " SCARR 눌렀을 때
      CLEAR: ZSCARRFLIGHT_B03-CARRNAME,
             ZSCARRFLIGHT_B03-CURRCODE,
             ZSCARRFLIGHT_B03-PRICE,
             ZSCARRFLIGHT_B03-CURRENCY,
             ZSCARRFLIGHT_B03-PLANETYPE,
             ZSCARRFLIGHT_B03-SEATSMAX,
             ZSCARRFLIGHT_B03-SEATSOCC.
      gv_button1 = 1.
    WHEN 'FCBTN02'.   " SFLIGHT 눌렀을 때
      CLEAR: ZSCARRFLIGHT_B03-CARRNAME,
             ZSCARRFLIGHT_B03-CURRCODE,
             ZSCARRFLIGHT_B03-PRICE,
             ZSCARRFLIGHT_B03-CURRENCY,
             ZSCARRFLIGHT_B03-PLANETYPE,
             ZSCARRFLIGHT_B03-SEATSMAX,
             ZSCARRFLIGHT_B03-SEATSOCC.
      gv_button2 = 1.
    WHEN 'FCBTN03'.   " 검색 눌렀을 때
*      CLEAR: gs_data.
      IF gv_button1 = 1.
        SELECT SINGLE CARRNAME CURRCODE FROM scarr
          INTO CORRESPONDING FIELDS OF gs_data
           WHERE carrid = ZSCARRFLIGHT_B03-CARRID.
        gv_result_btn1 = 1.
      ELSEIF gv_button2 = 1.
        SELECT SINGLE PRICE CURRENCY PLANETYPE SEATSMAX SEATSOCC FROM sflight
          INTO CORRESPONDING FIELDS OF gs_data
          WHERE carrid = ZSCARRFLIGHT_B03-CARRID
            AND connid = ZSCARRFLIGHT_B03-CONNID
            AND fldate = ZSCARRFLIGHT_B03-FLDATE.
        gv_result_btn2 = 1.
      ELSE.
        SELECT SINGLE A~CARRNAME A~CURRCODE B~PRICE B~CURRENCY B~PLANETYPE B~SEATSMAX B~SEATSOCC
          INTO CORRESPONDING FIELDS OF gs_data
          FROM scarr AS A INNER JOIN sflight AS B
            ON A~CARRID = B~CARRID
          WHERE A~carrid = ZSCARRFLIGHT_B03-CARRID
            AND B~connid = ZSCARRFLIGHT_B03-CONNID
            AND B~fldate = ZSCARRFLIGHT_B03-FLDATE.
        gv_result_btn3 = 1.
      ENDIF.

      gs_data-carrid = ZSCARRFLIGHT_B03-CARRID.
      gs_data-connid = ZSCARRFLIGHT_B03-CONNID.
      gs_data-fldate = ZSCARRFLIGHT_B03-FLDATE.
    WHEN OTHERS.
  ENDCASE.

  CLEAR: OK_CODE.
ENDMODULE.
```
</br>

**5) `PBO` 모듈 구현**
```abap
MODULE status_0100 OUTPUT.
  IF gv_button1 = 1.
    LOOP AT SCREEN.
      IF SCREEN-GROUP2 = 'FLT'.
        SCREEN-invisible = 1.
        SCREEN-input = 0.
      ENDIF.
      MODIFY SCREEN.
    ENDLOOP.
  ELSEIF gv_button2 = 1.
    LOOP AT SCREEN.
      IF SCREEN-GROUP1 = 'CAR'.
        SCREEN-invisible = 1.
        SCREEN-input = 0.
      ENDIF.
      MODIFY SCREEN.
    ENDLOOP.
  ENDIF.

  IF gv_result_btn1 = 1.    " SCARR -> 검색 눌렀을 때
    LOOP AT SCREEN.
      IF SCREEN-GROUP2 = 'FLT'.
        SCREEN-invisible = 1.
        SCREEN-input = 0.
      ENDIF.
      MODIFY SCREEN.
    ENDLOOP.

    MOVE-CORRESPONDING gs_data TO ZSCARRFLIGHT_B03.
    gv_button1 = 0.
    gv_result_btn1 = 0.

  ELSEIF gv_result_btn2 = 1.    " SFLIGHT -> 검색 눌렀을 때
    LOOP AT SCREEN.
      IF SCREEN-GROUP1 = 'CAR'.
        SCREEN-invisible = 1.
        SCREEN-input = 0.
      ENDIF.
      MODIFY SCREEN.
    ENDLOOP.

    MOVE-CORRESPONDING gs_data TO ZSCARRFLIGHT_B03.
    gv_button2 = 0.
    gv_result_btn2 = 0.

  ELSEIF gv_result_btn3 = 1.    " 검색 눌렀을 때
    MOVE-CORRESPONDING gs_data TO ZSCARRFLIGHT_B03.
    gv_result_btn3 = 0.
  ENDIF.
ENDMODULE.
```
</br>

**6) 결과 확인**
- `검색` 누르면 전체 출력 ( Inner Join 사용 )
  
<img width="467" height="494" alt="image" src="https://github.com/user-attachments/assets/36b2b3a5-6453-437a-8a8b-06a54a9f846a" />
</br>
</br>

- `SCARR` 누르면 해당 데이터 출력

<img width="473" height="432" alt="image" src="https://github.com/user-attachments/assets/6687403b-b8dc-453f-98b5-6f41d04c1c01" />
</br>
</br>

- `SFLIGHT` 누르면 해당 데이터 출력
  
<img width="476" height="480" alt="image" src="https://github.com/user-attachments/assets/71fcff73-4f33-4d7f-bb87-9ec2993efbbf" />

</br>
</br>
</br>
</br>
</br>

### 실습 3 ( call screen / leave to screen 0 활용 )
</br>

**1) 스크린 추가**
- 100의 next dynpro는 200, 200은 300, 300은 400, 400은 400으로 설정

<img width="220" height="303" alt="image" src="https://github.com/user-attachments/assets/a737c19d-04a6-4f0b-a27c-1cb882bd5551" />

</br>
</br>

**2) 모듈 `PAI` 생성**
```abap
MODULE user_command_0100 INPUT.

  CASE OK_CODE.
    WHEN 'MOVE'.
     " Next 스크린 200번으로 설정되어 있지만,
     " Next 스크린 300번으로 세팅값 변경(복귀X)
*      SET SCREEN 300.
*      LEAVE SCREEN.
*      => LEAVE TO SCREEN 300. 과 동일함

      " 현재 시점에서 300번 스크린 호출(추후 복귀)
      CALL SCREEN 300.

    WHEN 'BACK' OR 'EXIT' OR 'CANCEL'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.

ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0200 INPUT.
  CASE OK_CODE.
    WHEN 'BACK' OR 'EXIT' OR 'CANCEL'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0300 INPUT.
  CASE OK_CODE.
    WHEN 'BACK' OR 'EXIT' OR 'CANCEL'.
       LEAVE SCREEN.
*      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0400 INPUT.
  CASE OK_CODE.
    WHEN 'BACK' OR 'EXIT' OR 'CANCEL'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**3) 모듈 `PBO` 생성**
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0200 OUTPUT.
 SET PF-STATUS 'S200'.
* SET TITLEBAR 'xxx'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0300 OUTPUT.
 SET PF-STATUS 'S300'.
* SET TITLEBAR 'xxx'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0400 OUTPUT.
 SET PF-STATUS 'S400'.
* SET TITLEBAR 'xxx'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR OK_CODE.
ENDMODULE.
```
</br>

**4) 결과 확인**
- `100` 에서 버튼 클릭시 `300` 으로 이동
- `300` 에서 뒤로가기 하면 `LEAVE SCREEN` 때문에 Next Dynpro인 `400` 으로 이동
- `400` 에서 뒤로가기 하면 `LEAVE TO SCREEN 0` 때문에 가장 최근 CALL SCREEN 호출자인 100의 Next Dynpro인 `200` 으로 이동
- `200` 에서 뒤로가기 하면 프로그램 종료

<img width="302" height="200" alt="image" src="https://github.com/user-attachments/assets/5b0e964b-c059-4b86-b019-e6cdff26a385" />

</br>
</br>

<img width="263" height="183" alt="image" src="https://github.com/user-attachments/assets/5abd8f7b-a392-44ed-80f6-21b3fff51576" />

</br>
</br>

<img width="272" height="187" alt="image" src="https://github.com/user-attachments/assets/5eb2f35e-26b2-49e7-a6eb-c71e2e3d26c2" />

</br>
</br>

<img width="267" height="208" alt="image" src="https://github.com/user-attachments/assets/00e2cf72-f6e6-4fe2-a165-a1e15a26a3df" />


</br>
</br>

# 12/15

</br>
</br>
## <  핵심 개념 >
</br>

- **1) `SET CURSOR FIELD` - 특정 화면 필드에 포커스를 이동시킴**
- **2) Function Key / Function type 설정하기 ( PF-STATUS - PBO에서 설정 )**
- **3) Titlebar ( all title )**
- **4) `STARTING AT / ENDING AT` - dialog 크기 지정하는 함수 ( CALL SCREEN 과 함께 사용 )**

</br>

---

</br>

## < ABAP 개념 >
</br>

### < ABAP Dynpro CALL SCREEN과 Screen Stack 흐름 >
- **`LEAVE TO SCREEN 0`** 같은 화면 전환 명령은 **`PAI`** 에서만
- **`SCREEN-INPUT`** 같은 화면 속성 변경은 **`PBO`** 에서만
- 사용자 입력 기반 SELECT는 **`PAI`** , 조회 결과 화면 반영/속성 변경은 **`PBO`**
- **OK_CODE 초기화** 코드 꼭 넣어줘야 함 ( 보통 **`PBO`** 에서)
- **`OK_CODE`** 케이스문은 **`PAI`** 에서
```abap
MODULE clear_ok_code OUTPUT.
  CLEAR: OK_CODE.
ENDMODULE.
```

<img width="584" height="323" alt="image" src="https://github.com/user-attachments/assets/2fc3f75c-acfe-4c79-82c7-fd88c67b058c" />
</br>
</br>

---

</br>

## < 스크린 인터페이스(UI) 구성 기능 >
</br>

### 1) SET CURSOR FIELD 
- 보통 **`PBO`** 에서 실행.
- 특정 화면 필드에 포커스를 이동시킴
- `<field_name>` : 화면(Screen)에 존재하는 필드 이름
```abap
SET CURSOR FIELD <field_name>.
```
```abap
SET CURSOR FIELD 'SDYN_CONN-CONNID'.
```
</br>

<img width="462" height="304" alt="image" src="https://github.com/user-attachments/assets/75fa9c97-ee46-4f0a-845d-5fd0105b82fa" />
</br>
</br>

<img width="423" height="303" alt="image" src="https://github.com/user-attachments/assets/ea8a1738-c120-4564-a8df-d43f12b70b24" />
</br>
</br>
</br>
</br>

### 2) Function Key / Function type ( PF-STATUS - PBO에서 설정 )
**2-1) Function Type**
- 종류: `NORMAL / EXIT / TABSTRIP CTRL`
  - 기본값: NORMAL
- Function Type을 비워두면 `NORMAL` 로 처리됨
</br>

- `PF-STATUS` 에서 더블클릭시 function key 및 function code 지정 가능
  
<img width="581" height="216" alt="image" src="https://github.com/user-attachments/assets/9f6448b4-e07b-4a84-bbc1-b4de4aa160c8" />
</br>
</br>

- `function type` 에 따라 저기에 들어가는 내용이 달라짐
  
<img width="656" height="123" alt="image" src="https://github.com/user-attachments/assets/9c6e14cc-89de-4fd6-84fd-09bcd9beb981" />

</br>
</br>

- `PF-STATUS` 를 통한 펑션코드와 속성 설정 예시
  
<img width="577" height="387" alt="image" src="https://github.com/user-attachments/assets/8c638b9d-3e57-4e2d-a325-b5c2e15e1f18" />
</br>
</br>
</br>
</br>

### 3) Titlebar ( TITLEBAR - PBO에서 설정 )
- `All Title` 선택 시 모든 스크린에 동일 적용

<img width="605" height="148" alt="image" src="https://github.com/user-attachments/assets/ab7604b0-4567-4dc4-980a-e714ae96d91f" />
</br>
</br>
</br>
</br>


### 4) STARTING AT / ENDING AT
- dialog 크기 지정하는 함수
- `CALL SCREEN` 과 함께 사용됨
- `STARTING AT col row` : 화면의 왼쪽 위 시작 위치
- `ENDING AT col row` : 화면의 오른쪽 아래 끝 위치
- `col` = 열(X축), `row` = 행(Y축)
```abap
STARTING AT <column1> <row1>
ENDING   AT <column2> <row2>
```
- (5,5) 위치에서 시작
- (40,12)까지의 크기를 가진 팝업 화면 표시
```abap
CALL SCREEN 100
  STARTING AT 5 5
  ENDING AT 40 12.
```
</br>
</br>
</br>

---

</br>

## < PF-STATUS 및 Dialog 스크린 예제 >
**1) 각 스크린 코드에서 모듈 생성**
- CLEAR_OK_CODE. 모듈을 전부 선언해주어 OK_CODE를 클리어 시킴.
</br>

- 100 스크린
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE CLEAR_OK_CODE.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
```
- 110 스크린
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0110.
 MODULE CLEAR_OK_CODE.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0110.
```
- 200 스크린
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0200.
 MODULE CLEAR_OK_CODE.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
```
</br>
</br>
</br>

**2) `100 Screen` PF-STATUS, TITLEBAR 생성**
- `Menu Bar` 설정
- **최대 3레벨, 최대 15개까지 가능**

<img width="630" height="331" alt="image" src="https://github.com/user-attachments/assets/8bfe8db3-3162-4493-8349-baa50eb07cdc" />
</br>
</br>

<img width="490" height="207" alt="image" src="https://github.com/user-attachments/assets/8df34555-8d7b-44b8-92ae-acf189e84b3d" />
</br>
</br>

- `Application Toolbar` 설정
<img width="688" height="283" alt="image" src="https://github.com/user-attachments/assets/6256a641-bea8-412f-8963-af18ed670eae" />
</br>
</br>

<img width="702" height="239" alt="image" src="https://github.com/user-attachments/assets/e2f6a8e3-2bcf-4d7a-83d1-e09d127d845f" />
</br>
</br>

<img width="616" height="286" alt="image" src="https://github.com/user-attachments/assets/2273da92-2d35-4198-8c4e-5bcb08e15c6d" />
</br>
</br>

<img width="341" height="169" alt="image" src="https://github.com/user-attachments/assets/eafc8069-42b9-41ea-9101-9f3b4ae584b8" />
</br>
</br>

- `Function Keys` 설정

<img width="648" height="312" alt="image" src="https://github.com/user-attachments/assets/0e476e6d-c8a1-492f-b5dc-b0c90c7621cc" />
</br>
</br>

- `TITLEBAR` 생성
- `&1` 이용해 변수 넣기
  
<img width="583" height="140" alt="image" src="https://github.com/user-attachments/assets/c1f8d966-6167-410d-bf12-f8bb4ec705be" />
</br>
</br>

<img width="386" height="177" alt="image" src="https://github.com/user-attachments/assets/9a38a8ad-5c66-4096-8263-4f49c3ab4c0b" />

</br>
</br>
</br>
</br>

**3) `110 Screen` PF-STATUS 생성 (Dialog)**
- 생성할 때 `Normal` 대신 `Dialog Box` 선택
<img width="514" height="327" alt="image" src="https://github.com/user-attachments/assets/a07132ec-45b0-4431-8018-3930f08a6824" />
</br>
</br>

- `Application Toolbar` 설정
  
<img width="692" height="335" alt="image" src="https://github.com/user-attachments/assets/dddd6815-ae4b-478f-ab33-00747919ed0d" />
</br>
</br>

- `Layout` 설정
<img width="543" height="349" alt="image" src="https://github.com/user-attachments/assets/9ed62e47-491d-45f0-b27b-ce749cc0e054" />
</br>
</br>
</br>
</br>

**4) 각 스크린 `Layout` 설정**
- 110 스크린

<img width="467" height="300" alt="image" src="https://github.com/user-attachments/assets/7fe97864-cebd-44f4-a018-bd8a78d04ea7" />
</br>
</br>

- 200 스크린
  
<img width="452" height="306" alt="image" src="https://github.com/user-attachments/assets/0ba8d3cf-36cb-4b40-b5ab-10c48a7bcaff" />
</br>
</br>
</br>
</br>

**5) `PBO` 모듈 생성**
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100' WITH sy-dynnr.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0200 OUTPUT.
 SET PF-STATUS 'S200'.
 SET TITLEBAR 'T100' WITH sy-dynnr.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0110 OUTPUT.
 SET PF-STATUS 'S110'.
 SET TITLEBAR 'T100' WITH sy-dynnr.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR: OK_CODE.
ENDMODULE.
```
</br>
</br>
</br>

**6) `PAI` 모듈 생성**
```abap
MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN 'EXIT' OR 'CANCEL'.
      LEAVE PROGRAM.
    WHEN 'MOVE'.
      SET SCREEN 200.
      LEAVE SCREEN.
      " LEAVE TO SCREEN 200. 과 동일
    WHEN 'REMARK'.
*      MESSAGE 'Remark 메뉴 선택' TYPE 'I'.
      CALL SCREEN 110
      STARTING AT 5 5
      ENDING AT 50 10.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0110 INPUT.
  CASE OK_CODE.
    WHEN 'OK'.
      MESSAGE 'OK 클릭' TYPE 'I'.
    WHEN 'CLOSE'.
      MESSAGE 'CLOSE 클릭' TYPE 'I'.
    WHEN 'DISP'.
      MESSAGE 'DISP 클릭' TYPE 'I'.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>
</br>
</br>
</br>

**7) 결과 확인**

- 첫 화면 (스크린 100)
  
<img width="436" height="184" alt="image" src="https://github.com/user-attachments/assets/450cb3a4-c027-487f-b5f5-8ac0a202afcb" />
</br>
</br>

- 첫 화면에서 `MOVE` 버튼 클릭 시 (스크린 200)
<img width="319" height="225" alt="image" src="https://github.com/user-attachments/assets/39e30e96-2e00-4ec3-8f0a-fadfe01b1e68" />
</br>
</br>

- 스크린 100에서 비고 클릭 시
  
<img width="463" height="195" alt="image" src="https://github.com/user-attachments/assets/a81b7ded-e7b7-44d1-87fd-37e1a5967b33" />

</br>
</br>

- 스크린 110 (Dialog)
<img width="444" height="382" alt="image" src="https://github.com/user-attachments/assets/cb604364-9370-49a6-96ff-423db4dd8fd3" />

</br>
</br>
</br>

---

</br>

## < 실습 코드 >

### 실습 1
- 문제 ( ABAP Dynpro CALL SCREEN과 Screen Stack 흐름 )

<img width="436" height="226" alt="image" src="https://github.com/user-attachments/assets/9ce0443e-acaf-408a-a37a-e43a75d932fa" />
</br>
</br>

**1) 각 스크린의 `Layout` 설정**
- `Screen 100`
<img width="303" height="183" alt="image" src="https://github.com/user-attachments/assets/3143132f-d12f-40c8-8247-f67a222bd64e" />
</br>
</br>

- `Screen 200`
<img width="321" height="281" alt="image" src="https://github.com/user-attachments/assets/439391c4-5f02-4fbd-9386-15c2c4e57460" />
</br>
</br>
</br>

**2) `TOP` 모듈 생성**
```abap
PROGRAM SAPMZPRACTICE03B03.

TABLES: ZSCARRFLIGHT_B03.

DATA: OK_CODE TYPE sy-ucomm,
      gv_carrid TYPE ZSCARRFLIGHT_B03-CARRID,
      gv_connid TYPE ZSCARRFLIGHT_B03-CONNID,
      gv_fldate TYPE ZSCARRFLIGHT_B03-FLDATE,
      gs_data TYPE ZSCARRFLIGHT_B03.
```
</br>

**3) `F01` 모듈 생성**
```abap
FORM get_data USING pa_carrid pa_connid pa_fldate
              CHANGING gt_data.

  SELECT SINGLE A~CARRID, A~CARRNAME, A~CURRCODE, B~CONNID, B~FLDATE, B~PRICE, B~CURRENCY, B~PLANETYPE, B~SEATSMAX, B~SEATSOCC
    INTO @gs_data
    FROM scarr AS A INNER JOIN sflight AS B
      ON A~carrid = B~carrid
    WHERE B~carrid = @pa_carrid
      AND B~connid = @pa_connid
      AND B~fldate = @pa_fldate.
  MOVE-CORRESPONDING gs_data TO ZSCARRFLIGHT_B03.

ENDFORM.
```
</br>


**4) `PBO` 모듈 생성**
```abap
MODULE status_0100 OUTPUT.
* SET PF-STATUS 'xxxxxxxx'.
* SET TITLEBAR 'xxx'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0200 OUTPUT.
  PERFORM get_data USING gv_carrid gv_connid gv_fldate
                   CHANGING gs_data.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR: OK_CODE.
ENDMODULE.
```
</br>

**5) `PAI` 모듈 생성**
```abap
MODULE user_command_0100 INPUT.
  gv_carrid = ZSCARRFLIGHT_B03-CARRID.
  gv_connid = ZSCARRFLIGHT_B03-CONNID.
  gv_fldate = ZSCARRFLIGHT_B03-FLDATE.

  CALL SCREEN 200.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0200 INPUT.
  IF OK_CODE = 'MOVE'.
    LEAVE TO SCREEN 0.
  ENDIF.
ENDMODULE.
```
</br>

**6) 결과 확인**
- 입력 후 엔터
<img width="324" height="239" alt="image" src="https://github.com/user-attachments/assets/ec51fa6f-cab5-4a2a-91cd-9e817fb0072d" />

</br>
</br>

- 입력한 값에 따라 출력
<img width="373" height="351" alt="image" src="https://github.com/user-attachments/assets/2fabeebc-ec21-4cef-8bb2-33381df28731" />

</br>
</br>
</br>
</br>
</br>

### 실습 2
- 문제 ( 버튼과 Application Toolbar 사용 )
- 전에 했던 실습해서 추가구현

<img width="489" height="253" alt="image" src="https://github.com/user-attachments/assets/53959b85-e2fc-4d5b-b28b-b7d46701d9fd" />
</br>
</br>

**1) 각 스크린 코드에서 모듈 생성**
- `Screen 100`
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE CLEAR_OK_CODE.
*
PROCESS AFTER INPUT.
  MODULE CHECK_SFLIGHT.
  MODULE USER_COMMAND_0100.
```
- `Screen 150`
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0150.
 MODULE CLEAR_OK_CODE.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0150.
```
</br>
</br>

**2) `100 Screen` PF-STATUS 생성**

<img width="536" height="225" alt="image" src="https://github.com/user-attachments/assets/00345637-c4ad-41cf-8718-80b9567ee07c" />

</br>
</br>

**3) 각 스크린 `Layout` 설정**
- `Screen 100`
  
<img width="540" height="409" alt="image" src="https://github.com/user-attachments/assets/9414ea76-85b5-4a67-9b88-f2355060bf3f" />
</br>
</br>

- `Screen 150`
  
<img width="366" height="274" alt="image" src="https://github.com/user-attachments/assets/98b72890-c515-45ea-9659-725361985447" />
</br>
</br>

**4) `PBO` 모듈 수정**
- `OK_CODE` 초기화 코드 추가됨
```abap
MODULE status_0100 OUTPUT.

  SET PF-STATUS 'S100'.
  IF gv_button = 1.
    IF gv_subrc <> 0.
      CLEAR SDYN_CONN.
      gv_subrc = 0.
    ELSE.
      MOVE-CORRESPONDING gs_data TO SDYN_CONN.
    ENDIF.
  ELSE.
    gv_button = 0.
  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0150 OUTPUT.
 SET PF-STATUS 'S150'.
 SET TITLEBAR 'xxx'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR: OK_CODE.
ENDMODULE.
```
</br>
</br>

**5) `PAI` 모듈 수정**
- exit_button = 'T'` 일 때의 if문 추가
- `exit_button` 초기화 코드 추가
```abap
MODULE user_command_0100 INPUT.

  IF exit_button = 'X'.
    LEAVE TO SCREEN 0.
  ELSEIF exit_button = 'T'.
    CALL SCREEN 150
    STARTING AT 5 5
    ENDING AT 50 10.
    CLEAR: exit_button.
  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*

MODULE check_sflight INPUT.

  IF OK_CODE = 'PUSH'.
    gv_button = 1.

    SELECT SINGLE * FROM sflight
      INTO CORRESPONDING FIELDS OF gs_data
      WHERE carrid = SDYN_CONN-carrid
        AND connid = SDYN_CONN-connid
        AND fldate = SDYN_CONN-fldate.

    IF sy-subrc <> 0.
      gv_subrc = 4.
      message text-007 TYPE 'I'.
    ENDIF.
  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0150 INPUT.
  IF OK_CODE = 'BTN01'.
    LEAVE TO SCREEN 0.
  ENDIF.
ENDMODULE.
```
</br>
</br>

**6) 결과확인**
- 필수 값 입력 후 `T` 입력 후 엔터
<img width="531" height="375" alt="image" src="https://github.com/user-attachments/assets/ae634ba6-75e7-4a91-bd2a-c6e9cdb1094b" />
</br>
</br>

- 다이얼로그 창 띄워짐 ( 시간이 띄워짐 )
<img width="534" height="376" alt="image" src="https://github.com/user-attachments/assets/50a3e05b-2c85-4084-a8ca-3fd02f4e4602" />

</br>
</br>

# 12/16

</br>
</br>
## <  핵심 개념 >
</br>

- **1) MESSAGE TYPE 종류**
- **2) Icon Field 사용 ( `ICON_CREATE` 함수 불러오기 )**
- **3) `Listbox` (드롭다운) = 여러 값 중 하나를 선택**
- **4)  라디오버튼 및 체크박스 ( Radio button / Check box )**
- **5) 버튼에 아이콘을 같이 띄우기** 

</br>

---

</br>


## < MESSAGE TYPE 종류 >
</br>

### 1) TYPE 'A' (Abort)
- 치명적인 오류 발생 시 사용
- 메시지 출력 후 프로그램이 즉시 종료됨
```abap
MESSAGE '치명적 오류 발생' TYPE 'A'.
```
<img width="484" height="148" alt="image" src="https://github.com/user-attachments/assets/b10f81ee-593c-4b2d-97b3-1dfaf2544b8a" />
</br>
</br>
</br>

### 2) TYPE 'X' (Exit)
- 시스템 오류 메시지
- 출력과 동시에 Short Dump 발생
```abap
MESSAGE '시스템 오류 발생' TYPE 'X'.
```
<img width="409" height="330" alt="image" src="https://github.com/user-attachments/assets/7972ecc4-fa92-4c5d-bb7d-8e37987477b2" />

</br>
</br>
</br>

### 3) TYPE 'E' (Error)
- 오류 메시지 출력
- 현재 화면에 머물며 다음 단계로 진행 불가
```abap
MESSAGE '입력값 오류입니다' TYPE 'E'.
```
<img width="233" height="50" alt="image" src="https://github.com/user-attachments/assets/ddf4ff77-2521-44eb-995c-b787a54e435b" />
</br>
</br>
</br>

### 4) TYPE 'W' (Warning)
- 경고 메시지 출력
- Enter를 누르면 처리가 계속 진행됨
```abap
MESSAGE '주의가 필요합니다' TYPE 'W'.
```
<img width="220" height="44" alt="image" src="https://github.com/user-attachments/assets/94150f34-68d1-4055-918c-0b837232cb3a" />

</br>
</br>
</br>

### 5) TYPE 'I' (Information)
- 정보 메시지 출력
- 팝업 창으로 표시됨
```abap
MESSAGE '안내 메시지입니다' TYPE 'I'.
```
<img width="483" height="143" alt="image" src="https://github.com/user-attachments/assets/697e2d8e-593d-403f-a18a-056583a3ae1e" />
</br>
</br>
</br>

### 6) TYPE 'S' (Success)
- 성공 메시지 출력
- 화면 하단 상태바에 표시됨
```abap
MESSAGE '정상 처리되었습니다' TYPE 'S'.
```
<img width="206" height="44" alt="image" src="https://github.com/user-attachments/assets/cadb4bb8-7bbf-439e-8606-66c6b27b3d58" />
</br>
</br>
</br>

### 7) DISPLAY LIKE 사용
- 메시지의 실제 동작(TYPE)은 그대로 유지하면서 화면에 보이는 표시 형태만 변경하는 옵션
```abap
MESSAGE '<메시지 내용>' TYPE '<실제타입>' DISPLAY LIKE '<표시타입>'.
```
- 메시지 동작은 E 타입, 표시 모양만 S 타입으로 보여줌
```abap
MESSAGE 'I타입 메세지입니다.' TYPE 'I' DISPLAY LIKE 'S'.
```
<img width="483" height="143" alt="image" src="https://github.com/user-attachments/assets/f00c3f74-380b-4dae-917a-6798c78c18fa" />
</br>
</br>

```abap
MESSAGE 'E타입 메세지입니다.' TYPE 'E' DISPLAY LIKE 'S'.
```
<img width="225" height="46" alt="image" src="https://github.com/user-attachments/assets/f49a1573-bcd5-4cd6-9b0c-d553f983aeb8" />
</br>
</br>
</br>
</br>
</br>

### < 추가적인 개념 - `SET / GET PARAMETER` >
- 서로 다른 프로그램/화면 간에 입력값을 공유하기 위한 기능
- Data Element에 설정된 Parameter ID를 키로 사용
- 한 프로그램에서 SET으로 저장한 값을 다른 프로그램에서 GET으로 불러옴

<img width="433" height="330" alt="image" src="https://github.com/user-attachments/assets/2092cfa6-8af8-403b-b2e8-4b55492a8c7d" />
</br>
</br>
</br>
</br>

---

</br>

## < Icon Field >
- SAP에서 제공하는 아이콘을 저장하기 위한 데이터 타입
```abap
DATA: <icon_field> TYPE ICONS-TEXT.
```
```abap
DATA: iconfield1 TYPE ICONS-TEXT,
      iconfield2 TYPE ICONS-TEXT.
```

- `/oicon` 으로 아이콘 볼 수 있음
<img width="268" height="81" alt="image" src="https://github.com/user-attachments/assets/fe1f0051-1c41-45f6-8cd2-0bd880d10115" />

</br>
</br>
</br>


### < `ICON_CREATE` 함수 불러오기 >
- `Pattern` 을 통해 가져오기
  
<img width="622" height="391" alt="image" src="https://github.com/user-attachments/assets/ba885de6-4761-440d-bf23-c890d700720d" />

</br>
</br>
</br>
</br>

### < Icon Field 를 이용한  예제 >
</br>
</br>

- 문제

<img width="453" height="294" alt="image" src="https://github.com/user-attachments/assets/343c3b1a-33c2-4845-9ab1-faaf80c25e02" />
</br>
</br>
</br>

**1) `Icon` 이용한 Layout 설정**

<img width="541" height="500" alt="image" src="https://github.com/user-attachments/assets/93017b3d-facf-40a3-806e-7aa830caa00a" />
</br>
</br>
</br>

**2) 100 Screen 모듈 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE SET_ICONS.
 MODULE CLEAR_OK_CODE.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
```
</br>
</br>

**3) `TOP` 모듈 생성**
```abap
PROGRAM SAPMZB03004.

DATA: gs_flight TYPE sflight.
DATA: OK_CODE TYPE sy-ucomm.

DATA: gv_button TYPE I,
      ICONFIELD1 TYPE ICONS-TEXT,
      ICONFIELD2 TYPE ICONS-TEXT.
```
</br>
</br>

**4) `F01` 모듈 생성**
```abap
FORM set_icon USING icon_name
              CHANGING icon_result.
  CALL FUNCTION 'ICON_CREATE'
    EXPORTING
      name = icon_name
    IMPORTING
      RESULT                      = icon_result
    EXCEPTIONS
      ICON_NOT_FOUND              = 1
      OUTPUTFIELD_TOO_SHORT       = 2
      OTHERS                      = 3
    .
  IF sy-subrc <> 0.
    MESSAGE 'Error' TYPE 'E'.
  ENDIF.
ENDFORM.
```
</br>
</br>

**5) `PAI` 모듈 생성**
```abap
MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BTN01'.
      IF gv_button = 1.
        gv_button = 0.
      ELSE.
        gv_button = 1.
      ENDIF.
    WHEN 'ICON'.
      IF gv_button = 1.
        gv_button = 0.
      ELSE.
        gv_button = 1.
      ENDIF.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN 'EXIT' OR 'CANCEL'.
      LEAVE PROGRAM.
    WHEN 'MOVE'.
      SET SCREEN 200.
      LEAVE SCREEN.
      " LEAVE TO SCREEN 200. 과 동일
    WHEN 'REMARK'.
*      MESSAGE 'Remark 메뉴 선택' TYPE 'I'.
      CALL SCREEN 110
      STARTING AT 5 5
      ENDING AT 50 10.
    WHEN OTHERS.
  ENDCASE.

ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0110 INPUT.
  CASE OK_CODE.
    WHEN 'OK'.
      MESSAGE 'OK 클릭' TYPE 'I'.
    WHEN 'CLOSE'.
      MESSAGE 'CLOSE 클릭' TYPE 'I'.
    WHEN 'DISP'.
      MESSAGE 'DISP 클릭' TYPE 'I'.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>
</br>

**6) `PBO` 모듈 생성**
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100' WITH sy-dynnr.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0200 OUTPUT.
 SET PF-STATUS 'S200'.
 SET TITLEBAR 'T100' WITH sy-dynnr.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0110 OUTPUT.
 SET PF-STATUS 'S110'.
 SET TITLEBAR 'T100' WITH sy-dynnr.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE set_icons OUTPUT.

  PERFORM set_icon USING 'ICON_CHANGE' CHANGING ICONFIELD2.

  IF gv_button = 1.
    PERFORM set_icon USING 'ICON_SYSTEM_OKAY' CHANGING ICONFIELD1.
  ELSE.
    PERFORM set_icon USING 'ICON_DISPLAY' CHANGING ICONFIELD1.
  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR: OK_CODE.
ENDMODULE.
```
</br>
</br>

**7) 결과 확인**
- 아이콘 변경 버튼 클릭시 체크 아이콘으로 바뀜 ( 다시 누르면 원래대로 바뀜 )
<img width="538" height="443" alt="image" src="https://github.com/user-attachments/assets/ed54eb70-b443-4760-a6f8-5a003bf65f0e" />

</br>
</br>
</br>
</br>

---

</br>

## < 스크린 인터페이스(UI) 구성 기능 >
</br>

### 1) 드롭다운
- `Listbox` (드롭다운) = 여러 값 중 하나를 선택
</br>

- `Listbox with key` 선택 시
  
<img width="581" height="411" alt="image" src="https://github.com/user-attachments/assets/b2fad37b-7386-42c8-8728-9c2f080e2044" />
</br>
</br>

<img width="540" height="457" alt="image" src="https://github.com/user-attachments/assets/02045538-3903-4b1e-a475-98ac10ddd584" />

</br>
</br>

- `Listbox` 선택 시
<img width="575" height="448" alt="image" src="https://github.com/user-attachments/assets/d07b66a3-b33f-4635-802f-d2377f769e15" />
</br>
</br>

<img width="531" height="460" alt="image" src="https://github.com/user-attachments/assets/ff0a7dda-af17-4df5-b638-82cfe09cf818" />

</br>
</br>
</br>
</br>

### 2) 라디오버튼 및 체크박스 ( Radio button / Check box )

- 라디오 버튼끼리 그룹 지정 가능
- 그룹 지정시 라디오버튼을 그룹 중 하나만 선택 가능하게 됨
- `OK_CODE` 없이 바로 라디오버튼 체크 가능
```abap
CASE 'X'.
  WHEN view.
    gv_title = 1.
  WHEN maintain_flights.
    gv_title = 2.
  WHEN maintain_bookings.
    gv_title = 3.
ENDCASE.
```

<img width="724" height="373" alt="image" src="https://github.com/user-attachments/assets/9bfbf8d0-91fa-4f9b-b11c-d6fcf922a92f" />

</br>
</br>

- 라디오 버튼끼리 그룹 지정 시 하나만 펑션코드 설정하면 됨
<img width="696" height="356" alt="image" src="https://github.com/user-attachments/assets/d7e18577-96db-4a89-8d98-4e2f119d5dd2" />

</br>
</br>
</br>
</br>

### 3) 버튼의 아이콘 지정
- 버튼에 아이콘을 같이 띄울 수 있음
<img width="699" height="434" alt="image" src="https://github.com/user-attachments/assets/ec5b76f3-e4e2-413f-94d2-9006dc726313" />

</br>
</br>
</br>
</br>

---

</br>

## < 실습 코드 >

### 실습 1
</br>


**1) Screen 100 `Layout` 설정**
- `Foreign Key Check` 해제해야 오류 Message 가 안뜸
  
<img width="550" height="506" alt="image" src="https://github.com/user-attachments/assets/d4b1fba2-bbd3-4d9f-93d9-35b6a8e85b0c" />
</br>
</br>
</br>
</br>

**2) `TOP` 모듈 생성**
```abap
PROGRAM SAPMZPRACTICE04B03.

TABLES: SDYN_CONN.

DATA: OK_CODE TYPE sy-ucomm,
      ICONFIELD01 TYPE ICONS-TEXT,
      gs_spfli TYPE SPFLI,
      gv_subrc TYPE I.
```
</br>
</br>

**3) `F01` 모듈 생성**
```abap
FORM set_icons USING icon_name CHANGING icon_result.
  CALL FUNCTION 'ICON_CREATE'
    EXPORTING
      name                        = icon_name
    IMPORTING
      RESULT                      = icon_result
    EXCEPTIONS
      ICON_NOT_FOUND              = 1
      OUTPUTFIELD_TOO_SHORT       = 2
      OTHERS                      = 3
             .
    IF sy-subrc <> 0.
      MESSAGE 'Error' TYPE 'E'.
    ENDIF.
ENDFORM.
```
</br>
</br>

**4) `PAI` 모듈 생성**
```abap
MODULE user_command_0100 INPUT.
  IF OK_CODE = 'BTN01'.
    SELECT SINGLE * FROM SPFLI
      INTO CORRESPONDING FIELDS OF gs_spfli
      WHERE carrid = SDYN_CONN-carrid
        AND connid = SDYN_CONN-connid.
    IF sy-subrc <> 0.
      gv_subrc = 4.
    ELSE.
      gv_subrc = 1.
    ENDIF.
  ENDIF.
ENDMODULE.
```
</br>
</br>

**5) `PBO` 모듈 생성**
```abap
MODULE status_0100 OUTPUT.
  IF gv_subrc = 4.
    PERFORM set_icons USING 'ICON_LED_RED' CHANGING ICONFIELD01.
  ELSEIF gv_subrc = 1.
    PERFORM set_icons USING 'ICON_LED_GREEN' CHANGING ICONFIELD01.
  ENDIF.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR: OK_CODE.
ENDMODULE.
```
</br>
</br>

**6) 결과 확인**

<img width="314" height="284" alt="image" src="https://github.com/user-attachments/assets/9cc57410-24da-4d26-a7b8-de86f9cbafa9" />
</br>
</br>
</br>
</br>
</br>
</br>

### 실습 2
- 라디오버튼 활용 실습
- 타이틀 변경 실습 (titlebar)
</br>

**1) Screen 100 `Layout` 설정**

<img width="738" height="307" alt="image" src="https://github.com/user-attachments/assets/17c29bf5-c52d-48cb-a710-43ddc3b44549" />
</br>
</br>
</br>
</br>

**2) `TOP` 모듈 수정**
```abap
PROGRAM SAPMZBC410_SOLUTION_03_01.

TABLES: SDYN_CONN.

DATA: exit_button TYPE C,
      OK_CODE TYPE SY-UCOMM,
      gs_data TYPE SDYN_CONN,
      gv_subrc TYPE sy-subrc,
      gs_data2 LIKE SDYN_CONN,
      gv_button TYPE I.

DATA: VIEW TYPE C VALUE 'X',
      MAINTAIN_FLIGHTS TYPE C,
      MAINTAIN_BOOKINGS TYPE C,
      gv_title TYPE I.
```
</br>
</br>

**3) `PAI` 모듈 수정**
```abap
MODULE user_command_0100 INPUT.

  IF exit_button = 'X'.
    LEAVE TO SCREEN 0.
  ELSEIF exit_button = 'T'.
    CALL SCREEN 150
    STARTING AT 5 5
    ENDING AT 50 10.
    CLEAR: exit_button.
  ENDIF.

ENDMODULE.

*----------------------------------------------------------------------*

MODULE check_sflight INPUT.

  CASE OK_CODE.
    WHEN 'MODE'.
      CASE 'X'.
        WHEN VIEW.
          gv_title = 1.
        WHEN MAINTAIN_FLIGHTS.
          gv_title = 2.
        WHEN MAINTAIN_BOOKINGS.
          gv_title = 3.
        WHEN OTHERS.
      ENDCASE.
    WHEN 'PUSH'.
      gv_button = 1.

      SELECT SINGLE * FROM sflight
        INTO CORRESPONDING FIELDS OF gs_data
        WHERE carrid = SDYN_CONN-carrid
          AND connid = SDYN_CONN-connid
          AND fldate = SDYN_CONN-fldate.

      IF sy-subrc <> 0.
        gv_subrc = 4.
        message text-007 TYPE 'I'.
      ENDIF.
    WHEN OTHERS.
  ENDCASE.

ENDMODULE.

*----------------------------------------------------------------------*

MODULE user_command_0150 INPUT.
  IF OK_CODE = 'BTN01'.
    LEAVE TO SCREEN 0.
  ENDIF.
ENDMODULE.
```
</br>
</br>

**4) `PBO` 모듈 수정**
```abap
MODULE status_0100 OUTPUT.

  SET PF-STATUS 'S100'.

  IF gv_title = 1.
    SET TITLEBAR 'T100' WITH 'View'.
  ELSEIF gv_title = 2.
    SET TITLEBAR 'T100' WITH 'Maintain flights'.
    LOOP AT SCREEN.
      IF screen-name = 'SDYN_CONN-PLANETYPE'.
        screen-input = 1.
      ENDIF.
      MODIFY SCREEN.
    ENDLOOP.
  ELSEIF gv_title = 3.
    SET TITLEBAR 'T100' WITH 'Maintain bookings'.
  ENDIF.

  IF gv_button = 1.
    IF gv_subrc <> 0.
      CLEAR SDYN_CONN.
      gv_subrc = 0.
    ELSE.
      MOVE-CORRESPONDING gs_data TO SDYN_CONN.
    ENDIF.
  ELSE.
    gv_button = 0.
  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0150 OUTPUT.
 SET PF-STATUS 'S150'.
 SET TITLEBAR 'xxx'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR: OK_CODE.
ENDMODULE.
```
</br>
</br>

**5) 결과 확인**
- 라디오 버튼 클릭에 따라 타이틀이 바뀌고 `Maintain flights` 클릭 시 `Plane type` 인풋이 가능
<img width="607" height="277" alt="image" src="https://github.com/user-attachments/assets/d0bb79eb-a9ef-4b8f-80d3-65a332a3e71a" />
</br>
</br>
</br>
</br>
</br>
</br>

### 실습 3
</br>

- 문제
<img width="370" height="211" alt="image" src="https://github.com/user-attachments/assets/b718816c-c7b8-4164-b521-3fb326df95fc" />
</br>
</br>
</br>
</br>


**1) Screen 100 `Layout` 설정**

<img width="537" height="275" alt="image" src="https://github.com/user-attachments/assets/21e4e168-07c9-478a-a864-f2f762d419d5" />
</br>
</br>
</br>
</br>

**2) 100 Screen 모듈 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE CLEAR_OK_CODE.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
```
</br>
</br>

**3) `F01` 모듈 생성**
```abap
FORM set_icons USING icon_name CHANGING icon_result.
  CALL FUNCTION 'ICON_CREATE'
    EXPORTING
      name                        = icon_name
    IMPORTING
      RESULT                      = icon_result
    EXCEPTIONS
      ICON_NOT_FOUND              = 1
      OUTPUTFIELD_TOO_SHORT       = 2
      OTHERS                      = 3
             .
    IF sy-subrc <> 0.
      MESSAGE 'Error' TYPE 'E'.
    ENDIF.
ENDFORM.
```
</br>
</br>

**4) `TOP` 모듈 생성**
```abap
PROGRAM SAPMZPRACTICE04B03.

TABLES: SDYN_CONN, SFLIGHT.

DATA: OK_CODE TYPE sy-ucomm,
      ICONFIELD01 TYPE ICONS-TEXT,
      gs_spfli TYPE SPFLI,
      gs_sflight TYPE sflight,
      gv_subrc TYPE I,
      gv_max_fldate TYPE S_DATE,
      gv_remain_seat TYPE INT4.
```
</br>
</br>

**5) `PAI` 모듈 생성**
```abap
MODULE user_command_0100 INPUT.
  IF OK_CODE = 'BTN01'.
    SELECT SINGLE * FROM SPFLI
      INTO CORRESPONDING FIELDS OF gs_spfli
      WHERE carrid = SDYN_CONN-carrid
        AND connid = SDYN_CONN-connid.
    IF sy-subrc <> 0.
      MESSAGE '일치하는 데이터가 없습니다.' TYPE 'I'.
    ELSE.
      SELECT MAX( fldate ) FROM sflight
        INTO gv_max_fldate
        WHERE carrid = SDYN_CONN-carrid
          AND connid = SDYN_CONN-connid.

      SELECT SINGLE * FROM sflight
        INTO gs_sflight
        WHERE fldate = gv_max_fldate.

      gv_remain_seat = gs_sflight-SEATSMAX - gs_sflight-SEATSOCC.

      IF gv_remain_seat = 0.
        gv_subrc = 1.
      ELSEIF gv_remain_seat >= 10.
        gv_subrc = 2.
      ELSEIF gv_remain_seat < 10.
        gv_subrc = 3.
      ENDIF.

    ENDIF.
  ENDIF.
ENDMODULE.
```
</br>
</br>

**6) `PBO` 모듈 생성**
```abap
MODULE status_0100 OUTPUT.
  MOVE-CORRESPONDING gs_sflight TO SFLIGHT.
  IF gv_subrc = 3.
    PERFORM set_icons USING 'ICON_LED_YELLOW' CHANGING ICONFIELD01.
  ELSEIF gv_subrc = 2.
    PERFORM set_icons USING 'ICON_LED_RED' CHANGING ICONFIELD01.
  ELSEIF gv_subrc = 1.
    PERFORM set_icons USING 'ICON_LED_GREEN' CHANGING ICONFIELD01.
  ENDIF.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR: OK_CODE.
ENDMODULE.
```
</br>
</br>

**7) 결과 확인**
- 잔여석이 0 이면 초록색, 10 이상이면 빨간색, 10 미만이면 노란색

<img width="567" height="292" alt="image" src="https://github.com/user-attachments/assets/ff6f0c7c-a3a4-440f-b7e2-2cc87cdefd7b" />

</br>
</br>


# 12/17

</br>
</br>
## <  핵심 개념 >
</br>

- **1) FIELD / CHAIN 입력 체크 방식**
- **2) `AT EXIT-COMMAND` - E 타입 메시지 일 때 나가기**
- **3) `Back` 예제 - `POPUP` 팝업**

</br>

- **`LEAVE TO SCREEN 0`** 같은 화면 전환 명령은 **`PAI`** 에서만
- **`SCREEN-INPUT`** 같은 화면 속성 변경은 **`PBO`** 에서만
- 사용자 입력 기반 SELECT는 **`PAI`** , 조회 결과 화면 반영/속성 변경은 **`PBO`**
- **OK_CODE 초기화** 코드 꼭 넣어줘야 함 ( 보통 **`PBO`** 에서)
- **`OK_CODE`** 케이스문은 **`PAI`** 에서
- LOOP AT SCREEN 사용시 **`MODIFY SCREEN`** 넣기
- **`FIELD / CHAIN`** 은 무조건 **PAI** 에서만 구현
- **`AT EXIT-COMMAND`** 은 무조건 **PAI** 에서만 구현
- **`AT EXIT-COMMAND`** 는 Screen 코드에서 **맨 위** 에 두는 게 좋음

</br>

---

</br>

## < PAI FIELD / CHAIN 입력 체크 방식 >
- **`FIELD / CHAIN`** 은 무조건 **PAI** 에서만 구현
- 화면에 입력된 값을 기준으로 검증하기 위해 사용
</br>

### 1) 기본형 (옵션 없음) – 항상 실행
- PAI 발생 시 무조건 MODULE 실행
- 값 입력 여부, 변경 여부 모두 무관
</br>

- **단일값 체크 (FIELD)**
```abap
FIELD <field> MODULE <module>.
```
```abap
FIELD SCARR-CARRID MODULE CHECK_INPUT.
```
- **다중값 체크 (CHAIN)**
```abap
CHAIN.
  FIELD: <field1>, <field2>.
  MODULE <module>.
ENDCHAIN.
```
```abap
CHAIN.
  FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
  MODULE CHECK_INPUTS.
ENDCHAIN.
```
</br>
</br>

### 2) 입력값 존재 기준 (ON INPUT / ON CHAIN-INPUT)
- 값이 입력된 경우에만 MODULE 실행
- 다중 값 체크 시 CHAIN 내 하나라도 값이 있으면 실행 (OR 조건)
</br>

- **단일값 체크 (ON INPUT)**
```abap
FIELD <field> MODULE <module> ON INPUT.
```
```abap
FIELD SCARR-CARRID MODULE CHECK_INPUT ON INPUT.
```
- **다중값 체크 (ON CHAIN-INPUT)**
```abap
CHAIN.
  FIELD: <field1>, <field2>.
  MODULE <module> ON CHAIN-INPUT.
ENDCHAIN.
```
```abap
CHAIN.
  FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
  MODULE CHECK_INPUTS ON CHAIN-INPUT.
ENDCHAIN.
```
</br>
</br>

### 3) 값 변경 기준 (ON REQUEST / ON CHAIN-REQUEST)
- 이전 값과 비교하여 변경되었을 때만 MODULE 실행
- 다중 값 체크 시 CHAIN 내 하나라도 값이 변경되면 실행
- 값의 존재 여부와 무관하게, 이전 값과 달라지기만 하면 실행 ( 값이 있다가 빈 값이어도 실행 )
</br>

- **단일값 체크 (ON REQUEST)**
```abap
FIELD <field> MODULE <module> ON REQUEST.
```
```abap
FIELD SCARR-CARRID MODULE CHECK_INPUT ON REQUEST.
```
- **다중값 체크 (ON CHAIN-REQUEST)**
```abap
CHAIN.
  FIELD: <field1>, <field2>.
  MODULE <module> ON CHAIN-REQUEST.
ENDCHAIN.
```
```abap
CHAIN.
  FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
  MODULE CHECK_INPUTS ON CHAIN-REQUEST.
ENDCHAIN.
```
</br>
</br>
</br>

## < PAI FIELD / CHAIN 예제 >
</br>

**1) `Layout` 설정**

<img width="538" height="255" alt="image" src="https://github.com/user-attachments/assets/f839bae4-e194-4514-b412-e8e6838c230b" />

</br>
</br>

**2) `Screen` 코드에서 모듈 생성 ( PAI, PBO )**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE INIT_DATA.
*
PROCESS AFTER INPUT.
  MODULE EXIT AT EXIT-COMMAND.

**********************************************************************

* FIELD SCARR-CARRID MODULE CHECK_INPUT. " 단일값 체크
*
* CHAIN. " 다중값 체크
*  FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
*  MODULE CHECK_INPUTS.
* ENDCHAIN.

**********************************************************************

*  " 단일값 체크 : ON INPUT 값이 있을때만 체크하도록 설정
*  FIELD SCARR-CARRID MODULE CHECK_INPUT ON INPUT.
*
*  " 다중값 체크 : ON CHAIN-INPUT 값이 있을때만 체크하도록 설정
*  CHAIN.
*    FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
*    MODULE CHECK_INPUTS ON CHAIN-INPUT.
*  ENDCHAIN.
* MODULE USER_COMMAND_0100.

**********************************************************************

   " 단일값 체크 : ON REQUEST 값이 변경되었을 때 체크하도록 설정
  FIELD SCARR-CARRID MODULE CHECK_INPUT ON REQUEST.

  " 다중값 체크 : ON CHAIN-REQUEST 값이 변경되었을 때만 체크하도록 설정
  CHAIN.
    FIELD: SDYN_CONN-CARRID, SDYN_CONN-CONNID.
    MODULE CHECK_INPUTS ON CHAIN-REQUEST.
  ENDCHAIN.
 MODULE USER_COMMAND_0100.
```
</br>

**3) `PAI` 에서 모듈 생성**
```abap
" 단일입력
MODULE check_input INPUT.
  IF SCARR-CARRID IS NOT INITIAL.
    SELECT SINGLE CARRID
      FROM SPFLI " 여기엔 AB값이 없음
      INTO SCARR-CARRID
      WHERE CARRID = SCARR-CARRID.
    IF sy-subrc <> 0.
      MESSAGE '해당 항공사 데이터는 존재하지 않습니다.' TYPE 'E'.
    ENDIF.
  ENDIF.
ENDMODULE.

" 다중입력
MODULE check_inputs INPUT.
  IF SDYN_CONN-CARRID IS NOT INITIAL AND
     SDYN_CONN-CONNID IS NOT INITIAL.
    SELECT SINGLE *
      FROM SPFLI
      INTO CORRESPONDING FIELDS OF SDYN_CONN
      WHERE CARRID = SDYN_CONN-CARRID
        AND CONNID = SDYN_CONN-CONNID.
    IF sy-subrc <> 0.
      MESSAGE '해당 항공사의 항공편이 존재하지 않습니다.' TYPE 'E'.
    ENDIF.
  ENDIF.
ENDMODULE.
```

</br>
</br>
</br>

---

</br>

## < AT EXIT-COMMAND >
- **`AT EXIT-COMMAND`** 은 무조건 **PAI** 에서만 구현
- `AT EXIT-COMMAND` 는 Screen 코드에서 맨 위에 두는 게 좋음
- PF-STATUS에서 Function Type = E(Exit) 로 정의된 커맨드만 대상으로 동작함
- 메시지 E로 화면 진행이 막힌 상태에서, 사용자가 “종료”를 선택했을 때 빠져나가기 위한 용도
</br>
</br>

**1) `Function Type` 설정**
- `EXIT` , `CANCEL` 일 때 `Function Type` 을 `E` 로 설정

<img width="669" height="331" alt="image" src="https://github.com/user-attachments/assets/b0aae6c7-d74c-49c6-887c-1824e4d1c110" />

</br>
</br>
</br>
</br>

**2) `PAI` 모듈 생성**
- Screen 코드에서 모듈 생성
```abap
PROCESS AFTER INPUT.
  MODULE <module_name> AT EXIT-COMMAND.
```
```abap
PROCESS AFTER INPUT.
  MODULE EXIT AT EXIT-COMMAND.
```
- 해당 PAI 모듈에서 코드 작성
```abap
MODULE exit INPUT.
  CASE OK_CODE.
    WHEN 'EXIT'.
      LEAVE PROGRAM. " 프로그램 종료
    WHEN 'CANCEL'.
      LEAVE TO SCREEN 0. " 스크린 종료
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>
</br>

**3) 결과 확인**
- `EXIT` , `CANCEL` 누르면 에러가 나도 빠져나올 수 있음 ( `BACK` 은 불가능 )

<img width="580" height="383" alt="image" src="https://github.com/user-attachments/assets/5c8e4e7b-c752-4f23-b7d2-928950bfda70" />
</br>
</br>
</br>
</br>

---

</br>

## < 종료(Function) 버튼 로직 >
- **🟢 Back (뒤로가기)**

  - 일반적인 화면 이동용 버튼
  - 이전 화면으로 돌아가며 프로그램은 종료되지 않음
- **🟡 Exit (노란색)**

  - 현재 프로그램을 완전히 종료
  - SAP Easy Access(초기 화면)로 이동
- **🔴 Cancel (빨간색)**
  
  - 오류 발생 등으로 진행이 불가능할 때 사용
  - 현재 처리를 취소하고 이전 상태로 복귀

<img width="550" height="377" alt="image" src="https://github.com/user-attachments/assets/1b0e6a46-aec0-4a37-b379-d4190f733c21" />
</br>
</br>
</br>
</br>
</br>

### < `Back` 예제 - POPUP 팝업 >
</br>

**1) `TOP` 모듈 생성**
```abap
PROGRAM SAPMZB03005.

" TABLES에는 직접적으로 Table 이름 넣는것보단
" 필요한 필드 구성하여 만든 Structure 이름 넣는게 좋음.
" => 지금은 테스트용으로..
TABLES: SCARR, SDYN_CONN.
DATA: OK_CODE TYPE sy-ucomm.

" 신호등 결과 값으로 '1', '2', 'A' 를 받을 변수
DATA: gv_answer TYPE C.
```
</br>

**2) `PAI` 모듈 생성**

<img width="598" height="304" alt="image" src="https://github.com/user-attachments/assets/4a27c9a0-3465-4118-a1f0-72829a58743b" />
</br>
</br>

```abap
MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      CALL FUNCTION 'POPUP_TO_CONFIRM'
        EXPORTING
          titlebar =  'Information'
          text_question               = 'Are you sure?'
        IMPORTING
          ANSWER                      = gv_answer
        EXCEPTIONS
          TEXT_NOT_FOUND              = 1
          OTHERS                      = 2.

      IF sy-subrc <> 0.
        MESSAGE '오류 발생' TYPE 'E'.
      ELSE.
        IF gv_answer = 1.
          LEAVE TO SCREEN 0.
        ENDIF.
      ENDIF.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**3) 결과 확인**
- `BACK` 누르면 팝업이 뜸

<img width="611" height="294" alt="image" src="https://github.com/user-attachments/assets/c1948e66-7c1b-4390-a450-c088b3697217" />
</br>
</br>
</br>
</br>
</br>

---

</br>

## < 추가적인 기능 >

</br>

- **`PAI` 에 있는 모듈들은 순차적으로 실행됨**
<img width="525" height="363" alt="image" src="https://github.com/user-attachments/assets/fb5f10f3-4de3-41cc-884e-4ea875403676" />
</br>
</br>
</br>
</br>

### `SWITCH` ( TCODE : `SFW5` ) 기반 MODULE 호출
- SWITCH는 스위치가 ON일 때만 MODULE을 실행하는 제어 장치
- PAI에서 조건부로 로직을 활성/비활성하기 위해 사용
```abap
PROCESS AFTER INPUT.
  MODULE <module_name> SWITCH <switch_name>.
```
```abap
PROCESS AFTER INPUT.
  MODULE add_check SWITCH sw_bc410.
```
- `PAI` 모듈 코드
```abap
MODULE add_check INPUT.
  CASE ok_code.
    WHEN 'ADD_FUNCTION'.
      " 기능 처리
  ENDCASE.
ENDMODULE.
```
</br>
</br>

### `SET / GET PARAMETER`
- 서로 다른 프로그램/화면 간에 입력값을 공유하기 위한 기능
- Data Element에 설정된 Parameter ID를 키로 사용
- 한 프로그램에서 SET으로 저장한 값을 다른 프로그램에서 GET으로 불러옴

<img width="433" height="330" alt="image" src="https://github.com/user-attachments/assets/2092cfa6-8af8-403b-b2e8-4b55492a8c7d" />
</br>
</br>
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1
</br>

- 문제
  
<img width="445" height="225" alt="image" src="https://github.com/user-attachments/assets/64038eae-eb24-46ab-9a1f-a283a997be7c" />
</br>
</br>
</br>

**1) `Layout` 설정**

<img width="282" height="256" alt="image" src="https://github.com/user-attachments/assets/752bef5c-f436-4598-8335-657595f20b67" />
</br>
</br>

**2) `Screen` 코드에서 모듈 생성 ( PAI, PBO )**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE CLEAR_OK_CODE.
*
PROCESS AFTER INPUT.
 MODULE EXIT AT EXIT-COMMAND.
 CHAIN.
  FIELD: SDYN_BOOK-CARRID, SDYN_BOOK-CONNID, SDYN_BOOK-FLDATE,
SDYN_BOOK-BOOKID.
  MODULE CHECK_INPUTS ON CHAIN-REQUEST.
 ENDCHAIN.
 MODULE USER_COMMAND_0100.
```
</br>


**3) `TOP` 모듈 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE CLEAR_OK_CODE.
*
PROCESS AFTER INPUT.
 MODULE EXIT AT EXIT-COMMAND.
 CHAIN.
  FIELD: SDYN_BOOK-CARRID, SDYN_BOOK-CONNID, SDYN_BOOK-FLDATE, SDYN_BOOK-BOOKID.
  MODULE CHECK_INPUTS ON CHAIN-REQUEST.
 ENDCHAIN.
 MODULE USER_COMMAND_0100.
```
</br>

**4) `PAI` 모듈 생성**
```abap
MODULE check_inputs INPUT.
  IF SDYN_BOOK-CARRID IS NOT INITIAL AND
     SDYN_BOOK-CONNID IS NOT INITIAL AND
     SDYN_BOOK-FLDATE IS NOT INITIAL AND
     SDYN_BOOK-BOOKID IS NOT INITIAL.
    SELECT SINGLE CANCELLED FROM SBOOK
      INTO gv_cancelled
      WHERE carrid = SDYN_BOOK-CARRID
        AND connid = SDYN_BOOK-CONNID
        AND fldate = SDYN_BOOK-FLDATE
        AND bookid = SDYN_BOOK-BOOKID.
    SELECT SINGLE carrid connid fldate bookid CUSTOMID CUSTTYPE FROM SBOOK
      INTO CORRESPONDING FIELDS OF gs_data
      WHERE carrid = SDYN_BOOK-CARRID
        AND connid = SDYN_BOOK-CONNID
        AND fldate = SDYN_BOOK-FLDATE
        AND bookid = SDYN_BOOK-BOOKID.

    IF gv_cancelled = 'X'.
      MESSAGE '항공편 예약이 취소된 건 입니다.' TYPE 'E'.
    ENDIF.
  ENDIF.
ENDMODULE.

*----------------------------------------------------------------------*

MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*----------------------------------------------------------------------*

MODULE EXIT INPUT.
  CASE OK_CODE.
    WHEN 'EXIT'.
      LEAVE PROGRAM.
    WHEN 'CANCEL'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**5) `PBO` 모듈 생성**

<img width="536" height="186" alt="image" src="https://github.com/user-attachments/assets/d8623302-5ef3-45b0-b053-ce9d166d5cc1" />
</br>
</br>

```abap
MODULE status_0100 OUTPUT.
  SET PF-STATUS 'S100'.
  MOVE-CORRESPONDING gs_data TO SDYN_BOOK.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR: OK_CODE.
ENDMODULE.
```
</br>

**6) 결과 확인**
- CANCELLED 가 `X` 일 때

<img width="289" height="258" alt="image" src="https://github.com/user-attachments/assets/ad495b9a-3564-4de0-80be-5a8bed2ddd53" />
</br>
</br>

- CANCELLED 가 `X` 가 아닐 때

<img width="280" height="257" alt="image" src="https://github.com/user-attachments/assets/f31a0317-f737-4867-8f4d-b54428c2f1e5" />
</br>
</br>
</br>
</br>
</br>

### 실습 2
</br>

- 문제
  
<img width="382" height="229" alt="image" src="https://github.com/user-attachments/assets/ec99c30b-7f0b-4501-9ac8-3cbe00bae763" />
</br>
</br>
</br>

- **위 문제 코드에서 `PAI` 코드 수정**
```abap
MODULE check_inputs INPUT.
  IF SDYN_BOOK-CARRID IS NOT INITIAL AND
     SDYN_BOOK-CONNID IS NOT INITIAL AND
     SDYN_BOOK-FLDATE IS NOT INITIAL AND
     SDYN_BOOK-BOOKID IS NOT INITIAL.
    SELECT SINGLE CANCELLED FROM SBOOK
      INTO gv_cancelled
      WHERE carrid = SDYN_BOOK-CARRID
        AND connid = SDYN_BOOK-CONNID
        AND fldate = SDYN_BOOK-FLDATE
        AND bookid = SDYN_BOOK-BOOKID.
    SELECT SINGLE carrid connid fldate bookid CUSTOMID CUSTTYPE FROM SBOOK
      INTO CORRESPONDING FIELDS OF gs_data
      WHERE carrid = SDYN_BOOK-CARRID
        AND connid = SDYN_BOOK-CONNID
        AND fldate = SDYN_BOOK-FLDATE
        AND bookid = SDYN_BOOK-BOOKID.

    IF gv_cancelled = 'X'.
      MESSAGE '항공편 예약이 취소된 건 입니다.' TYPE 'E'.
    ENDIF.
  ELSE.
    IF SDYN_BOOK-CARRID IS INITIAL.
      SET CURSOR FIELD 'SDYN_BOOK-CARRID'.
    ELSEIF SDYN_BOOK-CONNID IS INITIAL.
      SET CURSOR FIELD 'SDYN_BOOK-CONNID'.
    ELSEIF SDYN_BOOK-FLDATE IS INITIAL.
      SET CURSOR FIELD 'SDYN_BOOK-FLDATE'.
    ELSEIF SDYN_BOOK-BOOKID IS INITIAL.
      SET CURSOR FIELD 'SDYN_BOOK-BOKKID'.
    ENDIF.
    MESSAGE '1개 이상의 필드가 비워져 있습니다.' TYPE 'E'.
  ENDIF.
ENDMODULE.

*----------------------------------------------------------------------*

MODULE EXIT INPUT.
  CASE OK_CODE.
    WHEN 'EXIT'.
      MESSAGE '정말 이동하시겠습니까?' TYPE 'I'.
      LEAVE PROGRAM.
    WHEN 'CANCEL'.
      MESSAGE '정말 이동하시겠습니까?' TYPE 'I'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

- **결과 확인**

- 빈칸에 커서가 옮겨짐
<img width="319" height="268" alt="image" src="https://github.com/user-attachments/assets/dc38a9cd-5fac-4423-89b8-519d2a896335" />
</br>
</br>

- 나가면 창이 띄워짐
  
<img width="439" height="134" alt="image" src="https://github.com/user-attachments/assets/be90aad3-8164-45d5-9dc7-a11a2e4153fe" />

</br>
</br>


# 12/18

</br>
</br>
## <  핵심 개념 >
</br>

- **1) `CALL SUBSCREEN`**
- **2) Tabstrip (Tab Page) - 로컬 스크롤링**
- **3) Tabstrip (Tab Page) - PAI 스크롤링**
- **`ACTIVETAB`** 은 무조건 **`PBO`** 에서 해야 함
- **`ACTIVETAB`** 값 = 탭의 **`Function Code`**

</br>

- **`LEAVE TO SCREEN 0`** 같은 화면 전환 명령은 **`PAI`** 에서만
- **`SCREEN-INPUT`** 같은 화면 속성 변경은 **`PBO`** 에서만
- 사용자 입력 기반 SELECT는 **`PAI`** , 조회 결과 화면 반영/속성 변경은 **`PBO`**
- **OK_CODE 초기화** 코드 꼭 넣어줘야 함 ( 보통 **`PBO`** 에서 )
- **`OK_CODE`** 케이스문은 **`PAI`** 에서
- LOOP AT SCREEN 사용시 **`MODIFY SCREEN`** 넣기
- **`FIELD / CHAIN`** 은 무조건 **PAI** 에서만 구현
- **`AT EXIT-COMMAND`** 은 무조건 **PAI** 에서만 구현
- **`AT EXIT-COMMAND`** 는 Screen 코드에서 **맨 위** 에 두는 게 좋음
- **서로 다른 스크린의 버튼** 은 같은 MODULE에서 처리하면 **안됨**
- **즉시 반응** = **`Function Code`** 필수
- **버튼** → **`Function Code`** 만 OK_CODE로 옴
- **라디오·체크** → 보통 **`Name`** 값(X)으로 판단 ( `Function Code` 지정 필수 )
- **`ACTIVETAB`** 은 무조건 **`PBO`** 에서 해야 함
- **`ACTIVETAB`** 값 = 탭의 **`Function Code`**

</br>
</br>

---

</br>

## < 서브스크린 (Subscreen) >
- 메인 화면에 `Subscreen Area` (예약 영역) 를 미리 정의
- 실행 시 다른 Screen( `Subscreen` )을 해당 영역에 채워 넣음
- 메인 화면은 유지되며 부분 화면을 재사용·동적으로 교체 가능
- 서브스크린은 영역 1개당 1개만 표시되며, 영역을 여러 개 만들면 여러 개를 동시에 띄울 수 있음
</br>

### < Subscreen 제약사항 정리 >
- LOOP 문 내부 사용 불가
  - `LOOP AT SCREEN` , `LOOP AT itab` 등 반복문 안에서 `CALL SUBSCREEN` 사용 ❌
- CHAIN … ENDCHAIN 내부 사용 불가
- OK Code 필드 가질 수 없음
- 스크린 번호(Screen No.)는 유니크해야 함
- 화면 제어 명령 사용 불가
  - 타이틀, 메뉴, 버튼은 메인 스크린에서만 설정
</br>
</br>

### < `CALL SUBSCREEN` >
- `CALL SUBSCREEN` 은 화면 전환이 아님
- 메인 스크린 안의 `Subscreen Area` 에 다른 Screen을 포함시키는 동작
- 메인 스크린의 흐름(PBO/PAI) 안에서 서브스크린의 PBO/PAI도 함께 실행됨
- 시스템변수 `SY-CPROG` = 현재 호출된(실행 중인) ABAP 프로그램명
</br>

- PBO에서 사용 (서브스크린 지정)
- `INCLUDING` 은 PBO에서만 사용
```abap
CALL SUBSCREEN <subscreen_area>
  INCLUDING <program> <dynpro>.
```
- PAI에서 사용 (입력 처리)
```abap
CALL SUBSCREEN <subscreen_area>.
```
```abap
PROCESS BEFORE OUTPUT.
  CALL SUBSCREEN sub1
    INCLUDING SY-CPROG '0101'.

PROCESS AFTER INPUT.
  CALL SUBSCREEN sub1.
```
</br>
</br>

### < `CALL SUBSCREEN` 예제 >
</br>

**1) 메인 스크린 Layout에 `Subscreen Area` 정의**

<img width="381" height="338" alt="image" src="https://github.com/user-attachments/assets/6c0e373f-b0d1-4018-ad6f-f1ca417b747d" />

</br>
</br>

<img width="407" height="334" alt="image" src="https://github.com/user-attachments/assets/9f55763e-9639-4ce3-82f5-2a5951dfa53e" />
</br>
</br>

- 스크린 생성 시 `Dynpro Type` 을 `Subscreen` 으로 설정
<img width="480" height="314" alt="image" src="https://github.com/user-attachments/assets/642f35c6-806b-4b9a-b02e-38530152fa33" />

</br>
</br>
</br>

**2) Screen 100 에서 모듈 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE set_subscreen.
 MODULE CLEAR_OK_CODE.

  " SUB 라는 이름의 서브스크린 공간에 서브스크린을 세팅함
  " sy-cprog : 현재 프로그램 이름
  " gv_dynnr : TOP에 추가한 변수이며 '0110' 과 같은 서브스크린 번호가 들어감
  CALL SUBSCREEN SUB
  INCLUDING SY-CPROG gv_dynnr.

PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
   CALL SUBSCREEN SUB.
```
</br>

**3) `TOP` 모듈 생성**
```abap
PROGRAM SAPMZB03006.

DATA: OK_CODE TYPE sy-ucomm.
DATA: RAD1 TYPE C,
      RAD2 TYPE C,
      RAD3 TYPE C VALUE 'X'.
DATA: gv_dynnr TYPE sy-dynnr.
```
</br>

**4) `PAI` 모듈 생성**
```abap
MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN 'EXIT' OR 'CANCEL'.
      LEAVE PROGRAM.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**5) `PBO` 모듈 생성**
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100' WITH sy-uname.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE set_subscreen OUTPUT.
  CASE 'X'.
    WHEN RAD1.
      gv_dynnr = '0110'.
    WHEN RAD2.
      gv_dynnr = '0120'.
    WHEN RAD3.
      gv_dynnr = '0130'.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR OK_CODE.
ENDMODULE.
```
</br>
</br>
</br>

---

</br>

## < Tabstrip (Tab Page) >
- `Tabstrip` = 여러 화면을 탭으로 전환하는 컨트롤
- 탭 제목 = Pushbutton
- 탭 내용 = Subscreen Area + Subscreen Screen
- 실제 데이터/화면 로직은 Subscreen에서 처리
  
</br>

### < Tabstrip(Tab Page) 스크롤링 방식 >
**1) 로컬 스크롤링**
- Tab Page마다 Subscreen Area 각각 보유
- 구조 단순, 탭별 화면·데이터 완전 분리
- Function Type = `P`
  
**2) PAI 스크롤링**
- Tab Page 여러 개 + Subscreen Area 1개 재사용
- 탭 선택 시 PAI에서 서브스크린 교체
- Function Type = 공백(` `)
</br>

- `TOP` 모듈 (컨트롤 선언)
```abap
CONTROLS : <탭스트립명> TYPE TABSTRIP.
```
```abap
CONTROLS: TAB_STRIP TYPE TABSTRIP.
```
- `Screen` 코드 (서브스크린 호출)
```abap
CALL SUBSCREEN <Area명> INCLUDING <프로그램> <스크린번호>.
```
```abap
CALL SUBSCREEN REFSUB1 INCLUDING sy-cprog '110'.
CALL SUBSCREEN REFSUB2 INCLUDING sy-cprog '120'.
CALL SUBSCREEN REFSUB3 INCLUDING sy-cprog '130'.
```
</br>
</br>
</br>
</br>

### 1) 로컬 스크롤링
</br>

**1) Layout에서 tabstrip 생성**

<img width="526" height="352" alt="image" src="https://github.com/user-attachments/assets/7fbe02c8-0a59-4855-822b-31e6b4fb23a1" />
</br>
</br>

- `Tap Title` 로 TAP 개수 정할 수 있음
  
<img width="527" height="325" alt="image" src="https://github.com/user-attachments/assets/e29e8f16-1056-4783-a1d0-64f7c68e703f" />
</br>
</br>
</br>

**2) Layout에서 `FctCode` 와 `FctType` 설정**
- `FctType` 은 **`P`** 로 설정
  
<img width="553" height="325" alt="image" src="https://github.com/user-attachments/assets/1fa73db5-aa96-4b1d-911d-72dbeb5ebb59" />
</br>
</br>
</br>

**3) Layout에서 Tab 안에 Subscreen 넣기**
-  Subscreen area를 추가
-  추가하면 REF 자동으로 할당됨


<img width="553" height="306" alt="image" src="https://github.com/user-attachments/assets/f7dec350-de01-4a2c-84e2-85cbe1543b08" />

</br>
</br>
</br>

**4) `TOP` 모듈 생성**
```abap
PROGRAM SAPMZB03006.

DATA: OK_CODE TYPE sy-ucomm.
DATA: RAD1 TYPE C,
      RAD2 TYPE C,
      RAD3 TYPE C VALUE 'X',
      CHK1 TYPE C,
      CHK2 TYPE C VALUE 'X'.

CONTROLS: TAB_STRIP TYPE TABSTRIP.
```
</br>

**5) `Screen` 에서 모듈 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE set_subscreen.
 MODULE CLEAR_OK_CODE.

" TAB_STRIP 로컬 스크롤링 버전
  CALL SUBSCREEN REFSUB1 INCLUDING sy-cprog '110'.
  CALL SUBSCREEN REFSUB2 INCLUDING sy-cprog '120'.
  CALL SUBSCREEN REFSUB3 INCLUDING sy-cprog '130'.

PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.

" TAB_STRIP 로컬 스크롤링 버전
   CALL SUBSCREEN REFSUB1.
   CALL SUBSCREEN REFSUB2.
   CALL SUBSCREEN REFSUB3.
```
</br>
</br>
</br>
</br>
</br>

### 2) PAI 스크롤링
- `TAB_STRIP-activetab` : 현재 선택된 Tab Page를 저장하는 필드
- `activetab` = 현재 활성화된 탭의 Function Code ( 설정해야 탭 서브스크린에 그려짐 )
</br>

**1) Layout에서 `FctCode` 을 None으로 지정**

<img width="543" height="318" alt="image" src="https://github.com/user-attachments/assets/d875863d-8584-4761-be6e-8483bbf82461" />
</br>
</br>
</br>

**2) 첫 번째 Tab에만 Subscreen 넣기 / 나머지 Tab `Ref` 설정하기**

<img width="547" height="305" alt="image" src="https://github.com/user-attachments/assets/a93ceb3f-b07d-4ef1-a087-9ecfda083457" />
</br>
</br>
</br>

**3) `TOP` 모듈 생성**
```abap
PROGRAM SAPMZB03006.

DATA: OK_CODE TYPE sy-ucomm.
DATA: RAD1 TYPE C,
      RAD2 TYPE C,
      RAD3 TYPE C VALUE 'X',
      CHK1 TYPE C,
      CHK2 TYPE C VALUE 'X'.
DATA: gv_dynnr TYPE sy-dynnr,
      gv_tabdynnr TYPE sy-dynnr.

CONTROLS: TAB_STRIP TYPE TABSTRIP.
```

</br>

**4) `Screen` 에서 모듈 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE set_subscreen.
 MODULE CLEAR_OK_CODE.
   MODULE set_tabstrip.

   " TAP_STRIP PAI 스크롤링 버전
   CALL SUBSCREEN REFSUB1 INCLUDING sy-cprog gv_tabdynnr.

PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.

  " TAP_STRIP PAI 스크롤링 버전
   CALL SUBSCREEN REFSUB1.
```
</br>

**5) `PAI` 모듈 수정**
```abap
MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN 'EXIT' OR 'CANCEL'.
      LEAVE PROGRAM.
    WHEN '200BUTTON'.
      LEAVE TO SCREEN 200.
    " activetab 속성에 들어가는 값은 Function Code여야 함
    WHEN 'TABFC1' OR 'TABFC2' OR 'TABFC3'.
      tab_strip-activetab = OK_CODE. " 펑션코드 그대로 넣어주면 됨
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**6) `PBO` 모듈 수정**
```abap
MODULE set_tabstrip OUTPUT.
  CASE TAB_STRIP-activetab.
    WHEN 'TABFC1'.
      gv_tabdynnr = '0110'.
    WHEN 'TABFC2'.
      gv_tabdynnr = '0120'.
    WHEN 'TABFC3'.
      gv_tabdynnr = '0130'.
    WHEN OTHERS.
      gv_tabdynnr = '0110'.
      tab_strip-activetab = 'TABFC1'.
  ENDCASE.
ENDMODULE.
```
</br>
</br>
</br>

---

</br>

## < 추가적인 개념 >
</br>

### < 펑션그룹을 활용한 서브스크린 데이터 공유 >
- 서브스크린은 `Function Group` 안에 정의 가능
- 같은 Function Group의 글로벌 데이터(전역변수)를 서브스크린에서 직접 사용 가능
- PBO/PAI에서 `Function Module` 호출로 데이터 EXPORT / IMPORT 가능
</br>
</br>
</br>

### < Maintenance View 에서 TCODE 생성 >
**1) SCARR 테이블 복사해서 새 테이블 만들기**

<img width="407" height="298" alt="image" src="https://github.com/user-attachments/assets/216741b5-5d23-4bd5-b1e4-ac7a49400ff7" />

</br>
</br>

**2) Maintenance View 설정**

<img width="430" height="382" alt="image" src="https://github.com/user-attachments/assets/17be6231-9dc9-4ecd-923c-134dd9d1320e" />

</br>
</br>

<img width="556" height="246" alt="image" src="https://github.com/user-attachments/assets/042332ac-3efb-4e8a-9c56-822f726ad6f4" />
</br>
</br>

**3) Maintenance View `TCODE` 생성**

- `Transaction with parameters` 선택

<img width="465" height="291" alt="image" src="https://github.com/user-attachments/assets/53e1c5af-a876-4adc-94de-8d272dc65fe8" />
</br>
</br>

- `UPDATE = 'X'` → 변경/저장 가능
- `UPDATE 비어 있음` → 조회(Display) 모드
  
<img width="401" height="463" alt="image" src="https://github.com/user-attachments/assets/29ecfcce-9a90-4b5f-9771-679496e1e7ca" />

</br>
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1
</br>

- 문제
  
<img width="391" height="234" alt="image" src="https://github.com/user-attachments/assets/972bf0b6-b73c-4140-a8a4-20be7ba81441" />
</br>
</br>
</br>
</br>

**1) 200 Screen Layout 생성**
- 체크 박스 즉시 반응 시키려면 `Function code` 무조건 설정해야 함

<img width="458" height="309" alt="image" src="https://github.com/user-attachments/assets/4022d7d7-b302-46cf-84e8-c7aba5e35552" />
</br>
</br>
</br>
</br>

**2) Screen 코드 수정 및 생성**
- 100 Screen 코드 생성
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE set_subscreen.
 MODULE CLEAR_OK_CODE.

  " SUB 라는 이름의 서브스크린 공간에 서브스크린을 세팅함
  " sy-cprog : 현재 프로그램 이름
  " gv_dynnr : TOP에 추가한 변수이며 '0110' 과 같은 서브스크린 번호가 들어감
  CALL SUBSCREEN SUB
  INCLUDING SY-CPROG gv_dynnr.

PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0100.
   CALL SUBSCREEN SUB.
```
- 200 Screen 코드 생성
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0200.
 MODULE set_subscreen2.
 MODULE CLEAR_OK_CODE.
   CALL SUBSCREEN SUB2
   INCLUDING sy-cprog gv_dynnr.
*
PROCESS AFTER INPUT.
 MODULE USER_COMMAND_0200.
   CALL SUBSCREEN SUB2.
```
</br>
</br>

**3) `TOP` 모듈 수정**
```abap
PROGRAM SAPMZB03006.

DATA: OK_CODE TYPE sy-ucomm.
DATA: RAD1 TYPE C,
      RAD2 TYPE C,
      RAD3 TYPE C VALUE 'X',
      CHK1 TYPE C,
      CHK2 TYPE C VALUE 'X'.
DATA: gv_dynnr TYPE sy-dynnr.
```
</br>
</br>

**4) `PAI` 모듈 수정**
```abap
MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN 'EXIT' OR 'CANCEL'.
      LEAVE PROGRAM.
    WHEN '200BUTTON'.
      LEAVE TO SCREEN 200.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE user_command_0200 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN 'EXIT' OR 'CANCEL'.
      LEAVE PROGRAM.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>
</br>

**5) `PBO` 모듈 수정**
```abap
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
 SET TITLEBAR 'T100' WITH sy-uname.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE set_subscreen OUTPUT.
  CASE 'X'.
    WHEN RAD1.
      gv_dynnr = '0110'.
    WHEN RAD2.
      gv_dynnr = '0120'.
    WHEN RAD3.
      gv_dynnr = '0130'.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE set_subscreen2 OUTPUT.
  IF CHK1 = 'X' AND CHK2 = 'X'.
    MESSAGE '입력값이 2개 입니다.' TYPE 'E' DISPLAY LIKE 'I'.
  ELSE.
    CASE 'X'.
      WHEN CHK1.
        gv_dynnr = '0140'.
      WHEN CHK2.
        gv_dynnr = '0150'.
      WHEN OTHERS.
    ENDCASE.
  ENDIF.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR OK_CODE.
ENDMODULE.
```
</br>
</br>

**6) 결과 확인**
- 체크에 따라 서브스크린이 달라짐
  
<img width="469" height="270" alt="image" src="https://github.com/user-attachments/assets/4175ec54-93b6-46f5-b8be-3f8e85984167" />
</br>
</br>
</br>
</br>
</br>

### 실습 2
- 기존 프로그램 코드에서 서브스크린 추가
</br>

**1) 각 스크린의 `Layout` 지정**
- Screen 100
  
<img width="621" height="367" alt="image" src="https://github.com/user-attachments/assets/f16219aa-d986-4b18-95bd-53da8499413d" />
</br>
</br>

- Screen 110
  
<img width="241" height="186" alt="image" src="https://github.com/user-attachments/assets/a401a937-5697-4e15-8a56-c75ec40e87e0" />

</br>
</br>

- Screen 120
  
<img width="227" height="116" alt="image" src="https://github.com/user-attachments/assets/9a03cf31-a18e-43ba-ae37-a353d44bb8eb" />
</br>
</br>

- Screen 130

<img width="176" height="139" alt="image" src="https://github.com/user-attachments/assets/6211cda0-42b1-4b2a-9c0e-fb3f029dec3e" />
</br>
</br>
</br>
</br>

**2) `Screen 100` 에서의 모듈 생성**
```abap
PROCESS BEFORE OUTPUT.
 MODULE STATUS_0100.
 MODULE set_subscreen.
   CALL SUBSCREEN SUB
   INCLUDING sy-cprog gv_tabdynnr.
 MODULE CLEAR_OK_CODE.

PROCESS AFTER INPUT.
  MODULE CHECK_SFLIGHT.
  MODULE USER_COMMAND_0100.
    CALL SUBSCREEN SUB.
```
</br>
</br>

**3) `TOP` 모듈 수정**
```abap
PROGRAM SAPMZBC410_SOLUTION_03_01.

TABLES: SDYN_CONN, SPFLI, SCARR, SBOOK.

DATA: exit_button TYPE C,
      OK_CODE TYPE SY-UCOMM,
      gs_data TYPE SDYN_CONN,
      gv_subrc TYPE sy-subrc,
      gv_button TYPE I.

DATA: VIEW TYPE C VALUE 'X',
      MAINTAIN_FLIGHTS TYPE C,
      MAINTAIN_BOOKINGS TYPE C,
      gv_title TYPE I VALUE 1,
      gv_tabdynnr TYPE sy-dynnr.

CONTROLS: MY_TABSTRIP TYPE TABSTRIP.

DATA: gs_spfli TYPE spfli,
      gs_scarr TYPE scarr,
      gs_sbook TYPE sbook.
```
</br>
</br>

**4) 100 Screen `PAI` 모듈 수정**
- CASE문에서는 `OR` 절만 가능
```abap
MODULE user_command_0100 INPUT.

  IF exit_button = 'X'.
    LEAVE TO SCREEN 0.
  ELSEIF exit_button = 'T'.
    CALL SCREEN 150
    STARTING AT 5 5
    ENDING AT 50 10.
    CLEAR: exit_button.
  ENDIF.

ENDMODULE.

*----------------------------------------------------------------------*

MODULE check_sflight INPUT.

  CASE OK_CODE.
    WHEN 'FC1' OR 'FC2' OR 'FC3'.
      MY_TABSTRIP-activetab = OK_CODE.
    WHEN 'MODE'.
      CASE 'X'.
        WHEN VIEW.
          gv_title = 1.
        WHEN MAINTAIN_FLIGHTS.
          gv_title = 2.
        WHEN MAINTAIN_BOOKINGS.
          gv_title = 3.
        WHEN OTHERS.
      ENDCASE.
    WHEN 'PUSH'.
      gv_button = 1.

      SELECT SINGLE * FROM sflight
        INTO CORRESPONDING FIELDS OF gs_data
        WHERE carrid = SDYN_CONN-carrid
          AND connid = SDYN_CONN-connid
          AND fldate = SDYN_CONN-fldate.

      SELECT SINGLE * FROM spfli
        INTO CORRESPONDING FIELDS OF gs_spfli
        WHERE carrid = SDYN_CONN-carrid
          AND connid = SDYN_CONN-connid.

      SELECT SINGLE * FROM scarr
        INTO CORRESPONDING FIELDS OF gs_scarr
        WHERE carrid = SDYN_CONN-carrid.

      SELECT SINGLE * FROM sbook
        INTO CORRESPONDING FIELDS OF gs_sbook
        WHERE carrid = SDYN_CONN-carrid
          AND connid = SDYN_CONN-connid
          AND fldate = SDYN_CONN-fldate.

      IF sy-subrc <> 0.
        gv_subrc = 4.
        message text-007 TYPE 'I'.
      ENDIF.
    WHEN OTHERS.
  ENDCASE.

ENDMODULE.

*----------------------------------------------------------------------*

MODULE user_command_0150 INPUT.
  IF OK_CODE = 'BTN01'.
    LEAVE TO SCREEN 0.
  ENDIF.
ENDMODULE.
```
</br>
</br>

**5) 100 Screen `PBO` 모듈 수정**
```abap
MODULE status_0100 OUTPUT.

  SET PF-STATUS 'S100'.

  IF gv_title = 1.
    SET TITLEBAR 'T100' WITH 'View'.
  ELSEIF gv_title = 2.
    SET TITLEBAR 'T100' WITH 'Maintain flights'.
    LOOP AT SCREEN.
      IF screen-name = 'SDYN_CONN-PLANETYPE'.
        screen-input = 1.
      ENDIF.
      MODIFY SCREEN.
    ENDLOOP.
  ELSEIF gv_title = 3.
    SET TITLEBAR 'T100' WITH 'Maintain bookings'.
  ENDIF.

  IF gv_button = 1.
    IF gv_subrc <> 0.
      CLEAR SDYN_CONN.
      gv_subrc = 0.
    ELSE.
      MOVE-CORRESPONDING gs_data TO SDYN_CONN.
    ENDIF.
  ELSE.
    gv_button = 0.
  ENDIF.

ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0150 OUTPUT.
 SET PF-STATUS 'S150'.
 SET TITLEBAR 'xxx'.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE clear_ok_code OUTPUT.
  CLEAR: OK_CODE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE set_subscreen OUTPUT.
  CASE MY_TABSTRIP-activetab.
    WHEN 'FC1'.
      gv_tabdynnr = '0110'.
    WHEN 'FC2'.
      gv_tabdynnr = '0120'.
    WHEN 'FC3'.
      gv_tabdynnr = '0130'.
    WHEN OTHERS.
      gv_tabdynnr = '0110'.
      MY_TABSTRIP-activetab = 'FC1'.
  ENDCASE.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0110 OUTPUT.
  MOVE-CORRESPONDING gs_spfli TO SPFLI.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0120 OUTPUT.
  MOVE-CORRESPONDING gs_scarr TO SCARR.
ENDMODULE.

*&---------------------------------------------------------------------*

MODULE status_0130 OUTPUT.
  MOVE-CORRESPONDING gs_sbook TO SBOOK.
ENDMODULE.
```
</br>
</br>

**6) 결과 확인**
- 아래 서브스크린에도 데이터가 뜸

<img width="538" height="341" alt="image" src="https://github.com/user-attachments/assets/2c183bbf-c0dc-49f1-b516-5a79827d846c" />

</br>
</br>


# 12/19
</br>
</br>

## <  핵심 개념 >
</br>

- **1) Search Help (F4 도움말) 설정하기**

</br>

- **`LEAVE TO SCREEN 0`** 같은 화면 전환 명령은 **`PAI`** 에서만
- **`SCREEN-INPUT`** 같은 화면 속성 변경은 **`PBO`** 에서만
- 사용자 입력 기반 SELECT는 **`PAI`** , 조회 결과 화면 반영/속성 변경은 **`PBO`**
- **OK_CODE 초기화** 코드 꼭 넣어줘야 함 ( 보통 **`PBO`** 에서 )
- **`OK_CODE`** 케이스문은 **`PAI`** 에서
- LOOP AT SCREEN 사용시 **`MODIFY SCREEN`** 넣기
- **`FIELD / CHAIN`** 은 무조건 **PAI** 에서만 구현
- **`AT EXIT-COMMAND`** 은 무조건 **PAI** 에서만 구현
- **`AT EXIT-COMMAND`** 는 Screen 코드에서 **맨 위** 에 두는 게 좋음
- **서로 다른 스크린의 버튼** 은 같은 MODULE에서 처리하면 **안됨**
- **즉시 반응** = **`Function Code`** 필수
- **버튼** → **`Function Code`** 만 OK_CODE로 옴
- **라디오·체크** → 보통 **`Name`** 값(X)으로 판단 ( `Function Code` 지정 필수 )
- **`ACTIVETAB`** 은 무조건 **`PBO`** 에서 해야 함
- **`ACTIVETAB`** 값 = 탭의 **`Function Code`**

</br>
</br>

---

</br>

## < Search Help (F4 도움말) >
- F4 Help / Input Help / Value Help / Possible Entry 전부 같은 의미
- 입력 필드 옆 버튼 클릭 시 유효한 값 목록 조회
- 테이블/뷰 기반 + 조건(제한) 걸어서 조회 가능
</br>
</br>

### < Dialog Behavior >
- 조회 전에 조건 입력(Restriction) 다이얼로그 표시 가능
- 조건 입력 → 조회 결과 목록(히트 리스트) 표시
</br>
</br>

### < Search Help 연결 >
- **Dictionary(테이블/구조 필드)** 에 Search Help 연결 → 화면에서 자동 F4 제공 (권장)
- 연결 가능 위치
  - Data Element / Table 필드 / Structure 필드 / Check Table
  - Domain에는 F4(Search Help) 직접 연결 ❌
- Screen Painter에서 직접 연결도 가능하지만 비추천
</br>

- Structure 안의 개별 필드에 Search Help 연결
<img width="597" height="196" alt="image" src="https://github.com/user-attachments/assets/2d59e5d9-6cbb-4ac6-9026-fee832da0165" />
</br>

<img width="594" height="318" alt="image" src="https://github.com/user-attachments/assets/a1976759-8f11-4f58-b03f-5f7a8870530a" />

</br>

- DB Table 안의 개별 필드에 Search Help 연결
  
<img width="562" height="322" alt="image" src="https://github.com/user-attachments/assets/4b7047c7-d893-4475-8cc4-953dba163f14" />
</br>

- Screen 에 Search Help 연결
  
<img width="364" height="328" alt="image" src="https://github.com/user-attachments/assets/798d500a-9a0f-4ca8-b2e8-100fd585897c" />
</br>

- Data element 에 Search Help 연결
<img width="587" height="432" alt="image" src="https://github.com/user-attachments/assets/2d1b75a3-476b-43a1-ac62-79d8f7ebe75f" />
</br>
</br>
</br>
</br>

### < Input Help(F4) 적용 우선순위 >

- **1) Program(화면)**
  - 화면 필드 직접 지정 (최우선)

- **2) Dictionary – Table / Structure 필드**
  - 필드에 Search Help 연결

- **3) Check Table(FK)**
  - Check Table → 텍스트 → 키값

- **4) Data Element**
  - Data Element에 연결된 Search Help

- **5) Domain**
  - Fixed Values 목록

- **6) 날짜/시간**
  - Calendar / Clock 자동 제공

<img width="464" height="296" alt="image" src="https://github.com/user-attachments/assets/f88d9d3c-8fa0-4471-9044-e2f60e0a5e1b" />
</br>
</br>
</br>
</br>

### < Search Help 생성 예제 >
**1) Search Help 생성**
  
- `Selection Method`
    
  - Table 또는 View 지정
  - F4 조회 시 데이터를 가져오는 대상
- `Dialog Type`

  - `System-dependent` : 데이터 양에 따라 시스템이 자동 판단. 바로 결과 or 조건 화면 중 선택.
  - `Display values immediately` : 조건 없이 즉시 조회 결과 출력.
  - `Display restriction dialog` : 조회 조건 입력 화면 먼저 출력.
- `Parameter` 설정

  - Search Help에서 사용하는 필드 정의
  - `IMP` : 화면 값 → Search Help로 전달 (조회 조건)
  - `EXP` : Search Help 선택 값 → 화면으로 반환
  - `LPOS (List Position)` → 결과 리스트에 표시되는 순서
  - `SPOS (Selection Position)` → 조회조건(Restriction) 화면에 표시되는 순서
</br>

<img width="329" height="104" alt="image" src="https://github.com/user-attachments/assets/cccc53b0-5bed-4eea-94ec-20e24ed826c0" />
</br>

<img width="577" height="344" alt="image" src="https://github.com/user-attachments/assets/1cf7d842-4c95-41c2-b602-7922949e575a" />

</br>
</br>
</br>
</br>

**2) DB Table에 Search Help 설정**
- 원하는 필드 선택 후에 `Search Help` 버튼 클릭

<img width="592" height="201" alt="image" src="https://github.com/user-attachments/assets/ea73a953-873d-47b1-a836-b49a1ff16ee3" />
</br>
</br>

<img width="410" height="98" alt="image" src="https://github.com/user-attachments/assets/0f15a1ea-c88b-4c70-9ce4-e14b830ee483" />
</br>
</br>

<img width="391" height="266" alt="image" src="https://github.com/user-attachments/assets/88907ec1-4d5c-4214-a709-281ee8b12ad0" />
</br>
</br>

- 설정된 것을 확인
<img width="593" height="191" alt="image" src="https://github.com/user-attachments/assets/af75078c-a3d8-41da-8317-fd39b3ee03a3" />
</br>
</br>
</br>
</br>

**3) Search Help 에서 제안 기능 활성화 가능**
- `Enhanced Options` : 입력하면서 자동으로 추천·검색을 도와주는 기능
  
<img width="597" height="338" alt="image" src="https://github.com/user-attachments/assets/5f5e7db7-3009-4ad0-af0b-9573ea0972cc" />

</br>
</br>

<img width="417" height="238" alt="image" src="https://github.com/user-attachments/assets/de6386ef-a61f-45d1-a742-e565fa3ebd3e" />

