## <  핵심 개념 >
</br>

- **1) ㅁ**
</br>

- **C01에서 더블클릭 이벤트 발생해도 자동으로 PAI/PBO 안 탐**
- **더블클릭 이후 로직은 기본적으로 C01에서만 처리**
</br>
</br>

---

</br>

## < ALV Docking Container >
</br>

### 1) Docking Container 기반 ALV 화면 구성

- `Docking Container` : 선택화면을 유지한 채 화면 가장자리에 ALV를 고정 표시하기 위한 컨테이너
- `side` : 도킹 위치 (TOP / BOTTOM / LEFT / RIGHT)
- `extension` : 도킹 영역 크기
- Docking Container 사용 시 → 별도의 AREA(스크린 영역) 필요 없음.

```abap
*************** TOP ****************
DATA: <DOCKING_CONTAINER> TYPE REF TO cl_gui_docking_container,
      <ALV_GRID>          TYPE REF TO cl_gui_alv_grid.

DATA: <ITAB> TYPE TABLE OF <DDIC_STRUCTURE>.

*************** Docking Container ****************
IF <DOCKING_CONTAINER> IS INITIAL.
  CREATE OBJECT <DOCKING_CONTAINER>
    EXPORTING
      side      = <DOCK_POSITION>
      extension = <SIZE>
      repid     = <PROGRAM_ID>
      dynnr     = <SCREEN_NO>.

  CREATE OBJECT <ALV_GRID>
    EXPORTING
      i_parent = <DOCKING_CONTAINER>.
ENDIF.

*************** Docking ALV 최초 출력 ****************
CALL METHOD <ALV_GRID>->set_table_for_first_display
  EXPORTING
    i_structure_name = <DDIC_STRUCTURE>
  CHANGING
    it_outtab        = <ITAB>.
```
- `UP TO <ROW_COUNT> ROWS` : 조회 결과 중 최대 N건까지만 내부테이블에 담음 (성능/미리보기용)
```abap
SELECT *
  FROM <DB_TABLE>
  INTO TABLE <ITAB>
  UP TO <ROW_COUNT> ROWS
  WHERE <CONDITION>.
```
```abap
*************** TOP ****************
PARAMETERS: pa_car TYPE s_carr_id DEFAULT 'AA'.

DATA: go_docking TYPE REF TO cl_gui_docking_container,
      go_alv TYPE REF TO cl_gui_alv_grid.
DATA: gt_data TYPE TABLE OF sflight.

*************** E01 ****************
AT SELECTION-SCREEN OUTPUT.
  IF go_docking IS INITIAL.
    SELECT * FROM sflight INTO TABLE gt_data
      UP TO 20 ROWS
      WHERE carrid = pa_car.

    CHECK sy-subrc = 0. " 참이면 아래 로직 실행
    " Docking Container 생성
    CREATE OBJECT go_docking
      EXPORTING
        side      = cl_gui_docking_container=>dock_at_bottom
        extension = 300
        repid     = sy-repid
        dynnr     = sy-dynnr.
    " Docking Container에 ALV 생성
    CREATE OBJECT go_alv EXPORTING i_parent = go_docking.

    CALL METHOD go_alv->set_table_for_first_display
      EXPORTING
        i_structure_name              = 'SFLIGHT'
      CHANGING
        it_outtab                     = gt_data
      EXCEPTIONS
        invalid_parameter_combination = 1
        program_error                 = 2
        too_many_lines                = 3
        others                        = 4.
    IF sy-subrc <> 0.
      MESSAGE '데이터 조회 중 오류 발생' TYPE 'E'.
    ENDIF.
  ENDIF.

START-OF-SELECTION.
  SELECT * FROM sflight INTO TABLE gt_data
    UP TO 20 ROWS
    WHERE carrid = pa_car.

  IF sy-subrc = 0.
    CALL METHOD go_alv->refresh_table_display
      EXCEPTIONS
        finished       = 1
        others         = 2.
    IF sy-subrc <> 0.
      MESSAGE 'Refresh 작업 중 오류 발생' TYPE 'E'.
    ENDIF.
  ENDIF.
```
</br>
</br>
</br>

### 2) Splitter Container 기반 다중 ALV 구성
- 하나의 화면(또는 Docking 영역)을 여러 영역으로 나눠, 각 영역에 서로 다른 ALV를 동시에 보여주기 위해 사용
- `cl_gui_splitter_container` : 하나의 컨테이너를 행·열로 분할해 여러 영역을 동시에 사용할 수 있게 해주는 컨테이너 클래스
- `->get_container` : Splitter로 나뉜 특정 행·열 위치의 하위 컨테이너를 가져오는 메서드
```abap
*************** TOP ****************
DATA: <DOCKING_CONTAINER>  TYPE REF TO cl_gui_docking_container,
      <SPLITTER_CONTAINER> TYPE REF TO cl_gui_splitter_container,
      <LEFT_CONTAINER>     TYPE REF TO cl_gui_container,
      <RIGHT_CONTAINER>    TYPE REF TO cl_gui_container,
      <ALV_LEFT>           TYPE REF TO cl_gui_alv_grid,
      <ALV_RIGHT>          TYPE REF TO cl_gui_alv_grid.

*************** Splitter Container ****************
CREATE OBJECT <SPLITTER_CONTAINER>
  EXPORTING
    parent  = <PARENT_CONTAINER>
    rows    = <ROW_COUNT>
    columns = <COLUMN_COUNT>.

*************** Split 영역 Container 획득 ****************
CALL METHOD <SPLITTER_CONTAINER>->get_container      " 왼쪽
  EXPORTING
    row    = <ROW_NO>
    column = <COL_NO_LEFT>
  RECEIVING
    container = <LEFT_CONTAINER>.
CALL METHOD <SPLITTER_CONTAINER>->get_container      " 오른쪽
  EXPORTING
    row    = <ROW_NO>
    column = <COL_NO_RIGHT>
  RECEIVING
    container = <RIGHT_CONTAINER>.

*************** Split 영역에 ALV 생성 ****************
CREATE OBJECT <ALV_LEFT>      " 왼쪽
  EXPORTING
    i_parent = <LEFT_CONTAINER>.
CREATE OBJECT <ALV_RIGHT>      " 오른쪾
  EXPORTING
    i_parent = <RIGHT_CONTAINER>.
```
```abap
*************** TOP ****************
DATA: go_docking TYPE REF TO cl_gui_docking_container,
      go_splitter TYPE REF TO cl_gui_splitter_container,
      go_cont_l   TYPE REF TO cl_gui_container,
      go_cont_r   TYPE REF TO cl_gui_container,
      go_alv_l    TYPE REF TO cl_gui_alv_grid,
      go_alv_r    TYPE REF TO cl_gui_alv_grid.

*************** Splitter Container ****************
CREATE OBJECT go_splitter            " Container 영역 분할 (1행 2열로)
EXPORTING parent  = go_docking
        rows    = 1
        columns = 2.

*************** Split 영역 Container 획득 ****************
CALL METHOD go_splitter->get_container      " 왼쪽 영역 컨테이너
EXPORTING row    = 1
          column = 1
RECEIVING container = go_cont_l.
CALL METHOD go_splitter->get_container      " 오른쪽 영역 컨테이너
EXPORTING row    = 1
          column = 2
RECEIVING container = go_cont_r.

*************** Split 영역에 ALV 생성 ****************
CREATE OBJECT go_alv_l
EXPORTING i_parent = go_cont_l.
CREATE OBJECT go_alv_r
EXPORTING i_parent = go_cont_r.
```
</br>
</br>
</br>

---

</br>

## < SUBMIT 호출 방식 >
- 다른 프로그램 실행만 하고 자동으로 돌아오지 않음
```abap
SUBMIT prog_name_2.
```
- 다른 프로그램 실행 후 끝나면 원래 프로그램으로 돌아옴
```abap
SUBMIT prog_name_2 AND RETURN.
```
- 실행 전 조회조건 화면을 보여주고, 끝나면 원래 프로그램으로 돌아옴
```abap
SUBMIT prog_name_2 VIA SELECTION-SCREEN AND RETURN.
```
</br>
</br>

## < 트랜잭션 호출 방식 >
- 현재 프로그램 종료 후 트랜잭션으로 이동 (복귀 ❌)
```abap
LEAVE TO TRANSACTION 'T_CODE'
```
- 트랜잭션 실행 후 종료 시 원래 프로그램으로 복귀 ⭕
```abap
CALL TRANSACTION 'T_CODE'
```
</br>
</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1
</br>

- 문제
<img width="356" height="196" alt="image" src="https://github.com/user-attachments/assets/4888e9dc-6d7b-43c1-ac54-52f8f3c76a29" />
</br>
</br>
</br>
</br>

**1) Report 프로그램에서 모듈 생성**
```abap
REPORT ZPROGB03_0031.

INCLUDE ZPROGB03_0031_TOP.
INCLUDE ZPROGB03_0031_O01.
INCLUDE ZPROGB03_0031_I01.
INCLUDE ZPROGB03_0031_F01.

START-OF-SELECTION.
  PERFORM get_data.
  CALL SCREEN 100.
```
</br>

**2) `TOP` 모듈 생성**
```abap
*&---------------------------------------------------------------------*
*& Include          ZPROGB03_0031_TOP
*&---------------------------------------------------------------------*

DATA: OK_CODE TYPE sy-ucomm,
      go_dock TYPE REF TO cl_gui_docking_container,
      go_alv TYPE REF TO cl_gui_alv_grid.
DATA: gt_sflight TYPE TABLE OF sflight.

PARAMETERS: pa_car TYPE sflight-carrid DEFAULT 'AZ'.
```
</br>

**3) `PBO` 및 `F01` 모듈 생성**
```abap
*************** F01 ****************
FORM get_data.
  SELECT * FROM SFLIGHT
    INTO TABLE gt_sflight
    UP TO 30 ROWS
    WHERE carrid = pa_car.
ENDFORM.

*************** PBO ****************
MODULE status_0100 OUTPUT.
 SET PF-STATUS 'S100'.
ENDMODULE.

MODULE init_alv OUTPUT.
  IF go_dock IS INITIAL.
    CREATE OBJECT go_dock
      EXPORTING
        repid                       = sy-repid
        dynnr                       = sy-dynnr
        side                        = cl_gui_docking_container=>dock_at_bottom
        extension                   = 300.

    CREATE OBJECT go_alv
      EXPORTING
        i_parent          = go_dock.

    CALL METHOD go_alv->set_table_for_first_display
      EXPORTING
        i_structure_name              = 'SFLIGHT'
      CHANGING
        it_outtab                     = gt_sflight
      EXCEPTIONS
        invalid_parameter_combination = 1
        program_error                 = 2
        too_many_lines                = 3
        others                        = 4.
    IF sy-subrc <> 0.
      MESSAGE '데이터 조회 중 오류 발생' TYPE 'E'.
    ENDIF.
  ELSE.
    IF sy-subrc = 0.
      CALL METHOD go_alv->refresh_table_display
        EXCEPTIONS
          finished       = 1
          others         = 2.
      IF sy-subrc <> 0.
        MESSAGE 'Refresh 작업 중 오류 발생' TYPE 'E'.
      ENDIF.
    ENDIF.
  ENDIF.
ENDMODULE.
```
</br>

**4) `PAI` 모듈 생성**
```abap
*&---------------------------------------------------------------------*
*& Include          ZPROGB03_0031_I01
*&---------------------------------------------------------------------*

MODULE exit INPUT.
  CASE OK_CODE.
    WHEN 'EXIT'.
      LEAVE PROGRAM.
    WHEN 'CANCEL'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.

*----------------------------------------------------------------------*

MODULE user_command_0100 INPUT.
  CASE OK_CODE.
    WHEN 'BACK'.
      LEAVE TO SCREEN 0.
    WHEN OTHERS.
  ENDCASE.
ENDMODULE.
```
</br>

**5) 결과 확인**

<img width="284" height="96" alt="image" src="https://github.com/user-attachments/assets/386d3fff-0177-4a29-b0ea-08e209effe26" />
</br>

<img width="454" height="258" alt="image" src="https://github.com/user-attachments/assets/2aa8ec00-46bf-4df0-b667-80620cbd6164" />
</br>
</br>
</br>
</br>
</br>
</br>

### 실습 2
</br>

- 문제
<img width="330" height="183" alt="image" src="https://github.com/user-attachments/assets/254b894d-5b6d-443b-8bf2-5ab47bb16ce7" />

</br>
</br>
</br>

**1) Report 프로그램에서 모듈 수정**
```abap
REPORT ZPROGB03_0031.

INCLUDE ZPROGB03_0031_TOP.
INCLUDE ZPROGB03_0031_C01.
INCLUDE ZPROGB03_0031_O01.
INCLUDE ZPROGB03_0031_I01.
INCLUDE ZPROGB03_0031_F01.

START-OF-SELECTION.
  PERFORM get_data2.
  CALL SCREEN 100.
```
</br>

**2) `TOP` 모듈 수정**
```abap
*&---------------------------------------------------------------------*
*& Include          ZPROGB03_0031_TOP
*&---------------------------------------------------------------------*

DATA: OK_CODE TYPE sy-ucomm,
      go_dock TYPE REF TO cl_gui_docking_container,
      go_splitter TYPE REF TO cl_gui_splitter_container,
      go_cont_l TYPE REF TO cl_gui_container,
      go_cont_r TYPE REF TO cl_gui_container,
      go_alv_l TYPE REF TO cl_gui_alv_grid,
      go_alv_r TYPE REF TO cl_gui_alv_grid.
```
</br>

**3) `F01` 모듈 수정**
```abap
*&---------------------------------------------------------------------*
*& Include          ZPROGB03_0031_F01
*&---------------------------------------------------------------------*

*************** SFLIGHT 데이터ㅗ ****************
FORM get_data.
  READ TABLE gt_spfli INTO gs_spfli INDEX gv_index.

  SELECT * FROM SFLIGHT
    INTO TABLE gt_sflight
    UP TO 30 ROWS
    WHERE carrid = gs_spfli-carrid
      AND connid = gs_spfli-connid.
ENDFORM.

*************** SPFLI 데이터 ****************
FORM get_data2.
  SELECT * FROM SPFLI
    INTO TABLE gt_spfli
    UP TO 30 ROWS
    WHERE carrid = pa_car.
ENDFORM.

*************** REFRESH ****************
FORM set_refresh.
  CALL METHOD go_alv_r->refresh_table_display
    EXCEPTIONS
      finished       = 1
      others         = 2.
  IF sy-subrc <> 0.
    MESSAGE 'Refresh 작업 중 오류 발생' TYPE 'E'.
  ENDIF.
ENDFORM.
```
</br>

**4) `C01` 모듈 생성**
```abap
*&---------------------------------------------------------------------*
*& Include          ZPROGB03_0031_C01
*&---------------------------------------------------------------------*

CLASS lcl_event_handler DEFINITION.
  PUBLIC SECTION.
  CLASS-METHODS: ON_DOUBLE_CLICK
    FOR EVENT DOUBLE_CLICK OF CL_GUI_ALV_GRID
    IMPORTING ES_ROW_NO SENDER.
ENDCLASS.

CLASS lcl_event_handler IMPLEMENTATION.
  METHOD ON_DOUBLE_CLICK.
    IF SENDER = GO_ALV_L.
      gv_index = ES_ROW_NO-row_id.
      PERFORM get_data.
      PERFORM set_refresh.
    ENDIF.
  ENDMETHOD.
ENDCLASS.
```
</br>

**5) `PBO` 모듈 수정**
```abap
*&---------------------------------------------------------------------*
*& Include          ZPROGB03_0031_O01
*&---------------------------------------------------------------------*

MODULE init_alv OUTPUT.
  IF go_dock IS INITIAL.

*************** Docking Container 생성 ****************
    CREATE OBJECT go_dock
      EXPORTING
        repid                       = sy-repid
        dynnr                       = sy-dynnr
        side                        = cl_gui_docking_container=>dock_at_bottom
        extension                   = 300.

*************** Splitter 생성 (1행 2열) ****************
    CREATE OBJECT go_splitter
    EXPORTING parent = go_dock
              rows = 1
              columns = 2.

*************** Split 영역 Container 획득 ****************
    CALL METHOD go_splitter->get_container
    EXPORTING row = 1
              column = 1
    RECEIVING container = go_cont_l.
    CALL METHOD go_splitter->get_container
    EXPORTING row = 1
              column = 2
    RECEIVING container = go_cont_r.

*************** Split 영역에 ALV 생성 ****************
    CREATE OBJECT go_alv_l
    EXPORTING i_parent = go_cont_l.
    CREATE OBJECT go_alv_r
    EXPORTING i_parent = go_cont_r.

*************** 데이터 조회 ****************
    SET HANDLER lcl_event_handler=>on_double_click FOR go_alv_l.

    CALL METHOD go_alv_r->set_table_for_first_display
      EXPORTING
        i_structure_name              = 'SFLIGHT'
      CHANGING
        it_outtab                     = gt_sflight
      EXCEPTIONS
        invalid_parameter_combination = 1
        program_error                 = 2
        too_many_lines                = 3
        others                        = 4.
    IF sy-subrc <> 0.
      MESSAGE '데이터 조회 중 오류 발생' TYPE 'E'.
    ENDIF.

    PERFORM get_data.
    CALL METHOD go_alv_l->set_table_for_first_display
      EXPORTING
        i_structure_name              = 'SPFLI'
      CHANGING
        it_outtab                     = gt_spfli
      EXCEPTIONS
        invalid_parameter_combination = 1
        program_error                 = 2
        too_many_lines                = 3
        others                        = 4.
    IF sy-subrc <> 0.
      MESSAGE '데이터 조회 중 오류 발생' TYPE 'E'.
    ENDIF.
  ENDIF.
ENDMODULE.
```
</br>

**6) 결과 확인**

- 더블클릭 시 데이터 출력
<img width="535" height="240" alt="image" src="https://github.com/user-attachments/assets/0faf79a3-c470-4a4f-9e7a-d27efd122f58" />

</br>
</br>
</br>
</br>
</br>
</br>
