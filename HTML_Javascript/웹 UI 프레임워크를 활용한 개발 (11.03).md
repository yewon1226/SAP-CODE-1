# 11/03 ê¸°ë¡
### í´ë¼ì´ì–¸íŠ¸ vs ì„œë²„ ëª¨ë¸
1) Client (Local) Model
   - JSONModelì„ ì‚¬ìš©
   - ë¡œì»¬ ë°ì´í„°(ì´ë¯¸ ê°€ì§€ê³  ìˆëŠ” ë°ì´í„°)ë¥¼ í™”ë©´ê³¼ ì—°ê²°í•  ë•Œ ì‚¬ìš©

2) Server Model
   - ODataModel V2ë¥¼ ì‚¬ìš©
   - ì„œë²„ì— ìˆëŠ” ë°ì´í„°ë¥¼ OData ì„œë¹„ìŠ¤ë¡œ ìš”ì²­í•˜ê³ , ì‘ë‹µì„ í™”ë©´ì— ë°”ì¸ë”©í•  ë•Œ ì‚¬ìš©
</br>

### OData ì„œë¹„ìŠ¤ í™œìš©
- ìƒ˜í”Œ Northwind ì„œë¹„ìŠ¤ì™€ ì—°ê²°í•˜ì—¬ í”„ë¡œê·¸ë¨ ìƒì„± ê°€ëŠ¥
- ì—°ê²° ì‹œ OData Modelì´ ìë™ ìƒì„±ë¨
- ì´ë¦„ ì—†ì´ `ê¸°ë³¸ ëª¨ë¸(Default Model)`ë¡œ ì„¤ì •
- ëª¨ë¸ ì„¤ì • ì •ë³´ëŠ” `manifest.json`ì— ê¸°ë¡ë¨
</br>

### ğŸŒ OData ê¸°ë³¸ ê°œë… ì •ë¦¬

| ìš©ì–´ | ì˜ë¯¸ | ì˜ˆì‹œ |
|------|------|------|
| **Entity Set** | ì—¬ëŸ¬ ê°œì˜ ë°ì´í„°ë¥¼ ëª¨ì•„ë‘” ë°ì´í„° ì§‘í•© (ì¦‰, í•˜ë‚˜ì˜ í…Œì´ë¸”) | ì˜ˆ: **Orders** í…Œì´ë¸” |
| **Entity** | Entity Set ì•ˆì— ë“¤ì–´ ìˆëŠ” í•œ ì¤„ì˜ ë°ì´í„° (ë ˆì½”ë“œ) | ì˜ˆ: ì£¼ë¬¸ë²ˆí˜¸ê°€ 1001ì¸ ì£¼ë¬¸ ë°ì´í„° |
| **Property** | Entity ì•ˆì— í¬í•¨ëœ ê°ê°ì˜ í•„ë“œ (ì—´, ì†ì„±) | ì˜ˆ: OrderID, CustomerName, OrderDate |
| **Entity Type** | Entityì˜ ì „ì²´ êµ¬ì¡°ì™€ í•„ë“œ ì •ì˜ (ì„¤ê³„ë„, ìŠ¤í‚¤ë§ˆ) | ì˜ˆ: Orders í…Œì´ë¸”ì˜ í•„ë“œ êµ¬ì¡° ì •ì˜ |
</br>

### OData ìš”ì²­ ì˜ˆì‹œ
```bash
https://port8081-workspaces-ws-kzwp3.us10.trial.applicationstudio.cloud.sap/northwind/northwind.svc/Customers?$format=json&$filter=CustomerID eq 'ALFKI'
```
- ì„œë²„(Northwind ì„œë¹„ìŠ¤)ì— CustomerIDê°€ 'ALFKI'ì¸ ê³ ê° ë°ì´í„°ë¥¼ ìš”ì²­í•¨
- ì‘ë‹µ(Response)ì€ JSON í˜•ì‹ìœ¼ë¡œ ë°›ìŒ
</br>

### ë°ì´í„° ì²˜ë¦¬ ë°©ì‹
1) ë¡œì»¬(Local) ë°ì´í„°
   - ì´ë¯¸ ê°€ì§€ê³  ìˆëŠ” ë°ì´í„°ëŠ” `.getData()` ë˜ëŠ” `.getProperty()`ë¡œ ì ‘ê·¼í•˜ì—¬ ì‚¬ìš©

   
2) ì„œë²„(Server) ë°ì´í„°
   - í•„ìš”í•œ ë°ì´í„°ë¥¼ ìš”ì²­(Request) í•´ì„œ ì‘ë‹µ(Response) ìœ¼ë¡œ ë°›ìŒ
   - ë°›ì€ ë°ì´í„°ëŠ” JSON í˜•ì‹ì´ë©°, ì´ë¥¼ JSONModel ì— ë‹´ì•„ í™œìš©í•  ìˆ˜ ìˆìŒ
   - ëª¨ë¸ì— ë°ì´í„°ë¥¼ ë„£ê±°ë‚˜ ìˆ˜ì •í•  ë•ŒëŠ” setData() ë˜ëŠ” setProperty()ë¥¼ ì‚¬ìš©í•¨
</br>

### DynamicPage êµ¬ì„±
- `<DynamicPage>`ì˜ `<content>` ì˜ì—­ì—ëŠ” í•˜ë‚˜ì˜ ì»¨í…ì¸ ë§Œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆìŒ
- ì—¬ëŸ¬ UI ìš”ì†Œ(Button, Table ë“±)ë¥¼ í•¨ê»˜ ë„£ê³  ì‹¶ë‹¤ë©´ `<VBox>`ë¡œ ê°ì‹¸ì„œ í•˜ë‚˜ì˜ ì»¨í…ì¸ ë¡œ êµ¬ì„±í•´ì•¼ í•¨
</br>
</br>

### getOwnerComponent()
- ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì†í•œ ì•±(Component)ì„ ê°€ì ¸ì˜´.
- getView()ëŠ” í˜„ì¬ ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ë·°, getOwnerComponent()ëŠ” ì•± ì „ì²´ë¥¼ ê°€ì ¸ì˜´
```java
let oModel = this.getOwnerComponent().getModel(); // ê¸°ë³¸ OData ëª¨ë¸ ê°€ì ¸ì˜¤ê¸°
```
</br>

### oModel.read()
- OData ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ì¡°íšŒ(read)í•¨
- ë‹¨ ê±´ ì¡°íšŒ: í•˜ë‚˜ì˜ ë ˆì½”ë“œ ì¡°íšŒ ì‹œ `oReturn`ì— ë°”ë¡œ ê°ì²´ë¡œ ë°ì´í„°ê°€ ë“¤ì–´ì˜´.
- ë‹¤ ê±´ ì¡°íšŒ: ì—¬ëŸ¬ ë ˆì½”ë“œ ì¡°íšŒ ì‹œ `oReturn.results` ë°°ì—´ ì•ˆì— ê°ì²´ë“¤ì´ ë“¤ì–´ ìˆìŒ.
```java
oModel.read("EntitySet", {
    filters: [oFilter],            // ì¡°ê±´
    urlParameters: { "$expand": "Relation" }, // ê´€ë ¨ ë°ì´í„° í™•ì¥
    success: function(oData) {},   // ì¡°íšŒ ì„±ê³µ ì‹œ ì‹¤í–‰
    error: function(oError) {}     // ì¡°íšŒ ì‹¤íŒ¨ ì‹œ ì‹¤í–‰
});
```
</br>

### oModel.createKey(sPath, oParameters);
- OData ì—”í‹°í‹°ì˜ ê³ ìœ  ê²½ë¡œ(Key Path)ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
- `sPath` : ì—”í‹°í‹° ì„¸íŠ¸ ì´ë¦„
- `oParameters` : ì—”í‹°í‹° í‚¤(Primary Key) ì´ë¦„ê³¼ ê°’ì˜ ìŒ
```java
oModel.createKey(sPath, oParameters);
```
- ë‹¨ì¼ í‚¤
```java
var oModel = this.getView().getModel();

var sKeyPath = oModel.createKey("/Products", {
   ProductID: 1
});

console.log(sKeyPath);
// ì¶œë ¥: "/Products(ProductID=1)"
```
- ë³µí•© í‚¤
```java
var sKeyPath = oModel.createKey("/SalesOrderItems", {
   SalesOrderID: "SO123",
   ItemPosition: "10"
});

console.log(sKeyPath);
// ì¶œë ¥: "/SalesOrderItems(SalesOrderID='SO123',ItemPosition='10')"
```
</br>

```java
let oLocalModel = this.getView().getModel("local");
let oModel = this.getOwnerComponent().getModel();   // OData Model. ì´ë¦„ì—†ëŠ” ê¸°ë³¸ëª¨ë¸
let oFilter = new Filter({
    path : "ProductID",
    operator : "BT",
    value1 : 10,
    value2 : 20
});

oModel.createKey("/Products", {
   OrderID : "1",
   ProductID : "2"
});
// sPath => "Order_Details(OrderID=1, ProductID=2)"

// .create() ìƒì„± .read() ì¡°íšŒ .update() ì—…ë°ì´íŠ¸ .remove() ì‚­ì œ 
// oModel.read("ê²½ë¡œ", {});
oModel.read("/Products", {            // oModel.read("/Products(${ë³€ìˆ˜})" => íŠ¹ì • ì—”í‹°í‹°(ë°ì´í„° í•œ ê±´)ë¥¼ ì½ê¸°
    urlParameters: {
        "$expand" : "Supplier"
    },
    filters: [oFilter],
    // sorters: [],
    success: function(oReturn) {
        // ë‹¨ ê±´ ì¡°íšŒ : oReturn ìì²´ì— ë°ì´í„°ê°€ ë“¤ì–´ì˜´
        // ë‹¤ ê±´ ì¡°íšŒ : oReturn.results í•´ì„œ ë°°ì—´ ì ‘ê·¼

        // oLocalModel.setProperty("ê²½ë¡œ", ì„¸íŒ…í• ë°ì´í„°);
        let oData = [];
        for(let i=0; i<oReturn.results.length; i++) {
            let item = oReturn.results[i];
            oData.push({
                ProductID: item.ProductID,
                ProductName: item.ProductName,
                SupplierID: item.SupplierID,
                UnitsInStock: item.UnitsInStock
            });
        }
        oLocalModel.setProperty("/results", oData);
    },
    error: function() {}
});
```
</br>

### this ë¬¸ì œ í•´ê²° ë°©ë²• (SAPUI5 ë¹„ë™ê¸° í•¨ìˆ˜ ë‚´ë¶€)
- `success`, `error` ê°™ì€ ì½œë°± í•¨ìˆ˜ ì•ˆì—ì„œëŠ” `this`ê°€ Controllerë¥¼ ìƒì–´ë²„ë¦¼ â†’ í•´ê²° í•„ìš”
</br>

1) `.bind(this)` ì‚¬ìš©
```java
success: function(oReturn) {
    this.getView(); // ì •ìƒ ì‘ë™
}.bind(this);
```
2) `let that = this;` ì‚¬ìš©
```java
let that = this;
success: function(oReturn) {
    that.getView(); // thatìœ¼ë¡œ ì»¨íŠ¸ë¡¤ëŸ¬ ì ‘ê·¼
}
```
3) í•„ìš”í•œ ë³€ìˆ˜ ë¯¸ë¦¬ ì„ ì–¸
```java
let oView = this.getView();
success: function(oReturn) {
    oView.getModel().setData(...);
}
```
</br>

### OData URL
- ì „ì²´ ì—”í‹°í‹° ì¡°íšŒ: `/Products?$`
- íŠ¹ì • ì—”í‹°í‹° ì¡°íšŒ + JSON + í™•ì¥: `/Products(1)?$format=json&$expand=Supplier`
- ë³µí•© í‚¤ ì¡°íšŒ: `/EntitySet(key1=ê°’,key2=ê°’)`
- ë‹¨ì¼ í‚¤ ì¡°íšŒ: `/EntitySet(key1=ê°’)` ë˜ëŠ” `/EntitySet(ê°’)`
</br>

### ë·°(View)ì™€ ë¼ìš°í„°(Router)
- ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹œì‘ â†’ RootView (App.view.xml) ì‹¤í–‰
- ë¼ìš°í„° ì—­í•  â†’ URL ê´€ë¦¬, ê¸°ë³¸ URL â†’ Main.view.xml
- ë¼ìš°í„° êµ¬ì„±: config â†’ ë¼ìš°í„° ì •ì˜, routes â†’ ë¼ìš°í„° ê°ì²´ ìƒì„±, targets â†’ í™”ë©´ ì¶œë ¥ ìœ„ì¹˜ ì§€ì •
</br>

### ë¼ìš°í„° íŒŒë¼ë¯¸í„°
- URL í˜•ì‹: `"detail/{í•„ìˆ˜íŒŒë¼ë¯¸í„°}/:ì˜µì…˜íŒŒë¼ë¯¸í„°:"`
- ì£¼ì˜: ë¼ìš°í„°ë¥¼ 2ê°œ ì´ìƒ ë§Œë“¤ë©´ ì²« ë²ˆì§¸ ë¼ìš°í„°ë§Œ ì ìš©ë¨ â†’ ëª…í™•íˆ êµ¬ë¶„ í•„ìš”
</br>

### í™”ë©´ ì „í™˜ ì• ë‹ˆë©”ì´ì…˜
- ì§€ì› ì• ë‹ˆë©”ì´ì…˜: `slide`(ê¸°ë³¸), `flip`, `show`, `fade`
</br>
</br>

## < ë¼ìš°í„° ì„ ì–¸ >

### 1) manifest.json íŒŒì¼
- `manifest.json`ì—ì„œ ë¼ìš°í„°ëŠ” `sap.ui5.routing` ì•ˆì— ì„ ì–¸
- `config` â†’ ë¼ìš°í„° ê¸°ë³¸ ì„¤ì •
- `routes` â†’ URL íŒ¨í„´ê³¼ ë¼ìš°í„° ì´ë¦„
- `targets` â†’ ì–´ë–¤ ë·°(View)ë¥¼ ë³´ì—¬ì¤„ì§€ ì—°ê²°
```java
"sap.ui5": {
    "routing": {
        "config": { ... },
        "routes": [ ... ],
        "targets": { ... }
    }
}
```
- routes ì„ ì–¸ í˜•ì‹
- `name` â†’ navToì—ì„œ ì‚¬ìš©í•  ë¼ìš°í„° ì´ë¦„
- `pattern` â†’ ë¸Œë¼ìš°ì € URL ê²½ë¡œ
  - {param} â†’ í•„ìˆ˜ íŒŒë¼ë¯¸í„°
  - :param: â†’ ì„ íƒ íŒŒë¼ë¯¸í„°
- `target` â†’ ì—°ê²°í•  targets ID ë°°ì—´ (1ê°œ ì´ìƒ ê°€ëŠ¥)
```java
"routes": [
    {
        "name": "<ë¼ìš°í„° ì´ë¦„>",
        "pattern": "<URL íŒ¨í„´>",
        "target": ["<íƒ€ê²Ÿ ID>"]
    },
    ...
]
```

- targets ì„ ì–¸ í˜•ì‹
- `id` â†’ ë·°ì˜ ê³ ìœ  ID, í™”ë©´ ì „í™˜ ì‹œ ì°¸ì¡° ê°€ëŠ¥
- `name` â†’ ì‹¤ì œ XML ë·° íŒŒì¼ ì´ë¦„
```java
"targets": {
    "<íƒ€ê²Ÿ ID>": {
        "id": "<ë·° ì»¨íŠ¸ë¡¤ ID>",
        "name": "<ë·° íŒŒì¼ ì´ë¦„>"
    },
    ...
}
```
</br>

- `pattern: ""` â†’ ì•± ì‹¤í–‰ ì‹œ ê¸°ë³¸ìœ¼ë¡œ í‘œì‹œë  í™”ë©´
```java
"routing": {
   "config": {
     "routerClass": "sap.m.routing.Router",
     "controlAggregation": "pages",
     "controlId": "app",
     "transition": "slide",
     "type": "View",
     "viewType": "XML",
     "path": "ycl2project10.view",
     "async": true,
     "viewPath": "ycl2project10.view"
   },
   "routes": [
     {
       "name": "RouteMain",
       "pattern": "",
       "target": [
         "TargetMain"
       ]
     },
     {
       "name": "RouteDetail",
       "pattern": "detail/{param1}/:param2:",
       "target": [
         "TargetDetail"
       ]
     }
   ],
   "targets": {
     "TargetMain": {
       "id": "Main",
       "name": "Main"
     },
     "TargetDetail": {
       "id": "Detail",
       "name": "Detail"
     }
   }
 }
```
</br>

### 2) view.xml íŒŒì¼
- Main.view.xml íŒŒì¼
- showNavButton="true" â†’ ìƒë‹¨ ì™¼ìª½ì— ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í‘œì‹œ
- navButtonPress="onNavButtonPress" â†’ ë’¤ë¡œê°€ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ì‹¤í–‰ë  í•¨ìˆ˜ ì§€ì •
```html
<mvc:View controllerName="ycl2project10.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m">
    <Page id="page" showNavButton="true" navButtonPress="onNavButtonPress" title="{i18n>title}">
        <Text text="Main page" />
        <Button text="í™”ë©´ ì´ë™" press="onPress" />
    </Page>
</mvc:View>
```

- Detail.view.xml íŒŒì¼
```html
<mvc:View controllerName="ycl2project10.controller.Detail"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m">
    <Page id="page2" showNavButton="true" navButtonPress="onNavButtonPress" title="{i18n>title}">
        <Text id="idText" text="Detail page" />
    </Page>
</mvc:View>
```
</br>

### 3) controller.js íŒŒì¼
</br>

### getRouter()
- í˜„ì¬ Componentì—ì„œ ì‚¬ìš©í•˜ëŠ” Router ê°ì²´ ì „ì²´ë¥¼ ê°€ì ¸ì˜´
- Router ì „ì²´ë¥¼ ê°€ì ¸ì™€ì„œ `navTo`, `getRoute` ë“± ë©”ì„œë“œë¥¼ ì‚¬ìš© ê°€ëŠ¥
```java
let oRouter = this.getOwnerComponent().getRouter();
oRouter.navTo("RouteDetail", { param1: "hihi" });
```
</br>

### getRoute(routeName)
- Router ì•ˆì—ì„œ íŠ¹ì • Route ê°ì²´ í•˜ë‚˜ë¥¼ ê°€ì ¸ì˜´
- í•´ë‹¹ ë¼ìš°íŠ¸ì˜ URL íŒ¨í„´ ë§¤ì¹­ ì´ë²¤íŠ¸ ì²˜ë¦¬ ë“±
```java
let oRoute = this.getOwnerComponent().getRouter().getRoute("RouteDetail");
oRoute.attachPatternMatched(this._onMatched, this);
```
</br>

### navTo
- ë‹¤ë¥¸ í™”ë©´(Route)ìœ¼ë¡œ ì´ë™
```java
router.navTo(routeName, parameters?, replace?);
```
- `routeName`: ì´ë™í•  ë¼ìš°íŠ¸ ì´ë¦„
- `parameters`: URLì— ì „ë‹¬í•  íŒŒë¼ë¯¸í„° {param1: "ê°’", param2: "ê°’"}
- `replace`: true â†’ íˆìŠ¤í† ë¦¬ ì´ˆê¸°í™”, false â†’ ë’¤ë¡œê°€ê¸° ìœ ì§€
```java
let oRouter = this.getOwnerComponent().getRouter();
oRouter.navTo("RouteDetail", { param1: "hihi", param2: "okok" }, false);
```
- `/detail/hihi/okok` í™”ë©´ìœ¼ë¡œ ì´ë™, ë’¤ë¡œê°€ê¸° ê°€ëŠ¥

</br>

### attachPatternMatched
- URL íŒ¨í„´ê³¼ ì¼ì¹˜í•  ë•Œ íŠ¹ì • í•¨ìˆ˜ ì‹¤í–‰
- `onInit` â†’ ì»¨íŠ¸ë¡¤ëŸ¬ ìµœì´ˆ ìƒì„± ì‹œ 1ë²ˆ ì‹¤í–‰, `attachPatternMatched` â†’ URL íŒ¨í„´ ë§¤ì¹­ë  ë•Œë§ˆë‹¤ ì‹¤í–‰
```java
route.attachPatternMatched(handlerFunction, context?);
```
- `handlerFunction`: URLì´ íŒ¨í„´ê³¼ ë§ì„ ë•Œ ì‹¤í–‰í•  í•¨ìˆ˜
- `context`: í•¨ìˆ˜ ë‚´ë¶€ì—ì„œ this ë°”ì¸ë”©
```java
oRouter.getRoute("RouteDetail")
       .attachPatternMatched(this._onPatternMatched, this);

_onPatternMatched: function(oEvent) {
    let param1 = oEvent.getParameter("arguments").param1;
    this.byId("idText").setText(param1);
}
```
- `/detail/hihi`ë¡œ ì´ë™í•˜ë©´ `_onPatternMatched` ì‹¤í–‰, í™”ë©´ì— `"hihi"` í‘œì‹œ
