# 10/27 기록
### Grid
- 여러 UI 요소를 격자(그리드) 형태로 반응형 배치하는 레이아웃 컨트롤
```java
new sap.ui.layout.Grid({
  defaultSpan: "L6 M6 S12",
  content: [
    new sap.m.Label({ text: "이름" }),
    new sap.m.Input({ placeholder: "이름을 입력하세요" }),
    new sap.m.Label({ text: "이메일" }),
    new sap.m.Input({ placeholder: "example@email.com" })
  ]
});
```
</br>

### Label - Input
- Label은 필드 이름을 표시하고, Input은 사용자의 텍스트 입력을 받는 컨트롤
```java
new sap.m.Label({
  text: "사용자 ID",
  labelFor: "userInput"
});

new sap.m.Input({
  id: "userInput",
  placeholder: "ID를 입력하세요"
});
```
</br>

### Panel
- 관련된 콘텐츠를 하나의 접이식 영역으로 묶는 컨테이너
```java
new sap.m.Panel({
  headerText: "사용자 정보",
  expandable: true,
  expanded: true,
  content: [
    new sap.m.Label({ text: "이름" }),
    new sap.m.Input({ placeholder: "이름 입력" }),
    new sap.m.Label({ text: "직급" }),
    new sap.m.Input({ placeholder: "직급 입력" })
  ]
});
```
</br>

### ToolbarSpacer
- 툴바에서 버튼이나 아이콘을 가운데 또는 오른쪽으로 띄울 때 사용
```html
<Toolbar>
    <Button text="왼쪽"/>
    <ToolbarSpacer/>   <!-- 이 공간 때문에 다음 버튼이 오른쪽으로 밀림 -->
    <Button text="오른쪽"/>
</Toolbar>
```
</br>

### Page
- 앱의 하나의 화면 단위를 정의하는 컨테이너
- 상단에 홈 화면이라는 제목 표시, 뒤로가기 버튼 표시, 버튼 클릭 시 onNavBack 함수 실행
```html
<Page title="홈 화면" showNavButton="true" navButtonPress="onNavBack">
    <Text text="메인 컨텐츠"/>
</Page>
```
</br>

- border: 테두리
- padding: 내용물과 테두리 사이의 내부 여백
- margin: 다른 요소와의 외부 간격
</br>

### < 예제 1 >
- `class` : CSS 문법에서 스타일을 적용할 때 요소에 이름을 붙이는 속성
- `<ComboBox>` : 사용자가 입력하거나 목록에서 선택할 수 있는 드롭다운
- `<Select>` : 목록에서 항목만 선택할 수 있는 드롭다운
```html
<mvc:View controllerName="ycl2project03.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:l="sap.ui.layout"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <!-- <l:VerticalLayout class="sapUiContentPadding">   
            <Input value="input Value"/>
            <Text text="text" />
            <StepInput />
            <ComboBox ></ComboBox>     
            <Select />                  
            <DatePicker displayFormat="yyyy-MM-dd" />
            <DateRangeSelection />
            <Label text="label" />
        </l:VerticalLayout> -->

        <!-- sap.m.VBox 또는 sap.m.HBox로 대체 사용 가능 -->
        
        <!-- <l:HorizontalLayout >
            <Input value="input Value"/>
            <Text text="text" />
            <StepInput />
            <ComboBox ></ComboBox>      
            <Select />                  
            <DatePicker displayFormat="yyyy-MM-dd" />
            <DateRangeSelection />
            <Label text="label" />
        </l:HorizontalLayout> -->

    </Page>
</mvc:View>
```
</br>

### MessageToast
- 화면 하단에 잠깐 나타나는 간단 알림용 메시지
- 숫자도 자동으로 문자열로 변환되어 표시 → 별도 변환 불필요
```java
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/m/MessageToast"
], function(Controller, MessageToast) { ... });
```
```java
MessageToast.show("메시지 내용");
```
</br>

### MessageBox
- 팝업 형태로 표시되며 사용자 확인이 필요한 중요한 메시지
- 숫자나 객체는 문자열로 변환해서 전달해야 안전하게 표시 가능
```java
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/m/MessageBox"
], function(Controller, MessageBox) { ... });
```
```
MessageBox.show("메시지 내용");
```
</br>

### < 실습 1 >

### 1. Controller 코드
- Main.controller.js 파일
```java
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/m/MessageBox",
    "sap/m/MessageToast"
], (Controller, MessageBox, MessageToast) => {
    "use strict";

    return Controller.extend("ycl2project04.controller.Main", {
        onInit() {
        },
        onCalc: function() {
            // this.getView() 에서 .getView() 생략 가능! (버전업)
            //let oSelect = this.byId("idSelect");  oSelect = {bAllowTextSelection: true};
            let Number1 = Number(this.byId("idNumber1").getValue());
            let Number2 = Number(this.byId("idNumber2").getValue());

            let oSelect = this.byId("idselect").getSelectedItem().getKey();

            if(oSelect === "PLUS") {
                MessageBox.show(String(Number1+Number2));
                MessageToast.show(Number1+Number2);
            }
            else if(oSelect === "MINUS") {
                MessageBox.show(String(Number1-Number2));
                MessageToast.show(Number1-Number2);
            }
            else if(oSelect == "MULTIPL") {
                MessageBox.show(String(Number1*Number2));
                MessageToast.show(Number1*Number2);
            }
            else if(oSelect === "DIVIDE") {
                MessageBox.show(String(Number1/Number2));
                MessageToast.show(Number1/Number2);
            }

            //debugger;       
            // break-point 라고 부름. 로직 실행중 debugger를 만나면
            // 디버깅이 걸려서 해당 구간에서 멈춰서 진행사항을 확인할 수 있다 (=디버깅이 걸렸다고 표현)
            // debugger를 동작시키기 위해선 개발자도구(F12)가 켜진 상태여야함

        }
    });
});
```
</br>

### 2. View 코드
- Main.view.xml 파일
```java
<mvc:View controllerName="ycl2project04.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:core="sap.ui.core"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <FlexBox justifyContent="Center" alignItems="Center">
            <VBox width="30%" class="sapUiSmallMargin">
                <Input id="idNumber1" width="100%" />
                <Select id="idselect" width="100%" showSecondaryValues="true">
                    <items>
                        <core:ListItem key="PLUS" text="+" additionalText="PLUS"/>
                        <core:ListItem key="MINUS" text="-" additionalText="MINUS"/>
                        <core:ListItem key="MULTIPL" text="*" additionalText="MULTIPL"/>
                        <core:ListItem key="DIVIDE" text="/" additionalText="DIVIDE"/>
                    </items>
                </Select>
                <Input id="idNumber2" width="100%" />
                <Button text="계산하기" press="onCalc"
                        width="100%" type="Emphasized" />
            </VBox>
        </FlexBox>
    </Page>
</mvc:View>
```
</br>

### Fragment (조각 View)
- View 일부를 별도 파일로 분리해서 관리
- 장점: 재사용 가능, 유지보수 용이
```
<파일명1>.fragment.xml
<파일명2>.fragment.xml
<파일명3>.fragment.xml
```
- Fragment 로드 함수:
```java
this.loadFragment({ name: "sap.training.exc.view.Dialog" });
// 또는
sap.ui.core.Fragment.load({ name: "sap.training.exc.view.Dialog" });
```
</br>

### Dialog
- 사용자 입력이나 정보를 받는 팝업 창
- Fragment로 구현하면 재사용 가능
- Controller에서 this.pDialog에 저장 → 한 번만 생성, 계속 재사용 가능
- Dialog는 비동기 로딩되므로 로딩 완료 후에 open()을 호출하려면 반드시 then() 안에서 열어야 함
```java
anyControllerMethod: function() {
    if(!this.pDialog) {                        // dialog는 한 번만 로드(재사용)
        this.pDialog = this.loadFragment({
            name: "sap.training.exc.view.Dialog"
        });
    }
    this.pDialog.open(); // 팝업 열기
}
```
</br>

### Fragment 파일 위치
1. webapp/fragment 폴더
2. webapp/view/fragment 폴더 (권장 ✅)
3. webapp/view 안에 직접 생성
</br>

### < 예제 2 >
- .then()은 Promise(프로미스) 라는 객체에서 작업이 끝난 다음에 실행할 코드
```
[버튼 클릭]
   ↓
onClick() 실행
   ↓
Dialog 있으면 open()
   ↓
Dialog 없으면 Fragment.load()
   ↓
Fragment.load()가 XML 파일을 불러옴 (비동기)
   ↓
다 불러온 다음 .then() 실행 → oDialog.open()
```
- .then()이 필요한 이유 : XML 파일 가져오고 Dialog를 실행해야 하므로
```java
// Fragment.load()가 끝나야 Dialog를 사용할 수 있음
Fragment.load({...})
    .then(function(oDialog) {
        oDialog.open();  // 로드 완료 후 Dialog 열기
    });
```
- 이미 만들어진 Dialog가 있는지 Core(전역 공간)에서 찾아봄
- Fragment는 View랑 분리되어 있어서 Core로 접근해야 함
```java
let oDialog = sap.ui.getCore().byId("idDialog");
```
- 없으면 Fragment.load() 로 Dialog를 불러오고
- .then() 안에서 oDialog.open() 실행 (로드 끝난 뒤에만 가능)
```java
if (oDialog) {
    oDialog.open();   // 이미 있으면 바로 열기
} else {
    Fragment.load({
        name: "ycl2project05.view.fragment.Dialog",
        type: "XML",
        controller: this
    }).then(function(oDialog) {
        oDialog.open();   // 로드 끝난 후 열기
    });
}
```
</br>

### SAPUI5 컨트롤러 라이프사이클 메서드
- `onInit` : 컨트롤러가 처음 생성될 때 실행, 모델 설정이나 초기 데이터 로딩에 사용
- `onBeforerendering` : 뷰가 렌더링되기 직전에 실행, UI를 동적으로 수정할 때 사용
- `onAfterRendering` : 뷰가 렌더링된 후 실행, DOM 접근이나 jQuery 작업에 사용
- `onExit` : 컨트롤러가 종료될 때 실행, 리소스 해제나 이벤트 해제에 사용
</br>

### SAP Fiori UI 밀도 설정: Compact와 Cozy
1) Compact (PC용)
- 클래스: sapUiSizeCompact
- 특징: 요소가 작고 촘촘하게 표시 → 한눈에 많은 정보 확인 가능
2) Cozy (모바일용)
- 클래스: sapUiSizeCozy
- 특징: 요소가 크고 여유 있게 표시 → 터치 시 오타 방지, 사용 편리
</br>

### PC/모바일 환경에 맞춰 UI 크기 조절
- View가 Compact/Cozy에 맞게 스타일 적용됨
- Controller → Component → View
```java
onInit: function() {
    // Component에서 화면 밀도(UI Density) 클래스 가져오기
    var sClass = this.getOwnerComponent().getContentDensityClass();

    // 가져온 클래스(Compact / Cozy)를 현재 View에 적용
    this.getView().addStyleClass(sClass);
}
```
</br>

### SAPUI5 Dialog Fragment 모델 바인딩 예제 
- DataChange.fragment.xml 파일
```html
<Dialog id="idDialog" title="First Dialog">
    <content>
        <Text text="팝업 띄우기 완료!" />
        <SimpleForm>
            <Label text="First Name" /><Input value="{dialog>/inputValue1}" />
            <Label text="Last Name" /><Input value="{dialog>/inputValue2}" />
            <Label text="Input Value" /><Input value="{dialog>/inputValue3}" />
        </SimpleForm>
    </content>
    <buttons>
        <Button text="OK" press=".onDialogOKPress" />
        <Button text="Close" press=".onClose" />
    </buttons>
</Dialog>
```
</br>

- Main.controller.js 파일
```java
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel",
    "sap/ui/core/Fragment"
], (Controller, JSONModel, Fragment) => {
    "use strict";

    return Controller.extend("ycl2project07.controller.Main", {
        onInit() {
            // View 모델
            this.getView().setModel(new JSONModel({
                name: { firstName: "Hong", lastName: "Gildong" },
                inpvalue: "hihi"
            }));

            // Dialog 모델
            this.getView().setModel(new JSONModel({
                inputValue1: "1",
                inputValue2: "2",
                inputValue3: "3"
            }), "dialog");
        },

        onPress() {
            let oDialog = sap.ui.getCore().byId("idDialog");

            if(oDialog) {
                oDialog.open();
            } else {
                Fragment.load({
                    name: "ycl2project07.view.fragment.DataChange",
                    type: "XML",
                    controller: this
                }).then(dialog => {
                    dialog.setModel(this.getView().getModel("dialog"), "dialog");
                    dialog.open();
                });
            }
        },

        onClose() {
            sap.ui.getCore().byId("idDialog").close();
        }
    });
});
```
