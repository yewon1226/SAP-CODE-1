# 11/03(화) 기록
# chart 생성 - view 버전
### 1) `<viz:VizFrame>`
- 차트를 그리는 핵심 컨트롤
- `<Page>`나 `<Panel>` 안에 배치, 내부에 `<dataset>`와 `<feeds>` 포함
- 속성:
  - `vizType` : 차트 종류 (`line`, `bar`, `donut` 등)
  - `vizProperties` : 제목, 레이블 등 차트 속성 설정
  - `uiConfig` : Fiori UI 스타일 적용
  - `width/height` : 차트 크기 지정
```html
<viz:VizFrame 
    id="idViewChart"
    width="300px"
    height="300px"
    vizType="donut"
    uiConfig="{'applicationSet':'fiori'}"
    vizProperties="{
        title : { visible : true, text : 'My Chart' },
        plotArea : {
            drawingEffect: 'glowsy',
            dataLabel: { visible: true },
            colorPalette: ['#FAED7D', '#FFB2D9', '#FFC19E']
        }
    }">
```
</br>

### 2) `<viz:dataset>` + `<FlattenedDataset>`
- 차트에 표시할 데이터 집합을 정의
- 이 안에서 dimensions와 measures를 정의하여 차트에 어떤 데이터를 표시할지 결정
- `<VizFrame>` 내부에 배치
- 속성:
  - `data="{view>/list}"` : JSONModel(view)의 list 배열 데이터를 바인딩
```html
<viz:dataset>
    <viz.data:FlattenedDataset data="{view>/list}">
        <!-- 차원/측정값 정의 -->
    </viz.data:FlattenedDataset>
</viz:dataset>
```
</br>

### 3-1) `<viz.data:dimensions>`
- 차트의 범주(Category) 역할, X축이나 색상 구분에 사용
- 여러 개 정의 가능, 도넛 차트에서는 색상을 구분하는 기준이 되기도 함
- `<FlattenedDataset>` 안에 배치
- 속성:
  - `name` : 차트에서 표시될 항목 이름(예: "이름")
  - `value` : 모델 필드와 연결 (`{view>name}`)
```html
<viz.data:dimensions>
    <viz.data:DimensionDefinition 
        name="이름" 
        value="{view>name}" />
</viz.data:dimensions>
```
</br>

### 3-2) `<viz.data:measures>`
- 차트의 값(Value) 역할, Y축 또는 크기에 사용
- 여러 개 정의 가능, 도넛 차트에서는 조각의 크기를 결정
- `<FlattenedDataset>` 안에 배치
- 속성:
  - `name` : 차트에서 표시될 값 이름(예: "숫자")
  - `value` : 모델 필드와 연결 ({view>rate})
```html
<viz.data:measures>
    <viz.data:MeasureDefinition 
        name="숫자" 
        value="{view>rate}" />
</viz.data:measures>
```
 </br>

### 4) `<viz:feeds>` + `<viz.feeds:FeedItem>`
- 차트 데이터와 시각적 요소를 연결
- 도넛/파이 차트는 color(조각 색상)와 size(조각 크기)
- 막대/라인 차트는 CategoryAxi와 valueAxis 사용
- `<VizFrame>` 내부에 배치
- 속성:
  - `uid` : 차트에서 피드 역할 지정 (color, size, categoryAxis, valueAxis 등)
  - `type` : Dimension 또는 Measure 지정
  - `values` : 매핑할 데이터 이름(Dimension/Measure에서 정의한 name)
```html
<viz:feeds>
    <viz.feeds:FeedItem 
        uid="color" 
        type="Dimension" 
        values="이름" />
    <viz.feeds:FeedItem 
        uid="size" 
        type="Measure" 
        values="숫자" />
</viz:feeds>
```
</br>

---

# chart 생성 - controller 버전
### 1) FlattenedDataset
- VizFrame(차트)에 바인딩할 데이터 구조 정의
- `dimension` → X축 / 분류 기준 (예: 제품명)
- `measures` → Y축 / 수치 값 (예: 매출, 수량)
- `data.path` → 모델의 데이터 경로
```java
let oDataset = new FlattenedDataset({
    dimensions: [
        { name: "차원이름", value: "{모델명>필드명}" }
    ],
    measures: [
        { name: "측정값이름", value: "{모델명>필드명}" }
    ],
    data: { path: "모델명>/데이터경로" }
});
```
```java
let oChart = this.byId("idControllerChart");

// dataset 만들기
let oDataSet = new FlattenedDataset({
    dimensions: [{ name : "Product", value : "{cont>product}" }],
    measures: [{ name : "Amount", value : "{cont>amount}" }],
    data: { path : "cont>/sales" }
});
oChart.setDataset(oDataSet);
```
</br>

### 2) FeedItem
- VizFrame 차트에서 데이터와 시각적 요소(축, 색상 등) 를 연결하는 역할
- FeedItem 여러 개를 추가할 수 있음
```java
let oFeed = new FeedItem({
    uid: "feed유형",      // 예: valueAxis, categoryAxis, color, size
    type: "Dimension" or "Measure",
    values: ["데이터이름"]
});
```
```java
let feedValueAxis = new FeedItem({
    uid: "valueAxis",
    type: "Measure",
    values: ["Amount"]
});
let feedCategoryAxis = new FeedItem({
    uid: "categoryAxis",
    type: "Dimension",
    values: ["Product"]
});

oChart.addFeed(feedValueAxis);
oChart.addFeed(feedCategoryAxis);

oChart.setVizProperties({
    title: { test : '막대차트', visible : true }
})
oChart.setVizType("line");
```
</br>
</br>

### ODataModel.read() 정리

### 1) 기본 형식
- 경로의 데이터를 읽고 성공하면 success 실행, 실패하면 error 실행
- sPath : 읽을 대상의 경로 (엔티티셋 또는 키값 포함 경로)
- success : 요청 성공 시 실행되는 콜백 함수
- error : 요청 실패 시 실행되는 콜백 함수
```java
oModel.read(sPath, {
  success: function(oData, response) {},
  error: function(oError) {}
});
```
</br>

### 2) 단일 데이터 (Key 기반 조회)
- OData의 특정 레코드를 가져올 때는 엔티티셋 이름 뒤에 키 필드들을 괄호 안에 지정
```java
oModel.read("/esConDetailSet(Carrid='AA',Connid='0017')", {
  success: function(oReturn) {
    console.log(oReturn);
  }
});
```
- oReturn 결과 예시
```java
{
  Carrid: "AA",
  Connid: "0017",
  Airpto: "ICN"
}
```
- 실습 예제
```java
onSelectionChange: function() {
    let table = this.byId("idesConListSet");  
    let oRow = table.getSelectedItem();     
    let oBindingContext = oRow.getBindingContext("local");
    let sPath = oBindingContext.getPath();

    let oModel = this.getView().getModel("local");
    let inputCarrid = oModel.getProperty(sPath).Carrid;  
    let inputConnid = oModel.getProperty(sPath).Connid; 
    
    let aModel = this.getView().getModel("aModel");
    
    oModel.read(`/esConDetailSet(Carrid='${inputCarrid}',Connid='${inputConnid}')`, {            
        success: function(oReturn) {
            aModel.setProperty("/data", [{ Airpto: oReturn.Airpto }]);
        },
        error: function() {
            
        }
    });
}
```
</br>

### 3) 여러 건 (전체 조회)
- 키값 없이 엔티티셋만 지정하면 전체 데이터를 읽음
```java
oModel.read("/esConDetailSet", {
  success: function(oReturn) {
    console.log(oReturn.results);
  }
});
```
- 결과 데이터 구조
```java
{
  results: [
    { Carrid: "AA", Connid: "0017", Airpto: "ICN" },
    { Carrid: "LH", Connid: "0400", Airpto: "FRA" }
  ]
}
```
</br>

### 4) 조건 조회 (Filter 사용)
- 특정 조건만 조회하고 싶을 때는 filters 옵션을 사용
```java
oModel.read("/esConDetailSet", {
  filters: [
    new sap.ui.model.Filter("Carrid", "EQ", "AA")
  ],
  success: function(oData) {
    console.log(oData.results);
  }
});
```
</br>

### setProperty 헷갈리는 부분
- 초기 상태
```java
let oModel = new JSONModel({
  data: [
    { name: "A" },
    { name: "B" }
  ]
});
```
- 이때 이렇게 하면
```java
oModel.setProperty("/data", { name: "C" });
```
- 결과
```java
{
  data: { name: "C" }   // 배열이었던 부분이 객체로 바뀜
}
```
