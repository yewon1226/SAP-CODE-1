# 실습 코드 (푼거)

- Main.controller.js
```java
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel",
    "sap/ui/core/Fragment",
    "sap/btp/ux400solving/model/formatter"
], (Controller, JSONModel, Fragment, formatter) => {
    "use strict";

    return Controller.extend("sap.btp.ux400solving.controller.Main", {
        formatFile : formatter,
        onInit() {
            let oData = {
                RandomValue : []
            };
            let oModel = new JSONModel(oData);
            this.getView().setModel(oModel, "RandomModel");
        },
        onRandomPress: function() {
            let randomData = Math.floor(Math.random() * 100) + 1;
            this.byId("InputRandom").setValue(randomData);
            let rData = this.getView().getModel("RandomModel").getProperty("/RandomValue");
            rData.push({ Random_val : randomData});

            let rModel = this.getView().getModel("RandomModel");
            rModel.setProperty("/RandomValue", rData);
        },
        onOpenProduct: function() {
            let oModel = this.getView().getModel();
            let oDialog = sap.ui.getCore().byId("idDialog");

            if(oDialog) {
                oDialog.open();
            }
            else {
                Fragment.load({
                    name: "sap.btp.ux400solving.view.fragment.Products",
                    type: "XML",
                    controller: this
                }).then( function(mDialog) {
                    mDialog.setModel(oModel);
                    mDialog.open();
                })
            }
        },
        onClose: function() {
            sap.ui.getCore().byId("idDialog").close();
        },
        onValueChange: function(oEvent) {
            let iValue = Number(oEvent.getParameter("value"));
            let oInput = oEvent.getSource();

            if(iValue < 0 || iValue > 100) {
                oInput.setValueState("Error");
                oInput.setValueStateText("1 이상 100 이하의 숫자를 입력하세요.");
            }
            else {
                let rData = this.getView().getModel("RandomModel").getProperty("/RandomValue");
                rData.push({ Random_val : iValue});
                let rModel = this.getView().getModel("RandomModel");
                rModel.setProperty("/RandomValue", rData);
            }
        }
    });
});
```
</br>

- Main.view.xml
```html
<mvc:View controllerName="sap.btp.ux400solving.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:t="sap.ui.table"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <VBox class="sapUiLargeMargin">
            <Text text="버튼을 클릭하면 아래 input에 값이 랜덤으로 채워집니다." />
            <Input id="InputRandom" value="" type="Number" change=".onValueChange" />
            <Button text="Random" press=".onRandomPress"/>
            <!-- 
                일반적으로 Controller 랑 연결된 함수는 .onPress 랑 onPress 둘 다 가능 (생략가능)
            -->
            <t:Table id="idRandomTable" rows="{RandomModel>/RandomValue}" width="50%">
                <t:extension>
                    <OverflowToolbar style="Clear">
                        <Title id="title" text="랜덤 목록 리스트"/>
                    </OverflowToolbar>
                </t:extension>
                <t:columns>
                    <t:Column>
                        <Label text="value" />
                        <t:template>
                            <Text text="{RandomModel>Random_val}" />
                        </t:template>
                    </t:Column>
                </t:columns>
            </t:Table>

            <Button text="open Product" press="onOpenProduct" />
        </VBox>
    </Page>
</mvc:View>
```
</br>

- fragment/Products.fragment.xml
```html
<c:FragmentDefinition 
    xmlns="sap.m" 
    xmlns:t="sap.ui.table"
    xmlns:c="sap.ui.core">
    <Dialog id="idDialog">
        <content>
            <t:Table id="idProductsTable" rows="{/Products}">
                <t:extension>
                    <OverflowToolbar style="Clear">
                        <Title id="productTitle" text="Products"/>
                    </OverflowToolbar>
                </t:extension>
                <t:columns>
                    <t:Column width="7rem">
                        <Label text="ProductID" />
                        <t:template>
                            <Text text="{ProductID}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="11rem">
                        <Label text="ProductName" />
                        <t:template>
                            <Text text="{ProductName}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="SupplierID" />
                        <t:template>
                            <Text text="{SupplierID}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="CategoryID" />
                        <t:template>
                            <Text text="{CategoryID}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="11rem">
                        <Label text="QuantityPerUnit" />
                        <t:template>
                            <Text text="{QuantityPerUnit}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="UnitPrice" />
                        <t:template>
                            <Text text="{UnitPrice}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="UnitsInStock" />
                        <t:template>
                            <Text text="{UnitsInStock}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="UnitsOnOrder" />
                        <t:template>
                            <Text text="{UnitsOnOrder}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="ReorderLevel" />
                        <t:template>
                            <Text text="{ReorderLevel}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="Discontinued" />
                        <t:template>
                            <Text text="{
                                path : 'Discontinued',
                                formatter : '.formatFile.transformDiscontinued'
                            }" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="Status" />
                        <t:template>
                            <c:Icon src="{= (${UnitPrice} >= 15) ? 'sap-icon://thumb-up' : 'sap-icon://thumb-down' }"
                                    color="{= (${UnitPrice} >= 15) ? 'rgb(27, 234, 33)' : 'rgb(234, 52, 27)' }" />
                        </t:template>
                    </t:Column>
                </t:columns>
            </t:Table>
        </content>
        <endButton>
            <Button text="닫기" press=".onClose" />
        </endButton>
    </Dialog>
</c:FragmentDefinition>
```
</br>

- model/formatter.js
```java
sap.ui.define([], function() {
    "use strict"

    return {
        transformDiscontinued: function(sValue) {
            if(sValue) {
                return "Yes"
            }
            else {
                return "No"
            }
        }
    }
})
```
</br>
</br>

# 실습 코드 (답지)
- js 파일
```java
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel",
    "sap/ui/core/Fragment",
    "ycl2testproject02/model/formatter"

], (Controller, JSONModel, Fragment, formatter) => {
    "use strict";

    return Controller.extend("ycl2testproject02.controller.Main", {

        formatFile: formatter,

        onInit() {
            let oData = { result: [] };
            let oModel = new JSONModel(oData);

            this.getView().setModel(oModel, "list");
        },

        onRandomPress() {
            let oInput = this.getView().byId("inp01");
            let sValue = Math.floor(Math.random() * 100 + 1);
            oInput.setValue(sValue);

            let oModel = this.getView().getModel("list");
            let arrCopy = oModel.getProperty("/result");

            arrCopy.push(sValue);
            oModel.setProperty("/result", arrCopy);

        },

        onValueChange: function(oEvent) {
            let oInput = oEvent.getSource();
            let iValue = oInput.getValue();

            let isValid = true;

            if(iValue < 1 || iValue > 100  || isNaN(iValue) || iValue === "") {
                isValid = false;
            }

            if(isValid) {
                oInput.setValueState("None");
            } else {
                oInput.setValueState("Error");
            }


        },

        openProduct() {

            let oThis = this;

            Fragment.load({
                name: "ycl2testproject02.view.fragment.Products",
                type: "XML",
                controller:this,
            }).then(function(oDialog) {
                let oModel = oThis.getView().getModel();
                oDialog.setModel(oModel, "product");
                oDialog.open();
            }); 
        },

        onClose() {
            sap.ui.getCore().byId("idDialog").close();
        }
    });
});
```
</br>

- view.xml 파일
```html
<mvc:View controllerName="ycl2testproject02.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:t="sap.ui.table"
>
    <Page id="page" title="{i18n>title}">
        <VBox id="box01" class="sapUiLargeMargin">
            <Text id="txt01" text="버튼을 클릭하면 아래 Input 값이 랜덤으로 채워집니다"></Text>
            <Input id="inp01" type="Number" change="onValueChange" placeholder="1부터 100까지 입력하세요" valueState="None" valueStateText="1부터 100 사이의 값만 입력할 수 있습니다." />
            <Button id="btn01" text="Random" press="onRandomPress"></Button>

            <t:Table id="tb01" rows="{list>/result}">
                <t:extension>
					<OverflowToolbar style="Clear">
						<Title id="title01" text="랜덤 목록 리스트"/>
					</OverflowToolbar>
				</t:extension>

                <t:columns>
                	<t:Column width="11rem">
						<Label text="value" />
						<t:template>
							<Text text="{list>}"></Text>
						</t:template>
					</t:Column>
                </t:columns>

            </t:Table>

            <Button id="btn02" text="open Product" press="openProduct"></Button>

        </VBox>
    </Page>
</mvc:View>
```
</br>

- fragment 파일
```html
<c:FragmentDefinition 
    xmlns="sap.m" 
    xmlns:c="sap.ui.core"
    xmlns:f="sap.ui.layout.form"
    xmlns:t="sap.ui.table"
>
    <Dialog id="idDialog"
            title="First Dialog"
            contentHeight="20%"
            contentWidth="80%"
            draggable="true"
            resizable="true">
        <content>
            <!-- Dialog 안에 들어갈 내용 작성 -->
            <t:Table id="tb02" rows="{product>/Products}">
                <t:extension>
					<OverflowToolbar style="Clear">
						<Title id="title02" text="Products"/>
					</OverflowToolbar>
				</t:extension>

                <t:columns>
                	<t:Column width="9rem">
						<Label text="ProductID" />
						<t:template>
							<Text text="{product>ProductID}"></Text>
						</t:template>
					</t:Column>

                    <t:Column width="13rem">
						<Label text="ProductName" />
						<t:template>
							<Text text="{product>ProductName}"></Text>
						</t:template>
					</t:Column>

                    <t:Column width="7rem">
						<Label text="SupplierID" />
						<t:template>
							<Text text="{product>SupplierID}"></Text>
						</t:template>
					</t:Column>

                    <t:Column width="7rem">
						<Label text="CategoryID" />
						<t:template>
							<Text text="{product>CategoryID}"></Text>
						</t:template>
					</t:Column>

                    <t:Column width="13rem">
						<Label text="QuantityPerUnit" />
						<t:template>
							<Text text="{product>QuantityPerUnit}"></Text>
						</t:template>
					</t:Column>

                    <t:Column width="9em">
						<Label text="UnitPrice" />
						<t:template>
							<Text text="{product>UnitPrice}"></Text>
						</t:template>
					</t:Column>

                    <t:Column width="9rem">
						<Label text="UnitsInStock" />
						<t:template>
							<Text text="{product>UnitsInStock}"></Text>
						</t:template>
					</t:Column>

                    <t:Column width="9rem">
						<Label text="UnitsOnOrder" />
						<t:template>
							<Text text="{product>UnitsOnOrder}"></Text>
						</t:template>
					</t:Column>

                    <t:Column width="9rem">
						<Label text="ReorderLevel" />
						<t:template>
							<Text text="{product>ReorderLevel}"></Text>
						</t:template>
					</t:Column>

                    <t:Column width="9rem">
						<Label text="Discontinued" />
						<t:template>
							<Text text="{
                                path: 'product>Discontinued',
                                formatter: '.formatFile.fnFormatter'
                            }" />
						</t:template>
					</t:Column>

                    <t:Column width="9rem">
						<Label text="Status" />
						<t:template>
							<c:Icon src="{= ${product>UnitPrice} >= 15 ? 'sap-icon://thumb-up' : 'sap-icon://thumb-down'}" color="{= ${product>UnitPrice} >= 15 ? 'rgb(27,234,33)' : 'rgb(234,52,27)' }"></c:Icon>
						</t:template>
					</t:Column>

                </t:columns>

            </t:Table>
        </content>

        <buttons>
            <Button text="close" press=".onClose" />
        </buttons>

    </Dialog>
</c:FragmentDefinition>
```
