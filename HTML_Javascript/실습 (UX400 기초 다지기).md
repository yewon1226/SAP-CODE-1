# 실습 코드 (푼거)
<img width="701" height="339" alt="image" src="https://github.com/user-attachments/assets/96406e8a-b9f4-4783-b5af-98da13c8e015" />

<img width="697" height="316" alt="image" src="https://github.com/user-attachments/assets/b032d6e6-3ea1-41a1-a84f-99bc0bb63e14" />


- Main.controller.js
```java
sap.ui.define([
    "sap/ui/core/mvc/Controller",
    "sap/ui/model/json/JSONModel",
    "sap/ui/core/Fragment",
    "sap/btp/ux400solving/model/formatter"
], (Controller, JSONModel, Fragment, formatter) => {
    "use strict";

    return Controller.extend("sap.btp.ux400solving.controller.Main", {
        formatFile : formatter,
        onInit() {
            let oData = {
                RandomValue : []
            };
            let oModel = new JSONModel(oData);
            this.getView().setModel(oModel, "RandomModel");
        },
        onRandomPress: function() {
            let randomData = Math.floor(Math.random() * 100) + 1;
            this.byId("InputRandom").setValue(randomData);
            let rData = this.getView().getModel("RandomModel").getProperty("/RandomValue");
            rData.push({ Random_val : randomData});

            let rModel = this.getView().getModel("RandomModel");
            rModel.setProperty("/RandomValue", rData);
        },
        onOpenProduct: function() {
            let oModel = this.getView().getModel();
            let oDialog = sap.ui.getCore().byId("idDialog");

            if(oDialog) {
                oDialog.open();
            }
            else {
                Fragment.load({
                    name: "sap.btp.ux400solving.view.fragment.Products",
                    type: "XML",
                    controller: this
                }).then( function(mDialog) {
                    mDialog.setModel(oModel);
                    mDialog.open();
                })
            }
        },
        onClose: function() {
            sap.ui.getCore().byId("idDialog").close();
        },
        onValueChange: function(oEvent) {
            let iValue = Number(oEvent.getParameter("value"));
            let oInput = oEvent.getSource();

            if(iValue < 0 || iValue > 100) {
                oInput.setValueState("Error");
                oInput.setValueStateText("1 이상 100 이하의 숫자를 입력하세요.");
            }
            else {
                let rData = this.getView().getModel("RandomModel").getProperty("/RandomValue");
                rData.push({ Random_val : iValue});
                let rModel = this.getView().getModel("RandomModel");
                rModel.setProperty("/RandomValue", rData);
            }
        }
    });
});
```
</br>

- Main.view.xml
```html
<mvc:View controllerName="sap.btp.ux400solving.controller.Main"
    xmlns:mvc="sap.ui.core.mvc"
    xmlns:t="sap.ui.table"
    xmlns="sap.m">
    <Page id="page" title="{i18n>title}">
        <VBox class="sapUiLargeMargin">
            <Text text="버튼을 클릭하면 아래 input에 값이 랜덤으로 채워집니다." />
            <Input id="InputRandom" value="" type="Number" change=".onValueChange" />
            <Button text="Random" press=".onRandomPress"/>
            <!-- 
                일반적으로 Controller 랑 연결된 함수는 .onPress 랑 onPress 둘 다 가능 (생략가능)
            -->
            <t:Table id="idRandomTable" rows="{RandomModel>/RandomValue}" width="50%">
                <t:extension>
                    <OverflowToolbar style="Clear">
                        <Title id="title" text="랜덤 목록 리스트"/>
                    </OverflowToolbar>
                </t:extension>
                <t:columns>
                    <t:Column>
                        <Label text="value" />
                        <t:template>
                            <Text text="{RandomModel>Random_val}" />
                        </t:template>
                    </t:Column>
                </t:columns>
            </t:Table>

            <Button text="open Product" press="onOpenProduct" />
        </VBox>
    </Page>
</mvc:View>
```
</br>

- fragment/Products.fragment.xml
```html
<c:FragmentDefinition 
    xmlns="sap.m" 
    xmlns:t="sap.ui.table"
    xmlns:c="sap.ui.core">
    <Dialog id="idDialog">
        <content>
            <t:Table id="idProductsTable" rows="{/Products}">
                <t:extension>
                    <OverflowToolbar style="Clear">
                        <Title id="productTitle" text="Products"/>
                    </OverflowToolbar>
                </t:extension>
                <t:columns>
                    <t:Column width="7rem">
                        <Label text="ProductID" />
                        <t:template>
                            <Text text="{ProductID}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="11rem">
                        <Label text="ProductName" />
                        <t:template>
                            <Text text="{ProductName}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="SupplierID" />
                        <t:template>
                            <Text text="{SupplierID}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="CategoryID" />
                        <t:template>
                            <Text text="{CategoryID}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="11rem">
                        <Label text="QuantityPerUnit" />
                        <t:template>
                            <Text text="{QuantityPerUnit}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="UnitPrice" />
                        <t:template>
                            <Text text="{UnitPrice}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="UnitsInStock" />
                        <t:template>
                            <Text text="{UnitsInStock}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="UnitsOnOrder" />
                        <t:template>
                            <Text text="{UnitsOnOrder}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="ReorderLevel" />
                        <t:template>
                            <Text text="{ReorderLevel}" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="Discontinued" />
                        <t:template>
                            <Text text="{
                                path : 'Discontinued',
                                formatter : '.formatFile.transformDiscontinued'
                            }" />
                        </t:template>
                    </t:Column>
                    <t:Column width="7rem">
                        <Label text="Status" />
                        <t:template>
                            <c:Icon src="{= (${UnitPrice} >= 15) ? 'sap-icon://thumb-up' : 'sap-icon://thumb-down' }"
                                    color="{= (${UnitPrice} >= 15) ? 'rgb(27, 234, 33)' : 'rgb(234, 52, 27)' }" />
                        </t:template>
                    </t:Column>
                </t:columns>
            </t:Table>
        </content>
        <endButton>
            <Button text="닫기" press=".onClose" />
        </endButton>
    </Dialog>
</c:FragmentDefinition>
```
</br>

- model/formatter.js
```java
sap.ui.define([], function() {
    "use strict"

    return {
        transformDiscontinued: function(sValue) {
            if(sValue) {
                return "Yes"
            }
            else {
                return "No"
            }
        }
    }
})
```
</br>
</br>

# 실습 코드 (답지)
- js 파일
```java
sap.ui.define([
    "sap/ui/core/mvc/Controller",      // MVC 컨트롤러
    "sap/ui/model/json/JSONModel",     // JSON 모델 (데이터 저장용)
    "sap/ui/core/Fragment",            // Fragment (다이얼로그 등 팝업용)
    "ycl2testproject02/model/formatter" // 데이터 포맷터
], (Controller, JSONModel, Fragment, formatter) => {
    "use strict";

    return Controller.extend("ycl2testproject02.controller.Main", {

        // 포맷터 파일 연결
        formatFile: formatter,

        // 1️⃣ 초기 실행 시 모델 설정
        onInit() {
            // 빈 배열을 가진 기본 데이터 준비
            let oData = { result: [] };
            // JSON 모델 생성
            let oModel = new JSONModel(oData);
            // 뷰(View)에 "list"라는 이름으로 모델 연결
            this.getView().setModel(oModel, "list");
        },

        // 2️⃣ "Random" 버튼 클릭 시 실행
        onRandomPress() {
            // Input 컨트롤 가져오기
            let oInput = this.getView().byId("inp01");
            // 1~100 사이의 랜덤 숫자 생성
            let sValue = Math.floor(Math.random() * 100 + 1);
            // 생성한 랜덤 숫자를 Input에 표시
            oInput.setValue(sValue);

            // "list" 모델 가져오기
            let oModel = this.getView().getModel("list");
            // result 배열 꺼내오기
            let arrCopy = oModel.getProperty("/result");

            // 랜덤 값 배열에 추가
            arrCopy.push(sValue);
            // 모델 업데이트
            oModel.setProperty("/result", arrCopy);
        },

        // 3️⃣ Input 값 변경 시 실행 (유효성 검사)
        onValueChange: function(oEvent) {
            // 이벤트 발생한 Input 객체
            let oInput = oEvent.getSource();
            // 입력된 값 가져오기
            let iValue = oInput.getValue();

            let isValid = true;

            // 1~100 사이가 아니거나, 숫자가 아닌 경우 에러
            if (iValue < 1 || iValue > 100 || isNaN(iValue) || iValue === "") {
                isValid = false;
            }

            // 값이 유효하면 상태 정상으로
            if (isValid) {
                oInput.setValueState("None");
            } else {
                // 잘못된 값이면 Input을 에러 상태로 표시
                oInput.setValueState("Error");
            }
        },

        // 4️⃣ "open Product" 버튼 클릭 시 다이얼로그 열기
        openProduct() {
            let oThis = this; // this를 변수에 저장 (비동기 함수 안에서도 사용하기 위함)

            // Fragment 로드 (XML로 정의된 다이얼로그)
            Fragment.load({
                name: "ycl2testproject02.view.fragment.Products", // Fragment 파일 경로
                type: "XML",
                controller: this, // 컨트롤러 연결
            }).then(function(oDialog) {
                // 모델 설정 (현재 뷰의 모델을 다이얼로그에 연결)
                let oModel = oThis.getView().getModel();
                oDialog.setModel(oModel, "product");
                // 다이얼로그 열기
                oDialog.open();
            });
        },

        // 5️⃣ 다이얼로그 닫기
        onClose() {
            sap.ui.getCore().byId("idDialog").close(); // idDialog로 등록된 다이얼로그 닫기
        }
    });
});
```
</br>

- view.xml 파일
```html
<mvc:View 
    controllerName="ycl2testproject02.controller.Main"  <!-- 연결할 컨트롤러 -->
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"          <!-- sap.m: 모바일 UI 컨트롤 -->
    xmlns:t="sap.ui.table" <!-- sap.ui.table: 표 컨트롤 -->
>
    <!-- 메인 페이지 -->
    <Page id="page" title="{i18n>title}"> <!-- i18n에서 다국어 제목 불러오기 -->
        <VBox id="box01" class="sapUiLargeMargin"> <!-- 세로 정렬 박스 (여백 있음) -->
            
            <!-- 설명 문구 -->
            <Text 
                id="txt01" 
                text="버튼을 클릭하면 아래 Input 값이 랜덤으로 채워집니다">
            </Text>

            <!-- 숫자 입력 필드 -->
            <Input 
                id="inp01" 
                type="Number" 
                change="onValueChange" <!-- 값 변경 시 유효성 검사 함수 호출 -->
                placeholder="1부터 100까지 입력하세요" 
                valueState="None" 
                valueStateText="1부터 100 사이의 값만 입력할 수 있습니다." 
            />

            <!-- 랜덤 버튼 -->
            <Button 
                id="btn01" 
                text="Random" 
                press="onRandomPress"> <!-- 버튼 클릭 시 랜덤 숫자 생성 -->
            </Button>

            <!-- 랜덤 숫자 목록을 표시할 테이블 -->
            <t:Table id="tb01" rows="{list>/result}"> <!-- list 모델의 result 배열과 바인딩 -->
                
                <!-- 테이블 상단 툴바 -->
                <t:extension>
					<OverflowToolbar style="Clear">
						<Title id="title01" text="랜덤 목록 리스트"/> <!-- 제목 -->
					</OverflowToolbar>
				</t:extension>

                <!-- 테이블 컬럼 정의 -->
                <t:columns>
                	<t:Column width="11rem">
						<Label text="value" /> <!-- 컬럼 헤더 -->
						<t:template>
							<!-- 배열 안의 각 숫자 값 표시 -->
							<Text text="{list>}"></Text>
						</t:template>
					</t:Column>
                </t:columns>

            </t:Table>

            <!-- 제품 보기 다이얼로그 열기 버튼 -->
            <Button 
                id="btn02" 
                text="open Product" 
                press="openProduct">
            </Button>

        </VBox>
    </Page>
</mvc:View>
```
</br>

- fragment 파일
```html
<c:FragmentDefinition 
    xmlns="sap.m"           <!-- sap.m: 모바일용 UI 컨트롤 -->
    xmlns:c="sap.ui.core"   <!-- sap.ui.core: 기본 UI 컴포넌트 (Icon 등) -->
    xmlns:f="sap.ui.layout.form"  <!-- (폼 레이아웃용 네임스페이스, 여기서는 사용 안 함) -->
    xmlns:t="sap.ui.table"  <!-- sap.ui.table: 테이블 UI 컨트롤 -->
>

    <!-- 다이얼로그 정의 -->
    <Dialog 
        id="idDialog"               <!-- 다이얼로그 ID (컨트롤러에서 찾을 때 사용) -->
        title="First Dialog"        <!-- 다이얼로그 제목 -->
        contentHeight="20%"         <!-- 다이얼로그 세로 크기 -->
        contentWidth="80%"          <!-- 다이얼로그 가로 크기 -->
        draggable="true"            <!-- 드래그로 이동 가능 -->
        resizable="true">           <!-- 크기 조절 가능 -->
        
        <content>
            <!-- 다이얼로그 안에 표시될 실제 콘텐츠 영역 -->
            
            <!-- 제품 목록 테이블 -->
            <t:Table id="tb02" rows="{product>/Products}"> <!-- product 모델의 Products 배열에 바인딩 -->
                
                <!-- 테이블 상단 제목 영역 -->
                <t:extension>
					<OverflowToolbar style="Clear">
						<Title id="title02" text="Products"/> <!-- 테이블 제목 -->
					</OverflowToolbar>
				</t:extension>

                <!-- 각 제품 속성을 표시할 컬럼들 정의 -->
                <t:columns>

                    <!-- ProductID 컬럼 -->
                	<t:Column width="9rem">
						<Label text="ProductID" /> <!-- 헤더 제목 -->
						<t:template>
							<Text text="{product>ProductID}"/> <!-- 각 행의 ProductID 값 표시 -->
						</t:template>
					</t:Column>

                    <!-- ProductName 컬럼 -->
                    <t:Column width="13rem">
						<Label text="ProductName" />
						<t:template>
							<Text text="{product>ProductName}"/>
						</t:template>
					</t:Column>

                    <!-- SupplierID 컬럼 -->
                    <t:Column width="7rem">
						<Label text="SupplierID" />
						<t:template>
							<Text text="{product>SupplierID}"/>
						</t:template>
					</t:Column>

                    <!-- CategoryID 컬럼 -->
                    <t:Column width="7rem">
						<Label text="CategoryID" />
						<t:template>
							<Text text="{product>CategoryID}"/>
						</t:template>
					</t:Column>

                    <!-- QuantityPerUnit (단위당 수량) -->
                    <t:Column width="13rem">
						<Label text="QuantityPerUnit" />
						<t:template>
							<Text text="{product>QuantityPerUnit}"/>
						</t:template>
					</t:Column>

                    <!-- UnitPrice (단가) -->
                    <t:Column width="9em">
						<Label text="UnitPrice" />
						<t:template>
							<Text text="{product>UnitPrice}"/>
						</t:template>
					</t:Column>

                    <!-- UnitsInStock (재고 수량) -->
                    <t:Column width="9rem">
						<Label text="UnitsInStock" />
						<t:template>
							<Text text="{product>UnitsInStock}"/>
						</t:template>
					</t:Column>

                    <!-- UnitsOnOrder (주문 중 수량) -->
                    <t:Column width="9rem">
						<Label text="UnitsOnOrder" />
						<t:template>
							<Text text="{product>UnitsOnOrder}"/>
						</t:template>
					</t:Column>

                    <!-- ReorderLevel (재주문 기준 수량) -->
                    <t:Column width="9rem">
						<Label text="ReorderLevel" />
						<t:template>
							<Text text="{product>ReorderLevel}"/>
						</t:template>
					</t:Column>

                    <!-- Discontinued (단종 여부) -->
                    <t:Column width="9rem">
						<Label text="Discontinued" />
						<t:template>
							<!-- formatter 함수를 사용하여 표시 형식 제어 -->
							<Text text="{
                                path: 'product>Discontinued',
                                formatter: '.formatFile.fnFormatter'  <!-- Controller의 formatter 함수 사용 -->
                            }" />
						</t:template>
					</t:Column>

                    <!-- Status (상태 아이콘) -->
                    <t:Column width="9rem">
						<Label text="Status" />
						<t:template>
                            <!-- UnitPrice(가격)이 15 이상이면 초록색 엄지 아이콘, 아니면 빨간색 아래 엄지 -->
							<c:Icon 
                                src="{= ${product>UnitPrice} >= 15 ? 'sap-icon://thumb-up' : 'sap-icon://thumb-down'}"
                                color="{= ${product>UnitPrice} >= 15 ? 'rgb(27,234,33)' : 'rgb(234,52,27)' }"/>
						</t:template>
					</t:Column>

                </t:columns>

            </t:Table>
        </content>

        <!-- 다이얼로그 하단 버튼 영역 -->
        <buttons>
            <!-- 닫기 버튼: 컨트롤러의 onClose 함수 실행 -->
            <Button text="close" press=".onClose" />
        </buttons>

    </Dialog>
</c:FragmentDefinition>
```
