# 10/30 기록
### 1) Property Binding (속성 바인딩)
- 컨트롤의 단일 속성을 모델 값에 연결. 모델 값이 변경되면 UI 속성도 자동 업데이트.
```html
<Text text="{모델명>경로}" />

<Text text="{customer>/CustomerName}" />
<Text text="{main>/state}" />
```
</br>

### 2) Aggregation Binding (집합 바인딩)
- 컨트롤의 자식 집합(aggregation)에 모델 데이터를 연결. 주로 리스트, 테이블, VBox 등 반복되는 UI 생성에 사용.
```html
<Table items="{모델명>경로}">
    <columns>...</columns>
    <items>
        <ColumnListItem>
            <cells>
                <Text text="{모델명>속성}" />
            </cells>
        </ColumnListItem>
    </items>
</Table>

<Table id="idCustomers" items="{customer>/Customers}">
    <columns>
        <Column><Text text="이름" /></Column>
        <Column><Text text="나이" /></Column>
    </columns>
    <items>
        <ColumnListItem>
            <cells>
                <Text text="{customer>CustomerName}" />
                <Text text="{customer>Age}" />
            </cells>
        </ColumnListItem>
    </items>
</Table>
```
</br>

### 3) Element Binding (바인딩 컨텍스트)
- 컨트롤 전체(Element)를 특정 모델 경로에 바인딩. 하위 속성들은 상대 경로로 접근 가능.
```java
this.byId("idVBox").bindElement({
    path: "/company",
    model: "main"
});
```
```html
<VBox id="idVBox" class="sapUiSmallMargin">
    <Text text="{main>name}" />
    <Text text="{main>city}" />
</VBox>
```
</br>

### 4) Expression Binding (표현식 바인딩)
- 단순 바인딩이 아니라, 모델 데이터를 기반으로 계산/조건 처리 후 UI 속성에 반영.
```html
<Text text="{= ${모델명>속성} > 18 ? '성인' : '청소년'}" />

<Text text="{= ${customer>Age} >= 20 ? '성인' 
                  : ${customer>Age} >= 14 ? '청소년' 
                  : '어린이' }" />
```
</br>
</br>

### Element Binding
- UI 요소를 모델의 특정 데이터(객체)에 연결

### Context
- 바인딩 시 자동 생성되는 객체로 모델 정보, 데이터 경로, 현재 인덱스 등을 가짐
- 리스트 구조(List, Table)에서 각 항목마다 개별 context 생성
</br>

### JSONModel.loadData
- 외부 JSON 파일을 모델에 불러와 데이터로 채우는 함수
```java
oModel.loadData("파일 경로");
```
```java
let oModel = new JSONModel();
oModel.loadData(sap.ui.require.toUrl("ycl2project082/model/data.json"));
this.getView().setModel(oModel, "main");
```
</br>

### Element Binding (`bindElement`)
- 컨테이너(VBox 등)에 모델 객체를 연결해, 자식 컨트롤이 해당 객체를 기준으로 데이터를 참조하게 함
- JS 함수 형식
```java
control.bindElement({
    path: "모델 경로",
    model: "모델 이름"
});
```
</br>

### 직접 경로 바인딩 (bindElement 불필요한 경우)
- bindElement 필요 없음
```html
<Text binding="{/company}" text="{state}" />    // 모델명 x
```
```html
<Text text="{main>/company/state}" />           // 모델명 o
```
</br>

### 컨텍스트 바인딩 (bindElement 필요한 경우)
- 여러 속성을 바인딩할 때 사용
</br>
  
1) 이름 없는 기본 모델
- controller.js 파일
```java
onInit() {
            let oModel = new JSONModel();
            oModel.loadData(sap.ui.require.toUrl("ycl2project082/model/data.json"));
            this.getView().setModel(oModel);

            this.byId("idVBox").bindElement("/company");
}
```
- view.xml 파일
```html
<VBox id="idVBox" class="sapUiSmallMargin">
    <Text text="VBox안에 데이터 : {name}" />
    <Text text="VBox안에 데이터 : {street}" />
    <Text text="VBox안에 데이터 : {city}" />
    <Text text="VBox안에 데이터 : {state}" />
</VBox>
```
</br>
</br>

2) 이름 있는 모델
- controller.js 파일
```java
onInit() {
            let oModel = new JSONModel();
            oModel.loadData(sap.ui.require.toUrl("ycl2project082/model/data.json"));
            this.getView().setModel(oModel, "main");

            this.byId("idVBox").bindElement({
                path : "/company",
                model : "main"
            });
}
```
- view.xml 파일
```html
<VBox id="idVBox" class="sapUiSmallMargin">
    <Text text="VBox안에 데이터 : {main>name}" />
    <Text text="VBox안에 데이터 : {main>street}" />
    <Text text="VBox안에 데이터 : {main>city}" />
    <Text text="VBox안에 데이터 : {main>state}" />
</VBox>
```
</br>
</br>

### onSelectionChange
- `sap.m.Table`에서 사용자가 행(Row)을 선택할 때 실행되는 이벤트
```java
onSelectionChange: function(oEvent) {
    // 이벤트 처리 로직
}
```
</br>

### getSource()
- 이벤트를 발생시킨 컨트롤 객체를 반환
```java
let oTable = oEvent.getSource(); // 클릭한 테이블 객체
```
</br>

### getParameters()
- 이벤트 객체에 담긴 파라미터 정보 반환. Row 선택 이벤트에서는 선택된 항목, 인덱스 등이 포함됨.
```java
let oParams = oEvent.getParameters();
let oSelectedItem = oParams.listItem; // 선택된 Row
```
</br>

### getBindingContext()
- 컨트롤 또는 Row가 참조하는 모델과 경로를 반환
```java
let oBindingContext = oSelectedItem.getBindingContext("customer");
```
</br>

### setBindingContext()
- 컨트롤에 특정 모델의 컨텍스트를 바인딩. 다른 테이블, Form 등에서 데이터 표시할 때 사용
```java
oControl.setBindingContext(oBindingContext, "모델명")/;
```
```java
this.byId("idBookings").setBindingContext(oBindingContext, "customer");
```
</br>

### getPath()
- 바인딩 컨텍스트(BindingContext)가 참조하는 모델 내 경로(Path)를 반환
```java
let sPath = oBindingContext.getPath();
```
</br>

- 사용자가 sap.m.Table에서 행(Row)을 클릭했을 때 자동으로 호출되는 이벤트 함수
- 고객을 선택하면 그 고객의 _Bookings 데이터가 아래 테이블에 자동 표시됨
```java
onSelectionChange: function(oEvent) {
    // 이벤트 함수는 이벤트 객체가 파라미터로 들어온다
    // 이벤트 객체는 이벤트마다 다르다
    // .getSource : 이벤트를 일으킨 객체
    // .getParameters : 이벤트에 들어있는 파라미터 정보 (요게 다름)
    let oBindingContext = oEvent.getParameters().listItem.getBindingContext("customer");
    let sPath = oBindingContext.getPath();  // 현재 선택한 Item의 모델 경로

    this.byId("idBookings").setBindingContext(oBindingContext, "customer");
}
```
</br>

### formatter (포매터 함수)
- 바인딩 값이 화면에 표시되기 전에 데이터를 변환할 때 사용
```java
<Text text="{path: '모델명>속성', formatter: '.포매터함수명'}" />
```
- view.xml 파일
```java
<Text text="{
    path: 'customer>Age',
    formatter: '.fnFormatter'
}" />
```
- controller.js 파일
```java
fnFormatter: function(sValue) {
    let result;
    // formatter 사용시 if문으로 value가 있는 경우를 체크하여
    // 처리하는게 좋다. value 값만 들어오는게 아니기 때문
    if(sValue) {    
        let oModel = this.getView().getModel("customer");

        if(sValue >= 20) result = "성인";
        else if(sValue >= 17) result = "중학생";
        else if(sValue >= 14) result = "초등학생";
        else if(sValue >= 8) result = "초등학생";
        else result = "아동";
        return result;
    }
}
```
</br>

### < 실습 1 >
```java
onPress: function(oEvent) {
    let oRow = oEvent.getSource().getParent();
    let oBindingContext = oRow.getBindingContext("customer");
    let sPath = oBindingContext.getPath();

    let oModel = this.getView().getModel("customer");
    let oData = oModel.getProperty(sPath);
    let phone_num = oData.PhoneNumber;
    sap.m.MessageToast.show(phone_num);
}
```
