## < Table Join 방법 >
### 1) Database View 이용
- DB 레벨에서 여러 테이블을 미리 조인하여 가상 테이블(View) 생성
- 재사용 가능, SQL 최적화, 코드 간결
- 조건 변경에는 유연하지 않음
```abap
SELECT <필드1> <필드2> ...
  FROM <DatabaseView>
  WHERE <조건>.
```
```
SELECT carrid connid carrname      
  FROM zabc        " zabc는 이미 여러 테이블을 조인해 만든 Database View
  WHERE carrid = 'LH'.
```
</br>

### 2) 프로그램에서 직접 조인
- ABAP 프로그램 안에서 SELECT문에서 직접 JOIN 수행
- 조건을 동적으로 처리 가능, 유연성 높음
- 코드 길어지고, DB 최적화는 View보다 어려움
</br>

- `INNER JOIN` : 두 테이블 모두에 있는 데이터만 반환 (교집합)
- `LEFT OUTER JOIN` : 왼쪽 테이블 기준, 오른쪽 테이블 없으면 NULL 포함
- `RIGHT OUTER JOIN` : 오른쪽 테이블 기준, 왼쪽 테이블 없으면 NULL 포함
</br>

- `-` : 내부 테이블(워크 에어리어) 또는 구조 필드 접근용
- `~` : DB 테이블이나 뷰 필드 접근용 (SELECT, JOIN, WHERE 등)
```abap
SELECT <테이블1~필드>, <테이블2~필드>
  INTO TABLE <내테이블>
  FROM <테이블1>
  INNER JOIN <테이블2>
  ON <테이블1~키> = <테이블2~키>
  WHERE <조건>.
```
```abap
SELECT SCARR~CARRID
       SPFLI~CONNID
       SCARR~CARRNAME
       SPFLI~CITYFROM
  INTO TABLE lt_flight
  FROM SCARR as A INNER JOIN SPFLI as B
    ON SCARR~CARRID = SPFLI~CARRID      " spfli와 scarr 모두 존재하는 carrid만 결과에 포함
  WHERE SCARR~CARRID = 'AA'.

  IF sy-subrc = 0.
    cl_demo_output=>display( lt_flight ).
  ENDIF.
```
```abap
TYPES: BEGIN OF ts_data,
        CARRID TYPE SCARR-CARRID,
        CONNID TYPE SFLIGHT-CONNID,
        FLDATE TYPE SFLIGHT-FLDATE,
       END OF ts_data.

DATA: gs_data TYPE ts_data,
      gt_data TYPE TABLE OF ts_data.

SELECT C~CARRID F~CONNID F~FLDATE
  INTO TABLE gt_data
  FROM SCARR AS C INNER JOIN SFLIGHT AS F
    ON C~CARRID = F~CARRID
  WHERE C~CARRID = 'AA'.

  IF sy-subrc = 0.
    cl_demo_output=>display( gt_data ).
  ENDIF.
```
</br>
</br>

---

</br>

## < AUTHORITY-CHECK (SU21) >
</br>

- 사용자가 특정 권한을 가지고 있는지 확인하는 ABAP 구문
- Role 부여: 특정 사용자에게 역할(Role)을 부여하면 해당 권한 획득
- 권한 객체(Object) + 필드(ID) + 액티비티(ACTVT) 기반으로 체크
- ACTVT(Activity): 수행 가능한 작업 지정
  - `01` = Create
  - `02` = Change
  - `03` = Display
- AUTHORITY-CHECK: ABAP에서 사용자 권한을 확인하는 구문
  - 성공 여부는 sy-subrc로 판단 (0 = 권한 있음, <>0 = 권한 없음)
```abap
AUTHORITY-CHECK OBJECT '<권한객체>'
  ID '<필드1>' FIELD <값1>
  ID '<필드2>' FIELD <값2>
  ...
IF sy-subrc = 0.
  " 권한 있음 처리
ELSE.
  " 권한 없음 처리
ENDIF.
```
```abap
AUTHORITY-CHECK OBJECT 'S_CARRID'
  ID 'CARRID' FIELD iv_carrid
  ID 'ACTVT' FIELD '03'.  " Display 권한 체크

IF sy-subrc = 0.
  " 권한 있음 → 데이터 조회
  SELECT * FROM spfli WHERE carrid = iv_carrid.
ELSE.
  " 권한 없음 → 메시지 처리
  MESSAGE '권한이 없습니다.' TYPE 'E'.
ENDIF.
```
</br>
</br>

---

</br>

## < ABAP EVENT >
- 프로그램 실행 시점에 자동 호출되는 코드 블록
- 주요 이벤트
  - **INITIALIZATION**
    - 프로그램 시작 시 실행
    - 화면이나 변수의 초기값 설정
  - **AT SELECTION-SCREEN**
    - 사용자가 셀렉션 스크린에 입력한 값 처리
    - 입력값 검증이나 추가 처리 수행
  - **START-OF-SELECTION**
    - SAP에서 사전 정의된 이벤트
    - 프로그램 실행 시 자동 호출
    - 메인 처리 로직 수행 (데이터 조회, 주요 작업)
- 주의 및 특징
  - 동일 이벤트 중복 선언 불가
  - 모든 이벤트 작성 필요 없음 (필요한 것만 사용)
  - 이벤트 순서와 상관없이 호출 시점에 따라 실행됨
```abap
REPORT z_event_example.

" 초기값 설정
INITIALIZATION.
  gv_title = '항공편 조회 프로그램'.

" 셀렉션 스크린 입력값 검증
PARAMETERS: p_carrid TYPE spfli-carrid.

AT SELECTION-SCREEN.
  IF p_carrid IS INITIAL.
    MESSAGE '항공사를 입력하세요.' TYPE 'E'.
  ENDIF.

" 메인 처리 로직
START-OF-SELECTION.
  SELECT * FROM spfli
    WHERE carrid = p_carrid
    INTO TABLE @DATA(lt_spfli).

  LOOP AT lt_spfli INTO DATA(ls_spfli).
    WRITE: / ls_spfli-carrid, ls_spfli-connid, ls_spfli-cityfrom, ls_spfli-cityto.
  ENDLOOP.
```
</br>
</br>

---

</br>


</br>

## < ABAP 추가 문법 >
</br>

**1) APPENDING**
- SELECT 결과를 기존 내부 테이블 뒤에 이어서 추가
- 기존 데이터는 그대로 유지
- 필드명이 같은 컬럼끼리 자동 매칭
- 구문 비교:
  - `INTO TABLE itab` → 내부테이블 기존 내용 삭제 후 새 데이터
  - `APPENDING CORRESPONDING FIELDS OF TABLE itab` → 기존 데이터 유지 후 추가
```abap
SELECT <필드1> <필드2> ...
  FROM <테이블>
  APPENDING CORRESPONDING FIELDS OF TABLE <itab>  " `INTO` 대신 `APPENDING` 넣기
  WHERE <조건>.
```
</br>
</br>

**2) CLIENT SPECIFIED**
- SAP ABAP에서 일반적으로 SELECT는 현재 클라이언트(sy-mandt) 기준으로만 데이터 조회.
- CLIENT SPECIFIED를 사용하면 MANDT 값을 직접 지정하여 다른 클라이언트 데이터도 조회 가능.
- 주의: 잘못 사용하면 보안/데이터 일관성 문제 발생 가능.
```abap
SELECT fields
  INTO <TABLE|STRUCTURE>
  FROM dbtable
  CLIENT SPECIFIED
  WHERE mandt = '값'.
```
```abap
DATA: lt_scarr TYPE TABLE OF SCARR.

SELECT *
  INTO CORRESPONDING FIELDS OF TABLE lt_scarr
  FROM SCARR
  CLIENT SPECIFIED
  WHERE mandt BETWEEN '000' AND '800'.

IF sy-subrc = 0.
  cl_demo_output=>display( lt_scarr ).
ENDIF.
```

</br>
</br>

---

</br>

## < 실습 코드 >
</br>

### 실습 1
- Event 함수 실습
```abap
DATA: gt_flight TYPE TABLE OF SFLIGHT,
      gs_flight LIKE LINE OF gt_flight.

SELECT-OPTIONS: so_con FOR gs_flight-connid.
PARAMETERS: pa_car TYPE sflight-carrid,
            pa_chk TYPE CHAR01 AS CHECKBOX DEFAULT 'X'.

INITIALIZATION.
  pa_car = 'LH'.
  so_con-SIGN = 'I'.
  so_con-OPTION = 'EQ'.
  so_con-LOW = '0400'.
  so_con-HIGH = '0402'.
  APPEND so_con. " 원래 APPEND SO_CON TO SO_SON 처럼
                 " TO~부분이 있어야 하지만, Select-options는
                 " Header Line 있는 itab 이므로 생략
  CLEAR so_con.  " Header(Structure)만 클리어

  so_con-SIGN = 'E'.
  so_con-OPTION = 'EQ'.
  so_con-LOW = '0400'.
  APPEND so_con.
  CLEAR so_con.

AT SELECTION-SCREEN.
  IF pa_chk = 'X' AND pa_car IS INITIAL.
    MESSAGE 'carrid를 입력하세요~~~~' TYPE 'E'.
  ENDIF.

START-OF-SELECTION.
  SELECT *
    FROM SFLIGHT
    INTO CORRESPONDING FIELDS OF TABLE gt_flight
    WHERE CARRID = PA_CAR
      AND CONNID IN SO_CON.

  IF sy-subrc = 0.
    cl_demo_output=>display( gt_flight ).
  ENDIF.
```
</br>
</br>

### 실습 2
```abap
PARAMETERS: pa_car TYPE S_CARR_ID.
DATA: gt_data TYPE BC400_T_CONNECTIONS.

AT SELECTION-SCREEN.
  IF pa_car IS INITIAL.
    MESSAGE 'pa_car가 입력되지 않았습니다.' TYPE 'E'.
  ENDIF.

START-OF-SELECTION.
  CALL FUNCTION 'ZGET_CONNECT03'
    EXPORTING
      iv_carrid = pa_car
    IMPORTING
      ET_CONNECT = gt_data
    EXCEPTIONS
      NO_DATA   = 1
      OTHERS    = 2.

  IF sy-subrc <> 0.
    MESSAGE 'No Data error!' TYPE 'E'.
  ELSE.
    cl_demo_output=>display( gt_data ).
  ENDIF.
```
