# Internal Table 정리
</br>

**1) MOVE-CORRESPONDING**
- 동일한 이름을 가진 필드끼리 자동으로 값 복사
- 워크에어리어나 내부 테이블 행 단위로 사용 가능
```abap
MOVE-CORRESPONDING <source> TO <target>.
```
</br>
</br>

**2) SORT**
- 내부 테이블의 데이터를 지정 필드 기준으로 정렬
- Standard Table 기준, Sorted/Hashed Table에서는 일부 옵션 불가
```abap
SORT <itab>.                                " Table의 키 필드 기준 오름차순
SORT <itab> BY <field>.                     " 특정 필드 기준 오름차순(생략 시 기본)
SORT <itab> BY <field1> DESCENDING
               <field2> ASCENDING.            " field1 내림차순, field2 오름차순(생략 시 기본)
SORT <itab> BY <field1> <field2> DESCENDING. `" field1 오름차순(생략 시 기본), field2 내림차순
```
```abap
DATA: gt_flight TYPE TABLE OF flight.

" 기본 키 기준 정렬
SORT gt_flight.

" 단일 필드 기준 정렬
SORT gt_flight BY carrid.

" 다중 필드 정렬
SORT gt_flight BY carrid DESCENDING connid ASCENDING.
SORT gt_flight BY carrid connid DESCENDING.
```
</br>
</br>

**3) WITH HEADER LINE**
- 내부 테이블 안에 자동으로 한 줄(row)을 나타내는 구조를 생성
- 테이블 이름과 동일한 구조가 만들어져 별도 워크에어리어 없이 한 줄 데이터를 바로 사용 가능
  - `itab[]` → 테이블 전체
  - `itab` → 테이블의 헤더라인(한 줄)
```abap
DATA: <itab> TYPE TABLE OF <structure> WITH HEADER LINE.
```
```abap
DATA: gt_flight TYPE TABLE OF flight WITH HEADER LINE.

" 헤더라인 사용 예시
gt_flight-carrid = 'AA'.
APPEND gt_flight.
```
</br>
</br>

**4) REFRESH**
- 내부 테이블 내용 초기화
- 테이블이 존재하면 바디(데이터: `itab[]`)만 삭제, 구조와 타입은 유지
- 테이블이 없으면 생성 후 초기화
```abap
REFRESH <itab>.
```
```abap
DATA: gt_flight TYPE TABLE OF flight.

" 내부 테이블 내용 삭제
REFRESH gt_flight.
```
</br>
</br>

**5) CLEAR**
- 변수/워크에어리어를 초기화
- 숫자는 0, 문자형은 공백, 구조는 내부 필드별 초기화
- 단일 필드 또는 전체 구조 초기화 가능
```abap
CLEAR <variable>.
```
```abap
DATA: ls_flight TYPE flight.

CLEAR ls_flight.
" 모든 필드 0/공백으로 초기화
```
</br>
</br>

**6) FREE**
- 내부 테이블의 메모리까지 완전히 해제
- REFRESH와 달리 테이블 자체 메모리 공간도 반환
```abap
FREE <itab>.
```
```abap
DATA: gt_flight TYPE TABLE OF flight.

FREE gt_flight.
" 내부 테이블 삭제 + 메모리 해제
```
</br>
</br>

---

</br>

## < 실습 코드 >

### 실습 1
- LOOP AT 반복문과 MODIFY를 이용하여 결과 출력
```abap
DATA: gs_data TYPE bc400_s_flight,
      gt_data TYPE TABLE OF bc400_s_flight.

SELECT carrid connid fldate seatsmax seatsocc
  FROM sflight
  INTO TABLE gt_data
  WHERE carrid = 'AA'.

" 1) 만약 sy-subrc가 0 이라면
" gt_data를 LOOP 돌면서 Percentage 계산하여 MODIFY를 이용해 반영한다.
" 계산식 : percentage = seatsocc * 100 / seatmax

IF ( sy-subrc = 0 ).
  LOOP AT gt_data INTO gs_data.
    gs_data-percentage = gs_data-seatsocc * 100 / gs_data-seatsmax.
    MODIFY gt_data FROM gs_data.
  ENDLOOP.
ENDIF.

" 2) percentage 반영된 itab을 LOOP 돌면서,
"    percentage 가 80을 초과하는 레코드만 출력한다. (출력필드는 전체필드 기준)

LOOP AT gt_data INTO gs_data WHERE percentage > 80.
  WRITE:/ gs_data-carrid,
          gs_data-connid,
          gs_data-fldate,
          gs_data-seatsmax,
          gs_data-seatsocc,
          gs_data-percentage.
ENDLOOP.
```

