# < Table Join 방법 >
## 1) DDIC(Database) View를 활용
- DB 레벨에서 여러 테이블을 미리 조인하여 가상 테이블(View) 생성
- 재사용 가능, SQL 최적화, 코드 간결
- 조건 변경에는 유연하지 않음

```abap
SELECT <필드1> <필드2> ...
  FROM <DatabaseView>
  WHERE <조건>.
```
```
SELECT carrid connid carrname      
  FROM zabc        " zabc는 이미 여러 테이블을 조인해 만든 Database View
  WHERE carrid = 'LH'.
```
</br>
</br>
</br>

### 1-1) Database View
- 여러 테이블 조인 가능
- WHERE 절 설정 가능 (Selection Condition)
- JOIN 종류: 무조건 `INNER JOIN`
- ABAP 프로그램에서 TYPE과 SELECT 모두 사용 가능
</br>
</br>

**예제 1**
- `Table/Join Conditions` 에서 IN 조건에 넣을 필드와 테이블 선택

<img width="495" height="234" alt="image" src="https://github.com/user-attachments/assets/5db6f42c-bdab-4ec5-bb9b-10ea1c18cdc6" />

</br>
</br>

- `View Fields` 에서 `Table fields` 눌러서 출력할 필드 선택

<img width="494" height="238" alt="image" src="https://github.com/user-attachments/assets/74c7d487-5ea1-4f47-801a-1b8e3f3b9fa0" />

</br>
</br>

- `Selection Conditions` 에서 where 조건 달기
- operator(EQ, NQ) 와 AND/OR 조건 달기

<img width="494" height="146" alt="image" src="https://github.com/user-attachments/assets/174e9455-6f28-4f5a-8ed5-fed56f11bd6f" />


</br>
</br>
</br>
</br>
</br>

**예제 2**
- `Table/Join Conditions` 에서 `Relationships` 눌러서 출력할 테이블 선택

<img width="498" height="292" alt="image" src="https://github.com/user-attachments/assets/2322d3fe-31f2-4096-b1de-fe1ea0382ae2" />

</br>
</br>

<img width="485" height="358" alt="image" src="https://github.com/user-attachments/assets/32ead43f-85cb-4bc0-b492-0664b9c5b5fe" />

</br>
</br>

- `View Fields` 에서 `Table fields` 눌러서 출력할 필드 선택

<img width="489" height="296" alt="image" src="https://github.com/user-attachments/assets/d2e884ab-e5b1-4342-ab4f-e345dfacc6b9" />

</br>
</br>

<img width="547" height="194" alt="image" src="https://github.com/user-attachments/assets/2846f5ba-bd2f-40fb-bbc0-30a860f7e13b" />

</br>
</br>

- `Selection Conditions` 에서 where 조건 달기
- operator(EQ, NQ) 와 AND/OR 조건 달기

<img width="488" height="173" alt="image" src="https://github.com/user-attachments/assets/449f2abb-705c-427b-a2b6-6d7e5f291384" />

</br>
</br>
</br>
</br>
</br>
</br>

**예제 3**
- `Table/Join Conditions` 에서 `Relationships` 눌러서 출력할 테이블 선택

<img width="509" height="183" alt="image" src="https://github.com/user-attachments/assets/12d9f3e0-6209-4e93-b3b5-39ac47dd2b39" />

</br>
</br>

- `View Fields` 에서 출력할 필드 선택
- `*` : 테이블의 모든 필드 자동 포함
- `- 필드명` : 특정 필드만 제외

<img width="579" height="224" alt="image" src="https://github.com/user-attachments/assets/c313c351-59dc-416b-849a-0a885c1c1a0c" />

</br>
</br>

- `Selection Conditions` 에서 where 조건 달기
- operator(EQ, NQ) 와 AND/OR 조건 달기

<img width="488" height="173" alt="image" src="https://github.com/user-attachments/assets/449f2abb-705c-427b-a2b6-6d7e5f291384" />

</br>
</br>
</br>
</br>
</br>
</br>


### 1-2) Projection View
- 하나의 테이블에서 특정 필드만 추출 → Projection
- JOIN 없음
- ABAP 프로그램에서 TYPE/SELECT 모두 사용 가능
</br>
</br>

**예제**
- `SE11`에서 view 선택 후 생성
  
<img width="423" height="283" alt="image" src="https://github.com/user-attachments/assets/eaed92d0-3775-457e-bd89-ed2df2e600b6" />
</br>
</br>

<img width="311" height="240" alt="image" src="https://github.com/user-attachments/assets/b93f7a4d-85e3-4bd0-ae65-67242bc1c841" />
</br>
</br>

- 출력할 필드 선택
<img width="491" height="229" alt="image" src="https://github.com/user-attachments/assets/db775d5b-607c-4cf4-8629-d75f18a5e721" />

</br>
</br>
</br>
</br>

 ### 1-3) Maintenance View
- 여러 테이블을 묶어서 한 화면에서 CRUD 가능
- JOIN 방식: 무조건 `LEFT OUTER JOIN`
- ABAP 프로그램에서 SELECT 불가 (테이블 유지 용도)

</br>
</br>

**예제 1**
- `Maint.Status` 에서 Access 조건 선택
  
<img width="629" height="388" alt="image" src="https://github.com/user-attachments/assets/ca869525-3a12-4602-8685-0999e7ba9df8" />

</br>
</br>

- `View Fields` 에서 `Table fields` 눌러서 출력할 필드 선택

<img width="494" height="238" alt="image" src="https://github.com/user-attachments/assets/74c7d487-5ea1-4f47-801a-1b8e3f3b9fa0" />

</br>
</br>

- `Selection Conditions` 에서 where 조건 달기
- operator(EQ, NQ) 와 AND/OR 조건 달기

<img width="494" height="146" alt="image" src="https://github.com/user-attachments/assets/174e9455-6f28-4f5a-8ed5-fed56f11bd6f" />


</br>
</br>
</br>
</br>
</br>

**예제 2**
- `Table/Join Conditions` 에서 `Relationships` 눌러서 출력할 테이블 선택

<img width="498" height="292" alt="image" src="https://github.com/user-attachments/assets/2322d3fe-31f2-4096-b1de-fe1ea0382ae2" />

</br>
</br>

<img width="485" height="358" alt="image" src="https://github.com/user-attachments/assets/32ead43f-85cb-4bc0-b492-0664b9c5b5fe" />

</br>
</br>

- `View Fields` 에서 `Table fields` 눌러서 출력할 필드 선택

<img width="489" height="296" alt="image" src="https://github.com/user-attachments/assets/d2e884ab-e5b1-4342-ab4f-e345dfacc6b9" />

</br>
</br>

<img width="547" height="194" alt="image" src="https://github.com/user-attachments/assets/2846f5ba-bd2f-40fb-bbc0-30a860f7e13b" />

</br>
</br>
</br>
</br>
</br>
</br>

### 1-4) Help View
- Search Help(F4 도움창)에서만 사용
- JOIN 방식: 무조건 LEFT OUTER JOIN
- 프로그램에서 SELECT로 사용 불가
</br>
</br>
</br>
</br>
</br>

## 2) 프로그램에서 직접 조인
- ABAP 프로그램 안에서 SELECT문에서 직접 JOIN 수행
- 조건을 동적으로 처리 가능, 유연성 높음
- 코드 길어지고, DB 최적화는 View보다 어려움
</br>

- `INNER JOIN` : 두 테이블 모두에 있는 데이터만 반환 (교집합)
- `LEFT OUTER JOIN` : 왼쪽 테이블 기준, 오른쪽 테이블 없으면 NULL 포함
</br>

- `-` : 필드 접근용 (JOIN 에서만 안씀)
- `~` : JOIN 사용 시에만 사용
```abap
SELECT <테이블1~필드>, <테이블2~필드>
  INTO TABLE <내테이블>
  FROM <테이블1>
  INNER JOIN <테이블2>
  ON <테이블1~키> = <테이블2~키>
  WHERE <조건>.
```
- `INNER JOIN` 예제
```abap
SELECT SCARR~CARRID
       SPFLI~CONNID
       SCARR~CARRNAME
       SPFLI~CITYFROM
  INTO TABLE lt_flight
  FROM SCARR as A INNER JOIN SPFLI as B
    ON SCARR~CARRID = SPFLI~CARRID      " spfli와 scarr 모두 존재하는 carrid만 결과에 포함
  WHERE SCARR~CARRID = 'AA'.

  IF sy-subrc = 0.
    cl_demo_output=>display( lt_flight ).
  ENDIF.
```
- `LEFT OUTER JOIN` 예제
```abap
DATA: BEGIN OF ls_flight,
        carrid   TYPE s_carr_id,
        connid   TYPE s_conn_id,
        carrname TYPE s_carrname,
        cityfrom TYPE s_from_cit,
      END OF ls_flight.
DATA: lt_flight LIKE TABLE OF ls_flight.

SELECT A~carrid B~connid A~carrname B~cityfrom
  INTO TABLE lt_flight
  FROM scarr AS A LEFT OUTER JOIN spfli AS B
    ON A~carrid = B~carrid
  WHERE A~carrid BETWEEN 'NG' AND 'UA'.

SORT lt_flight BY carrid.

IF sy-subrc = 0.
  LOOP AT lt_flight INTO ls_flight.
    WRITE:/ ls_flight-carrid,
            ls_flight-connid,
            ls_flight-carrname,
            ls_flight-cityfrom.
  ENDLOOP.
ENDIF.
```
</br>
</br>

---

</br>

## < 실습 코드 >
