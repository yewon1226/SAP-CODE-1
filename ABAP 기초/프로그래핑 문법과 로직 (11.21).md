## < Internal Table (화면 출력/데이터 처리용 메모리 테이블) >
- 내부 테이블은 프로그램 안에서 임시로 데이터를 저장·처리하는 메모리상의 테이블
- 일반 테이블은 DB에 실제로 저장되어 여러 사용자와 프로그램이 공유하는 영구 테이블
</br>

**1) Line Type**
- 내부 테이블 한 줄(Row)의 구조
- Structure 또는 Dictionary 테이블 구조를 기반으로 함
- 예: `TABLE OF ty_user` → `ty_user`가 line type
</br>

**2) Primary Key**
- key = 내부 테이블에서 검색/행 식별에 사용되는 기준 필드
  - `components` → 어떤 필드들이 키인지
  - `uniqueness` → 중복 허용 여부 (UNIQUE / NON-UNIQUE)
  - `sequence` → 정렬 여부 (Sorted 테이블에서만 의미 있음)
</br>

**3) Table Kind**
- 내부 테이블의 정렬 방식, 중복 가능 여부, 검색 성능을 결정
- 종류:
  - Standard Table (Index Table)
  - Sorted Table
  - Hashed Table
</br>
</br>

**< ABAP Internal Table 비교 >**

| 구분 | STANDARD TABLE | SORTED TABLE | HASHED TABLE |
|------|----------------|--------------|--------------|
| **Table Kind** | Standard Table | Sorted Table | Hashed Table |
| **Index Access** | ✔ 가능 | ✔ 가능 | ❌ 불가능 |
| **Key Access** | ✔ 가능 | ✔ 가능 | ✔ 가능 |
| **Key Uniqueness** | NON-UNIQUE (중복 허용) | UNIQUE / NON-UNIQUE (중복 허용/불가 둘 다 가능) | UNIQUE (중복 불가) |
| **Use In** | Mainly Index Access (주로 인덱스 접근) | Mainly Key Access (주로 키 기반 검색) | Only Key Access (키 기반 초고속 검색 전용) |

</br>
</br>

## < Internal Table 선언 3가지 방식 >
</br>

**1) Table Type 기반**
- 이미 정의된 Table Type을 사용하여 Internal Table 선언
- Table Type에 Line Type, Table Kind, Key 등이 미리 정의되어 있어 코드가 간결
```abap
DATA <internal_table_name> TYPE <table_type>.
```
```abap
DATA gt_flights TYPE BC400_T_FLIGHTS.
DATA gt_flights TYPE tt_flights.
```
</br>

**2) Table Kind + Key 직접 정의**
- Table Type 없이 Internal Table 종류(Standard/Sorted/Hashed)와 Key를 직접 지정
- Table Type 없이 바로 선언 가능, Key 조건도 자유롭게 지정
```abap
DATA <internal_table_name> TYPE <table_kind> TABLE OF <structure_type>
     WITH [UNIQUE | NON-UNIQUE] KEY <field1> <field2> ... .
```
```abap
DATA gt_iteb1 TYPE STANDARD TABLE OF BC400_S_FLIGHT WITH DEFAULT KEY.
DATA gt_item2 TYPE STANDARD TABLE OF BC400_S_FLIGHT WITH NON-UNIQUE KEY CARRID CONNID.
DATA gt_item4 TYPE SORTED TABLE OF BC400_S_FLIGHT WITH NON-UNIQUE KEY CARRID CONNID.
DATA get_item6 TYPE HASHED TABLE OF BC400_S_FLIGHT WITH UNIQUE KEY CARRID CONNID.
```
</br>

**3) 단순 Table of Structure**
- Key를 지정하지 않고 단순히 Table of Structure 선언
- 간단하게 선언 가능, Standard Table 기본
```abap
DATA <internal_table_name> TYPE TABLE OF <structure_type>.
```
```abap
DATA gt_flight2 TYPE TABLE OF BC400_S_FLIGHT.
DATA gt_flight3 TYPE TABLE OF SCARR.
DATA gt_item3 TYPE TABLE OF BC400_S_FLIGHT.
```
</br>
</br>
</br>

## < ABAP Internal Table 및 Structure 선언과 사용 예제 >
</br>

**1) Internal Table 선언 (Table Type / Structure 기반)**
- `gt_flight` : 이미 정의된 Table Type을 기반으로 Internal Table 생성.
- `gt_flight2` : Global Structure를 기반으로 Internal Table 생성.
- `gt_flight3` : DB Transparent Table 구조를 그대로 Internal Table로 선언.
- `gt_flight4` : 기존 Table gt_flight3의 구조와 동일하게 선언(LIKE 사용).
```abap
DATA: gt_flight TYPE BC400_T_FLIGHTS,   " Table type 사용
      gt_flight2 TYPE TABLE OF BC400_S_FLIGHT,   " Global structure 사용
      gt_flight3 TYPE TABLE OF SCARR, " DB Table (Transparent table) 사용
      gt_flight4 LIKE gt_flight3. " LIKE 사용해서 Internal Table 사용
```
</br>

**2) Standard Internal Table 선언**
- `gt_iteb1` : 기본 키를 가지는 표준 Internal Table.
- `gt_item2` : 지정한 필드(CARRID, CONNID)를 기준으로 비유니크 키를 가지는 표준 Internal Table.
- `gt_item3` : 키를 명시하지 않은 표준 Internal Table.
```abap
" Standard internal table
DATA: gt_iteb1 TYPE STANDARD TABLE OF BC400_S_FLIGHT
               WITH DEFAULT KEY,
      gt_item2 TYPE STANDARD TABLE OF BC400_S_FLIGHT
               WITH NON-UNIQUE KEY CARRID CONNID,
      gt_item3 TYPE TABLE OF BC400_S_FLIGHT.
```
</br>

**3) Sorted Internal Table 선언**
- `gt_item4` : 지정된 키 기준으로 항상 정렬되는 Internal Table, 중복 키 허용.
- `gt_itab5` : 지정된 키 기준으로 정렬, 중복 키 불가.
```abap
" Sorted internal table
DATA: gt_item4 TYPE SORTED TABLE OF BC400_S_FLIGHT
               WITH NON-UNIQUE KEY CARRID CONNID, " key는 띄어쓰기로 구분
      gt_itab5 TYPE SORTED TABLE OF BC400_S_FLIGHT
               WITH UNIQUE KEY CARRID CONNID.
```
</br>

**4) Hashed Internal Table 선언**
- `get_item6` : Key 기반 Hash 구조를 사용, 빠른 검색 가능, 반드시 UNIQUE KEY 필요.
```abap
* Hashed internal table
DATA: get_item6 TYPE HASHED TABLE OF BC400_S_FLIGHT
                WITH UNIQUE KEY CARRID CONNID.
```
</br>

**5) Structure 변수 선언**
```abap
" Glocal structure type
DATA gs_flight TYPE BC400_S_FLIGHT.

" transparent table 가지고도 스트럭처 변수 생성 가능
DATA gs_flight2 TYPE SCARR.

" Table type의 Line type 정보로 스트럭처 변수 생성 가능
DATA gs_flight3 TYPE LINE OF BC400_T_FLIGHTS.

" 위에서 선언한 Internal table에서 Line type만 복사하여 생성
DATA gs_flight4 LIKE LINE OF gt_iteb1.
```
</br>

**6) 기타 Table/Structure 선언**
- `aa` : Table Type 기반 Internal Table.
- `bb` : Table Type의 Table 선언.
- `cc` : Table Type의 한 행(Line Type) 구조 변수.
- `dd` : bb Table 라인과 동일한 구조 변수(LIKE LINE OF).
- `ee` : 단일 Structure 변수.
- `ff` : dd와 같은 구조의 Internal Table(LIKE TABLE OF).
```abap
DATA: aa TYPE BC400_T_CONNECTIONS,
      " bb는 Table Type이 아니라 임시 테이블 선언이어서 LINE OF를 참조할 수 없음
      bb TYPE TABLE OF BC400_T_CONNECTIONS,    " bb TYPE aa 로 바꾸기
      cc TYPE LINE OF BC400_T_CONNECTIONS,
      dd LIKE LINE OF bb,
      ee TYPE S_CARR_ID,
      ff LIKE TABLE OF dd.
```
</br>
</br>
</br>

## < ABAP 인터널 테이블 CRUD 명령어 >
</br>

**1-1) APPEND – 인터널 테이블 끝에 값 추가**
- 인터널 테이블의 맨 끝에 데이터를 추가
- Standard Table 기준 → 삽입 순서 그대로 유지
```abap
APPEND <추가할_행> TO <인터널_테이블>.
APPEND VALUE #( <필드1> = <값1> <필드2> = <값2> … ) TO <인터널_테이블>.
```
```abap
DATA: flight TYPE BC400_S_FLIGHT,
      flights_table TYPE STANDARD TABLE OF BC400_S_FLIGHT.

flight-carrid = 'AA'.
flight-connid = '001'.

APPEND flight TO flights_table.
```
</br>

**1-2) APPEND LINES OF – 다른 테이블의 여러 행 끝에 추가**
- `<소스_테이블>`의 여러 행을 `<대상_테이블>` 끝에 추가
```abap
APPEND LINES OF <소스_테이블> [WHERE <조건>] TO <대상_테이블>.
```
```abap
APPEND LINES OF flights_table1 WHERE carrid = 'AA' TO flights_table2.
```
</br>
</br>
</br>

**2-1) INSERT – 특정 위치 또는 조건에 값 삽입**
- 조건 생략 → 맨 끝에 추가 (APPEND와 동일)
- 조건/인덱스 지정 가능 → 원하는 위치에 삽입
```abap
INSERT <추가할_행> INTO TABLE <인터널_테이블>.                " 조건 없으면 끝에 추가
INSERT <추가할_행> INTO TABLE <인터널_테이블> INDEX <위치>.   " 특정 위치에 삽입
INSERT LINES OF <다른_테이블> INTO TABLE <인터널_테이블>.
```
```abap
INSERT flight INTO TABLE flights_table INDEX 2.
INSERT flight INTO TABLE flights_table.  " 맨 끝
```
</br>

**2-2) INSERT LINES OF – 다른 테이블의 여러 행 삽입**
- `<소스_테이블>`의 여러 행을 `<대상_테이블>`에 삽입
```abap
INSERT LINES OF <소스_테이블> [WHERE <조건1>] INTO <대상_테이블> [INDEX <위치>] [FROM <조건2>].
```
```abap
INSERT LINES OF flights_table1 WHERE carrid = 'AA' INTO flights_table2.
```
</br>
</br>
</br>

**3) READ – 특정 조건/위치의 값 조회**
- 조건에 맞는 첫 번째 행을 가져옴
- 성공 → `sy-subrc` = 0, 실패 → `sy-subrc` <> 0
```abap
READ TABLE <인터널_테이블> INTO <행> 
     [WITH KEY <필드1> = <값1> <필드2> = <값2> …] 
     [INDEX <위치>] [BINARY SEARCH].
```
```abap
READ TABLE flights_table INTO flight WITH KEY carrid = 'AA' connid = '001'.
IF sy-subrc = 0.
  WRITE: / 'Flight found:', flight-carrid.
ENDIF.
```
</br>
</br>
</br>

**4) CHANGE – 기존 값 수정**
- 조건에 맞는 행을 덮어씀
- Standard Table 기준 → 조건에 맞는 여러 행이 있어도, 그 중에서 가장 먼저 나오는 한 행만 수정
- INDEX 지정 시 → 해당 위치 행만 변경
```abap
MODIFY TABLE <인터널_테이블> FROM <행>.
MODIFY TABLE <인터널_테이블> FROM <행> INDEX <위치>.
MODIFY TABLE <인터널_테이블> FROM <다른_테이블>.
```
```abap
flight-cityfrom = 'Seoul'.
MODIFY TABLE flights_table FROM flight.
```
</br>
</br>
</br>

**5) DELETE – 행 삭제**
- `INDEX` → 특정 위치 삭제
- `WHERE` → 조건에 맞는 행 삭제
- `FROM` → 구조체와 동일한 행 삭제
```abap
DELETE <인터널_테이블> INDEX <위치>.
DELETE <인터널_테이블> WHERE <필드1> = <값1> <필드2> = <값2> ….
DELETE <인터널_테이블> FROM <행>.
DELETE TABLE <인터널_테이블> WHERE <조건>.
```
```abap
DELETE flights_table WHERE carrid = 'AA'.
DELETE flights_table INDEX 1.
```
</br>
</br>
</br>

**6) LOOP AT – 테이블 반복 처리**
- 인터널 테이블의 모든 행 또는 조건에 맞는 행을 반복 처리
- `WHERE` 조건 생략 시 → 테이블 전체를 반복
```abap
LOOP AT <인터널_테이블> INTO <행> [WHERE <조건>].
  " 반복하면서 처리할 코드
ENDLOOP.
```
```abap
DATA: flight TYPE BC400_S_FLIGHT,
      flights_table TYPE STANDARD TABLE OF BC400_S_FLIGHT.

* 데이터 예시
* flight_table = [
*   {carrid='AA', connid='001'},
*   {carrid='BB', connid='002'},
*   {carrid='AA', connid='003'}
* ]

LOOP AT flights_table INTO flight WHERE carrid = 'AA'.
  WRITE: / flight-carrid, flight-connid.
ENDLOOP.
```

</br>
</br>
</br>

---

</br>

## < 실습 코드 >
- 실습 1
- global structure 생성하기
<img width="1520" height="660" alt="image" src="https://github.com/user-attachments/assets/d533af41-58cf-459f-a95e-12c8662a9c39" />
</br>

<img width="1556" height="668" alt="image" src="https://github.com/user-attachments/assets/44bebdb1-9117-4787-b7bd-0146e8df7f5d" />
</br>

```abap
DATA: gs_flight TYPE ZSCLB03_DEMO.

BREAK-POINT.
gs_flight-carrid = 'AA'.

WRITE:/ gs_flight-carrid.
```
