# SQL 활용
### SQL 활용 (1/5) : 연산자 및 함수 (1) 
</br>

### < 연산자 >
- 연산자는 비교, 논리, 특수, 산술, 집합연산자로 나뉨
<img width="457" height="356" alt="image" src="https://github.com/user-attachments/assets/b3b530b8-88b0-4006-ad62-7be23ada7939" />

<img width="991" height="461" alt="image" src="https://github.com/user-attachments/assets/b79a2260-dfb1-45be-93ce-515292b419af" />
</br>
</br>
</br>
</br>

### < 비교 연산자 >

### 1. = (같음)
- 특정 값과 같은 데이터를 조회할 때 사용
```sql
/* = : 같음 */
SELECT  *
  FROM  CUSTOMER
 WHERE  GENDER = 'MAN';
```

### 2. <> (같지 않음)
- 특정 값과 다른 데이터를 조회할 때 사용
```sql
/* <> : 같지 않음 */ 
SELECT  *
  FROM  CUSTOMER
 WHERE  GENDER <> 'MAN';
```

### 3. >= (크거나 같음)
- 기준 값 이상인 데이터를 조회할 때 사용
```sql
/* >= : ~보다 크거나 같음 */  
SELECT  *
  FROM  CUSTOMER
 WHERE  YEAR(JOIN_DATE) >= 2020;
```

### 4. <= (작거나 같음)
- 기준 값 이하인 데이터를 조회할 때 사용
```sql
/* <= : ~보다 작거나 같음 */  
SELECT  *
  FROM  CUSTOMER
 WHERE  YEAR(JOIN_DATE) <= 2019;
```

### 5. > (큼)
- 기준 값보다 큰 데이터를 조회할 때 사용
```sql
/* > : ~보다 큼 */  
SELECT  *
  FROM  CUSTOMER
 WHERE  YEAR(JOIN_DATE) > 2019;
```

### 6. < (작음)
- 기준 값보다 작은 데이터를 조회할 때 사용
```sql
/* < : ~보다 작음 */  
SELECT  *
  FROM  CUSTOMER
 WHERE  YEAR(JOIN_DATE) < 2020;
```
</br>
</br>

### < 논리 연산자 >

### 1. AND (그리고)
- 앞뒤 조건이 모두 참(TRUE) 일 때만 결과 반환
```sql
/* AND : 앞, 뒤 조건 모두 만족 */
SELECT  *
  FROM  CUSTOMER
 WHERE  GENDER = 'MAN'
   AND  ADDR = 'Gyeonggi';
```

### 2. NOT (부정)
- 뒤 조건을 반대로 해석
```sql
/* NOT : 뒤에 오는 조건과 반대 */ 
SELECT  *
  FROM  CUSTOMER
 WHERE  NOT GENDER = 'MAN'
   AND  ADDR = 'Gyeonggi';
```

### 3. OR (또는)
- 앞뒤 조건 중 하나라도 참(TRUE) 이면 결과 반환
```sql
/* OR : 하나라도 만족 */    
SELECT  *
  FROM  CUSTOMER
 WHERE  GENDER = 'MAN'
    OR  ADDR = 'Gyeonggi';
```
</br>
</br>

### < 특수 연산자 >

### 1. BETWEEN a AND b
- 값이 a 이상, b 이하 범위에 포함될 때 참
```sql
/* BETWEEN a AND b : a와 b의 값 사이 */
SELECT  *
  FROM  CUSTOMER
 WHERE  YEAR(BIRTHDAY) BETWEEN 2010 AND 2011;
```

### 2. NOT BETWEEN a AND b
- 값이 a ~ b 범위에 속하지 않는 경우
```sql
/* NOT BETWEEN a AND b : a와 b의 값 사이가 아님 */
SELECT  *
  FROM  CUSTOMER
 WHERE  YEAR(BIRTHDAY) NOT BETWEEN 1950 AND 2020;
```

### 3. IN (리스트)
- 여러 값 중 하나라도 일치하면 참
```sql
/* IN (List) : 리스트 값 */ 
SELECT  *
  FROM  CUSTOMER
 WHERE  YEAR(BIRTHDAY) IN (2010,2011);    // 생년이 2010년 또는 2011년인 고객 조회
```

### 4. NOT IN (리스트)
- 리스트 값에 포함되지 않음
```sql
/* NOT IN (List) : 리스트 값이 아님 */  
SELECT  *
  FROM  CUSTOMER
 WHERE  YEAR(BIRTHDAY) NOT IN (2010, 2011);    // 생년이 2010, 2011년이 아닌 고객 조회
```

### 5. LIKE (패턴 검색)
- % : 0글자 이상 모든 문자
- _ : 1글자 와일드카드
```sql
/* LIKE ‘비교문자열’ */   
SELECT  *
  FROM  CUSTOMER
 WHERE  ADDR LIKE 'D%'; /* ~로 시작하는 */

SELECT  *
  FROM  CUSTOMER
 WHERE  ADDR LIKE '%N'; /* ~로 끝나는 */
 
SELECT  *
  FROM  CUSTOMER
 WHERE  ADDR LIKE '%EO%'; /* ~를 포함하는 */
```

### 6. NOT LIKE
- 패턴과 일치하지 않는 값 찾기
```sql
/* NOT LIKE ‘비교문자열’ */   
SELECT  *
  FROM  CUSTOMER
 WHERE  ADDR NOT LIKE '%EO%'; /* ~를 제외하는 */
```

### 7. IS NULL
- 값이 NULL(없음) 인 경우
```sql
/* IS NULL : NULL */   
SELECT  *
  FROM  CUSTOMER AS A
  LEFT
  JOIN  SALES AS B
    ON  A.MEM_NO = B.MEM_NO
 WHERE  B.MEM_NO IS NULL;

/* 확인 */ 
SELECT  *
  FROM  SALES
 WHERE  MEM_NO = '1001736';    // B.MEM_NO IS NULL을 확인
```

### 8. IS NOT NULL
- 값이 NULL이 아닌 경우
```sql
/* IS NULL : NULL */   
SELECT  *
  FROM  CUSTOMER AS A
  LEFT
  JOIN  SALES AS B
    ON  A.MEM_NO = B.MEM_NO
 WHERE  B.MEM_NO IS NULL;
```
</br>
</br>

### < 산술 연산자 >

### 1. 곱셈 (*)
- 판매수량(SALES_QTY) × 단가(PRICE) 를 곱해서 결제금액 산출
```sql
/***************산술 연산자***************/
  
SELECT  *
		,A.SALES_QTY * PRICE AS 결제금액
  FROM  SALES AS A
  LEFT
  JOIN  PRODUCT AS B
    ON  A.PRODUCT_CODE = B.PRODUCT_CODE;
```
</br>
</br>
</br>

### < 집합연산자 – UNION, UNION ALL >
- UNION: 2개 이상 테이블의 중복된 행들을 제거하여 집합
- UNION ALL: 2개 이상 테이블의 중복된 행들을 제거 없이 집합 
* 열 개수와 데이터 타입 일치해야 함
<img width="587" height="326" alt="image" src="https://github.com/user-attachments/assets/cacbbf18-678c-4f94-9f4c-3fb7fd014a1b" />

<img width="940" height="407" alt="image" src="https://github.com/user-attachments/assets/f9e47630-fe4c-4388-9b4d-428c57799ede" />

</br>
</br>
</br>

### - 예제
```sql
 /***************집합 연산자***************/
 
CREATE TEMPORARY TABLE SALES_2019
SELECT  *
  FROM  SALES
 WHERE  YEAR(ORDER_DATE) = '2019';
 
/* 1235행 */
SELECT  *
  FROM  SALES_2019;

/* 3115행 */
SELECT  *
  FROM  SALES;

/* UNION : 2개 이상 테이블 중복된 행 제거 하여 집합(* 열 개수와 데이터 타입 일치) */
SELECT  *
  FROM  SALES_2019
UNION
SELECT  *
  FROM  SALES;

/* UNION ALL: 2개 이상 테이블 중복된 행 제거 없이 집합(* 열 개수와 데이터 타입 일치) */
SELECT 3115 + 1235;

SELECT  *
  FROM  SALES_2019
UNION ALL
SELECT  *
  FROM  SALES;
```
</br>
</br>

---

### SQL 활용 (2/5) : 연산자 및 함수 (2)
</br>

### < 함수 >
- 함수는 단일 및 복수 행 그리고 윈도우 함수로 나뉘며, 특정 규칙에 의해 새로운 결과값으로 반환하는 명령어
<img width="940" height="432" alt="image" src="https://github.com/user-attachments/assets/87b47b0c-5d34-4bf2-8109-0e452bf18c1f" />
</br>
</br>
</br>

### < 단일 행 함수 > 
- 단일 행 함수는 모든 행에 대하여 각각 함수가 적용되어 반환함
- 함수들을 중첩해서 사용 가능
<img width="940" height="208" alt="image" src="https://github.com/user-attachments/assets/174c46dd-0b21-4ea0-b442-066addc06af9" />

- 단일 행 함수는 숫자형, 문자형, 날짜형, 형변환, 일반함수로 나뉨
<img width="1012" height="431" alt="image" src="https://github.com/user-attachments/assets/c8d36f90-6a86-474f-99e2-1a15f7ba07cc" />
</br>
</br>
</br>
</br>

### < 숫자형 함수 >

### 1. ABS(숫자) : 절대값 반환
- 음수를 양수로 변환, 양수는 그대로 반환
```sql
/* ABS(숫자) : 절대값 반환 */
SELECT ABS(- 200);		// 결과 : 200
```

### 2. ROUND(숫자, N) : 반올림
- 소수점 N번째 자리에서 반올림
```sql
/* ROUND(숫자, N) : N 기준으로 반올림 값 반환 */
SELECT ROUND(2.18, 1);		// 결과 : 2.2
```

### 3. SQRT(숫자) : 제곱근
```sql
/* SQRT(숫자) : 제곱근 값 반환 */
SELECT SQRT(9);		// 결과 : 3
```
</br>
</br>

### < 문자형 함수 >

### 1. LOWER(문자) / UPPER(문자)
- LOWER: 모든 문자를 소문자로
- UPPER: 모든 문자를 대문자로
```sql
/* LOWER(문자) / UPPER(문자) : 소문자 / 대문자 반환 */
SELECT LOWER('AB');		// 결과 : ab
SELECT UPPER('ab');		// 결과 : AB
```

### 2. LEFT(문자, N) / RIGHT(문자, N)
- 문자열의 왼쪽/오른쪽에서 N개 문자 추출
```sql
/* LEFT(문자, N) / RIGHT(문자, N) : 왼쪽 / 오른쪽부터 N만큼 반환 */
SELECT LEFT('AB', 1); 		// 결과 : A
SELECT RIGHT('AB', 1);		// 결과 : B
```

### 3. LENGTH(문자)
- 문자열의 길이(문자 개수) 반환
```sql
/* LENGTH(문자) : 문자수 반환 */
SELECT LENGTH('AB');		// 결과 : 2
```
</br>
</br>

### < 날짜형 함수 >

### 1. YEAR(날짜) / MONTH(날짜) / DAY(날짜)
- 날짜에서 연/월/일을 분리해서 가져옴
```sql
/* YEAR / MONTH / DAY(날짜) : 연 / 월 / 일 반환 */
SELECT YEAR('2022-12-31');		// 결과 : 2022
SELECT MONTH('2022-12-31');		// 결과 : 12
SELECT DAY('2022-12-31');		// 결과 : 31
```

### 2. DATE_ADD(날짜, INTERVAL n 단위)
- 특정 날짜에 기간(일, 월, 년, 시, 분 등)을 더하거나 뺌
- INTERVAL 1 DAY → 하루 뒤
- INTERVAL -7 DAY → 7일 전
- INTERVAL 1 YEAR → 1년 뒤
```sql
/* DATE_ADD(날짜, INTERVAL) : INTERVAL만큼 더한 값 반환 */
SELECT DATE_ADD('2022-12-31', INTERVAL -1 MONTH);		// 결과 : 2022-11-30
```

### 3. DATEDIFF(날짜a, 날짜b)
- 두 날짜의 차이를 일(day) 단위로 반환
```sql
/* DATEDIFF(날짜a, 날짜b) : 날짜a – 날짜b 일수 반환 */
SELECT DATEDIFF('2022-12-31', '2022-12-1');		// 결과 : 30
```
</br>
</br>

### < 형변환 함수 >

### 1. DATE_FORMAT(날짜, 형식)
- 날짜 데이터를 원하는 출력 포맷으로 바꿔줌
- %Y : 4자리 연도 (2022)
- %y : 2자리 연도 (22)
- %m : 월(01~12)
- %M : 월 이름 (January, February …)
- %d : 일(01~31)
- %D : 서수(1st, 2nd, 3rd …)
```sql
/* DATE_FORMAT(날짜, 형식) : 날짜형식으로 변환 */
SELECT DATE_FORMAT('2022-12-31', '%m-%d-%y');		// 결과 : 12-31-22
SELECT DATE_FORMAT('2022-12-31', '%M-%D-%Y');		// 결과 : December-31st-2022
```

### 2. CAST(값 AS 형식)
- 데이터를 다른 데이터 타입으로 변환
- DATE : 날짜만 (YYYY-MM-DD)
- DATETIME : 날짜+시간
- CHAR(n) : 문자열
- SIGNED : 정수
- DECIMAL(m, n) : 소수 포함 숫자
```sql
/* CAST(형식a, 형식b) : 형식a를 형식b로 변환 */
SELECT CAST('2022-12-31 12:00:00' AS DATE);		// 결과 : 2022-12-31
```
</br>
</br>

### < 일반 함수 >

### 1. IFNULL(A, B)
- A 값이 NULL이면 B 반환, 그렇지 않으면 A 반환
```sql
/* IFNULL(A, B) : A가 NULL이면 B를 반환, 아니면 A 반환 */
SELECT IFNULL(NULL, 0);				// 결과 : 0
SELECT IFNULL('NULL이 아님', 0);		// 결과 : 'NULL이 아님'
```

### 2. CASE WHEN … THEN … ELSE … END
- 여러 조건을 만족하는 경우에 따라 다른 값을 반환
- IF문을 여러 번 쓰는 대신 깔끔하게 처리 가능
```sql
/* 
CASE WHEN [조건1] THEN [반환1]
 	 WHEN [조건2] THEN [반환2]
     ELSE [나머지] END
: 여러 조건별로 반환값 지정
*/
SELECT  *
		,CASE WHEN GENDER = 'MAN' THEN '남성'
              ELSE '여성' END
  FROM  CUSTOMER;
```
</br>
</br>

### < 함수 중첩 사용 >
- 하나의 함수 결과를 다시 다른 함수의 입력으로 사용할 수 있음
```sql
/***************함수 중첩 사용***************/
  
SELECT  *
		,YEAR(JOIN_DATE) AS 가입연도
        ,LENGTH( YEAR(JOIN_DATE) ) AS 가입연도_문자수
  FROM  CUSTOMER;
```
</br>
</br>
</br>

### < 복수 행 함수 >
- 복수 행 함수는 여러 행들이 하나의 결과값으로 반환
<img width="940" height="338" alt="image" src="https://github.com/user-attachments/assets/d9565c2f-1f81-4e7f-b64d-e3f7f4cc17b0" />

- 복수 행 함수는 집계, 그룹 함수로 나뉨
<img width="991" height="206" alt="image" src="https://github.com/user-attachments/assets/67f2445a-52f5-447b-9594-e87063ba95f4" />

- 복수 행 함수는 여러 행들이 하나의 결과 값으로 반환
- 주로 GROUP BY절과 함께 사용됨
</br>
</br>
</br>
</br>

### 1. 집계 함수
- COUNT(컬럼명) : 행 개수
- COUNT(DISTINCT 컬럼) : 중복 제거된 행 개수
- SUM(숫자컬럼) : 합계
- AVG(숫자컬럼) : 평균
- MAX(컬럼) : 최댓값
- MIN(컬럼) : 최솟값
```sql
SELECT  COUNT(ORDER_NO) AS 구매횟수 /* 행수 */
		,COUNT(DISTINCT MEM_NO) AS 구매자수 /* 중복제거된 행수  */
        ,SUM(SALES_QTY) AS 구매수량 /* 합계 */
        ,AVG(SALES_QTY) AS 평균구매수량 /* 평균 */
        ,MAX(ORDER_DATE) AS 최근구매일자 /* 최대 */
        ,MIN(ORDER_DATE) AS 최초구매일자 /* 최소 */
  FROM  SALES;
    
/* DISTINCT: 중복제거 */   
```

### 2. 그룹 함수
- GROUP BY는 데이터를 그룹별(묶음) 로 나누어 집계함
- WITH ROLLUP은 그룹화된 열들을 오른쪽에서 왼쪽 순으로 점점 합쳐가며 집계
```sql
/* WITH ROLLUP : GROUP BY 열들을 오른쪽에서 왼쪽순으로 그룹 (소계, 합계)*/
SELECT  YEAR(JOIN_DATE) AS 가입연도
		,ADDR
        ,COUNT(MEM_NO) AS 회원수
  FROM  CUSTOMER
 GROUP
    BY  YEAR(JOIN_DATE)
		,ADDR
WITH ROLLUP;
```

### 3. 집계 함수 + GROUP BY
- 회원별 총 구매 수량을 구하는 쿼리
```sql
SELECT  MEM_NO
        ,SUM(SALES_QTY) AS 구매수량
  FROM  SALES
 GROUP
    BY  MEM_NO;
    
/* 확인 */
SELECT  *
  FROM  SALES
 WHERE  MEM_NO = '1000970';
```
</br>
</br>
</br>

### < 윈도우 함수 >
- 윈도우 함수는 행과 행간의 관계를 정의하여 결과 값을 반환
<img width="940" height="369" alt="image" src="https://github.com/user-attachments/assets/d1d7b570-68e5-4a62-9e01-95ffcedb5980" />

- 윈도우 함수는 순위, 집계(누적) 함수로 나뉨
<img width="1004" height="261" alt="image" src="https://github.com/user-attachments/assets/77b754e3-b2f9-40ef-92d3-9002eb69ed02" />
</br>
</br>

- 윈도우 함수는 ORDER BY로 행과 행간의 순서를 정하며, PARTITION BY로 그룹화가 가능
</br>

<img width="720" height="348" alt="image" src="https://github.com/user-attachments/assets/ad982af6-0e69-4d63-a4e1-d5ad87f1c6d6" />
